(()=>{var t={321:(t,e,n)=>{var r,i;r=[n,e,n(3314)],i=function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;var r=function(){function t(){this.storage=null,this.abstractShapesFactory=null,this.conf={}}return t.prototype.setAppFactory=function(t){this.appFactory=t},t.prototype.getAppFactory=function(){return this.appFactory},t.prototype.init=function(t){this.conf={shapesFactory:null},this.appFactory.objectReplaceRecursive(this.conf,t)},t.prototype.getStorage=function(){return null===this.storage&&(this.storage=new n.Storage),this.storage},t.prototype.getAbstractShapesFactory=function(){return null===this.abstractShapesFactory&&(this.abstractShapesFactory=this.conf.shapesFactory,this.abstractShapesFactory.setStorageFactory(this)),this.abstractShapesFactory},t}();e.Factory=r}.apply(e,r),void 0===i||(t.exports=i)},485:(t,e,n)=>{var r;r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NavigationPanel=void 0;var n=function(){function t(){this.visible=!1}return t.prototype.setAppBus=function(t){this.appBus=t},t.prototype.init=function(t){this.container=t,this.listContainer=this.container.querySelector(".js-list-container")},t.prototype.toggleVisible=function(){this.visible=!this.visible,this.visible?this.container.style.display="flex":this.container.style.display="none"},t.prototype.loadNotes=function(t){this.notesData=t},t.prototype.load=function(t){var e=this;this.data=t,this.data.forEach((function(n){t.some((function(t){return t.links.some((function(t){return t.to===n.id}))}))||e.createHierarchy(e.listContainer,n)}))},t.prototype.clear=function(){this.listContainer.innerHTML="",this.data={}},t.prototype.findNodeById=function(t){return this.data.find((function(e){return e.id===t}))},t.prototype.createHierarchy=function(t,e){var n=this,r=this.createTagElement();if(r.load(e),e.links.length>0){var i=r.getChildsContainer();e.links.forEach((function(t){if(t.to!=t.from){var e=n.findNodeById(t.to);e&&n.createHierarchy(i,e)}}))}var o=this.notesData.filter((function(t){return!!t.tags&&t.tags.some((function(t){return t.id===e.id}))}));if(o.length>0){var a=r.getChildsContainer();o.forEach((function(t){var e=n.createNoteElement();e.load(t),a.appendChild(e.getTemplate()),e.eventsListen()}))}t.appendChild(r.getTemplate()),r.eventsListen()},t.prototype.createTagElement=function(){var t=new r;return t.setAppBus(this.appBus),t},t.prototype.createNoteElement=function(){var t=new i;return t.setAppBus(this.appBus),t},t}();e.NavigationPanel=n;var r=function(){function t(){this.template=document.createElement("li"),this.template.style.cursor="pointer",this.childsContainer=document.createElement("ul"),this.childsContainer.classList.add("hide"),this.template.appendChild(this.childsContainer)}return t.prototype.getTemplate=function(){return this.template},t.prototype.getChildsContainer=function(){return this.childsContainer},t.prototype.setAppBus=function(t){this.appBus=t},t.prototype.load=function(t){this.data=t;var e=document.createTextNode(t.title);this.template.prepend(e)},t.prototype.eventsListen=function(){var t=this;this.template.onclick=function(e){e.stopPropagation(),t.appBus.highligtForTag(t.data.id),t.childsContainer.classList.toggle("hide")}},t}(),i=function(){function t(){this.template=document.createElement("li"),this.template.classList.add("node-item"),this.template.style.cursor="pointer"}return t.prototype.getTemplate=function(){return this.template},t.prototype.setAppBus=function(t){this.appBus=t},t.prototype.load=function(t){this.data=t;var e=document.createTextNode(t.preview);this.template.prepend(e)},t.prototype.eventsListen=function(){var t=this;this.template.onclick=function(e){e.stopPropagation(),t.appBus.highligtNote(t.data.id),window.innerWidth<500&&t.appBus.toggleMenu(!1)}},t}()}.apply(e,[n,e]),void 0===r||(t.exports=r)},890:(t,e,n)=>{"use strict";var r=n(1719);n(8728),n(3904),n(8176),n(6158),n(3366),n(9328),n(5039),n(1335),n(8023),n(4570),n(1262);var i=n(3533),o=n(6709).xI,a=/Mac/.test(navigator.platform),s=new RegExp(/(<a.*?https?:\/\/.*?[^a]>)+?/g),l={toggleBold:y,toggleItalic:b,drawLink:M,toggleHeadingSmaller:k,toggleHeadingBigger:S,drawImage:B,toggleBlockquote:C,toggleOrderedList:P,toggleUnorderedList:L,toggleCodeBlock:w,togglePreview:q,toggleStrikethrough:x,toggleHeading1:_,toggleHeading2:D,toggleHeading3:A,toggleHeading4:T,toggleHeading5:E,toggleHeading6:F,cleanBlock:O,drawTable:j,drawHorizontalRule:z,undo:H,redo:G,toggleSideBySide:W,toggleFullScreen:v},u={toggleBold:"Cmd-B",toggleItalic:"Cmd-I",drawLink:"Cmd-K",toggleHeadingSmaller:"Cmd-H",toggleHeadingBigger:"Shift-Cmd-H",toggleHeading1:"Ctrl+Alt+1",toggleHeading2:"Ctrl+Alt+2",toggleHeading3:"Ctrl+Alt+3",toggleHeading4:"Ctrl+Alt+4",toggleHeading5:"Ctrl+Alt+5",toggleHeading6:"Ctrl+Alt+6",cleanBlock:"Cmd-E",drawImage:"Cmd-Alt-I",toggleBlockquote:"Cmd-'",toggleOrderedList:"Cmd-Alt-L",toggleUnorderedList:"Cmd-L",toggleCodeBlock:"Cmd-Alt-C",togglePreview:"Cmd-P",toggleSideBySide:"F9",toggleFullScreen:"F11"},c=function(){var t,e=!1;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(t.substr(0,4)))&&(e=!0),e};function h(t){return t=a?t.replace("Ctrl","Cmd"):t.replace("Cmd","Ctrl")}function d(t,e,n,r){var i=f(t,!1,e,n,"button",r);i.classList.add("easymde-dropdown"),i.onclick=function(){i.focus()};var o=document.createElement("div");o.className="easymde-dropdown-content";for(var a=0;a<t.children.length;a++){var s,l=t.children[a];(s=f("string"==typeof l&&l in et?et[l]:l,!0,e,n,"button",r)).addEventListener("click",(function(t){t.stopPropagation()}),!1),o.appendChild(s)}return i.appendChild(o),i}function f(t,e,n,r,i,o){t=t||{};var s=document.createElement(i);if(t.attributes)for(var u in t.attributes)Object.prototype.hasOwnProperty.call(t.attributes,u)&&s.setAttribute(u,t.attributes[u]);var c=o.options.toolbarButtonClassPrefix?o.options.toolbarButtonClassPrefix+"-":"";s.className=c+t.name,s.setAttribute("type",i),n=null==n||n,t.text&&(s.innerText=t.text),t.name&&t.name in r&&(l[t.name]=t.action),t.title&&n&&(s.title=function(t,e,n){var r,i=t;e&&n[r=function(t){for(var e in l)if(l[e]===t)return e;return null}(e)]&&(i+=" ("+h(n[r])+")");return i}(t.title,t.action,r),a&&(s.title=s.title.replace("Ctrl","⌘"),s.title=s.title.replace("Alt","⌥"))),t.title&&s.setAttribute("aria-label",t.title),t.noDisable&&s.classList.add("no-disable"),t.noMobile&&s.classList.add("no-mobile");var d=[];void 0!==t.className&&(d=t.className.split(" "));for(var f=[],p=0;p<d.length;p++){var g=d[p];g.match(/^fa([srlb]|(-[\w-]*)|$)/)?f.push(g):s.classList.add(g)}if(s.tabIndex=-1,f.length>0){for(var m=document.createElement("i"),v=0;v<f.length;v++){var y=f[v];m.classList.add(y)}s.appendChild(m)}return void 0!==t.icon&&(s.innerHTML=t.icon),t.action&&e&&("function"==typeof t.action?s.onclick=function(e){e.preventDefault(),t.action(o)}:"string"==typeof t.action&&(s.onclick=function(e){e.preventDefault(),window.open(t.action,"_blank")})),s}function p(){var t=document.createElement("i");return t.className="separator",t.innerHTML="|",t}function g(t,e){e=e||t.getCursor("start");var n=t.getTokenAt(e);if(!n.type)return{};for(var r,i,o=n.type.split(" "),a={},s=0;s<o.length;s++)"strong"===(r=o[s])?a.bold=!0:"variable-2"===r?(i=t.getLine(e.line),/^\s*\d+\.\s/.test(i)?a["ordered-list"]=!0:a["unordered-list"]=!0):"atom"===r?a.quote=!0:"em"===r?a.italic=!0:"quote"===r?a.quote=!0:"strikethrough"===r?a.strikethrough=!0:"comment"===r?a.code=!0:"link"!==r||a.image?"image"===r?a.image=!0:r.match(/^header(-[1-6])?$/)&&(a[r.replace("header","heading")]=!0):a.link=!0;return a}var m="";function v(t){var e=t.codemirror;e.setOption("fullScreen",!e.getOption("fullScreen")),e.getOption("fullScreen")?(m=document.body.style.overflow,document.body.style.overflow="hidden"):document.body.style.overflow=m;var n=e.getWrapperElement(),r=n.nextSibling;if(r.classList.contains("editor-preview-active-side"))if(!1===t.options.sideBySideFullscreen){var i=n.parentNode;e.getOption("fullScreen")?i.classList.remove("sided--no-fullscreen"):i.classList.add("sided--no-fullscreen")}else W(t);(t.options.onToggleFullScreen&&t.options.onToggleFullScreen(e.getOption("fullScreen")||!1),void 0!==t.options.maxHeight&&(e.getOption("fullScreen")?(e.getScrollerElement().style.removeProperty("height"),r.style.removeProperty("height")):(e.getScrollerElement().style.height=t.options.maxHeight,t.setPreviewMaxHeight())),t.toolbar_div.classList.toggle("fullscreen"),t.toolbarElements&&t.toolbarElements.fullscreen)&&t.toolbarElements.fullscreen.classList.toggle("active")}function y(t){V(t,"bold",t.options.blockStyles.bold)}function b(t){V(t,"italic",t.options.blockStyles.italic)}function x(t){V(t,"strikethrough","~~")}function w(t){var e=t.options.blockStyles.code;function n(t){if("object"!=typeof t)throw"fencing_line() takes a 'line' object (not a line number, or line text).  Got: "+typeof t+": "+t;return t.styles&&t.styles[2]&&-1!==t.styles[2].indexOf("formatting-code-block")}function r(t){return t.state.base.base||t.state.base}function i(t,e,i,o,a){i=i||t.getLineHandle(e),o=o||t.getTokenAt({line:e,ch:1}),a=a||!!i.text&&t.getTokenAt({line:e,ch:i.text.length-1});var s=o.type?o.type.split(" "):[];return a&&r(a).indentedCode?"indented":-1!==s.indexOf("comment")&&(r(o).fencedChars||r(a).fencedChars||n(i)?"fenced":"single")}var o,a,s,l=t.codemirror,u=l.getCursor("start"),c=l.getCursor("end"),h=l.getTokenAt({line:u.line,ch:u.ch||1}),d=l.getLineHandle(u.line),f=i(l,u.line,d,h);if("single"===f){var p=d.text.slice(0,u.ch).replace("`",""),g=d.text.slice(u.ch).replace("`","");l.replaceRange(p+g,{line:u.line,ch:0},{line:u.line,ch:99999999999999}),u.ch--,u!==c&&c.ch--,l.setSelection(u,c),l.focus()}else if("fenced"===f)if(u.line!==c.line||u.ch!==c.ch){for(o=u.line;o>=0&&!n(d=l.getLineHandle(o));o--);var m,v,y,b,x=r(l.getTokenAt({line:o,ch:1})).fencedChars;n(l.getLineHandle(u.line))?(m="",v=u.line):n(l.getLineHandle(u.line-1))?(m="",v=u.line-1):(m=x+"\n",v=u.line),n(l.getLineHandle(c.line))?(y="",b=c.line,0===c.ch&&(b+=1)):0!==c.ch&&n(l.getLineHandle(c.line+1))?(y="",b=c.line+1):(y=x+"\n",b=c.line+1),0===c.ch&&(b-=1),l.operation((function(){l.replaceRange(y,{line:b,ch:0},{line:b+(y?0:1),ch:0}),l.replaceRange(m,{line:v,ch:0},{line:v+(m?0:1),ch:0})})),l.setSelection({line:v+(m?1:0),ch:0},{line:b+(m?1:-1),ch:0}),l.focus()}else{var w=u.line;if(n(l.getLineHandle(u.line))&&("fenced"===i(l,u.line+1)?(o=u.line,w=u.line+1):(a=u.line,w=u.line-1)),void 0===o)for(o=w;o>=0&&!n(d=l.getLineHandle(o));o--);if(void 0===a)for(s=l.lineCount(),a=w;a<s&&!n(d=l.getLineHandle(a));a++);l.operation((function(){l.replaceRange("",{line:o,ch:0},{line:o+1,ch:0}),l.replaceRange("",{line:a-1,ch:0},{line:a,ch:0})})),l.focus()}else if("indented"===f){if(u.line!==c.line||u.ch!==c.ch)o=u.line,a=c.line,0===c.ch&&a--;else{for(o=u.line;o>=0;o--)if(!(d=l.getLineHandle(o)).text.match(/^\s*$/)&&"indented"!==i(l,o,d)){o+=1;break}for(s=l.lineCount(),a=u.line;a<s;a++)if(!(d=l.getLineHandle(a)).text.match(/^\s*$/)&&"indented"!==i(l,a,d)){a-=1;break}}var C=l.getLineHandle(a+1),k=C&&l.getTokenAt({line:a+1,ch:C.text.length-1});k&&r(k).indentedCode&&l.replaceRange("\n",{line:a+1,ch:0});for(var S=o;S<=a;S++)l.indentLine(S,"subtract");l.focus()}else{var _=u.line===c.line&&u.ch===c.ch&&0===u.ch,D=u.line!==c.line;_||D?function(t,e,n,r){var i=e.line+1,o=n.line+1,a=e.line!==n.line,s=r+"\n",l="\n"+r;a&&o++,a&&0===n.ch&&(l=r+"\n",o--),U(t,!1,[s,l]),t.setSelection({line:i,ch:0},{line:o,ch:0})}(l,u,c,e):U(l,!1,["`","`"])}}function C(t){$(t.codemirror,"quote")}function k(t){K(t.codemirror,"smaller")}function S(t){K(t.codemirror,"bigger")}function _(t){K(t.codemirror,void 0,1)}function D(t){K(t.codemirror,void 0,2)}function A(t){K(t.codemirror,void 0,3)}function T(t){K(t.codemirror,void 0,4)}function E(t){K(t.codemirror,void 0,5)}function F(t){K(t.codemirror,void 0,6)}function L(t){var e=t.codemirror,n="*";["-","+","*"].includes(t.options.unorderedListStyle)&&(n=t.options.unorderedListStyle),$(e,"unordered-list",n)}function P(t){$(t.codemirror,"ordered-list")}function O(t){!function(t){if(t.getWrapperElement().lastChild.classList.contains("editor-preview-active"))return;for(var e,n=t.getCursor("start"),r=t.getCursor("end"),i=n.line;i<=r.line;i++)e=(e=t.getLine(i)).replace(/^[ ]*([# ]+|\*|-|[> ]+|[0-9]+(.|\)))[ ]*/,""),t.replaceRange(e,{line:i,ch:0},{line:i,ch:99999999999999})}(t.codemirror)}function M(t){var e=t.options,n="https://";if(e.promptURLs){var r=prompt(e.promptTexts.link,n);if(!r)return!1;n=N(r)}Y(t,"link",e.insertTexts.link,n)}function B(t){var e=t.options,n="https://";if(e.promptURLs){var r=prompt(e.promptTexts.image,n);if(!r)return!1;n=N(r)}Y(t,"image",e.insertTexts.image,n)}function N(t){return encodeURI(t).replace(/([\\()])/g,"\\$1")}function I(t){t.openBrowseFileWindow()}function R(t,e){var n=t.codemirror,r=g(n),i=t.options,o=e.substr(e.lastIndexOf("/")+1),a=o.substring(o.lastIndexOf(".")+1).replace(/\?.*$/,"").toLowerCase();if(["png","jpg","jpeg","gif","svg","apng","avif","webp"].includes(a))U(n,r.image,i.insertTexts.uploadedImage,e);else{var s=i.insertTexts.link;s[0]="["+o,U(n,r.link,s,e)}t.updateStatusBar("upload-image",t.options.imageTexts.sbOnUploaded.replace("#image_name#",o)),setTimeout((function(){t.updateStatusBar("upload-image",t.options.imageTexts.sbInit)}),1e3)}function j(t){var e=t.codemirror,n=g(e),r=t.options;U(e,n.table,r.insertTexts.table)}function z(t){var e=t.codemirror,n=g(e),r=t.options;U(e,n.image,r.insertTexts.horizontalRule)}function H(t){var e=t.codemirror;e.undo(),e.focus()}function G(t){var e=t.codemirror;e.redo(),e.focus()}function W(t){var e=t.codemirror,n=e.getWrapperElement(),r=n.nextSibling,i=t.toolbarElements&&t.toolbarElements["side-by-side"],o=!1,a=n.parentNode;r.classList.contains("editor-preview-active-side")?(!1===t.options.sideBySideFullscreen&&a.classList.remove("sided--no-fullscreen"),r.classList.remove("editor-preview-active-side"),i&&i.classList.remove("active"),n.classList.remove("CodeMirror-sided")):(setTimeout((function(){e.getOption("fullScreen")||(!1===t.options.sideBySideFullscreen?a.classList.add("sided--no-fullscreen"):v(t)),r.classList.add("editor-preview-active-side")}),1),i&&i.classList.add("active"),n.classList.add("CodeMirror-sided"),o=!0);var s=n.lastChild;if(s.classList.contains("editor-preview-active")){s.classList.remove("editor-preview-active");var l=t.toolbarElements.preview,u=t.toolbar_div;l.classList.remove("active"),u.classList.remove("disabled-for-preview")}if(e.sideBySideRenderingFunction||(e.sideBySideRenderingFunction=function(){var e=t.options.previewRender(t.value(),r);null!=e&&(r.innerHTML=e)}),o){var c=t.options.previewRender(t.value(),r);null!=c&&(r.innerHTML=c),e.on("update",e.sideBySideRenderingFunction)}else e.off("update",e.sideBySideRenderingFunction);e.refresh()}function q(t){var e=t.codemirror,n=e.getWrapperElement(),r=t.toolbar_div,i=!!t.options.toolbar&&t.toolbarElements.preview,o=n.lastChild;if(e.getWrapperElement().nextSibling.classList.contains("editor-preview-active-side")&&W(t),!o||!o.classList.contains("editor-preview-full")){if((o=document.createElement("div")).className="editor-preview-full",t.options.previewClass)if(Array.isArray(t.options.previewClass))for(var a=0;a<t.options.previewClass.length;a++)o.classList.add(t.options.previewClass[a]);else"string"==typeof t.options.previewClass&&o.classList.add(t.options.previewClass);n.appendChild(o)}o.classList.contains("editor-preview-active")?(o.classList.remove("editor-preview-active"),i&&(i.classList.remove("active"),r.classList.remove("disabled-for-preview"))):(setTimeout((function(){o.classList.add("editor-preview-active")}),1),i&&(i.classList.add("active"),r.classList.add("disabled-for-preview")));var s=t.options.previewRender(t.value(),o);null!==s&&(o.innerHTML=s)}function U(t,e,n,r){if(!t.getWrapperElement().lastChild.classList.contains("editor-preview-active")){var i,o=n[0],a=n[1],s={},l={};Object.assign(s,t.getCursor("start")),Object.assign(l,t.getCursor("end")),r&&(o=o.replace("#url#",r),a=a.replace("#url#",r)),e?(o=(i=t.getLine(s.line)).slice(0,s.ch),a=i.slice(s.ch),t.replaceRange(o+a,{line:s.line,ch:0})):(i=t.getSelection(),t.replaceSelection(o+i+a),s.ch+=o.length,s!==l&&(l.ch+=o.length)),t.setSelection(s,l),t.focus()}}function K(t,e,n){if(!t.getWrapperElement().lastChild.classList.contains("editor-preview-active")){for(var r=t.getCursor("start"),i=t.getCursor("end"),o=r.line;o<=i.line;o++)!function(r){var i=t.getLine(r),o=i.search(/[^#]/);i=void 0!==e?o<=0?"bigger"==e?"###### "+i:"# "+i:6==o&&"smaller"==e?i.substr(7):1==o&&"bigger"==e?i.substr(2):"bigger"==e?i.substr(1):"#"+i:o<=0?"#".repeat(n)+" "+i:o==n?i.substr(o+1):"#".repeat(n)+" "+i.substr(o+1),t.replaceRange(i,{line:r,ch:0},{line:r,ch:99999999999999})}(o);t.focus()}}function $(t,e,n){if(!t.getWrapperElement().lastChild.classList.contains("editor-preview-active")){for(var r=/^(\s*)(\*|-|\+|\d*\.)(\s+)/,i=/^\s*/,o=g(t),a=t.getCursor("start"),s=t.getCursor("end"),l={quote:/^(\s*)>\s+/,"unordered-list":r,"ordered-list":r},u=function(t,e,o){var a=r.exec(e),s=function(t,e){return{quote:">","unordered-list":n,"ordered-list":"%%i."}[t].replace("%%i",e)}(t,c);return null!==a?(function(t,e){var r=new RegExp({quote:">","unordered-list":"\\"+n,"ordered-list":"\\d+."}[t]);return e&&r.test(e)}(t,a[2])&&(s=""),e=a[1]+s+a[3]+e.replace(i,"").replace(l[t],"$1")):0==o&&(e=s+" "+e),e},c=1,h=a.line;h<=s.line;h++)!function(n){var r=t.getLine(n);o[e]?r=r.replace(l[e],"$1"):("unordered-list"==e&&(r=u("ordered-list",r,!0)),r=u(e,r,!1),c+=1),t.replaceRange(r,{line:n,ch:0},{line:n,ch:99999999999999})}(h);t.focus()}}function Y(t,e,n,r){if(t.codemirror&&!t.isPreviewActive()){var i=t.codemirror,o=g(i)[e];if(o){var a=i.getCursor("start"),s=i.getCursor("end"),l=i.getLine(a.line),u=l.slice(0,a.ch),c=l.slice(a.ch);"link"==e?u=u.replace(/(.*)[^!]\[/,"$1"):"image"==e&&(u=u.replace(/(.*)!\[$/,"$1")),c=c.replace(/]\(.*?\)/,""),i.replaceRange(u+c,{line:a.line,ch:0},{line:a.line,ch:99999999999999}),a.ch-=n[0].length,a!==s&&(s.ch-=n[0].length),i.setSelection(a,s),i.focus()}else U(i,o,n,r)}}function V(t,e,n,r){if(t.codemirror&&!t.isPreviewActive()){r=void 0===r?n:r;var i,o=t.codemirror,a=g(o),s=n,l=r,u=o.getCursor("start"),c=o.getCursor("end");a[e]?(s=(i=o.getLine(u.line)).slice(0,u.ch),l=i.slice(u.ch),"bold"==e?(s=s.replace(/(\*\*|__)(?![\s\S]*(\*\*|__))/,""),l=l.replace(/(\*\*|__)/,"")):"italic"==e?(s=s.replace(/(\*|_)(?![\s\S]*(\*|_))/,""),l=l.replace(/(\*|_)/,"")):"strikethrough"==e&&(s=s.replace(/(\*\*|~~)(?![\s\S]*(\*\*|~~))/,""),l=l.replace(/(\*\*|~~)/,"")),o.replaceRange(s+l,{line:u.line,ch:0},{line:u.line,ch:99999999999999}),"bold"==e||"strikethrough"==e?(u.ch-=2,u!==c&&(c.ch-=2)):"italic"==e&&(u.ch-=1,u!==c&&(c.ch-=1))):(i=o.getSelection(),"bold"==e?i=(i=i.split("**").join("")).split("__").join(""):"italic"==e?i=(i=i.split("*").join("")).split("_").join(""):"strikethrough"==e&&(i=i.split("~~").join("")),o.replaceSelection(s+i+l),u.ch+=n.length,c.ch=u.ch+i.length),o.setSelection(u,c),o.focus()}}function X(t,e){if(Math.abs(t)<1024)return""+t+e[0];var n=0;do{t/=1024,++n}while(Math.abs(t)>=1024&&n<e.length);return""+t.toFixed(1)+e[n]}function J(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]instanceof Array?t[n]=e[n].concat(t[n]instanceof Array?t[n]:[]):null!==e[n]&&"object"==typeof e[n]&&e[n].constructor===Object?t[n]=J(t[n]||{},e[n]):t[n]=e[n]);return t}function Q(t){for(var e=1;e<arguments.length;e++)t=J(t,arguments[e]);return t}function Z(t){var e=t.match(/[a-zA-Z0-9_\u00A0-\u02AF\u0392-\u03c9\u0410-\u04F9]+|[\u4E00-\u9FFF\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af]+/g),n=0;if(null===e)return n;for(var r=0;r<e.length;r++)e[r].charCodeAt(0)>=19968?n+=e[r].length:n+=1;return n}var tt={bold:"fa fa-bold",italic:"fa fa-italic",strikethrough:"fa fa-strikethrough",heading:"fa fa-header fa-heading","heading-smaller":"fa fa-header fa-heading header-smaller","heading-bigger":"fa fa-header fa-heading header-bigger","heading-1":"fa fa-header fa-heading header-1","heading-2":"fa fa-header fa-heading header-2","heading-3":"fa fa-header fa-heading header-3",code:"fa fa-code",quote:"fa fa-quote-left","ordered-list":"fa fa-list-ol","unordered-list":"fa fa-list-ul","clean-block":"fa fa-eraser",link:"fa fa-link",image:"fa fa-image","upload-image":"fa fa-image",table:"fa fa-table","horizontal-rule":"fa fa-minus",preview:"fa fa-eye","side-by-side":"fa fa-columns",fullscreen:"fa fa-arrows-alt",guide:"fa fa-question-circle",undo:"fa fa-undo",redo:"fa fa-repeat fa-redo"},et={bold:{name:"bold",action:y,className:tt.bold,title:"Bold",default:!0},italic:{name:"italic",action:b,className:tt.italic,title:"Italic",default:!0},strikethrough:{name:"strikethrough",action:x,className:tt.strikethrough,title:"Strikethrough"},heading:{name:"heading",action:k,className:tt.heading,title:"Heading",default:!0},"heading-smaller":{name:"heading-smaller",action:k,className:tt["heading-smaller"],title:"Smaller Heading"},"heading-bigger":{name:"heading-bigger",action:S,className:tt["heading-bigger"],title:"Bigger Heading"},"heading-1":{name:"heading-1",action:_,className:tt["heading-1"],title:"Big Heading"},"heading-2":{name:"heading-2",action:D,className:tt["heading-2"],title:"Medium Heading"},"heading-3":{name:"heading-3",action:A,className:tt["heading-3"],title:"Small Heading"},"separator-1":{name:"separator-1"},code:{name:"code",action:w,className:tt.code,title:"Code"},quote:{name:"quote",action:C,className:tt.quote,title:"Quote",default:!0},"unordered-list":{name:"unordered-list",action:L,className:tt["unordered-list"],title:"Generic List",default:!0},"ordered-list":{name:"ordered-list",action:P,className:tt["ordered-list"],title:"Numbered List",default:!0},"clean-block":{name:"clean-block",action:O,className:tt["clean-block"],title:"Clean block"},"separator-2":{name:"separator-2"},link:{name:"link",action:M,className:tt.link,title:"Create Link",default:!0},image:{name:"image",action:B,className:tt.image,title:"Insert Image",default:!0},"upload-image":{name:"upload-image",action:I,className:tt["upload-image"],title:"Import an image"},table:{name:"table",action:j,className:tt.table,title:"Insert Table"},"horizontal-rule":{name:"horizontal-rule",action:z,className:tt["horizontal-rule"],title:"Insert Horizontal Line"},"separator-3":{name:"separator-3"},preview:{name:"preview",action:q,className:tt.preview,noDisable:!0,title:"Toggle Preview",default:!0},"side-by-side":{name:"side-by-side",action:W,className:tt["side-by-side"],noDisable:!0,noMobile:!0,title:"Toggle Side by Side",default:!0},fullscreen:{name:"fullscreen",action:v,className:tt.fullscreen,noDisable:!0,noMobile:!1,title:"Toggle Fullscreen",default:!0},"separator-4":{name:"separator-4"},guide:{name:"guide",action:"https://www.markdownguide.org/basic-syntax/",className:tt.guide,noDisable:!0,title:"Markdown Guide",default:!0},"separator-5":{name:"separator-5"},undo:{name:"undo",action:H,className:tt.undo,noDisable:!0,title:"Undo"},redo:{name:"redo",action:G,className:tt.redo,noDisable:!0,title:"Redo"}},nt={link:["[","](#url#)"],image:["![","](#url#)"],uploadedImage:["![](#url#)",""],table:["","\n\n| Column 1 | Column 2 | Column 3 |\n| -------- | -------- | -------- |\n| Text     | Text     | Text     |\n\n"],horizontalRule:["","\n\n-----\n\n"]},rt={link:"URL for the link:",image:"URL of the image:"},it={locale:"en-US",format:{hour:"2-digit",minute:"2-digit"}},ot={bold:"**",code:"```",italic:"*"},at={sbInit:"Attach files by drag and dropping or pasting from clipboard.",sbOnDragEnter:"Drop image to upload it.",sbOnDrop:"Uploading image #images_names#...",sbProgress:"Uploading #file_name#: #progress#%",sbOnUploaded:"Uploaded #image_name#",sizeUnits:" B, KB, MB"},st={noFileGiven:"You must select a file.",typeNotAllowed:"This image type is not allowed.",fileTooLarge:"Image #image_name# is too big (#image_size#).\nMaximum file size is #image_max_size#.",importError:"Something went wrong when uploading the image #image_name#."};function lt(t){(t=t||{}).parent=this;var e=!0;if(!1===t.autoDownloadFontAwesome&&(e=!1),!0!==t.autoDownloadFontAwesome)for(var n=document.styleSheets,r=0;r<n.length;r++)n[r].href&&n[r].href.indexOf("//maxcdn.bootstrapcdn.com/font-awesome/")>-1&&(e=!1);if(e){var i=document.createElement("link");i.rel="stylesheet",i.href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css",document.getElementsByTagName("head")[0].appendChild(i)}if(t.element)this.element=t.element;else if(null===t.element)return void console.log("EasyMDE: Error. No element was found.");if(void 0===t.toolbar)for(var o in t.toolbar=[],et)Object.prototype.hasOwnProperty.call(et,o)&&(-1!=o.indexOf("separator-")&&t.toolbar.push("|"),(!0===et[o].default||t.showIcons&&t.showIcons.constructor===Array&&-1!=t.showIcons.indexOf(o))&&t.toolbar.push(o));if(Object.prototype.hasOwnProperty.call(t,"previewClass")||(t.previewClass="editor-preview"),Object.prototype.hasOwnProperty.call(t,"status")||(t.status=["autosave","lines","words","cursor"],t.uploadImage&&t.status.unshift("upload-image")),t.previewRender||(t.previewRender=function(t){return this.parent.markdown(t)}),t.parsingConfig=Q({highlightFormatting:!0},t.parsingConfig||{}),t.insertTexts=Q({},nt,t.insertTexts||{}),t.promptTexts=Q({},rt,t.promptTexts||{}),t.blockStyles=Q({},ot,t.blockStyles||{}),null!=t.autosave&&(t.autosave.timeFormat=Q({},it,t.autosave.timeFormat||{})),t.iconClassMap=Q({},tt,t.iconClassMap||{}),t.shortcuts=Q({},u,t.shortcuts||{}),t.maxHeight=t.maxHeight||void 0,t.direction=t.direction||"ltr",void 0!==t.maxHeight?t.minHeight=t.maxHeight:t.minHeight=t.minHeight||"300px",t.errorCallback=t.errorCallback||function(t){alert(t)},t.uploadImage=t.uploadImage||!1,t.imageMaxSize=t.imageMaxSize||2097152,t.imageAccept=t.imageAccept||"image/png, image/jpeg, image/gif, image/avif",t.imageTexts=Q({},at,t.imageTexts||{}),t.errorMessages=Q({},st,t.errorMessages||{}),t.imagePathAbsolute=t.imagePathAbsolute||!1,t.imageCSRFName=t.imageCSRFName||"csrfmiddlewaretoken",t.imageCSRFHeader=t.imageCSRFHeader||!1,t.imageInputName=t.imageInputName||"image",null!=t.autosave&&null!=t.autosave.unique_id&&""!=t.autosave.unique_id&&(t.autosave.uniqueId=t.autosave.unique_id),t.overlayMode&&void 0===t.overlayMode.combine&&(t.overlayMode.combine=!0),this.options=t,this.render(),!t.initialValue||this.options.autosave&&!0===this.options.autosave.foundSavedValue||this.value(t.initialValue),t.uploadImage){var a=this;this.codemirror.on("dragenter",(function(t,e){a.updateStatusBar("upload-image",a.options.imageTexts.sbOnDragEnter),e.stopPropagation(),e.preventDefault()})),this.codemirror.on("dragend",(function(t,e){a.updateStatusBar("upload-image",a.options.imageTexts.sbInit),e.stopPropagation(),e.preventDefault()})),this.codemirror.on("dragleave",(function(t,e){a.updateStatusBar("upload-image",a.options.imageTexts.sbInit),e.stopPropagation(),e.preventDefault()})),this.codemirror.on("dragover",(function(t,e){a.updateStatusBar("upload-image",a.options.imageTexts.sbOnDragEnter),e.stopPropagation(),e.preventDefault()})),this.codemirror.on("drop",(function(e,n){n.stopPropagation(),n.preventDefault(),t.imageUploadFunction?a.uploadImagesUsingCustomFunction(t.imageUploadFunction,n.dataTransfer.files):a.uploadImages(n.dataTransfer.files)})),this.codemirror.on("paste",(function(e,n){t.imageUploadFunction?a.uploadImagesUsingCustomFunction(t.imageUploadFunction,n.clipboardData.files):a.uploadImages(n.clipboardData.files)}))}}function ut(){if("object"!=typeof localStorage)return!1;try{localStorage.setItem("smde_localStorage",1),localStorage.removeItem("smde_localStorage")}catch(t){return!1}return!0}lt.prototype.uploadImages=function(t,e,n){if(0!==t.length){for(var r=[],i=0;i<t.length;i++)r.push(t[i].name),this.uploadImage(t[i],e,n);this.updateStatusBar("upload-image",this.options.imageTexts.sbOnDrop.replace("#images_names#",r.join(", ")))}},lt.prototype.uploadImagesUsingCustomFunction=function(t,e){if(0!==e.length){for(var n=[],r=0;r<e.length;r++)n.push(e[r].name),this.uploadImageUsingCustomFunction(t,e[r]);this.updateStatusBar("upload-image",this.options.imageTexts.sbOnDrop.replace("#images_names#",n.join(", ")))}},lt.prototype.updateStatusBar=function(t,e){if(this.gui.statusbar){var n=this.gui.statusbar.getElementsByClassName(t);1===n.length?this.gui.statusbar.getElementsByClassName(t)[0].textContent=e:0===n.length?console.log("EasyMDE: status bar item "+t+" was not found."):console.log("EasyMDE: Several status bar items named "+t+" was found.")}},lt.prototype.markdown=function(t){if(o){var e;if(e=this.options&&this.options.renderingConfig&&this.options.renderingConfig.markedOptions?this.options.renderingConfig.markedOptions:{},this.options&&this.options.renderingConfig&&!1===this.options.renderingConfig.singleLineBreaks?e.breaks=!1:e.breaks=!0,this.options&&this.options.renderingConfig&&!0===this.options.renderingConfig.codeSyntaxHighlighting){var n=this.options.renderingConfig.hljs||window.hljs;n&&(e.highlight=function(t,e){return e&&n.getLanguage(e)?n.highlight(e,t).value:n.highlightAuto(t).value})}o.use(e);var r=o.parse(t);return this.options.renderingConfig&&"function"==typeof this.options.renderingConfig.sanitizerFunction&&(r=this.options.renderingConfig.sanitizerFunction.call(this,r)),r=function(t){for(var e=(new DOMParser).parseFromString(t,"text/html"),n=e.getElementsByTagName("li"),r=0;r<n.length;r++)for(var i=n[r],o=0;o<i.children.length;o++){var a=i.children[o];a instanceof HTMLInputElement&&"checkbox"===a.type&&(i.style.marginLeft="-1.5em",i.style.listStyleType="none")}return e.documentElement.innerHTML}(r=function(t){for(var e;null!==(e=s.exec(t));){var n=e[0];if(-1===n.indexOf("target=")){var r=n.replace(/>$/,' target="_blank">');t=t.replace(n,r)}}return t}(r))}},lt.prototype.render=function(t){if(t||(t=this.element||document.getElementsByTagName("textarea")[0]),!this._rendered||this._rendered!==t){this.element=t;var e,n,o=this.options,a=this,s={};for(var u in o.shortcuts)null!==o.shortcuts[u]&&null!==l[u]&&function(t){s[h(o.shortcuts[t])]=function(){var e=l[t];"function"==typeof e?e(a):"string"==typeof e&&window.open(e,"_blank")}}(u);if(s.Enter="newlineAndIndentContinueMarkdownList",s.Tab="tabAndIndentMarkdownList",s["Shift-Tab"]="shiftTabAndUnindentMarkdownList",s.Esc=function(t){t.getOption("fullScreen")&&v(a)},this.documentOnKeyDown=function(t){27==(t=t||window.event).keyCode&&a.codemirror.getOption("fullScreen")&&v(a)},document.addEventListener("keydown",this.documentOnKeyDown,!1),o.overlayMode?(r.defineMode("overlay-mode",(function(t){return r.overlayMode(r.getMode(t,!1!==o.spellChecker?"spell-checker":"gfm"),o.overlayMode.mode,o.overlayMode.combine)})),e="overlay-mode",(n=o.parsingConfig).gitHubSpice=!1):((e=o.parsingConfig).name="gfm",e.gitHubSpice=!1),!1!==o.spellChecker&&(e="spell-checker",(n=o.parsingConfig).name="gfm",n.gitHubSpice=!1,"function"==typeof o.spellChecker?o.spellChecker({codeMirrorInstance:r}):i({codeMirrorInstance:r})),this.codemirror=r.fromTextArea(t,{mode:e,backdrop:n,theme:null!=o.theme?o.theme:"easymde",tabSize:null!=o.tabSize?o.tabSize:2,indentUnit:null!=o.tabSize?o.tabSize:2,indentWithTabs:!1!==o.indentWithTabs,lineNumbers:!0===o.lineNumbers,autofocus:!0===o.autofocus,extraKeys:s,direction:o.direction,lineWrapping:!1!==o.lineWrapping,allowDropFileTypes:["text/plain"],placeholder:o.placeholder||t.getAttribute("placeholder")||"",styleSelectedText:null!=o.styleSelectedText?o.styleSelectedText:!c(),scrollbarStyle:null!=o.scrollbarStyle?o.scrollbarStyle:"native",configureMouse:function(t,e,n){return{addNew:!1}},inputStyle:null!=o.inputStyle?o.inputStyle:c()?"contenteditable":"textarea",spellcheck:null==o.nativeSpellcheck||o.nativeSpellcheck,autoRefresh:null!=o.autoRefresh&&o.autoRefresh}),this.codemirror.getScrollerElement().style.minHeight=o.minHeight,void 0!==o.maxHeight&&(this.codemirror.getScrollerElement().style.height=o.maxHeight),!0===o.forceSync){var d=this.codemirror;d.on("change",(function(){d.save()}))}this.gui={};var f=document.createElement("div");f.classList.add("EasyMDEContainer"),f.setAttribute("role","application");var p=this.codemirror.getWrapperElement();p.parentNode.insertBefore(f,p),f.appendChild(p),!1!==o.toolbar&&(this.gui.toolbar=this.createToolbar()),!1!==o.status&&(this.gui.statusbar=this.createStatusbar()),null!=o.autosave&&!0===o.autosave.enabled&&(this.autosave(),this.codemirror.on("change",(function(){clearTimeout(a._autosave_timeout),a._autosave_timeout=setTimeout((function(){a.autosave()}),a.options.autosave.submit_delay||a.options.autosave.delay||1e3)})));var g=this;this.codemirror.on("update",(function(){o.previewImagesInEditor&&f.querySelectorAll(".cm-image-marker").forEach((function(t){var e=t.parentElement;if(e.innerText.match(/^!\[.*?\]\(.*\)/g)&&!e.hasAttribute("data-img-src")){var n=e.innerText.match(/!\[.*?\]\((.*?)\)/);if(window.EMDEimagesCache||(window.EMDEimagesCache={}),n&&n.length>=2){var r=n[1];if(o.imagesPreviewHandler){var i=o.imagesPreviewHandler(n[1]);"string"==typeof i&&(r=i)}if(window.EMDEimagesCache[r])y(e,window.EMDEimagesCache[r]);else{window.EMDEimagesCache[r]={};var a=document.createElement("img");a.onload=function(){window.EMDEimagesCache[r]={naturalWidth:a.naturalWidth,naturalHeight:a.naturalHeight,url:r},y(e,window.EMDEimagesCache[r])},a.src=r}}}}))})),this.gui.sideBySide=this.createSideBySide(),this._rendered=this.element,(!0===o.autofocus||t.autofocus)&&this.codemirror.focus();var m=this.codemirror;setTimeout(function(){m.refresh()}.bind(m),0)}function y(t,e){var n,r,i=new URL(e.url,document.baseURI).href;t.setAttribute("data-img-src",i),t.setAttribute("style","--bg-image:url("+i+");--width:"+e.naturalWidth+"px;--height:"+(n=e.naturalWidth,r=e.naturalHeight,n<window.getComputedStyle(document.querySelector(".CodeMirror-sizer")).width.replace("px","")?r+"px":r/n*100+"%")),g.codemirror.setSize()}},lt.prototype.cleanup=function(){document.removeEventListener("keydown",this.documentOnKeyDown)},lt.prototype.autosave=function(){if(ut()){var t=this;if(null==this.options.autosave.uniqueId||""==this.options.autosave.uniqueId)return void console.log("EasyMDE: You must set a uniqueId to use the autosave feature");!0!==this.options.autosave.binded&&(null!=t.element.form&&null!=t.element.form&&t.element.form.addEventListener("submit",(function(){clearTimeout(t.autosaveTimeoutId),t.autosaveTimeoutId=void 0,localStorage.removeItem("smde_"+t.options.autosave.uniqueId)})),this.options.autosave.binded=!0),!0!==this.options.autosave.loaded&&("string"==typeof localStorage.getItem("smde_"+this.options.autosave.uniqueId)&&""!=localStorage.getItem("smde_"+this.options.autosave.uniqueId)&&(this.codemirror.setValue(localStorage.getItem("smde_"+this.options.autosave.uniqueId)),this.options.autosave.foundSavedValue=!0),this.options.autosave.loaded=!0);var e=t.value();""!==e?localStorage.setItem("smde_"+this.options.autosave.uniqueId,e):localStorage.removeItem("smde_"+this.options.autosave.uniqueId);var n=document.getElementById("autosaved");if(null!=n&&null!=n&&""!=n){var r=new Date,i=new Intl.DateTimeFormat([this.options.autosave.timeFormat.locale,"en-US"],this.options.autosave.timeFormat.format).format(r),o=null==this.options.autosave.text?"Autosaved: ":this.options.autosave.text;n.innerHTML=o+i}}else console.log("EasyMDE: localStorage not available, cannot autosave")},lt.prototype.clearAutosavedValue=function(){if(ut()){if(null==this.options.autosave||null==this.options.autosave.uniqueId||""==this.options.autosave.uniqueId)return void console.log("EasyMDE: You must set a uniqueId to clear the autosave value");localStorage.removeItem("smde_"+this.options.autosave.uniqueId)}else console.log("EasyMDE: localStorage not available, cannot autosave")},lt.prototype.openBrowseFileWindow=function(t,e){var n=this,r=this.gui.toolbar.getElementsByClassName("imageInput")[0];r.click(),r.addEventListener("change",(function i(o){n.options.imageUploadFunction?n.uploadImagesUsingCustomFunction(n.options.imageUploadFunction,o.target.files):n.uploadImages(o.target.files,t,e),r.removeEventListener("change",i)}))},lt.prototype.uploadImage=function(t,e,n){var r=this;function i(t){r.updateStatusBar("upload-image",t),setTimeout((function(){r.updateStatusBar("upload-image",r.options.imageTexts.sbInit)}),1e4),n&&"function"==typeof n&&n(t),r.options.errorCallback(t)}function o(e){var n=r.options.imageTexts.sizeUnits.split(",");return e.replace("#image_name#",t.name).replace("#image_size#",X(t.size,n)).replace("#image_max_size#",X(r.options.imageMaxSize,n))}if(e=e||function(t){R(r,t)},t.size>this.options.imageMaxSize)i(o(this.options.errorMessages.fileTooLarge));else{var a=new FormData;a.append("image",t),r.options.imageCSRFToken&&!r.options.imageCSRFHeader&&a.append(r.options.imageCSRFName,r.options.imageCSRFToken);var s=new XMLHttpRequest;s.upload.onprogress=function(e){if(e.lengthComputable){var n=""+Math.round(100*e.loaded/e.total);r.updateStatusBar("upload-image",r.options.imageTexts.sbProgress.replace("#file_name#",t.name).replace("#progress#",n))}},s.open("POST",this.options.imageUploadEndpoint),r.options.imageCSRFToken&&r.options.imageCSRFHeader&&s.setRequestHeader(r.options.imageCSRFName,r.options.imageCSRFToken),s.onload=function(){try{var t=JSON.parse(this.responseText)}catch(t){return console.error("EasyMDE: The server did not return a valid json."),void i(o(r.options.errorMessages.importError))}200===this.status&&t&&!t.error&&t.data&&t.data.filePath?e((r.options.imagePathAbsolute?"":window.location.origin+"/")+t.data.filePath):t.error&&t.error in r.options.errorMessages?i(o(r.options.errorMessages[t.error])):t.error?i(o(t.error)):(console.error("EasyMDE: Received an unexpected response after uploading the image."+this.status+" ("+this.statusText+")"),i(o(r.options.errorMessages.importError)))},s.onerror=function(t){console.error("EasyMDE: An unexpected error occurred when trying to upload the image."+t.target.status+" ("+t.target.statusText+")"),i(r.options.errorMessages.importError)},s.send(a)}},lt.prototype.uploadImageUsingCustomFunction=function(t,e){var n=this;t.apply(this,[e,function(t){R(n,t)},function(t){var r=function(t){var r=n.options.imageTexts.sizeUnits.split(",");return t.replace("#image_name#",e.name).replace("#image_size#",X(e.size,r)).replace("#image_max_size#",X(n.options.imageMaxSize,r))}(t);n.updateStatusBar("upload-image",r),setTimeout((function(){n.updateStatusBar("upload-image",n.options.imageTexts.sbInit)}),1e4),n.options.errorCallback(r)}])},lt.prototype.setPreviewMaxHeight=function(){var t=this.codemirror.getWrapperElement(),e=t.nextSibling,n=parseInt(window.getComputedStyle(t).paddingTop),r=parseInt(window.getComputedStyle(t).borderTopWidth),i=(parseInt(this.options.maxHeight)+2*n+2*r).toString()+"px";e.style.height=i},lt.prototype.createSideBySide=function(){var t=this.codemirror,e=t.getWrapperElement(),n=e.nextSibling;if(!n||!n.classList.contains("editor-preview-side")){if((n=document.createElement("div")).className="editor-preview-side",this.options.previewClass)if(Array.isArray(this.options.previewClass))for(var r=0;r<this.options.previewClass.length;r++)n.classList.add(this.options.previewClass[r]);else"string"==typeof this.options.previewClass&&n.classList.add(this.options.previewClass);e.parentNode.insertBefore(n,e.nextSibling)}if(void 0!==this.options.maxHeight&&this.setPreviewMaxHeight(),!1===this.options.syncSideBySidePreviewScroll)return n;var i=!1,o=!1;return t.on("scroll",(function(t){if(i)i=!1;else{o=!0;var e=t.getScrollInfo().height-t.getScrollInfo().clientHeight,r=parseFloat(t.getScrollInfo().top)/e,a=(n.scrollHeight-n.clientHeight)*r;n.scrollTop=a}})),n.onscroll=function(){if(o)o=!1;else{i=!0;var e=n.scrollHeight-n.clientHeight,r=parseFloat(n.scrollTop)/e,a=(t.getScrollInfo().height-t.getScrollInfo().clientHeight)*r;t.scrollTo(0,a)}},n},lt.prototype.createToolbar=function(t){if((t=t||this.options.toolbar)&&0!==t.length){var e;for(e=0;e<t.length;e++)null!=et[t[e]]&&(t[e]=et[t[e]]);var n=document.createElement("div");n.className="editor-toolbar",n.setAttribute("role","toolbar");var r=this,i={};for(r.toolbar=t,e=0;e<t.length;e++)if(("guide"!=t[e].name||!1!==r.options.toolbarGuideIcon)&&!(r.options.hideIcons&&-1!=r.options.hideIcons.indexOf(t[e].name)||"side-by-side"==t[e].name&&c())){if("|"===t[e]){for(var o=!1,a=e+1;a<t.length;a++)"|"===t[a]||r.options.hideIcons&&-1!=r.options.hideIcons.indexOf(t[a].name)||(o=!0);if(!o)continue}!function(t){var e;if(e="|"===t?p():t.children?d(t,r.options.toolbarTips,r.options.shortcuts,r):f(t,!0,r.options.toolbarTips,r.options.shortcuts,"button",r),i[t.name||t]=e,n.appendChild(e),"upload-image"===t.name){var o=document.createElement("input");o.className="imageInput",o.type="file",o.multiple=!0,o.name=r.options.imageInputName,o.accept=r.options.imageAccept,o.style.display="none",o.style.opacity=0,n.appendChild(o)}}(t[e])}r.toolbar_div=n,r.toolbarElements=i;var s=this.codemirror;s.on("cursorActivity",(function(){var t=g(s);for(var e in i)!function(e){var n=i[e];t[e]?n.classList.add("active"):"fullscreen"!=e&&"side-by-side"!=e&&n.classList.remove("active")}(e)}));var l=s.getWrapperElement();return l.parentNode.insertBefore(n,l),n}},lt.prototype.createStatusbar=function(t){t=t||this.options.status;var e=this.options,n=this.codemirror;if(t&&0!==t.length){var r,i,o,a,s=[];for(r=0;r<t.length;r++)if(i=void 0,o=void 0,a=void 0,"object"==typeof t[r])s.push({className:t[r].className,defaultValue:t[r].defaultValue,onUpdate:t[r].onUpdate,onActivity:t[r].onActivity});else{var l=t[r];"words"===l?(a=function(t){t.innerHTML=Z(n.getValue())},i=function(t){t.innerHTML=Z(n.getValue())}):"lines"===l?(a=function(t){t.innerHTML=n.lineCount()},i=function(t){t.innerHTML=n.lineCount()}):"cursor"===l?(a=function(t){t.innerHTML="1:1"},o=function(t){var e=n.getCursor(),r=e.line+1,i=e.ch+1;t.innerHTML=r+":"+i}):"autosave"===l?a=function(t){null!=e.autosave&&!0===e.autosave.enabled&&t.setAttribute("id","autosaved")}:"upload-image"===l&&(a=function(t){t.innerHTML=e.imageTexts.sbInit}),s.push({className:l,defaultValue:a,onUpdate:i,onActivity:o})}var u=document.createElement("div");for(u.className="editor-statusbar",r=0;r<s.length;r++){var c=s[r],h=document.createElement("span");h.className=c.className,"function"==typeof c.defaultValue&&c.defaultValue(h),"function"==typeof c.onUpdate&&this.codemirror.on("update",function(t,e){return function(){e.onUpdate(t)}}(h,c)),"function"==typeof c.onActivity&&this.codemirror.on("cursorActivity",function(t,e){return function(){e.onActivity(t)}}(h,c)),u.appendChild(h)}var d=this.codemirror.getWrapperElement();return d.parentNode.insertBefore(u,d.nextSibling),u}},lt.prototype.value=function(t){var e=this.codemirror;if(void 0===t)return e.getValue();if(e.getDoc().setValue(t),this.isPreviewActive()){var n=e.getWrapperElement().lastChild,r=this.options.previewRender(t,n);null!==r&&(n.innerHTML=r)}return this},lt.toggleBold=y,lt.toggleItalic=b,lt.toggleStrikethrough=x,lt.toggleBlockquote=C,lt.toggleHeadingSmaller=k,lt.toggleHeadingBigger=S,lt.toggleHeading1=_,lt.toggleHeading2=D,lt.toggleHeading3=A,lt.toggleHeading4=T,lt.toggleHeading5=E,lt.toggleHeading6=F,lt.toggleCodeBlock=w,lt.toggleUnorderedList=L,lt.toggleOrderedList=P,lt.cleanBlock=O,lt.drawLink=M,lt.drawImage=B,lt.drawUploadedImage=I,lt.drawTable=j,lt.drawHorizontalRule=z,lt.undo=H,lt.redo=G,lt.togglePreview=q,lt.toggleSideBySide=W,lt.toggleFullScreen=v,lt.prototype.toggleBold=function(){y(this)},lt.prototype.toggleItalic=function(){b(this)},lt.prototype.toggleStrikethrough=function(){x(this)},lt.prototype.toggleBlockquote=function(){C(this)},lt.prototype.toggleHeadingSmaller=function(){k(this)},lt.prototype.toggleHeadingBigger=function(){S(this)},lt.prototype.toggleHeading1=function(){_(this)},lt.prototype.toggleHeading2=function(){D(this)},lt.prototype.toggleHeading3=function(){A(this)},lt.prototype.toggleHeading4=function(){T(this)},lt.prototype.toggleHeading5=function(){E(this)},lt.prototype.toggleHeading6=function(){F(this)},lt.prototype.toggleCodeBlock=function(){w(this)},lt.prototype.toggleUnorderedList=function(){L(this)},lt.prototype.toggleOrderedList=function(){P(this)},lt.prototype.cleanBlock=function(){O(this)},lt.prototype.drawLink=function(){M(this)},lt.prototype.drawImage=function(){B(this)},lt.prototype.drawUploadedImage=function(){I(this)},lt.prototype.drawTable=function(){j(this)},lt.prototype.drawHorizontalRule=function(){z(this)},lt.prototype.undo=function(){H(this)},lt.prototype.redo=function(){G(this)},lt.prototype.togglePreview=function(){q(this)},lt.prototype.toggleSideBySide=function(){W(this)},lt.prototype.toggleFullScreen=function(){v(this)},lt.prototype.isPreviewActive=function(){return this.codemirror.getWrapperElement().lastChild.classList.contains("editor-preview-active")},lt.prototype.isSideBySideActive=function(){return this.codemirror.getWrapperElement().nextSibling.classList.contains("editor-preview-active-side")},lt.prototype.isFullscreenActive=function(){return this.codemirror.getOption("fullScreen")},lt.prototype.getState=function(){return g(this.codemirror)},lt.prototype.toTextArea=function(){var t=this.codemirror,e=t.getWrapperElement(),n=e.parentNode;n&&(this.gui.toolbar&&n.removeChild(this.gui.toolbar),this.gui.statusbar&&n.removeChild(this.gui.statusbar),this.gui.sideBySide&&n.removeChild(this.gui.sideBySide)),n.parentNode.insertBefore(e,n),n.remove(),t.toTextArea(),this.autosaveTimeoutId&&(clearTimeout(this.autosaveTimeoutId),this.autosaveTimeoutId=void 0,this.clearAutosavedValue())},t.exports=lt},916:function(t,e,n){var r,i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{l(r.next(t))}catch(t){o(t)}}function s(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TagsStorage=void 0;var n=function(){function t(){}return t.prototype.setDb=function(t){this.db=t},t.prototype.setTagsLinksStorage=function(t){this.tagsLinksStorage=t},t.prototype.getTagsWithLinks=function(){return i(this,void 0,void 0,(function(){var t,e,n,r;return o(this,(function(i){switch(i.label){case 0:return[4,this.db.tags.toArray()];case 1:return t=i.sent(),[4,this.tagsLinksStorage.getList()];case 2:for(n in e=(e=i.sent()).reduce((function(t,e){var n=e.from;return t[n]||(t[n]=[]),t[n].push(e),t}),{}),t)r=t[n].id,t[n].links=e[r]||[];return[2,Promise.resolve(t)]}}))}))},t.prototype.createTag=function(t){return this.db.tags.add(t)},t.prototype.updateTag=function(t){return this.db.tags.update(t.id,t)},t.prototype.deleteTag=function(t){return this.tagsLinksStorage.deleteFor(t),this.db.tags.where("id").equals(t).delete()},t}();e.TagsStorage=n}.apply(e,[n,e]),void 0===r||(t.exports=r)},1262:(t,e,n)=>{!function(t){"use strict";var e={autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,menuitem:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0,caseFold:!0},n={autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1,allowMissingTagName:!1,caseFold:!1};t.defineMode("xml",(function(r,i){var o,a,s=r.indentUnit,l={},u=i.htmlMode?e:n;for(var c in u)l[c]=u[c];for(var c in i)l[c]=i[c];function h(t,e){function n(n){return e.tokenize=n,n(t,e)}var r=t.next();return"<"==r?t.eat("!")?t.eat("[")?t.match("CDATA[")?n(p("atom","]]>")):null:t.match("--")?n(p("comment","--\x3e")):t.match("DOCTYPE",!0,!0)?(t.eatWhile(/[\w\._\-]/),n(g(1))):null:t.eat("?")?(t.eatWhile(/[\w\._\-]/),e.tokenize=p("meta","?>"),"meta"):(o=t.eat("/")?"closeTag":"openTag",e.tokenize=d,"tag bracket"):"&"==r?(t.eat("#")?t.eat("x")?t.eatWhile(/[a-fA-F\d]/)&&t.eat(";"):t.eatWhile(/[\d]/)&&t.eat(";"):t.eatWhile(/[\w\.\-:]/)&&t.eat(";"))?"atom":"error":(t.eatWhile(/[^&<]/),null)}function d(t,e){var n=t.next();if(">"==n||"/"==n&&t.eat(">"))return e.tokenize=h,o=">"==n?"endTag":"selfcloseTag","tag bracket";if("="==n)return o="equals",null;if("<"==n){e.tokenize=h,e.state=x,e.tagName=e.tagStart=null;var r=e.tokenize(t,e);return r?r+" tag error":"tag error"}return/[\'\"]/.test(n)?(e.tokenize=f(n),e.stringStartCol=t.column(),e.tokenize(t,e)):(t.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/),"word")}function f(t){var e=function(e,n){for(;!e.eol();)if(e.next()==t){n.tokenize=d;break}return"string"};return e.isInAttribute=!0,e}function p(t,e){return function(n,r){for(;!n.eol();){if(n.match(e)){r.tokenize=h;break}n.next()}return t}}function g(t){return function(e,n){for(var r;null!=(r=e.next());){if("<"==r)return n.tokenize=g(t+1),n.tokenize(e,n);if(">"==r){if(1==t){n.tokenize=h;break}return n.tokenize=g(t-1),n.tokenize(e,n)}}return"meta"}}function m(t){return t&&t.toLowerCase()}function v(t,e,n){this.prev=t.context,this.tagName=e||"",this.indent=t.indented,this.startOfLine=n,(l.doNotIndent.hasOwnProperty(e)||t.context&&t.context.noIndent)&&(this.noIndent=!0)}function y(t){t.context&&(t.context=t.context.prev)}function b(t,e){for(var n;;){if(!t.context)return;if(n=t.context.tagName,!l.contextGrabbers.hasOwnProperty(m(n))||!l.contextGrabbers[m(n)].hasOwnProperty(m(e)))return;y(t)}}function x(t,e,n){return"openTag"==t?(n.tagStart=e.column(),w):"closeTag"==t?C:x}function w(t,e,n){return"word"==t?(n.tagName=e.current(),a="tag",_):l.allowMissingTagName&&"endTag"==t?(a="tag bracket",_(t,e,n)):(a="error",w)}function C(t,e,n){if("word"==t){var r=e.current();return n.context&&n.context.tagName!=r&&l.implicitlyClosed.hasOwnProperty(m(n.context.tagName))&&y(n),n.context&&n.context.tagName==r||!1===l.matchClosing?(a="tag",k):(a="tag error",S)}return l.allowMissingTagName&&"endTag"==t?(a="tag bracket",k(t,e,n)):(a="error",S)}function k(t,e,n){return"endTag"!=t?(a="error",k):(y(n),x)}function S(t,e,n){return a="error",k(t,e,n)}function _(t,e,n){if("word"==t)return a="attribute",D;if("endTag"==t||"selfcloseTag"==t){var r=n.tagName,i=n.tagStart;return n.tagName=n.tagStart=null,"selfcloseTag"==t||l.autoSelfClosers.hasOwnProperty(m(r))?b(n,r):(b(n,r),n.context=new v(n,r,i==n.indented)),x}return a="error",_}function D(t,e,n){return"equals"==t?A:(l.allowMissing||(a="error"),_(t,e,n))}function A(t,e,n){return"string"==t?T:"word"==t&&l.allowUnquoted?(a="string",_):(a="error",_(t,e,n))}function T(t,e,n){return"string"==t?T:_(t,e,n)}return h.isInText=!0,{startState:function(t){var e={tokenize:h,state:x,indented:t||0,tagName:null,tagStart:null,context:null};return null!=t&&(e.baseIndent=t),e},token:function(t,e){if(!e.tagName&&t.sol()&&(e.indented=t.indentation()),t.eatSpace())return null;o=null;var n=e.tokenize(t,e);return(n||o)&&"comment"!=n&&(a=null,e.state=e.state(o||n,t,e),a&&(n="error"==a?n+" error":a)),n},indent:function(e,n,r){var i=e.context;if(e.tokenize.isInAttribute)return e.tagStart==e.indented?e.stringStartCol+1:e.indented+s;if(i&&i.noIndent)return t.Pass;if(e.tokenize!=d&&e.tokenize!=h)return r?r.match(/^(\s*)/)[0].length:0;if(e.tagName)return!1!==l.multilineTagIndentPastTag?e.tagStart+e.tagName.length+2:e.tagStart+s*(l.multilineTagIndentFactor||1);if(l.alignCDATA&&/<!\[CDATA\[/.test(n))return 0;var o=n&&/^<(\/)?([\w_:\.-]*)/.exec(n);if(o&&o[1])for(;i;){if(i.tagName==o[2]){i=i.prev;break}if(!l.implicitlyClosed.hasOwnProperty(m(i.tagName)))break;i=i.prev}else if(o)for(;i;){var a=l.contextGrabbers[m(i.tagName)];if(!a||!a.hasOwnProperty(m(o[2])))break;i=i.prev}for(;i&&i.prev&&!i.startOfLine;)i=i.prev;return i?i.indent+s:e.baseIndent||0},electricInput:/<\/[\s\w:]+>$/,blockCommentStart:"\x3c!--",blockCommentEnd:"--\x3e",configuration:l.htmlMode?"html":"xml",helperType:l.htmlMode?"html":"xml",skipAttribute:function(t){t.state==A&&(t.state=_)},xmlCurrentTag:function(t){return t.tagName?{name:t.tagName,close:"closeTag"==t.type}:null},xmlCurrentContext:function(t){for(var e=[],n=t.context;n;n=n.prev)e.push(n.tagName);return e.reverse()}}})),t.defineMIME("text/xml","xml"),t.defineMIME("application/xml","xml"),t.mimeModes.hasOwnProperty("text/html")||t.defineMIME("text/html",{name:"xml",htmlMode:!0})}(n(1719))},1269:(t,e,n)=>{var r;r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LayersPanel=void 0;var n=function(){function t(){this.labels=[]}return t.prototype.setAppCommands=function(t){this.appCommands=t},t.prototype.setAppBus=function(t){this.appBus=t},t.prototype.setCurrentBoard=function(t){var e=this;this.currentBoard=t,this.appCommands.getLayers(this.currentBoard.id).then((function(t){if(t.success)for(var n in t.layers){var r=e.createLabel();r.load(t.layers[n]),e.labelsContainer.append(r.getTemplate()),r.eventsListen(),e.labels.push(r)}}))},t.prototype.clear=function(){this.labels=[],this.labelsContainer.innerHTML=""},t.prototype.init=function(t){var e=this;this.container=t,this.newLayerBtn=this.container.querySelector(".js-new-layer-btn"),this.labelsContainer=this.container.querySelector(".js-labels-container"),this.newLayerBtn.onclick=function(){var t=prompt("Name");if(t){var n=e.currentBoard.id;e.appCommands.createLayer(n,t).then((function(n){var r=e.createLabel();r.load({id:n.layer.id,name:t}),e.labelsContainer.append(r.getTemplate()),r.eventsListen(),e.labels.push(r)}))}}},t.prototype.createLabel=function(){var t=this,e=new r;return e.setAppCommands(this.appCommands),e.setOnClick((function(e){for(var n in t.labels)t.labels[n]!==e?t.labels[n].setActive(!1):(t.labels[n].setActive(!0),t.appBus.setCurrentLayer(e.getData().id))})),e.setOnCheckboxClick((function(e){var n=[];for(var r in t.labels)t.labels[r].isChecked()&&n.push(t.labels[r].getData().id);t.appBus.setVisibleLayers(n)})),e.setOnDeleted((function(e){for(var n in t.labels)if(t.labels[n]===e){t.labels[n].getTemplate().remove(),delete t.labels[n];break}})),e},t}();e.LayersPanel=n;var r=function(){function t(){this.html='\n        <div style="cursor: pointer;">\n            <input class="js-checkbox" type="checkbox" value="">\n            <span class="js-title"></span>\n            <span class="js-delete-btn" style="margin-left: 10px;">×</span>\n        </div>\n    ';var t=document.createElement("div");t.innerHTML=this.html.trim(),this.template=t.firstChild,this.checkbox=this.template.querySelector(".js-checkbox"),this.title=this.template.querySelector(".js-title"),this.deleteBtn=this.template.querySelector(".js-delete-btn")}return t.prototype.getTemplate=function(){return this.template},t.prototype.getData=function(){return this.data},t.prototype.setOnClick=function(t){this.onClick=t},t.prototype.setOnDeleted=function(t){this.onDeleted=t},t.prototype.setOnCheckboxClick=function(t){this.onCheckboxClick=t},t.prototype.isChecked=function(){return this.checkbox.checked},t.prototype.setAppCommands=function(t){this.appCommands=t},t.prototype.eventsListen=function(){var t=this;this.template.onclick=function(){t.onClick(t)},this.checkbox.onclick=function(e){e.stopPropagation(),t.onCheckboxClick(t)},this.deleteBtn.onclick=function(e){confirm("Delete Layer?")&&(e.stopPropagation(),t.appCommands.deleteLayer(t.data.id),t.onDeleted(t))}},t.prototype.load=function(t){this.data=t,this.title.innerText=t.name},t.prototype.setActive=function(t){t?this.template.style.fontWeight="bold":this.template.style.removeProperty("font-weight")},t}()}.apply(e,[n,e]),void 0===r||(t.exports=r)},1335:(t,e,n)=>{!function(t){"use strict";function e(t){t.state.markedSelection&&t.operation((function(){u(t)}))}function n(t){t.state.markedSelection&&t.state.markedSelection.length&&t.operation((function(){s(t)}))}t.defineOption("styleSelectedText",!1,(function(r,i,o){var a=o&&o!=t.Init;i&&!a?(r.state.markedSelection=[],r.state.markedSelectionStyle="string"==typeof i?i:"CodeMirror-selectedtext",l(r),r.on("cursorActivity",e),r.on("change",n)):!i&&a&&(r.off("cursorActivity",e),r.off("change",n),s(r),r.state.markedSelection=r.state.markedSelectionStyle=null)}));var r=8,i=t.Pos,o=t.cmpPos;function a(t,e,n,a){if(0!=o(e,n))for(var s=t.state.markedSelection,l=t.state.markedSelectionStyle,u=e.line;;){var c=u==e.line?e:i(u,0),h=u+r,d=h>=n.line,f=d?n:i(h,0),p=t.markText(c,f,{className:l});if(null==a?s.push(p):s.splice(a++,0,p),d)break;u=h}}function s(t){for(var e=t.state.markedSelection,n=0;n<e.length;++n)e[n].clear();e.length=0}function l(t){s(t);for(var e=t.listSelections(),n=0;n<e.length;n++)a(t,e[n].from(),e[n].to())}function u(t){if(!t.somethingSelected())return s(t);if(t.listSelections().length>1)return l(t);var e=t.getCursor("start"),n=t.getCursor("end"),i=t.state.markedSelection;if(!i.length)return a(t,e,n);var u=i[0].find(),c=i[i.length-1].find();if(!u||!c||n.line-e.line<=r||o(e,c.to)>=0||o(n,u.from)<=0)return l(t);for(;o(e,u.from)>0;)i.shift().clear(),u=i[0].find();for(o(e,u.from)<0&&(u.to.line-e.line<r?(i.shift().clear(),a(t,e,u.to,0)):a(t,e,u.from,0));o(n,c.to)<0;)i.pop().clear(),c=i[i.length-1].find();o(n,c.to)>0&&(n.line-c.from.line<r?(i.pop().clear(),a(t,c.from,n)):a(t,c.to,n))}}(n(1719))},1453:(t,e,n)=>{var r;r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NotesLinksStorage=void 0;var n=function(){function t(){}return t.prototype.setDb=function(t){this.db=t},t.prototype.add=function(t){this.db.notesLinks.add(t)},t.prototype.getList=function(t){return this.db.notesLinks.where("boardId").equals(t).toArray()},t.prototype.delete=function(t){return this.db.notesLinks.where("id").equals(t).delete()},t.prototype.deleteFor=function(t){var e=this.db.notesLinks;e.where("from").equals(t).delete(),(e=this.db.notesLinks).where("to").equals(t).delete()},t.prototype.link=function(t,e,n,r){return this.db.notesLinks.add({id:"link_"+this.getRandomString(32),boardId:r,layerId:n,from:t,to:e})},t.prototype.unlink=function(t,e,n){return this.db.notesLinks.where("from").equals(t).and((function(t){return t.to==e})).and((function(t){return t.layerId==n})).delete()},t.prototype.deleteForBoard=function(t){return this.db.notesLinks.where("boardId").equals(t).delete()},t.prototype.deleteForLayer=function(t){return this.db.notesLinks.where("layerId").equals(t).delete()},t.prototype.getRandomString=function(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;r<t;r++)n+=e.charAt(Math.floor(62*Math.random()));return n},t}();e.NotesLinksStorage=n}.apply(e,[n,e]),void 0===r||(t.exports=r)},1713:(t,e,n)=>{var r,i;r=[n,e,n(2058)],i=function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;var r=function(){function t(){}return t.prototype.setAppFactory=function(t){this.appFactory=t},t.prototype.getAppCommands=function(){if(this.appCommands)return this.appCommands;this.appCommands=new n.AppComamnds;var t=this.appFactory.getStorageFactory().getBoardsStorage();this.appCommands.setBoardsStorage(t);var e=this.appFactory.getStorageFactory().getNotesStorage();this.appCommands.setNotesStorage(e);var r=this.appFactory.getStorageFactory().getNotesLinksStorage();this.appCommands.setNotesLinksStorage(r);var i=this.appFactory.getStorageFactory().getTagsStorage();this.appCommands.setTagsStorage(i);var o=this.appFactory.getStorageFactory().getTagsLinksStorage();this.appCommands.setTagsLinksStorage(o);var a=this.appFactory.getStorageFactory().getLayersStorage();return this.appCommands.setLayersStorage(a),this.appCommands},t}();e.Factory=r}.apply(e,r),void 0===i||(t.exports=i)},1719:function(t){t.exports=function(){"use strict";var t=navigator.userAgent,e=navigator.platform,n=/gecko\/\d/i.test(t),r=/MSIE \d/.test(t),i=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(t),o=/Edge\/(\d+)/.exec(t),a=r||i||o,s=a&&(r?document.documentMode||6:+(o||i)[1]),l=!o&&/WebKit\//.test(t),u=l&&/Qt\/\d+\.\d+/.test(t),c=!o&&/Chrome\/(\d+)/.exec(t),h=c&&+c[1],d=/Opera\//.test(t),f=/Apple Computer/.test(navigator.vendor),p=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(t),g=/PhantomJS/.test(t),m=f&&(/Mobile\/\w+/.test(t)||navigator.maxTouchPoints>2),v=/Android/.test(t),y=m||v||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(t),b=m||/Mac/.test(e),x=/\bCrOS\b/.test(t),w=/win/i.test(e),C=d&&t.match(/Version\/(\d*\.\d*)/);C&&(C=Number(C[1])),C&&C>=15&&(d=!1,l=!0);var k=b&&(u||d&&(null==C||C<12.11)),S=n||a&&s>=9;function _(t){return new RegExp("(^|\\s)"+t+"(?:$|\\s)\\s*")}var D,A=function(t,e){var n=t.className,r=_(e).exec(n);if(r){var i=n.slice(r.index+r[0].length);t.className=n.slice(0,r.index)+(i?r[1]+i:"")}};function T(t){for(var e=t.childNodes.length;e>0;--e)t.removeChild(t.firstChild);return t}function E(t,e){return T(t).appendChild(e)}function F(t,e,n,r){var i=document.createElement(t);if(n&&(i.className=n),r&&(i.style.cssText=r),"string"==typeof e)i.appendChild(document.createTextNode(e));else if(e)for(var o=0;o<e.length;++o)i.appendChild(e[o]);return i}function L(t,e,n,r){var i=F(t,e,n,r);return i.setAttribute("role","presentation"),i}function P(t,e){if(3==e.nodeType&&(e=e.parentNode),t.contains)return t.contains(e);do{if(11==e.nodeType&&(e=e.host),e==t)return!0}while(e=e.parentNode)}function O(t){var e,n=t.ownerDocument||t;try{e=t.activeElement}catch(t){e=n.body||null}for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}function M(t,e){var n=t.className;_(e).test(n)||(t.className+=(n?" ":"")+e)}function B(t,e){for(var n=t.split(" "),r=0;r<n.length;r++)n[r]&&!_(n[r]).test(e)&&(e+=" "+n[r]);return e}D=document.createRange?function(t,e,n,r){var i=document.createRange();return i.setEnd(r||t,n),i.setStart(t,e),i}:function(t,e,n){var r=document.body.createTextRange();try{r.moveToElementText(t.parentNode)}catch(t){return r}return r.collapse(!0),r.moveEnd("character",n),r.moveStart("character",e),r};var N=function(t){t.select()};function I(t){return t.display.wrapper.ownerDocument}function R(t){return j(t.display.wrapper)}function j(t){return t.getRootNode?t.getRootNode():t.ownerDocument}function z(t){return I(t).defaultView}function H(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e)}}function G(t,e,n){for(var r in e||(e={}),t)!t.hasOwnProperty(r)||!1===n&&e.hasOwnProperty(r)||(e[r]=t[r]);return e}function W(t,e,n,r,i){null==e&&-1==(e=t.search(/[^\s\u00a0]/))&&(e=t.length);for(var o=r||0,a=i||0;;){var s=t.indexOf("\t",o);if(s<0||s>=e)return a+(e-o);a+=s-o,a+=n-a%n,o=s+1}}m?N=function(t){t.selectionStart=0,t.selectionEnd=t.value.length}:a&&(N=function(t){try{t.select()}catch(t){}});var q=function(){this.id=null,this.f=null,this.time=0,this.handler=H(this.onTimeout,this)};function U(t,e){for(var n=0;n<t.length;++n)if(t[n]==e)return n;return-1}q.prototype.onTimeout=function(t){t.id=0,t.time<=+new Date?t.f():setTimeout(t.handler,t.time-+new Date)},q.prototype.set=function(t,e){this.f=e;var n=+new Date+t;(!this.id||n<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,t),this.time=n)};var K=50,$={toString:function(){return"CodeMirror.Pass"}},Y={scroll:!1},V={origin:"*mouse"},X={origin:"+move"};function J(t,e,n){for(var r=0,i=0;;){var o=t.indexOf("\t",r);-1==o&&(o=t.length);var a=o-r;if(o==t.length||i+a>=e)return r+Math.min(a,e-i);if(i+=o-r,r=o+1,(i+=n-i%n)>=e)return r}}var Q=[""];function Z(t){for(;Q.length<=t;)Q.push(tt(Q)+" ");return Q[t]}function tt(t){return t[t.length-1]}function et(t,e){for(var n=[],r=0;r<t.length;r++)n[r]=e(t[r],r);return n}function nt(t,e,n){for(var r=0,i=n(e);r<t.length&&n(t[r])<=i;)r++;t.splice(r,0,e)}function rt(){}function it(t,e){var n;return Object.create?n=Object.create(t):(rt.prototype=t,n=new rt),e&&G(e,n),n}var ot=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function at(t){return/\w/.test(t)||t>""&&(t.toUpperCase()!=t.toLowerCase()||ot.test(t))}function st(t,e){return e?!!(e.source.indexOf("\\w")>-1&&at(t))||e.test(t):at(t)}function lt(t){for(var e in t)if(t.hasOwnProperty(e)&&t[e])return!1;return!0}var ut=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function ct(t){return t.charCodeAt(0)>=768&&ut.test(t)}function ht(t,e,n){for(;(n<0?e>0:e<t.length)&&ct(t.charAt(e));)e+=n;return e}function dt(t,e,n){for(var r=e>n?-1:1;;){if(e==n)return e;var i=(e+n)/2,o=r<0?Math.ceil(i):Math.floor(i);if(o==e)return t(o)?e:n;t(o)?n=o:e=o+r}}function ft(t,e,n,r){if(!t)return r(e,n,"ltr",0);for(var i=!1,o=0;o<t.length;++o){var a=t[o];(a.from<n&&a.to>e||e==n&&a.to==e)&&(r(Math.max(a.from,e),Math.min(a.to,n),1==a.level?"rtl":"ltr",o),i=!0)}i||r(e,n,"ltr")}var pt=null;function gt(t,e,n){var r;pt=null;for(var i=0;i<t.length;++i){var o=t[i];if(o.from<e&&o.to>e)return i;o.to==e&&(o.from!=o.to&&"before"==n?r=i:pt=i),o.from==e&&(o.from!=o.to&&"before"!=n?r=i:pt=i)}return null!=r?r:pt}var mt=function(){var t="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",e="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";function n(n){return n<=247?t.charAt(n):1424<=n&&n<=1524?"R":1536<=n&&n<=1785?e.charAt(n-1536):1774<=n&&n<=2220?"r":8192<=n&&n<=8203?"w":8204==n?"b":"L"}var r=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,i=/[stwN]/,o=/[LRr]/,a=/[Lb1n]/,s=/[1n]/;function l(t,e,n){this.level=t,this.from=e,this.to=n}return function(t,e){var u="ltr"==e?"L":"R";if(0==t.length||"ltr"==e&&!r.test(t))return!1;for(var c=t.length,h=[],d=0;d<c;++d)h.push(n(t.charCodeAt(d)));for(var f=0,p=u;f<c;++f){var g=h[f];"m"==g?h[f]=p:p=g}for(var m=0,v=u;m<c;++m){var y=h[m];"1"==y&&"r"==v?h[m]="n":o.test(y)&&(v=y,"r"==y&&(h[m]="R"))}for(var b=1,x=h[0];b<c-1;++b){var w=h[b];"+"==w&&"1"==x&&"1"==h[b+1]?h[b]="1":","!=w||x!=h[b+1]||"1"!=x&&"n"!=x||(h[b]=x),x=w}for(var C=0;C<c;++C){var k=h[C];if(","==k)h[C]="N";else if("%"==k){var S=void 0;for(S=C+1;S<c&&"%"==h[S];++S);for(var _=C&&"!"==h[C-1]||S<c&&"1"==h[S]?"1":"N",D=C;D<S;++D)h[D]=_;C=S-1}}for(var A=0,T=u;A<c;++A){var E=h[A];"L"==T&&"1"==E?h[A]="L":o.test(E)&&(T=E)}for(var F=0;F<c;++F)if(i.test(h[F])){var L=void 0;for(L=F+1;L<c&&i.test(h[L]);++L);for(var P="L"==(F?h[F-1]:u),O=P==("L"==(L<c?h[L]:u))?P?"L":"R":u,M=F;M<L;++M)h[M]=O;F=L-1}for(var B,N=[],I=0;I<c;)if(a.test(h[I])){var R=I;for(++I;I<c&&a.test(h[I]);++I);N.push(new l(0,R,I))}else{var j=I,z=N.length,H="rtl"==e?1:0;for(++I;I<c&&"L"!=h[I];++I);for(var G=j;G<I;)if(s.test(h[G])){j<G&&(N.splice(z,0,new l(1,j,G)),z+=H);var W=G;for(++G;G<I&&s.test(h[G]);++G);N.splice(z,0,new l(2,W,G)),z+=H,j=G}else++G;j<I&&N.splice(z,0,new l(1,j,I))}return"ltr"==e&&(1==N[0].level&&(B=t.match(/^\s+/))&&(N[0].from=B[0].length,N.unshift(new l(0,0,B[0].length))),1==tt(N).level&&(B=t.match(/\s+$/))&&(tt(N).to-=B[0].length,N.push(new l(0,c-B[0].length,c)))),"rtl"==e?N.reverse():N}}();function vt(t,e){var n=t.order;return null==n&&(n=t.order=mt(t.text,e)),n}var yt=[],bt=function(t,e,n){if(t.addEventListener)t.addEventListener(e,n,!1);else if(t.attachEvent)t.attachEvent("on"+e,n);else{var r=t._handlers||(t._handlers={});r[e]=(r[e]||yt).concat(n)}};function xt(t,e){return t._handlers&&t._handlers[e]||yt}function wt(t,e,n){if(t.removeEventListener)t.removeEventListener(e,n,!1);else if(t.detachEvent)t.detachEvent("on"+e,n);else{var r=t._handlers,i=r&&r[e];if(i){var o=U(i,n);o>-1&&(r[e]=i.slice(0,o).concat(i.slice(o+1)))}}}function Ct(t,e){var n=xt(t,e);if(n.length)for(var r=Array.prototype.slice.call(arguments,2),i=0;i<n.length;++i)n[i].apply(null,r)}function kt(t,e,n){return"string"==typeof e&&(e={type:e,preventDefault:function(){this.defaultPrevented=!0}}),Ct(t,n||e.type,t,e),Et(e)||e.codemirrorIgnore}function St(t){var e=t._handlers&&t._handlers.cursorActivity;if(e)for(var n=t.curOp.cursorActivityHandlers||(t.curOp.cursorActivityHandlers=[]),r=0;r<e.length;++r)-1==U(n,e[r])&&n.push(e[r])}function _t(t,e){return xt(t,e).length>0}function Dt(t){t.prototype.on=function(t,e){bt(this,t,e)},t.prototype.off=function(t,e){wt(this,t,e)}}function At(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function Tt(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}function Et(t){return null!=t.defaultPrevented?t.defaultPrevented:0==t.returnValue}function Ft(t){At(t),Tt(t)}function Lt(t){return t.target||t.srcElement}function Pt(t){var e=t.which;return null==e&&(1&t.button?e=1:2&t.button?e=3:4&t.button&&(e=2)),b&&t.ctrlKey&&1==e&&(e=3),e}var Ot,Mt,Bt=function(){if(a&&s<9)return!1;var t=F("div");return"draggable"in t||"dragDrop"in t}();function Nt(t){if(null==Ot){var e=F("span","​");E(t,F("span",[e,document.createTextNode("x")])),0!=t.firstChild.offsetHeight&&(Ot=e.offsetWidth<=1&&e.offsetHeight>2&&!(a&&s<8))}var n=Ot?F("span","​"):F("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return n.setAttribute("cm-text",""),n}function It(t){if(null!=Mt)return Mt;var e=E(t,document.createTextNode("AخA")),n=D(e,0,1).getBoundingClientRect(),r=D(e,1,2).getBoundingClientRect();return T(t),!(!n||n.left==n.right)&&(Mt=r.right-n.right<3)}var Rt,jt=3!="\n\nb".split(/\n/).length?function(t){for(var e=0,n=[],r=t.length;e<=r;){var i=t.indexOf("\n",e);-1==i&&(i=t.length);var o=t.slice(e,"\r"==t.charAt(i-1)?i-1:i),a=o.indexOf("\r");-1!=a?(n.push(o.slice(0,a)),e+=a+1):(n.push(o),e=i+1)}return n}:function(t){return t.split(/\r\n?|\n/)},zt=window.getSelection?function(t){try{return t.selectionStart!=t.selectionEnd}catch(t){return!1}}:function(t){var e;try{e=t.ownerDocument.selection.createRange()}catch(t){}return!(!e||e.parentElement()!=t)&&0!=e.compareEndPoints("StartToEnd",e)},Ht="oncopy"in(Rt=F("div"))||(Rt.setAttribute("oncopy","return;"),"function"==typeof Rt.oncopy),Gt=null;function Wt(t){if(null!=Gt)return Gt;var e=E(t,F("span","x")),n=e.getBoundingClientRect(),r=D(e,0,1).getBoundingClientRect();return Gt=Math.abs(n.left-r.left)>1}var qt={},Ut={};function Kt(t,e){arguments.length>2&&(e.dependencies=Array.prototype.slice.call(arguments,2)),qt[t]=e}function $t(t,e){Ut[t]=e}function Yt(t){if("string"==typeof t&&Ut.hasOwnProperty(t))t=Ut[t];else if(t&&"string"==typeof t.name&&Ut.hasOwnProperty(t.name)){var e=Ut[t.name];"string"==typeof e&&(e={name:e}),(t=it(e,t)).name=e.name}else{if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return Yt("application/xml");if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+json$/.test(t))return Yt("application/json")}return"string"==typeof t?{name:t}:t||{name:"null"}}function Vt(t,e){e=Yt(e);var n=qt[e.name];if(!n)return Vt(t,"text/plain");var r=n(t,e);if(Xt.hasOwnProperty(e.name)){var i=Xt[e.name];for(var o in i)i.hasOwnProperty(o)&&(r.hasOwnProperty(o)&&(r["_"+o]=r[o]),r[o]=i[o])}if(r.name=e.name,e.helperType&&(r.helperType=e.helperType),e.modeProps)for(var a in e.modeProps)r[a]=e.modeProps[a];return r}var Xt={};function Jt(t,e){G(e,Xt.hasOwnProperty(t)?Xt[t]:Xt[t]={})}function Qt(t,e){if(!0===e)return e;if(t.copyState)return t.copyState(e);var n={};for(var r in e){var i=e[r];i instanceof Array&&(i=i.concat([])),n[r]=i}return n}function Zt(t,e){for(var n;t.innerMode&&(n=t.innerMode(e))&&n.mode!=t;)e=n.state,t=n.mode;return n||{mode:t,state:e}}function te(t,e,n){return!t.startState||t.startState(e,n)}var ee=function(t,e,n){this.pos=this.start=0,this.string=t,this.tabSize=e||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=n};function ne(t,e){if((e-=t.first)<0||e>=t.size)throw new Error("There is no line "+(e+t.first)+" in the document.");for(var n=t;!n.lines;)for(var r=0;;++r){var i=n.children[r],o=i.chunkSize();if(e<o){n=i;break}e-=o}return n.lines[e]}function re(t,e,n){var r=[],i=e.line;return t.iter(e.line,n.line+1,(function(t){var o=t.text;i==n.line&&(o=o.slice(0,n.ch)),i==e.line&&(o=o.slice(e.ch)),r.push(o),++i})),r}function ie(t,e,n){var r=[];return t.iter(e,n,(function(t){r.push(t.text)})),r}function oe(t,e){var n=e-t.height;if(n)for(var r=t;r;r=r.parent)r.height+=n}function ae(t){if(null==t.parent)return null;for(var e=t.parent,n=U(e.lines,t),r=e.parent;r;e=r,r=r.parent)for(var i=0;r.children[i]!=e;++i)n+=r.children[i].chunkSize();return n+e.first}function se(t,e){var n=t.first;t:do{for(var r=0;r<t.children.length;++r){var i=t.children[r],o=i.height;if(e<o){t=i;continue t}e-=o,n+=i.chunkSize()}return n}while(!t.lines);for(var a=0;a<t.lines.length;++a){var s=t.lines[a].height;if(e<s)break;e-=s}return n+a}function le(t,e){return e>=t.first&&e<t.first+t.size}function ue(t,e){return String(t.lineNumberFormatter(e+t.firstLineNumber))}function ce(t,e,n){if(void 0===n&&(n=null),!(this instanceof ce))return new ce(t,e,n);this.line=t,this.ch=e,this.sticky=n}function he(t,e){return t.line-e.line||t.ch-e.ch}function de(t,e){return t.sticky==e.sticky&&0==he(t,e)}function fe(t){return ce(t.line,t.ch)}function pe(t,e){return he(t,e)<0?e:t}function ge(t,e){return he(t,e)<0?t:e}function me(t,e){return Math.max(t.first,Math.min(e,t.first+t.size-1))}function ve(t,e){if(e.line<t.first)return ce(t.first,0);var n=t.first+t.size-1;return e.line>n?ce(n,ne(t,n).text.length):ye(e,ne(t,e.line).text.length)}function ye(t,e){var n=t.ch;return null==n||n>e?ce(t.line,e):n<0?ce(t.line,0):t}function be(t,e){for(var n=[],r=0;r<e.length;r++)n[r]=ve(t,e[r]);return n}ee.prototype.eol=function(){return this.pos>=this.string.length},ee.prototype.sol=function(){return this.pos==this.lineStart},ee.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},ee.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},ee.prototype.eat=function(t){var e=this.string.charAt(this.pos);if("string"==typeof t?e==t:e&&(t.test?t.test(e):t(e)))return++this.pos,e},ee.prototype.eatWhile=function(t){for(var e=this.pos;this.eat(t););return this.pos>e},ee.prototype.eatSpace=function(){for(var t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t},ee.prototype.skipToEnd=function(){this.pos=this.string.length},ee.prototype.skipTo=function(t){var e=this.string.indexOf(t,this.pos);if(e>-1)return this.pos=e,!0},ee.prototype.backUp=function(t){this.pos-=t},ee.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=W(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?W(this.string,this.lineStart,this.tabSize):0)},ee.prototype.indentation=function(){return W(this.string,null,this.tabSize)-(this.lineStart?W(this.string,this.lineStart,this.tabSize):0)},ee.prototype.match=function(t,e,n){if("string"!=typeof t){var r=this.string.slice(this.pos).match(t);return r&&r.index>0?null:(r&&!1!==e&&(this.pos+=r[0].length),r)}var i=function(t){return n?t.toLowerCase():t};if(i(this.string.substr(this.pos,t.length))==i(t))return!1!==e&&(this.pos+=t.length),!0},ee.prototype.current=function(){return this.string.slice(this.start,this.pos)},ee.prototype.hideFirstChars=function(t,e){this.lineStart+=t;try{return e()}finally{this.lineStart-=t}},ee.prototype.lookAhead=function(t){var e=this.lineOracle;return e&&e.lookAhead(t)},ee.prototype.baseToken=function(){var t=this.lineOracle;return t&&t.baseToken(this.pos)};var xe=function(t,e){this.state=t,this.lookAhead=e},we=function(t,e,n,r){this.state=e,this.doc=t,this.line=n,this.maxLookAhead=r||0,this.baseTokens=null,this.baseTokenPos=1};function Ce(t,e,n,r){var i=[t.state.modeGen],o={};Le(t,e.text,t.doc.mode,n,(function(t,e){return i.push(t,e)}),o,r);for(var a=n.state,s=function(r){n.baseTokens=i;var s=t.state.overlays[r],l=1,u=0;n.state=!0,Le(t,e.text,s.mode,n,(function(t,e){for(var n=l;u<t;){var r=i[l];r>t&&i.splice(l,1,t,i[l+1],r),l+=2,u=Math.min(t,r)}if(e)if(s.opaque)i.splice(n,l-n,t,"overlay "+e),l=n+2;else for(;n<l;n+=2){var o=i[n+1];i[n+1]=(o?o+" ":"")+"overlay "+e}}),o),n.state=a,n.baseTokens=null,n.baseTokenPos=1},l=0;l<t.state.overlays.length;++l)s(l);return{styles:i,classes:o.bgClass||o.textClass?o:null}}function ke(t,e,n){if(!e.styles||e.styles[0]!=t.state.modeGen){var r=Se(t,ae(e)),i=e.text.length>t.options.maxHighlightLength&&Qt(t.doc.mode,r.state),o=Ce(t,e,r);i&&(r.state=i),e.stateAfter=r.save(!i),e.styles=o.styles,o.classes?e.styleClasses=o.classes:e.styleClasses&&(e.styleClasses=null),n===t.doc.highlightFrontier&&(t.doc.modeFrontier=Math.max(t.doc.modeFrontier,++t.doc.highlightFrontier))}return e.styles}function Se(t,e,n){var r=t.doc,i=t.display;if(!r.mode.startState)return new we(r,!0,e);var o=Pe(t,e,n),a=o>r.first&&ne(r,o-1).stateAfter,s=a?we.fromSaved(r,a,o):new we(r,te(r.mode),o);return r.iter(o,e,(function(n){_e(t,n.text,s);var r=s.line;n.stateAfter=r==e-1||r%5==0||r>=i.viewFrom&&r<i.viewTo?s.save():null,s.nextLine()})),n&&(r.modeFrontier=s.line),s}function _e(t,e,n,r){var i=t.doc.mode,o=new ee(e,t.options.tabSize,n);for(o.start=o.pos=r||0,""==e&&De(i,n.state);!o.eol();)Ae(i,o,n.state),o.start=o.pos}function De(t,e){if(t.blankLine)return t.blankLine(e);if(t.innerMode){var n=Zt(t,e);return n.mode.blankLine?n.mode.blankLine(n.state):void 0}}function Ae(t,e,n,r){for(var i=0;i<10;i++){r&&(r[0]=Zt(t,n).mode);var o=t.token(e,n);if(e.pos>e.start)return o}throw new Error("Mode "+t.name+" failed to advance stream.")}we.prototype.lookAhead=function(t){var e=this.doc.getLine(this.line+t);return null!=e&&t>this.maxLookAhead&&(this.maxLookAhead=t),e},we.prototype.baseToken=function(t){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=t;)this.baseTokenPos+=2;var e=this.baseTokens[this.baseTokenPos+1];return{type:e&&e.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-t}},we.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},we.fromSaved=function(t,e,n){return e instanceof xe?new we(t,Qt(t.mode,e.state),n,e.lookAhead):new we(t,Qt(t.mode,e),n)},we.prototype.save=function(t){var e=!1!==t?Qt(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new xe(e,this.maxLookAhead):e};var Te=function(t,e,n){this.start=t.start,this.end=t.pos,this.string=t.current(),this.type=e||null,this.state=n};function Ee(t,e,n,r){var i,o,a=t.doc,s=a.mode,l=ne(a,(e=ve(a,e)).line),u=Se(t,e.line,n),c=new ee(l.text,t.options.tabSize,u);for(r&&(o=[]);(r||c.pos<e.ch)&&!c.eol();)c.start=c.pos,i=Ae(s,c,u.state),r&&o.push(new Te(c,i,Qt(a.mode,u.state)));return r?o:new Te(c,i,u.state)}function Fe(t,e){if(t)for(;;){var n=t.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!n)break;t=t.slice(0,n.index)+t.slice(n.index+n[0].length);var r=n[1]?"bgClass":"textClass";null==e[r]?e[r]=n[2]:new RegExp("(?:^|\\s)"+n[2]+"(?:$|\\s)").test(e[r])||(e[r]+=" "+n[2])}return t}function Le(t,e,n,r,i,o,a){var s=n.flattenSpans;null==s&&(s=t.options.flattenSpans);var l,u=0,c=null,h=new ee(e,t.options.tabSize,r),d=t.options.addModeClass&&[null];for(""==e&&Fe(De(n,r.state),o);!h.eol();){if(h.pos>t.options.maxHighlightLength?(s=!1,a&&_e(t,e,r,h.pos),h.pos=e.length,l=null):l=Fe(Ae(n,h,r.state,d),o),d){var f=d[0].name;f&&(l="m-"+(l?f+" "+l:f))}if(!s||c!=l){for(;u<h.start;)i(u=Math.min(h.start,u+5e3),c);c=l}h.start=h.pos}for(;u<h.pos;){var p=Math.min(h.pos,u+5e3);i(p,c),u=p}}function Pe(t,e,n){for(var r,i,o=t.doc,a=n?-1:e-(t.doc.mode.innerMode?1e3:100),s=e;s>a;--s){if(s<=o.first)return o.first;var l=ne(o,s-1),u=l.stateAfter;if(u&&(!n||s+(u instanceof xe?u.lookAhead:0)<=o.modeFrontier))return s;var c=W(l.text,null,t.options.tabSize);(null==i||r>c)&&(i=s-1,r=c)}return i}function Oe(t,e){if(t.modeFrontier=Math.min(t.modeFrontier,e),!(t.highlightFrontier<e-10)){for(var n=t.first,r=e-1;r>n;r--){var i=ne(t,r).stateAfter;if(i&&(!(i instanceof xe)||r+i.lookAhead<e)){n=r+1;break}}t.highlightFrontier=Math.min(t.highlightFrontier,n)}}var Me=!1,Be=!1;function Ne(){Me=!0}function Ie(){Be=!0}function Re(t,e,n){this.marker=t,this.from=e,this.to=n}function je(t,e){if(t)for(var n=0;n<t.length;++n){var r=t[n];if(r.marker==e)return r}}function ze(t,e){for(var n,r=0;r<t.length;++r)t[r]!=e&&(n||(n=[])).push(t[r]);return n}function He(t,e,n){var r=n&&window.WeakSet&&(n.markedSpans||(n.markedSpans=new WeakSet));r&&t.markedSpans&&r.has(t.markedSpans)?t.markedSpans.push(e):(t.markedSpans=t.markedSpans?t.markedSpans.concat([e]):[e],r&&r.add(t.markedSpans)),e.marker.attachLine(t)}function Ge(t,e,n){var r;if(t)for(var i=0;i<t.length;++i){var o=t[i],a=o.marker;if(null==o.from||(a.inclusiveLeft?o.from<=e:o.from<e)||o.from==e&&"bookmark"==a.type&&(!n||!o.marker.insertLeft)){var s=null==o.to||(a.inclusiveRight?o.to>=e:o.to>e);(r||(r=[])).push(new Re(a,o.from,s?null:o.to))}}return r}function We(t,e,n){var r;if(t)for(var i=0;i<t.length;++i){var o=t[i],a=o.marker;if(null==o.to||(a.inclusiveRight?o.to>=e:o.to>e)||o.from==e&&"bookmark"==a.type&&(!n||o.marker.insertLeft)){var s=null==o.from||(a.inclusiveLeft?o.from<=e:o.from<e);(r||(r=[])).push(new Re(a,s?null:o.from-e,null==o.to?null:o.to-e))}}return r}function qe(t,e){if(e.full)return null;var n=le(t,e.from.line)&&ne(t,e.from.line).markedSpans,r=le(t,e.to.line)&&ne(t,e.to.line).markedSpans;if(!n&&!r)return null;var i=e.from.ch,o=e.to.ch,a=0==he(e.from,e.to),s=Ge(n,i,a),l=We(r,o,a),u=1==e.text.length,c=tt(e.text).length+(u?i:0);if(s)for(var h=0;h<s.length;++h){var d=s[h];if(null==d.to){var f=je(l,d.marker);f?u&&(d.to=null==f.to?null:f.to+c):d.to=i}}if(l)for(var p=0;p<l.length;++p){var g=l[p];null!=g.to&&(g.to+=c),null==g.from?je(s,g.marker)||(g.from=c,u&&(s||(s=[])).push(g)):(g.from+=c,u&&(s||(s=[])).push(g))}s&&(s=Ue(s)),l&&l!=s&&(l=Ue(l));var m=[s];if(!u){var v,y=e.text.length-2;if(y>0&&s)for(var b=0;b<s.length;++b)null==s[b].to&&(v||(v=[])).push(new Re(s[b].marker,null,null));for(var x=0;x<y;++x)m.push(v);m.push(l)}return m}function Ue(t){for(var e=0;e<t.length;++e){var n=t[e];null!=n.from&&n.from==n.to&&!1!==n.marker.clearWhenEmpty&&t.splice(e--,1)}return t.length?t:null}function Ke(t,e,n){var r=null;if(t.iter(e.line,n.line+1,(function(t){if(t.markedSpans)for(var e=0;e<t.markedSpans.length;++e){var n=t.markedSpans[e].marker;!n.readOnly||r&&-1!=U(r,n)||(r||(r=[])).push(n)}})),!r)return null;for(var i=[{from:e,to:n}],o=0;o<r.length;++o)for(var a=r[o],s=a.find(0),l=0;l<i.length;++l){var u=i[l];if(!(he(u.to,s.from)<0||he(u.from,s.to)>0)){var c=[l,1],h=he(u.from,s.from),d=he(u.to,s.to);(h<0||!a.inclusiveLeft&&!h)&&c.push({from:u.from,to:s.from}),(d>0||!a.inclusiveRight&&!d)&&c.push({from:s.to,to:u.to}),i.splice.apply(i,c),l+=c.length-3}}return i}function $e(t){var e=t.markedSpans;if(e){for(var n=0;n<e.length;++n)e[n].marker.detachLine(t);t.markedSpans=null}}function Ye(t,e){if(e){for(var n=0;n<e.length;++n)e[n].marker.attachLine(t);t.markedSpans=e}}function Ve(t){return t.inclusiveLeft?-1:0}function Xe(t){return t.inclusiveRight?1:0}function Je(t,e){var n=t.lines.length-e.lines.length;if(0!=n)return n;var r=t.find(),i=e.find(),o=he(r.from,i.from)||Ve(t)-Ve(e);if(o)return-o;var a=he(r.to,i.to)||Xe(t)-Xe(e);return a||e.id-t.id}function Qe(t,e){var n,r=Be&&t.markedSpans;if(r)for(var i=void 0,o=0;o<r.length;++o)(i=r[o]).marker.collapsed&&null==(e?i.from:i.to)&&(!n||Je(n,i.marker)<0)&&(n=i.marker);return n}function Ze(t){return Qe(t,!0)}function tn(t){return Qe(t,!1)}function en(t,e){var n,r=Be&&t.markedSpans;if(r)for(var i=0;i<r.length;++i){var o=r[i];o.marker.collapsed&&(null==o.from||o.from<e)&&(null==o.to||o.to>e)&&(!n||Je(n,o.marker)<0)&&(n=o.marker)}return n}function nn(t,e,n,r,i){var o=ne(t,e),a=Be&&o.markedSpans;if(a)for(var s=0;s<a.length;++s){var l=a[s];if(l.marker.collapsed){var u=l.marker.find(0),c=he(u.from,n)||Ve(l.marker)-Ve(i),h=he(u.to,r)||Xe(l.marker)-Xe(i);if(!(c>=0&&h<=0||c<=0&&h>=0)&&(c<=0&&(l.marker.inclusiveRight&&i.inclusiveLeft?he(u.to,n)>=0:he(u.to,n)>0)||c>=0&&(l.marker.inclusiveRight&&i.inclusiveLeft?he(u.from,r)<=0:he(u.from,r)<0)))return!0}}}function rn(t){for(var e;e=Ze(t);)t=e.find(-1,!0).line;return t}function on(t){for(var e;e=tn(t);)t=e.find(1,!0).line;return t}function an(t){for(var e,n;e=tn(t);)t=e.find(1,!0).line,(n||(n=[])).push(t);return n}function sn(t,e){var n=ne(t,e),r=rn(n);return n==r?e:ae(r)}function ln(t,e){if(e>t.lastLine())return e;var n,r=ne(t,e);if(!un(t,r))return e;for(;n=tn(r);)r=n.find(1,!0).line;return ae(r)+1}function un(t,e){var n=Be&&e.markedSpans;if(n)for(var r=void 0,i=0;i<n.length;++i)if((r=n[i]).marker.collapsed){if(null==r.from)return!0;if(!r.marker.widgetNode&&0==r.from&&r.marker.inclusiveLeft&&cn(t,e,r))return!0}}function cn(t,e,n){if(null==n.to){var r=n.marker.find(1,!0);return cn(t,r.line,je(r.line.markedSpans,n.marker))}if(n.marker.inclusiveRight&&n.to==e.text.length)return!0;for(var i=void 0,o=0;o<e.markedSpans.length;++o)if((i=e.markedSpans[o]).marker.collapsed&&!i.marker.widgetNode&&i.from==n.to&&(null==i.to||i.to!=n.from)&&(i.marker.inclusiveLeft||n.marker.inclusiveRight)&&cn(t,e,i))return!0}function hn(t){for(var e=0,n=(t=rn(t)).parent,r=0;r<n.lines.length;++r){var i=n.lines[r];if(i==t)break;e+=i.height}for(var o=n.parent;o;o=(n=o).parent)for(var a=0;a<o.children.length;++a){var s=o.children[a];if(s==n)break;e+=s.height}return e}function dn(t){if(0==t.height)return 0;for(var e,n=t.text.length,r=t;e=Ze(r);){var i=e.find(0,!0);r=i.from.line,n+=i.from.ch-i.to.ch}for(r=t;e=tn(r);){var o=e.find(0,!0);n-=r.text.length-o.from.ch,n+=(r=o.to.line).text.length-o.to.ch}return n}function fn(t){var e=t.display,n=t.doc;e.maxLine=ne(n,n.first),e.maxLineLength=dn(e.maxLine),e.maxLineChanged=!0,n.iter((function(t){var n=dn(t);n>e.maxLineLength&&(e.maxLineLength=n,e.maxLine=t)}))}var pn=function(t,e,n){this.text=t,Ye(this,e),this.height=n?n(this):1};function gn(t,e,n,r){t.text=e,t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null),null!=t.order&&(t.order=null),$e(t),Ye(t,n);var i=r?r(t):1;i!=t.height&&oe(t,i)}function mn(t){t.parent=null,$e(t)}pn.prototype.lineNo=function(){return ae(this)},Dt(pn);var vn={},yn={};function bn(t,e){if(!t||/^\s*$/.test(t))return null;var n=e.addModeClass?yn:vn;return n[t]||(n[t]=t.replace(/\S+/g,"cm-$&"))}function xn(t,e){var n=L("span",null,null,l?"padding-right: .1px":null),r={pre:L("pre",[n],"CodeMirror-line"),content:n,col:0,pos:0,cm:t,trailingSpace:!1,splitSpaces:t.getOption("lineWrapping")};e.measure={};for(var i=0;i<=(e.rest?e.rest.length:0);i++){var o=i?e.rest[i-1]:e.line,a=void 0;r.pos=0,r.addToken=Cn,It(t.display.measure)&&(a=vt(o,t.doc.direction))&&(r.addToken=Sn(r.addToken,a)),r.map=[],Dn(o,r,ke(t,o,e!=t.display.externalMeasured&&ae(o))),o.styleClasses&&(o.styleClasses.bgClass&&(r.bgClass=B(o.styleClasses.bgClass,r.bgClass||"")),o.styleClasses.textClass&&(r.textClass=B(o.styleClasses.textClass,r.textClass||""))),0==r.map.length&&r.map.push(0,0,r.content.appendChild(Nt(t.display.measure))),0==i?(e.measure.map=r.map,e.measure.cache={}):((e.measure.maps||(e.measure.maps=[])).push(r.map),(e.measure.caches||(e.measure.caches=[])).push({}))}if(l){var s=r.content.lastChild;(/\bcm-tab\b/.test(s.className)||s.querySelector&&s.querySelector(".cm-tab"))&&(r.content.className="cm-tab-wrap-hack")}return Ct(t,"renderLine",t,e.line,r.pre),r.pre.className&&(r.textClass=B(r.pre.className,r.textClass||"")),r}function wn(t){var e=F("span","•","cm-invalidchar");return e.title="\\u"+t.charCodeAt(0).toString(16),e.setAttribute("aria-label",e.title),e}function Cn(t,e,n,r,i,o,l){if(e){var u,c=t.splitSpaces?kn(e,t.trailingSpace):e,h=t.cm.state.specialChars,d=!1;if(h.test(e)){u=document.createDocumentFragment();for(var f=0;;){h.lastIndex=f;var p=h.exec(e),g=p?p.index-f:e.length-f;if(g){var m=document.createTextNode(c.slice(f,f+g));a&&s<9?u.appendChild(F("span",[m])):u.appendChild(m),t.map.push(t.pos,t.pos+g,m),t.col+=g,t.pos+=g}if(!p)break;f+=g+1;var v=void 0;if("\t"==p[0]){var y=t.cm.options.tabSize,b=y-t.col%y;(v=u.appendChild(F("span",Z(b),"cm-tab"))).setAttribute("role","presentation"),v.setAttribute("cm-text","\t"),t.col+=b}else"\r"==p[0]||"\n"==p[0]?((v=u.appendChild(F("span","\r"==p[0]?"␍":"␤","cm-invalidchar"))).setAttribute("cm-text",p[0]),t.col+=1):((v=t.cm.options.specialCharPlaceholder(p[0])).setAttribute("cm-text",p[0]),a&&s<9?u.appendChild(F("span",[v])):u.appendChild(v),t.col+=1);t.map.push(t.pos,t.pos+1,v),t.pos++}}else t.col+=e.length,u=document.createTextNode(c),t.map.push(t.pos,t.pos+e.length,u),a&&s<9&&(d=!0),t.pos+=e.length;if(t.trailingSpace=32==c.charCodeAt(e.length-1),n||r||i||d||o||l){var x=n||"";r&&(x+=r),i&&(x+=i);var w=F("span",[u],x,o);if(l)for(var C in l)l.hasOwnProperty(C)&&"style"!=C&&"class"!=C&&w.setAttribute(C,l[C]);return t.content.appendChild(w)}t.content.appendChild(u)}}function kn(t,e){if(t.length>1&&!/  /.test(t))return t;for(var n=e,r="",i=0;i<t.length;i++){var o=t.charAt(i);" "!=o||!n||i!=t.length-1&&32!=t.charCodeAt(i+1)||(o=" "),r+=o,n=" "==o}return r}function Sn(t,e){return function(n,r,i,o,a,s,l){i=i?i+" cm-force-border":"cm-force-border";for(var u=n.pos,c=u+r.length;;){for(var h=void 0,d=0;d<e.length&&!((h=e[d]).to>u&&h.from<=u);d++);if(h.to>=c)return t(n,r,i,o,a,s,l);t(n,r.slice(0,h.to-u),i,o,null,s,l),o=null,r=r.slice(h.to-u),u=h.to}}}function _n(t,e,n,r){var i=!r&&n.widgetNode;i&&t.map.push(t.pos,t.pos+e,i),!r&&t.cm.display.input.needsContentAttribute&&(i||(i=t.content.appendChild(document.createElement("span"))),i.setAttribute("cm-marker",n.id)),i&&(t.cm.display.input.setUneditable(i),t.content.appendChild(i)),t.pos+=e,t.trailingSpace=!1}function Dn(t,e,n){var r=t.markedSpans,i=t.text,o=0;if(r)for(var a,s,l,u,c,h,d,f=i.length,p=0,g=1,m="",v=0;;){if(v==p){l=u=c=s="",d=null,h=null,v=1/0;for(var y=[],b=void 0,x=0;x<r.length;++x){var w=r[x],C=w.marker;if("bookmark"==C.type&&w.from==p&&C.widgetNode)y.push(C);else if(w.from<=p&&(null==w.to||w.to>p||C.collapsed&&w.to==p&&w.from==p)){if(null!=w.to&&w.to!=p&&v>w.to&&(v=w.to,u=""),C.className&&(l+=" "+C.className),C.css&&(s=(s?s+";":"")+C.css),C.startStyle&&w.from==p&&(c+=" "+C.startStyle),C.endStyle&&w.to==v&&(b||(b=[])).push(C.endStyle,w.to),C.title&&((d||(d={})).title=C.title),C.attributes)for(var k in C.attributes)(d||(d={}))[k]=C.attributes[k];C.collapsed&&(!h||Je(h.marker,C)<0)&&(h=w)}else w.from>p&&v>w.from&&(v=w.from)}if(b)for(var S=0;S<b.length;S+=2)b[S+1]==v&&(u+=" "+b[S]);if(!h||h.from==p)for(var _=0;_<y.length;++_)_n(e,0,y[_]);if(h&&(h.from||0)==p){if(_n(e,(null==h.to?f+1:h.to)-p,h.marker,null==h.from),null==h.to)return;h.to==p&&(h=!1)}}if(p>=f)break;for(var D=Math.min(f,v);;){if(m){var A=p+m.length;if(!h){var T=A>D?m.slice(0,D-p):m;e.addToken(e,T,a?a+l:l,c,p+T.length==v?u:"",s,d)}if(A>=D){m=m.slice(D-p),p=D;break}p=A,c=""}m=i.slice(o,o=n[g++]),a=bn(n[g++],e.cm.options)}}else for(var E=1;E<n.length;E+=2)e.addToken(e,i.slice(o,o=n[E]),bn(n[E+1],e.cm.options))}function An(t,e,n){this.line=e,this.rest=an(e),this.size=this.rest?ae(tt(this.rest))-n+1:1,this.node=this.text=null,this.hidden=un(t,e)}function Tn(t,e,n){for(var r,i=[],o=e;o<n;o=r){var a=new An(t.doc,ne(t.doc,o),o);r=o+a.size,i.push(a)}return i}var En=null;function Fn(t){En?En.ops.push(t):t.ownsGroup=En={ops:[t],delayedCallbacks:[]}}function Ln(t){var e=t.delayedCallbacks,n=0;do{for(;n<e.length;n++)e[n].call(null);for(var r=0;r<t.ops.length;r++){var i=t.ops[r];if(i.cursorActivityHandlers)for(;i.cursorActivityCalled<i.cursorActivityHandlers.length;)i.cursorActivityHandlers[i.cursorActivityCalled++].call(null,i.cm)}}while(n<e.length)}function Pn(t,e){var n=t.ownsGroup;if(n)try{Ln(n)}finally{En=null,e(n)}}var On=null;function Mn(t,e){var n=xt(t,e);if(n.length){var r,i=Array.prototype.slice.call(arguments,2);En?r=En.delayedCallbacks:On?r=On:(r=On=[],setTimeout(Bn,0));for(var o=function(t){r.push((function(){return n[t].apply(null,i)}))},a=0;a<n.length;++a)o(a)}}function Bn(){var t=On;On=null;for(var e=0;e<t.length;++e)t[e]()}function Nn(t,e,n,r){for(var i=0;i<e.changes.length;i++){var o=e.changes[i];"text"==o?zn(t,e):"gutter"==o?Gn(t,e,n,r):"class"==o?Hn(t,e):"widget"==o&&Wn(t,e,r)}e.changes=null}function In(t){return t.node==t.text&&(t.node=F("div",null,null,"position: relative"),t.text.parentNode&&t.text.parentNode.replaceChild(t.node,t.text),t.node.appendChild(t.text),a&&s<8&&(t.node.style.zIndex=2)),t.node}function Rn(t,e){var n=e.bgClass?e.bgClass+" "+(e.line.bgClass||""):e.line.bgClass;if(n&&(n+=" CodeMirror-linebackground"),e.background)n?e.background.className=n:(e.background.parentNode.removeChild(e.background),e.background=null);else if(n){var r=In(e);e.background=r.insertBefore(F("div",null,n),r.firstChild),t.display.input.setUneditable(e.background)}}function jn(t,e){var n=t.display.externalMeasured;return n&&n.line==e.line?(t.display.externalMeasured=null,e.measure=n.measure,n.built):xn(t,e)}function zn(t,e){var n=e.text.className,r=jn(t,e);e.text==e.node&&(e.node=r.pre),e.text.parentNode.replaceChild(r.pre,e.text),e.text=r.pre,r.bgClass!=e.bgClass||r.textClass!=e.textClass?(e.bgClass=r.bgClass,e.textClass=r.textClass,Hn(t,e)):n&&(e.text.className=n)}function Hn(t,e){Rn(t,e),e.line.wrapClass?In(e).className=e.line.wrapClass:e.node!=e.text&&(e.node.className="");var n=e.textClass?e.textClass+" "+(e.line.textClass||""):e.line.textClass;e.text.className=n||""}function Gn(t,e,n,r){if(e.gutter&&(e.node.removeChild(e.gutter),e.gutter=null),e.gutterBackground&&(e.node.removeChild(e.gutterBackground),e.gutterBackground=null),e.line.gutterClass){var i=In(e);e.gutterBackground=F("div",null,"CodeMirror-gutter-background "+e.line.gutterClass,"left: "+(t.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px; width: "+r.gutterTotalWidth+"px"),t.display.input.setUneditable(e.gutterBackground),i.insertBefore(e.gutterBackground,e.text)}var o=e.line.gutterMarkers;if(t.options.lineNumbers||o){var a=In(e),s=e.gutter=F("div",null,"CodeMirror-gutter-wrapper","left: "+(t.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px");if(s.setAttribute("aria-hidden","true"),t.display.input.setUneditable(s),a.insertBefore(s,e.text),e.line.gutterClass&&(s.className+=" "+e.line.gutterClass),!t.options.lineNumbers||o&&o["CodeMirror-linenumbers"]||(e.lineNumber=s.appendChild(F("div",ue(t.options,n),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+r.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+t.display.lineNumInnerWidth+"px"))),o)for(var l=0;l<t.display.gutterSpecs.length;++l){var u=t.display.gutterSpecs[l].className,c=o.hasOwnProperty(u)&&o[u];c&&s.appendChild(F("div",[c],"CodeMirror-gutter-elt","left: "+r.gutterLeft[u]+"px; width: "+r.gutterWidth[u]+"px"))}}}function Wn(t,e,n){e.alignable&&(e.alignable=null);for(var r=_("CodeMirror-linewidget"),i=e.node.firstChild,o=void 0;i;i=o)o=i.nextSibling,r.test(i.className)&&e.node.removeChild(i);Un(t,e,n)}function qn(t,e,n,r){var i=jn(t,e);return e.text=e.node=i.pre,i.bgClass&&(e.bgClass=i.bgClass),i.textClass&&(e.textClass=i.textClass),Hn(t,e),Gn(t,e,n,r),Un(t,e,r),e.node}function Un(t,e,n){if(Kn(t,e.line,e,n,!0),e.rest)for(var r=0;r<e.rest.length;r++)Kn(t,e.rest[r],e,n,!1)}function Kn(t,e,n,r,i){if(e.widgets)for(var o=In(n),a=0,s=e.widgets;a<s.length;++a){var l=s[a],u=F("div",[l.node],"CodeMirror-linewidget"+(l.className?" "+l.className:""));l.handleMouseEvents||u.setAttribute("cm-ignore-events","true"),$n(l,u,n,r),t.display.input.setUneditable(u),i&&l.above?o.insertBefore(u,n.gutter||n.text):o.appendChild(u),Mn(l,"redraw")}}function $n(t,e,n,r){if(t.noHScroll){(n.alignable||(n.alignable=[])).push(e);var i=r.wrapperWidth;e.style.left=r.fixedPos+"px",t.coverGutter||(i-=r.gutterTotalWidth,e.style.paddingLeft=r.gutterTotalWidth+"px"),e.style.width=i+"px"}t.coverGutter&&(e.style.zIndex=5,e.style.position="relative",t.noHScroll||(e.style.marginLeft=-r.gutterTotalWidth+"px"))}function Yn(t){if(null!=t.height)return t.height;var e=t.doc.cm;if(!e)return 0;if(!P(document.body,t.node)){var n="position: relative;";t.coverGutter&&(n+="margin-left: -"+e.display.gutters.offsetWidth+"px;"),t.noHScroll&&(n+="width: "+e.display.wrapper.clientWidth+"px;"),E(e.display.measure,F("div",[t.node],null,n))}return t.height=t.node.parentNode.offsetHeight}function Vn(t,e){for(var n=Lt(e);n!=t.wrapper;n=n.parentNode)if(!n||1==n.nodeType&&"true"==n.getAttribute("cm-ignore-events")||n.parentNode==t.sizer&&n!=t.mover)return!0}function Xn(t){return t.lineSpace.offsetTop}function Jn(t){return t.mover.offsetHeight-t.lineSpace.offsetHeight}function Qn(t){if(t.cachedPaddingH)return t.cachedPaddingH;var e=E(t.measure,F("pre","x","CodeMirror-line-like")),n=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,r={left:parseInt(n.paddingLeft),right:parseInt(n.paddingRight)};return isNaN(r.left)||isNaN(r.right)||(t.cachedPaddingH=r),r}function Zn(t){return K-t.display.nativeBarWidth}function tr(t){return t.display.scroller.clientWidth-Zn(t)-t.display.barWidth}function er(t){return t.display.scroller.clientHeight-Zn(t)-t.display.barHeight}function nr(t,e,n){var r=t.options.lineWrapping,i=r&&tr(t);if(!e.measure.heights||r&&e.measure.width!=i){var o=e.measure.heights=[];if(r){e.measure.width=i;for(var a=e.text.firstChild.getClientRects(),s=0;s<a.length-1;s++){var l=a[s],u=a[s+1];Math.abs(l.bottom-u.bottom)>2&&o.push((l.bottom+u.top)/2-n.top)}}o.push(n.bottom-n.top)}}function rr(t,e,n){if(t.line==e)return{map:t.measure.map,cache:t.measure.cache};if(t.rest){for(var r=0;r<t.rest.length;r++)if(t.rest[r]==e)return{map:t.measure.maps[r],cache:t.measure.caches[r]};for(var i=0;i<t.rest.length;i++)if(ae(t.rest[i])>n)return{map:t.measure.maps[i],cache:t.measure.caches[i],before:!0}}}function ir(t,e){var n=ae(e=rn(e)),r=t.display.externalMeasured=new An(t.doc,e,n);r.lineN=n;var i=r.built=xn(t,r);return r.text=i.pre,E(t.display.lineMeasure,i.pre),r}function or(t,e,n,r){return lr(t,sr(t,e),n,r)}function ar(t,e){if(e>=t.display.viewFrom&&e<t.display.viewTo)return t.display.view[Hr(t,e)];var n=t.display.externalMeasured;return n&&e>=n.lineN&&e<n.lineN+n.size?n:void 0}function sr(t,e){var n=ae(e),r=ar(t,n);r&&!r.text?r=null:r&&r.changes&&(Nn(t,r,n,Nr(t)),t.curOp.forceUpdate=!0),r||(r=ir(t,e));var i=rr(r,e,n);return{line:e,view:r,rect:null,map:i.map,cache:i.cache,before:i.before,hasHeights:!1}}function lr(t,e,n,r,i){e.before&&(n=-1);var o,a=n+(r||"");return e.cache.hasOwnProperty(a)?o=e.cache[a]:(e.rect||(e.rect=e.view.text.getBoundingClientRect()),e.hasHeights||(nr(t,e.view,e.rect),e.hasHeights=!0),(o=fr(t,e,n,r)).bogus||(e.cache[a]=o)),{left:o.left,right:o.right,top:i?o.rtop:o.top,bottom:i?o.rbottom:o.bottom}}var ur,cr={left:0,right:0,top:0,bottom:0};function hr(t,e,n){for(var r,i,o,a,s,l,u=0;u<t.length;u+=3)if(s=t[u],l=t[u+1],e<s?(i=0,o=1,a="left"):e<l?o=1+(i=e-s):(u==t.length-3||e==l&&t[u+3]>e)&&(i=(o=l-s)-1,e>=l&&(a="right")),null!=i){if(r=t[u+2],s==l&&n==(r.insertLeft?"left":"right")&&(a=n),"left"==n&&0==i)for(;u&&t[u-2]==t[u-3]&&t[u-1].insertLeft;)r=t[2+(u-=3)],a="left";if("right"==n&&i==l-s)for(;u<t.length-3&&t[u+3]==t[u+4]&&!t[u+5].insertLeft;)r=t[(u+=3)+2],a="right";break}return{node:r,start:i,end:o,collapse:a,coverStart:s,coverEnd:l}}function dr(t,e){var n=cr;if("left"==e)for(var r=0;r<t.length&&(n=t[r]).left==n.right;r++);else for(var i=t.length-1;i>=0&&(n=t[i]).left==n.right;i--);return n}function fr(t,e,n,r){var i,o=hr(e.map,n,r),l=o.node,u=o.start,c=o.end,h=o.collapse;if(3==l.nodeType){for(var d=0;d<4;d++){for(;u&&ct(e.line.text.charAt(o.coverStart+u));)--u;for(;o.coverStart+c<o.coverEnd&&ct(e.line.text.charAt(o.coverStart+c));)++c;if((i=a&&s<9&&0==u&&c==o.coverEnd-o.coverStart?l.parentNode.getBoundingClientRect():dr(D(l,u,c).getClientRects(),r)).left||i.right||0==u)break;c=u,u-=1,h="right"}a&&s<11&&(i=pr(t.display.measure,i))}else{var f;u>0&&(h=r="right"),i=t.options.lineWrapping&&(f=l.getClientRects()).length>1?f["right"==r?f.length-1:0]:l.getBoundingClientRect()}if(a&&s<9&&!u&&(!i||!i.left&&!i.right)){var p=l.parentNode.getClientRects()[0];i=p?{left:p.left,right:p.left+Br(t.display),top:p.top,bottom:p.bottom}:cr}for(var g=i.top-e.rect.top,m=i.bottom-e.rect.top,v=(g+m)/2,y=e.view.measure.heights,b=0;b<y.length-1&&!(v<y[b]);b++);var x=b?y[b-1]:0,w=y[b],C={left:("right"==h?i.right:i.left)-e.rect.left,right:("left"==h?i.left:i.right)-e.rect.left,top:x,bottom:w};return i.left||i.right||(C.bogus=!0),t.options.singleCursorHeightPerLine||(C.rtop=g,C.rbottom=m),C}function pr(t,e){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!Wt(t))return e;var n=screen.logicalXDPI/screen.deviceXDPI,r=screen.logicalYDPI/screen.deviceYDPI;return{left:e.left*n,right:e.right*n,top:e.top*r,bottom:e.bottom*r}}function gr(t){if(t.measure&&(t.measure.cache={},t.measure.heights=null,t.rest))for(var e=0;e<t.rest.length;e++)t.measure.caches[e]={}}function mr(t){t.display.externalMeasure=null,T(t.display.lineMeasure);for(var e=0;e<t.display.view.length;e++)gr(t.display.view[e])}function vr(t){mr(t),t.display.cachedCharWidth=t.display.cachedTextHeight=t.display.cachedPaddingH=null,t.options.lineWrapping||(t.display.maxLineChanged=!0),t.display.lineNumChars=null}function yr(t){return c&&v?-(t.body.getBoundingClientRect().left-parseInt(getComputedStyle(t.body).marginLeft)):t.defaultView.pageXOffset||(t.documentElement||t.body).scrollLeft}function br(t){return c&&v?-(t.body.getBoundingClientRect().top-parseInt(getComputedStyle(t.body).marginTop)):t.defaultView.pageYOffset||(t.documentElement||t.body).scrollTop}function xr(t){var e=rn(t).widgets,n=0;if(e)for(var r=0;r<e.length;++r)e[r].above&&(n+=Yn(e[r]));return n}function wr(t,e,n,r,i){if(!i){var o=xr(e);n.top+=o,n.bottom+=o}if("line"==r)return n;r||(r="local");var a=hn(e);if("local"==r?a+=Xn(t.display):a-=t.display.viewOffset,"page"==r||"window"==r){var s=t.display.lineSpace.getBoundingClientRect();a+=s.top+("window"==r?0:br(I(t)));var l=s.left+("window"==r?0:yr(I(t)));n.left+=l,n.right+=l}return n.top+=a,n.bottom+=a,n}function Cr(t,e,n){if("div"==n)return e;var r=e.left,i=e.top;if("page"==n)r-=yr(I(t)),i-=br(I(t));else if("local"==n||!n){var o=t.display.sizer.getBoundingClientRect();r+=o.left,i+=o.top}var a=t.display.lineSpace.getBoundingClientRect();return{left:r-a.left,top:i-a.top}}function kr(t,e,n,r,i){return r||(r=ne(t.doc,e.line)),wr(t,r,or(t,r,e.ch,i),n)}function Sr(t,e,n,r,i,o){function a(e,a){var s=lr(t,i,e,a?"right":"left",o);return a?s.left=s.right:s.right=s.left,wr(t,r,s,n)}r=r||ne(t.doc,e.line),i||(i=sr(t,r));var s=vt(r,t.doc.direction),l=e.ch,u=e.sticky;if(l>=r.text.length?(l=r.text.length,u="before"):l<=0&&(l=0,u="after"),!s)return a("before"==u?l-1:l,"before"==u);function c(t,e,n){return a(n?t-1:t,1==s[e].level!=n)}var h=gt(s,l,u),d=pt,f=c(l,h,"before"==u);return null!=d&&(f.other=c(l,d,"before"!=u)),f}function _r(t,e){var n=0;e=ve(t.doc,e),t.options.lineWrapping||(n=Br(t.display)*e.ch);var r=ne(t.doc,e.line),i=hn(r)+Xn(t.display);return{left:n,right:n,top:i,bottom:i+r.height}}function Dr(t,e,n,r,i){var o=ce(t,e,n);return o.xRel=i,r&&(o.outside=r),o}function Ar(t,e,n){var r=t.doc;if((n+=t.display.viewOffset)<0)return Dr(r.first,0,null,-1,-1);var i=se(r,n),o=r.first+r.size-1;if(i>o)return Dr(r.first+r.size-1,ne(r,o).text.length,null,1,1);e<0&&(e=0);for(var a=ne(r,i);;){var s=Lr(t,a,i,e,n),l=en(a,s.ch+(s.xRel>0||s.outside>0?1:0));if(!l)return s;var u=l.find(1);if(u.line==i)return u;a=ne(r,i=u.line)}}function Tr(t,e,n,r){r-=xr(e);var i=e.text.length,o=dt((function(e){return lr(t,n,e-1).bottom<=r}),i,0);return{begin:o,end:i=dt((function(e){return lr(t,n,e).top>r}),o,i)}}function Er(t,e,n,r){return n||(n=sr(t,e)),Tr(t,e,n,wr(t,e,lr(t,n,r),"line").top)}function Fr(t,e,n,r){return!(t.bottom<=n)&&(t.top>n||(r?t.left:t.right)>e)}function Lr(t,e,n,r,i){i-=hn(e);var o=sr(t,e),a=xr(e),s=0,l=e.text.length,u=!0,c=vt(e,t.doc.direction);if(c){var h=(t.options.lineWrapping?Or:Pr)(t,e,n,o,c,r,i);s=(u=1!=h.level)?h.from:h.to-1,l=u?h.to:h.from-1}var d,f,p=null,g=null,m=dt((function(e){var n=lr(t,o,e);return n.top+=a,n.bottom+=a,!!Fr(n,r,i,!1)&&(n.top<=i&&n.left<=r&&(p=e,g=n),!0)}),s,l),v=!1;if(g){var y=r-g.left<g.right-r,b=y==u;m=p+(b?0:1),f=b?"after":"before",d=y?g.left:g.right}else{u||m!=l&&m!=s||m++,f=0==m?"after":m==e.text.length?"before":lr(t,o,m-(u?1:0)).bottom+a<=i==u?"after":"before";var x=Sr(t,ce(n,m,f),"line",e,o);d=x.left,v=i<x.top?-1:i>=x.bottom?1:0}return Dr(n,m=ht(e.text,m,1),f,v,r-d)}function Pr(t,e,n,r,i,o,a){var s=dt((function(s){var l=i[s],u=1!=l.level;return Fr(Sr(t,ce(n,u?l.to:l.from,u?"before":"after"),"line",e,r),o,a,!0)}),0,i.length-1),l=i[s];if(s>0){var u=1!=l.level,c=Sr(t,ce(n,u?l.from:l.to,u?"after":"before"),"line",e,r);Fr(c,o,a,!0)&&c.top>a&&(l=i[s-1])}return l}function Or(t,e,n,r,i,o,a){var s=Tr(t,e,r,a),l=s.begin,u=s.end;/\s/.test(e.text.charAt(u-1))&&u--;for(var c=null,h=null,d=0;d<i.length;d++){var f=i[d];if(!(f.from>=u||f.to<=l)){var p=lr(t,r,1!=f.level?Math.min(u,f.to)-1:Math.max(l,f.from)).right,g=p<o?o-p+1e9:p-o;(!c||h>g)&&(c=f,h=g)}}return c||(c=i[i.length-1]),c.from<l&&(c={from:l,to:c.to,level:c.level}),c.to>u&&(c={from:c.from,to:u,level:c.level}),c}function Mr(t){if(null!=t.cachedTextHeight)return t.cachedTextHeight;if(null==ur){ur=F("pre",null,"CodeMirror-line-like");for(var e=0;e<49;++e)ur.appendChild(document.createTextNode("x")),ur.appendChild(F("br"));ur.appendChild(document.createTextNode("x"))}E(t.measure,ur);var n=ur.offsetHeight/50;return n>3&&(t.cachedTextHeight=n),T(t.measure),n||1}function Br(t){if(null!=t.cachedCharWidth)return t.cachedCharWidth;var e=F("span","xxxxxxxxxx"),n=F("pre",[e],"CodeMirror-line-like");E(t.measure,n);var r=e.getBoundingClientRect(),i=(r.right-r.left)/10;return i>2&&(t.cachedCharWidth=i),i||10}function Nr(t){for(var e=t.display,n={},r={},i=e.gutters.clientLeft,o=e.gutters.firstChild,a=0;o;o=o.nextSibling,++a){var s=t.display.gutterSpecs[a].className;n[s]=o.offsetLeft+o.clientLeft+i,r[s]=o.clientWidth}return{fixedPos:Ir(e),gutterTotalWidth:e.gutters.offsetWidth,gutterLeft:n,gutterWidth:r,wrapperWidth:e.wrapper.clientWidth}}function Ir(t){return t.scroller.getBoundingClientRect().left-t.sizer.getBoundingClientRect().left}function Rr(t){var e=Mr(t.display),n=t.options.lineWrapping,r=n&&Math.max(5,t.display.scroller.clientWidth/Br(t.display)-3);return function(i){if(un(t.doc,i))return 0;var o=0;if(i.widgets)for(var a=0;a<i.widgets.length;a++)i.widgets[a].height&&(o+=i.widgets[a].height);return n?o+(Math.ceil(i.text.length/r)||1)*e:o+e}}function jr(t){var e=t.doc,n=Rr(t);e.iter((function(t){var e=n(t);e!=t.height&&oe(t,e)}))}function zr(t,e,n,r){var i=t.display;if(!n&&"true"==Lt(e).getAttribute("cm-not-content"))return null;var o,a,s=i.lineSpace.getBoundingClientRect();try{o=e.clientX-s.left,a=e.clientY-s.top}catch(t){return null}var l,u=Ar(t,o,a);if(r&&u.xRel>0&&(l=ne(t.doc,u.line).text).length==u.ch){var c=W(l,l.length,t.options.tabSize)-l.length;u=ce(u.line,Math.max(0,Math.round((o-Qn(t.display).left)/Br(t.display))-c))}return u}function Hr(t,e){if(e>=t.display.viewTo)return null;if((e-=t.display.viewFrom)<0)return null;for(var n=t.display.view,r=0;r<n.length;r++)if((e-=n[r].size)<0)return r}function Gr(t,e,n,r){null==e&&(e=t.doc.first),null==n&&(n=t.doc.first+t.doc.size),r||(r=0);var i=t.display;if(r&&n<i.viewTo&&(null==i.updateLineNumbers||i.updateLineNumbers>e)&&(i.updateLineNumbers=e),t.curOp.viewChanged=!0,e>=i.viewTo)Be&&sn(t.doc,e)<i.viewTo&&qr(t);else if(n<=i.viewFrom)Be&&ln(t.doc,n+r)>i.viewFrom?qr(t):(i.viewFrom+=r,i.viewTo+=r);else if(e<=i.viewFrom&&n>=i.viewTo)qr(t);else if(e<=i.viewFrom){var o=Ur(t,n,n+r,1);o?(i.view=i.view.slice(o.index),i.viewFrom=o.lineN,i.viewTo+=r):qr(t)}else if(n>=i.viewTo){var a=Ur(t,e,e,-1);a?(i.view=i.view.slice(0,a.index),i.viewTo=a.lineN):qr(t)}else{var s=Ur(t,e,e,-1),l=Ur(t,n,n+r,1);s&&l?(i.view=i.view.slice(0,s.index).concat(Tn(t,s.lineN,l.lineN)).concat(i.view.slice(l.index)),i.viewTo+=r):qr(t)}var u=i.externalMeasured;u&&(n<u.lineN?u.lineN+=r:e<u.lineN+u.size&&(i.externalMeasured=null))}function Wr(t,e,n){t.curOp.viewChanged=!0;var r=t.display,i=t.display.externalMeasured;if(i&&e>=i.lineN&&e<i.lineN+i.size&&(r.externalMeasured=null),!(e<r.viewFrom||e>=r.viewTo)){var o=r.view[Hr(t,e)];if(null!=o.node){var a=o.changes||(o.changes=[]);-1==U(a,n)&&a.push(n)}}}function qr(t){t.display.viewFrom=t.display.viewTo=t.doc.first,t.display.view=[],t.display.viewOffset=0}function Ur(t,e,n,r){var i,o=Hr(t,e),a=t.display.view;if(!Be||n==t.doc.first+t.doc.size)return{index:o,lineN:n};for(var s=t.display.viewFrom,l=0;l<o;l++)s+=a[l].size;if(s!=e){if(r>0){if(o==a.length-1)return null;i=s+a[o].size-e,o++}else i=s-e;e+=i,n+=i}for(;sn(t.doc,n)!=n;){if(o==(r<0?0:a.length-1))return null;n+=r*a[o-(r<0?1:0)].size,o+=r}return{index:o,lineN:n}}function Kr(t,e,n){var r=t.display;0==r.view.length||e>=r.viewTo||n<=r.viewFrom?(r.view=Tn(t,e,n),r.viewFrom=e):(r.viewFrom>e?r.view=Tn(t,e,r.viewFrom).concat(r.view):r.viewFrom<e&&(r.view=r.view.slice(Hr(t,e))),r.viewFrom=e,r.viewTo<n?r.view=r.view.concat(Tn(t,r.viewTo,n)):r.viewTo>n&&(r.view=r.view.slice(0,Hr(t,n)))),r.viewTo=n}function $r(t){for(var e=t.display.view,n=0,r=0;r<e.length;r++){var i=e[r];i.hidden||i.node&&!i.changes||++n}return n}function Yr(t){t.display.input.showSelection(t.display.input.prepareSelection())}function Vr(t,e){void 0===e&&(e=!0);var n=t.doc,r={},i=r.cursors=document.createDocumentFragment(),o=r.selection=document.createDocumentFragment(),a=t.options.$customCursor;a&&(e=!0);for(var s=0;s<n.sel.ranges.length;s++)if(e||s!=n.sel.primIndex){var l=n.sel.ranges[s];if(!(l.from().line>=t.display.viewTo||l.to().line<t.display.viewFrom)){var u=l.empty();if(a){var c=a(t,l);c&&Xr(t,c,i)}else(u||t.options.showCursorWhenSelecting)&&Xr(t,l.head,i);u||Qr(t,l,o)}}return r}function Xr(t,e,n){var r=Sr(t,e,"div",null,null,!t.options.singleCursorHeightPerLine),i=n.appendChild(F("div"," ","CodeMirror-cursor"));if(i.style.left=r.left+"px",i.style.top=r.top+"px",i.style.height=Math.max(0,r.bottom-r.top)*t.options.cursorHeight+"px",/\bcm-fat-cursor\b/.test(t.getWrapperElement().className)){var o=kr(t,e,"div",null,null),a=o.right-o.left;i.style.width=(a>0?a:t.defaultCharWidth())+"px"}if(r.other){var s=n.appendChild(F("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));s.style.display="",s.style.left=r.other.left+"px",s.style.top=r.other.top+"px",s.style.height=.85*(r.other.bottom-r.other.top)+"px"}}function Jr(t,e){return t.top-e.top||t.left-e.left}function Qr(t,e,n){var r=t.display,i=t.doc,o=document.createDocumentFragment(),a=Qn(t.display),s=a.left,l=Math.max(r.sizerWidth,tr(t)-r.sizer.offsetLeft)-a.right,u="ltr"==i.direction;function c(t,e,n,r){e<0&&(e=0),e=Math.round(e),r=Math.round(r),o.appendChild(F("div",null,"CodeMirror-selected","position: absolute; left: "+t+"px;\n                             top: "+e+"px; width: "+(null==n?l-t:n)+"px;\n                             height: "+(r-e)+"px"))}function h(e,n,r){var o,a,h=ne(i,e),d=h.text.length;function f(n,r){return kr(t,ce(e,n),"div",h,r)}function p(e,n,r){var i=Er(t,h,null,e),o="ltr"==n==("after"==r)?"left":"right";return f("after"==r?i.begin:i.end-(/\s/.test(h.text.charAt(i.end-1))?2:1),o)[o]}var g=vt(h,i.direction);return ft(g,n||0,null==r?d:r,(function(t,e,i,h){var m="ltr"==i,v=f(t,m?"left":"right"),y=f(e-1,m?"right":"left"),b=null==n&&0==t,x=null==r&&e==d,w=0==h,C=!g||h==g.length-1;if(y.top-v.top<=3){var k=(u?x:b)&&C,S=(u?b:x)&&w?s:(m?v:y).left,_=k?l:(m?y:v).right;c(S,v.top,_-S,v.bottom)}else{var D,A,T,E;m?(D=u&&b&&w?s:v.left,A=u?l:p(t,i,"before"),T=u?s:p(e,i,"after"),E=u&&x&&C?l:y.right):(D=u?p(t,i,"before"):s,A=!u&&b&&w?l:v.right,T=!u&&x&&C?s:y.left,E=u?p(e,i,"after"):l),c(D,v.top,A-D,v.bottom),v.bottom<y.top&&c(s,v.bottom,null,y.top),c(T,y.top,E-T,y.bottom)}(!o||Jr(v,o)<0)&&(o=v),Jr(y,o)<0&&(o=y),(!a||Jr(v,a)<0)&&(a=v),Jr(y,a)<0&&(a=y)})),{start:o,end:a}}var d=e.from(),f=e.to();if(d.line==f.line)h(d.line,d.ch,f.ch);else{var p=ne(i,d.line),g=ne(i,f.line),m=rn(p)==rn(g),v=h(d.line,d.ch,m?p.text.length+1:null).end,y=h(f.line,m?0:null,f.ch).start;m&&(v.top<y.top-2?(c(v.right,v.top,null,v.bottom),c(s,y.top,y.left,y.bottom)):c(v.right,v.top,y.left-v.right,v.bottom)),v.bottom<y.top&&c(s,v.bottom,null,y.top)}n.appendChild(o)}function Zr(t){if(t.state.focused){var e=t.display;clearInterval(e.blinker);var n=!0;e.cursorDiv.style.visibility="",t.options.cursorBlinkRate>0?e.blinker=setInterval((function(){t.hasFocus()||ri(t),e.cursorDiv.style.visibility=(n=!n)?"":"hidden"}),t.options.cursorBlinkRate):t.options.cursorBlinkRate<0&&(e.cursorDiv.style.visibility="hidden")}}function ti(t){t.hasFocus()||(t.display.input.focus(),t.state.focused||ni(t))}function ei(t){t.state.delayingBlurEvent=!0,setTimeout((function(){t.state.delayingBlurEvent&&(t.state.delayingBlurEvent=!1,t.state.focused&&ri(t))}),100)}function ni(t,e){t.state.delayingBlurEvent&&!t.state.draggingText&&(t.state.delayingBlurEvent=!1),"nocursor"!=t.options.readOnly&&(t.state.focused||(Ct(t,"focus",t,e),t.state.focused=!0,M(t.display.wrapper,"CodeMirror-focused"),t.curOp||t.display.selForContextMenu==t.doc.sel||(t.display.input.reset(),l&&setTimeout((function(){return t.display.input.reset(!0)}),20)),t.display.input.receivedFocus()),Zr(t))}function ri(t,e){t.state.delayingBlurEvent||(t.state.focused&&(Ct(t,"blur",t,e),t.state.focused=!1,A(t.display.wrapper,"CodeMirror-focused")),clearInterval(t.display.blinker),setTimeout((function(){t.state.focused||(t.display.shift=!1)}),150))}function ii(t){for(var e=t.display,n=e.lineDiv.offsetTop,r=Math.max(0,e.scroller.getBoundingClientRect().top),i=e.lineDiv.getBoundingClientRect().top,o=0,l=0;l<e.view.length;l++){var u=e.view[l],c=t.options.lineWrapping,h=void 0,d=0;if(!u.hidden){if(i+=u.line.height,a&&s<8){var f=u.node.offsetTop+u.node.offsetHeight;h=f-n,n=f}else{var p=u.node.getBoundingClientRect();h=p.bottom-p.top,!c&&u.text.firstChild&&(d=u.text.firstChild.getBoundingClientRect().right-p.left-1)}var g=u.line.height-h;if((g>.005||g<-.005)&&(i<r&&(o-=g),oe(u.line,h),oi(u.line),u.rest))for(var m=0;m<u.rest.length;m++)oi(u.rest[m]);if(d>t.display.sizerWidth){var v=Math.ceil(d/Br(t.display));v>t.display.maxLineLength&&(t.display.maxLineLength=v,t.display.maxLine=u.line,t.display.maxLineChanged=!0)}}}Math.abs(o)>2&&(e.scroller.scrollTop+=o)}function oi(t){if(t.widgets)for(var e=0;e<t.widgets.length;++e){var n=t.widgets[e],r=n.node.parentNode;r&&(n.height=r.offsetHeight)}}function ai(t,e,n){var r=n&&null!=n.top?Math.max(0,n.top):t.scroller.scrollTop;r=Math.floor(r-Xn(t));var i=n&&null!=n.bottom?n.bottom:r+t.wrapper.clientHeight,o=se(e,r),a=se(e,i);if(n&&n.ensure){var s=n.ensure.from.line,l=n.ensure.to.line;s<o?(o=s,a=se(e,hn(ne(e,s))+t.wrapper.clientHeight)):Math.min(l,e.lastLine())>=a&&(o=se(e,hn(ne(e,l))-t.wrapper.clientHeight),a=l)}return{from:o,to:Math.max(a,o+1)}}function si(t,e){if(!kt(t,"scrollCursorIntoView")){var n=t.display,r=n.sizer.getBoundingClientRect(),i=null,o=n.wrapper.ownerDocument;if(e.top+r.top<0?i=!0:e.bottom+r.top>(o.defaultView.innerHeight||o.documentElement.clientHeight)&&(i=!1),null!=i&&!g){var a=F("div","​",null,"position: absolute;\n                         top: "+(e.top-n.viewOffset-Xn(t.display))+"px;\n                         height: "+(e.bottom-e.top+Zn(t)+n.barHeight)+"px;\n                         left: "+e.left+"px; width: "+Math.max(2,e.right-e.left)+"px;");t.display.lineSpace.appendChild(a),a.scrollIntoView(i),t.display.lineSpace.removeChild(a)}}}function li(t,e,n,r){var i;null==r&&(r=0),t.options.lineWrapping||e!=n||(n="before"==e.sticky?ce(e.line,e.ch+1,"before"):e,e=e.ch?ce(e.line,"before"==e.sticky?e.ch-1:e.ch,"after"):e);for(var o=0;o<5;o++){var a=!1,s=Sr(t,e),l=n&&n!=e?Sr(t,n):s,u=ci(t,i={left:Math.min(s.left,l.left),top:Math.min(s.top,l.top)-r,right:Math.max(s.left,l.left),bottom:Math.max(s.bottom,l.bottom)+r}),c=t.doc.scrollTop,h=t.doc.scrollLeft;if(null!=u.scrollTop&&(vi(t,u.scrollTop),Math.abs(t.doc.scrollTop-c)>1&&(a=!0)),null!=u.scrollLeft&&(bi(t,u.scrollLeft),Math.abs(t.doc.scrollLeft-h)>1&&(a=!0)),!a)break}return i}function ui(t,e){var n=ci(t,e);null!=n.scrollTop&&vi(t,n.scrollTop),null!=n.scrollLeft&&bi(t,n.scrollLeft)}function ci(t,e){var n=t.display,r=Mr(t.display);e.top<0&&(e.top=0);var i=t.curOp&&null!=t.curOp.scrollTop?t.curOp.scrollTop:n.scroller.scrollTop,o=er(t),a={};e.bottom-e.top>o&&(e.bottom=e.top+o);var s=t.doc.height+Jn(n),l=e.top<r,u=e.bottom>s-r;if(e.top<i)a.scrollTop=l?0:e.top;else if(e.bottom>i+o){var c=Math.min(e.top,(u?s:e.bottom)-o);c!=i&&(a.scrollTop=c)}var h=t.options.fixedGutter?0:n.gutters.offsetWidth,d=t.curOp&&null!=t.curOp.scrollLeft?t.curOp.scrollLeft:n.scroller.scrollLeft-h,f=tr(t)-n.gutters.offsetWidth,p=e.right-e.left>f;return p&&(e.right=e.left+f),e.left<10?a.scrollLeft=0:e.left<d?a.scrollLeft=Math.max(0,e.left+h-(p?0:10)):e.right>f+d-3&&(a.scrollLeft=e.right+(p?0:10)-f),a}function hi(t,e){null!=e&&(gi(t),t.curOp.scrollTop=(null==t.curOp.scrollTop?t.doc.scrollTop:t.curOp.scrollTop)+e)}function di(t){gi(t);var e=t.getCursor();t.curOp.scrollToPos={from:e,to:e,margin:t.options.cursorScrollMargin}}function fi(t,e,n){null==e&&null==n||gi(t),null!=e&&(t.curOp.scrollLeft=e),null!=n&&(t.curOp.scrollTop=n)}function pi(t,e){gi(t),t.curOp.scrollToPos=e}function gi(t){var e=t.curOp.scrollToPos;e&&(t.curOp.scrollToPos=null,mi(t,_r(t,e.from),_r(t,e.to),e.margin))}function mi(t,e,n,r){var i=ci(t,{left:Math.min(e.left,n.left),top:Math.min(e.top,n.top)-r,right:Math.max(e.right,n.right),bottom:Math.max(e.bottom,n.bottom)+r});fi(t,i.scrollLeft,i.scrollTop)}function vi(t,e){Math.abs(t.doc.scrollTop-e)<2||(n||Yi(t,{top:e}),yi(t,e,!0),n&&Yi(t),zi(t,100))}function yi(t,e,n){e=Math.max(0,Math.min(t.display.scroller.scrollHeight-t.display.scroller.clientHeight,e)),(t.display.scroller.scrollTop!=e||n)&&(t.doc.scrollTop=e,t.display.scrollbars.setScrollTop(e),t.display.scroller.scrollTop!=e&&(t.display.scroller.scrollTop=e))}function bi(t,e,n,r){e=Math.max(0,Math.min(e,t.display.scroller.scrollWidth-t.display.scroller.clientWidth)),(n?e==t.doc.scrollLeft:Math.abs(t.doc.scrollLeft-e)<2)&&!r||(t.doc.scrollLeft=e,Qi(t),t.display.scroller.scrollLeft!=e&&(t.display.scroller.scrollLeft=e),t.display.scrollbars.setScrollLeft(e))}function xi(t){var e=t.display,n=e.gutters.offsetWidth,r=Math.round(t.doc.height+Jn(t.display));return{clientHeight:e.scroller.clientHeight,viewHeight:e.wrapper.clientHeight,scrollWidth:e.scroller.scrollWidth,clientWidth:e.scroller.clientWidth,viewWidth:e.wrapper.clientWidth,barLeft:t.options.fixedGutter?n:0,docHeight:r,scrollHeight:r+Zn(t)+e.barHeight,nativeBarWidth:e.nativeBarWidth,gutterWidth:n}}var wi=function(t,e,n){this.cm=n;var r=this.vert=F("div",[F("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),i=this.horiz=F("div",[F("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");r.tabIndex=i.tabIndex=-1,t(r),t(i),bt(r,"scroll",(function(){r.clientHeight&&e(r.scrollTop,"vertical")})),bt(i,"scroll",(function(){i.clientWidth&&e(i.scrollLeft,"horizontal")})),this.checkedZeroWidth=!1,a&&s<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};wi.prototype.update=function(t){var e=t.scrollWidth>t.clientWidth+1,n=t.scrollHeight>t.clientHeight+1,r=t.nativeBarWidth;if(n){this.vert.style.display="block",this.vert.style.bottom=e?r+"px":"0";var i=t.viewHeight-(e?r:0);this.vert.firstChild.style.height=Math.max(0,t.scrollHeight-t.clientHeight+i)+"px"}else this.vert.scrollTop=0,this.vert.style.display="",this.vert.firstChild.style.height="0";if(e){this.horiz.style.display="block",this.horiz.style.right=n?r+"px":"0",this.horiz.style.left=t.barLeft+"px";var o=t.viewWidth-t.barLeft-(n?r:0);this.horiz.firstChild.style.width=Math.max(0,t.scrollWidth-t.clientWidth+o)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&t.clientHeight>0&&(0==r&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:n?r:0,bottom:e?r:0}},wi.prototype.setScrollLeft=function(t){this.horiz.scrollLeft!=t&&(this.horiz.scrollLeft=t),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},wi.prototype.setScrollTop=function(t){this.vert.scrollTop!=t&&(this.vert.scrollTop=t),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},wi.prototype.zeroWidthHack=function(){var t=b&&!p?"12px":"18px";this.horiz.style.height=this.vert.style.width=t,this.horiz.style.visibility=this.vert.style.visibility="hidden",this.disableHoriz=new q,this.disableVert=new q},wi.prototype.enableZeroWidthBar=function(t,e,n){function r(){var i=t.getBoundingClientRect();("vert"==n?document.elementFromPoint(i.right-1,(i.top+i.bottom)/2):document.elementFromPoint((i.right+i.left)/2,i.bottom-1))!=t?t.style.visibility="hidden":e.set(1e3,r)}t.style.visibility="",e.set(1e3,r)},wi.prototype.clear=function(){var t=this.horiz.parentNode;t.removeChild(this.horiz),t.removeChild(this.vert)};var Ci=function(){};function ki(t,e){e||(e=xi(t));var n=t.display.barWidth,r=t.display.barHeight;Si(t,e);for(var i=0;i<4&&n!=t.display.barWidth||r!=t.display.barHeight;i++)n!=t.display.barWidth&&t.options.lineWrapping&&ii(t),Si(t,xi(t)),n=t.display.barWidth,r=t.display.barHeight}function Si(t,e){var n=t.display,r=n.scrollbars.update(e);n.sizer.style.paddingRight=(n.barWidth=r.right)+"px",n.sizer.style.paddingBottom=(n.barHeight=r.bottom)+"px",n.heightForcer.style.borderBottom=r.bottom+"px solid transparent",r.right&&r.bottom?(n.scrollbarFiller.style.display="block",n.scrollbarFiller.style.height=r.bottom+"px",n.scrollbarFiller.style.width=r.right+"px"):n.scrollbarFiller.style.display="",r.bottom&&t.options.coverGutterNextToScrollbar&&t.options.fixedGutter?(n.gutterFiller.style.display="block",n.gutterFiller.style.height=r.bottom+"px",n.gutterFiller.style.width=e.gutterWidth+"px"):n.gutterFiller.style.display=""}Ci.prototype.update=function(){return{bottom:0,right:0}},Ci.prototype.setScrollLeft=function(){},Ci.prototype.setScrollTop=function(){},Ci.prototype.clear=function(){};var _i={native:wi,null:Ci};function Di(t){t.display.scrollbars&&(t.display.scrollbars.clear(),t.display.scrollbars.addClass&&A(t.display.wrapper,t.display.scrollbars.addClass)),t.display.scrollbars=new _i[t.options.scrollbarStyle]((function(e){t.display.wrapper.insertBefore(e,t.display.scrollbarFiller),bt(e,"mousedown",(function(){t.state.focused&&setTimeout((function(){return t.display.input.focus()}),0)})),e.setAttribute("cm-not-content","true")}),(function(e,n){"horizontal"==n?bi(t,e):vi(t,e)}),t),t.display.scrollbars.addClass&&M(t.display.wrapper,t.display.scrollbars.addClass)}var Ai=0;function Ti(t){t.curOp={cm:t,viewChanged:!1,startHeight:t.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Ai,markArrays:null},Fn(t.curOp)}function Ei(t){var e=t.curOp;e&&Pn(e,(function(t){for(var e=0;e<t.ops.length;e++)t.ops[e].cm.curOp=null;Fi(t)}))}function Fi(t){for(var e=t.ops,n=0;n<e.length;n++)Li(e[n]);for(var r=0;r<e.length;r++)Pi(e[r]);for(var i=0;i<e.length;i++)Oi(e[i]);for(var o=0;o<e.length;o++)Mi(e[o]);for(var a=0;a<e.length;a++)Bi(e[a])}function Li(t){var e=t.cm,n=e.display;Wi(e),t.updateMaxLine&&fn(e),t.mustUpdate=t.viewChanged||t.forceUpdate||null!=t.scrollTop||t.scrollToPos&&(t.scrollToPos.from.line<n.viewFrom||t.scrollToPos.to.line>=n.viewTo)||n.maxLineChanged&&e.options.lineWrapping,t.update=t.mustUpdate&&new Gi(e,t.mustUpdate&&{top:t.scrollTop,ensure:t.scrollToPos},t.forceUpdate)}function Pi(t){t.updatedDisplay=t.mustUpdate&&Ki(t.cm,t.update)}function Oi(t){var e=t.cm,n=e.display;t.updatedDisplay&&ii(e),t.barMeasure=xi(e),n.maxLineChanged&&!e.options.lineWrapping&&(t.adjustWidthTo=or(e,n.maxLine,n.maxLine.text.length).left+3,e.display.sizerWidth=t.adjustWidthTo,t.barMeasure.scrollWidth=Math.max(n.scroller.clientWidth,n.sizer.offsetLeft+t.adjustWidthTo+Zn(e)+e.display.barWidth),t.maxScrollLeft=Math.max(0,n.sizer.offsetLeft+t.adjustWidthTo-tr(e))),(t.updatedDisplay||t.selectionChanged)&&(t.preparedSelection=n.input.prepareSelection())}function Mi(t){var e=t.cm;null!=t.adjustWidthTo&&(e.display.sizer.style.minWidth=t.adjustWidthTo+"px",t.maxScrollLeft<e.doc.scrollLeft&&bi(e,Math.min(e.display.scroller.scrollLeft,t.maxScrollLeft),!0),e.display.maxLineChanged=!1);var n=t.focus&&t.focus==O(R(e));t.preparedSelection&&e.display.input.showSelection(t.preparedSelection,n),(t.updatedDisplay||t.startHeight!=e.doc.height)&&ki(e,t.barMeasure),t.updatedDisplay&&Ji(e,t.barMeasure),t.selectionChanged&&Zr(e),e.state.focused&&t.updateInput&&e.display.input.reset(t.typing),n&&ti(t.cm)}function Bi(t){var e=t.cm,n=e.display,r=e.doc;t.updatedDisplay&&$i(e,t.update),null==n.wheelStartX||null==t.scrollTop&&null==t.scrollLeft&&!t.scrollToPos||(n.wheelStartX=n.wheelStartY=null),null!=t.scrollTop&&yi(e,t.scrollTop,t.forceScroll),null!=t.scrollLeft&&bi(e,t.scrollLeft,!0,!0),t.scrollToPos&&si(e,li(e,ve(r,t.scrollToPos.from),ve(r,t.scrollToPos.to),t.scrollToPos.margin));var i=t.maybeHiddenMarkers,o=t.maybeUnhiddenMarkers;if(i)for(var a=0;a<i.length;++a)i[a].lines.length||Ct(i[a],"hide");if(o)for(var s=0;s<o.length;++s)o[s].lines.length&&Ct(o[s],"unhide");n.wrapper.offsetHeight&&(r.scrollTop=e.display.scroller.scrollTop),t.changeObjs&&Ct(e,"changes",e,t.changeObjs),t.update&&t.update.finish()}function Ni(t,e){if(t.curOp)return e();Ti(t);try{return e()}finally{Ei(t)}}function Ii(t,e){return function(){if(t.curOp)return e.apply(t,arguments);Ti(t);try{return e.apply(t,arguments)}finally{Ei(t)}}}function Ri(t){return function(){if(this.curOp)return t.apply(this,arguments);Ti(this);try{return t.apply(this,arguments)}finally{Ei(this)}}}function ji(t){return function(){var e=this.cm;if(!e||e.curOp)return t.apply(this,arguments);Ti(e);try{return t.apply(this,arguments)}finally{Ei(e)}}}function zi(t,e){t.doc.highlightFrontier<t.display.viewTo&&t.state.highlight.set(e,H(Hi,t))}function Hi(t){var e=t.doc;if(!(e.highlightFrontier>=t.display.viewTo)){var n=+new Date+t.options.workTime,r=Se(t,e.highlightFrontier),i=[];e.iter(r.line,Math.min(e.first+e.size,t.display.viewTo+500),(function(o){if(r.line>=t.display.viewFrom){var a=o.styles,s=o.text.length>t.options.maxHighlightLength?Qt(e.mode,r.state):null,l=Ce(t,o,r,!0);s&&(r.state=s),o.styles=l.styles;var u=o.styleClasses,c=l.classes;c?o.styleClasses=c:u&&(o.styleClasses=null);for(var h=!a||a.length!=o.styles.length||u!=c&&(!u||!c||u.bgClass!=c.bgClass||u.textClass!=c.textClass),d=0;!h&&d<a.length;++d)h=a[d]!=o.styles[d];h&&i.push(r.line),o.stateAfter=r.save(),r.nextLine()}else o.text.length<=t.options.maxHighlightLength&&_e(t,o.text,r),o.stateAfter=r.line%5==0?r.save():null,r.nextLine();if(+new Date>n)return zi(t,t.options.workDelay),!0})),e.highlightFrontier=r.line,e.modeFrontier=Math.max(e.modeFrontier,r.line),i.length&&Ni(t,(function(){for(var e=0;e<i.length;e++)Wr(t,i[e],"text")}))}}var Gi=function(t,e,n){var r=t.display;this.viewport=e,this.visible=ai(r,t.doc,e),this.editorIsHidden=!r.wrapper.offsetWidth,this.wrapperHeight=r.wrapper.clientHeight,this.wrapperWidth=r.wrapper.clientWidth,this.oldDisplayWidth=tr(t),this.force=n,this.dims=Nr(t),this.events=[]};function Wi(t){var e=t.display;!e.scrollbarsClipped&&e.scroller.offsetWidth&&(e.nativeBarWidth=e.scroller.offsetWidth-e.scroller.clientWidth,e.heightForcer.style.height=Zn(t)+"px",e.sizer.style.marginBottom=-e.nativeBarWidth+"px",e.sizer.style.borderRightWidth=Zn(t)+"px",e.scrollbarsClipped=!0)}function qi(t){if(t.hasFocus())return null;var e=O(R(t));if(!e||!P(t.display.lineDiv,e))return null;var n={activeElt:e};if(window.getSelection){var r=z(t).getSelection();r.anchorNode&&r.extend&&P(t.display.lineDiv,r.anchorNode)&&(n.anchorNode=r.anchorNode,n.anchorOffset=r.anchorOffset,n.focusNode=r.focusNode,n.focusOffset=r.focusOffset)}return n}function Ui(t){if(t&&t.activeElt&&t.activeElt!=O(j(t.activeElt))&&(t.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(t.activeElt.nodeName)&&t.anchorNode&&P(document.body,t.anchorNode)&&P(document.body,t.focusNode))){var e=t.activeElt.ownerDocument,n=e.defaultView.getSelection(),r=e.createRange();r.setEnd(t.anchorNode,t.anchorOffset),r.collapse(!1),n.removeAllRanges(),n.addRange(r),n.extend(t.focusNode,t.focusOffset)}}function Ki(t,e){var n=t.display,r=t.doc;if(e.editorIsHidden)return qr(t),!1;if(!e.force&&e.visible.from>=n.viewFrom&&e.visible.to<=n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo)&&n.renderedView==n.view&&0==$r(t))return!1;Zi(t)&&(qr(t),e.dims=Nr(t));var i=r.first+r.size,o=Math.max(e.visible.from-t.options.viewportMargin,r.first),a=Math.min(i,e.visible.to+t.options.viewportMargin);n.viewFrom<o&&o-n.viewFrom<20&&(o=Math.max(r.first,n.viewFrom)),n.viewTo>a&&n.viewTo-a<20&&(a=Math.min(i,n.viewTo)),Be&&(o=sn(t.doc,o),a=ln(t.doc,a));var s=o!=n.viewFrom||a!=n.viewTo||n.lastWrapHeight!=e.wrapperHeight||n.lastWrapWidth!=e.wrapperWidth;Kr(t,o,a),n.viewOffset=hn(ne(t.doc,n.viewFrom)),t.display.mover.style.top=n.viewOffset+"px";var l=$r(t);if(!s&&0==l&&!e.force&&n.renderedView==n.view&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo))return!1;var u=qi(t);return l>4&&(n.lineDiv.style.display="none"),Vi(t,n.updateLineNumbers,e.dims),l>4&&(n.lineDiv.style.display=""),n.renderedView=n.view,Ui(u),T(n.cursorDiv),T(n.selectionDiv),n.gutters.style.height=n.sizer.style.minHeight=0,s&&(n.lastWrapHeight=e.wrapperHeight,n.lastWrapWidth=e.wrapperWidth,zi(t,400)),n.updateLineNumbers=null,!0}function $i(t,e){for(var n=e.viewport,r=!0;;r=!1){if(r&&t.options.lineWrapping&&e.oldDisplayWidth!=tr(t))r&&(e.visible=ai(t.display,t.doc,n));else if(n&&null!=n.top&&(n={top:Math.min(t.doc.height+Jn(t.display)-er(t),n.top)}),e.visible=ai(t.display,t.doc,n),e.visible.from>=t.display.viewFrom&&e.visible.to<=t.display.viewTo)break;if(!Ki(t,e))break;ii(t);var i=xi(t);Yr(t),ki(t,i),Ji(t,i),e.force=!1}e.signal(t,"update",t),t.display.viewFrom==t.display.reportedViewFrom&&t.display.viewTo==t.display.reportedViewTo||(e.signal(t,"viewportChange",t,t.display.viewFrom,t.display.viewTo),t.display.reportedViewFrom=t.display.viewFrom,t.display.reportedViewTo=t.display.viewTo)}function Yi(t,e){var n=new Gi(t,e);if(Ki(t,n)){ii(t),$i(t,n);var r=xi(t);Yr(t),ki(t,r),Ji(t,r),n.finish()}}function Vi(t,e,n){var r=t.display,i=t.options.lineNumbers,o=r.lineDiv,a=o.firstChild;function s(e){var n=e.nextSibling;return l&&b&&t.display.currentWheelTarget==e?e.style.display="none":e.parentNode.removeChild(e),n}for(var u=r.view,c=r.viewFrom,h=0;h<u.length;h++){var d=u[h];if(d.hidden);else if(d.node&&d.node.parentNode==o){for(;a!=d.node;)a=s(a);var f=i&&null!=e&&e<=c&&d.lineNumber;d.changes&&(U(d.changes,"gutter")>-1&&(f=!1),Nn(t,d,c,n)),f&&(T(d.lineNumber),d.lineNumber.appendChild(document.createTextNode(ue(t.options,c)))),a=d.node.nextSibling}else{var p=qn(t,d,c,n);o.insertBefore(p,a)}c+=d.size}for(;a;)a=s(a)}function Xi(t){var e=t.gutters.offsetWidth;t.sizer.style.marginLeft=e+"px",Mn(t,"gutterChanged",t)}function Ji(t,e){t.display.sizer.style.minHeight=e.docHeight+"px",t.display.heightForcer.style.top=e.docHeight+"px",t.display.gutters.style.height=e.docHeight+t.display.barHeight+Zn(t)+"px"}function Qi(t){var e=t.display,n=e.view;if(e.alignWidgets||e.gutters.firstChild&&t.options.fixedGutter){for(var r=Ir(e)-e.scroller.scrollLeft+t.doc.scrollLeft,i=e.gutters.offsetWidth,o=r+"px",a=0;a<n.length;a++)if(!n[a].hidden){t.options.fixedGutter&&(n[a].gutter&&(n[a].gutter.style.left=o),n[a].gutterBackground&&(n[a].gutterBackground.style.left=o));var s=n[a].alignable;if(s)for(var l=0;l<s.length;l++)s[l].style.left=o}t.options.fixedGutter&&(e.gutters.style.left=r+i+"px")}}function Zi(t){if(!t.options.lineNumbers)return!1;var e=t.doc,n=ue(t.options,e.first+e.size-1),r=t.display;if(n.length!=r.lineNumChars){var i=r.measure.appendChild(F("div",[F("div",n)],"CodeMirror-linenumber CodeMirror-gutter-elt")),o=i.firstChild.offsetWidth,a=i.offsetWidth-o;return r.lineGutter.style.width="",r.lineNumInnerWidth=Math.max(o,r.lineGutter.offsetWidth-a)+1,r.lineNumWidth=r.lineNumInnerWidth+a,r.lineNumChars=r.lineNumInnerWidth?n.length:-1,r.lineGutter.style.width=r.lineNumWidth+"px",Xi(t.display),!0}return!1}function to(t,e){for(var n=[],r=!1,i=0;i<t.length;i++){var o=t[i],a=null;if("string"!=typeof o&&(a=o.style,o=o.className),"CodeMirror-linenumbers"==o){if(!e)continue;r=!0}n.push({className:o,style:a})}return e&&!r&&n.push({className:"CodeMirror-linenumbers",style:null}),n}function eo(t){var e=t.gutters,n=t.gutterSpecs;T(e),t.lineGutter=null;for(var r=0;r<n.length;++r){var i=n[r],o=i.className,a=i.style,s=e.appendChild(F("div",null,"CodeMirror-gutter "+o));a&&(s.style.cssText=a),"CodeMirror-linenumbers"==o&&(t.lineGutter=s,s.style.width=(t.lineNumWidth||1)+"px")}e.style.display=n.length?"":"none",Xi(t)}function no(t){eo(t.display),Gr(t),Qi(t)}function ro(t,e,r,i){var o=this;this.input=r,o.scrollbarFiller=F("div",null,"CodeMirror-scrollbar-filler"),o.scrollbarFiller.setAttribute("cm-not-content","true"),o.gutterFiller=F("div",null,"CodeMirror-gutter-filler"),o.gutterFiller.setAttribute("cm-not-content","true"),o.lineDiv=L("div",null,"CodeMirror-code"),o.selectionDiv=F("div",null,null,"position: relative; z-index: 1"),o.cursorDiv=F("div",null,"CodeMirror-cursors"),o.measure=F("div",null,"CodeMirror-measure"),o.lineMeasure=F("div",null,"CodeMirror-measure"),o.lineSpace=L("div",[o.measure,o.lineMeasure,o.selectionDiv,o.cursorDiv,o.lineDiv],null,"position: relative; outline: none");var u=L("div",[o.lineSpace],"CodeMirror-lines");o.mover=F("div",[u],null,"position: relative"),o.sizer=F("div",[o.mover],"CodeMirror-sizer"),o.sizerWidth=null,o.heightForcer=F("div",null,null,"position: absolute; height: "+K+"px; width: 1px;"),o.gutters=F("div",null,"CodeMirror-gutters"),o.lineGutter=null,o.scroller=F("div",[o.sizer,o.heightForcer,o.gutters],"CodeMirror-scroll"),o.scroller.setAttribute("tabIndex","-1"),o.wrapper=F("div",[o.scrollbarFiller,o.gutterFiller,o.scroller],"CodeMirror"),c&&h>=105&&(o.wrapper.style.clipPath="inset(0px)"),o.wrapper.setAttribute("translate","no"),a&&s<8&&(o.gutters.style.zIndex=-1,o.scroller.style.paddingRight=0),l||n&&y||(o.scroller.draggable=!0),t&&(t.appendChild?t.appendChild(o.wrapper):t(o.wrapper)),o.viewFrom=o.viewTo=e.first,o.reportedViewFrom=o.reportedViewTo=e.first,o.view=[],o.renderedView=null,o.externalMeasured=null,o.viewOffset=0,o.lastWrapHeight=o.lastWrapWidth=0,o.updateLineNumbers=null,o.nativeBarWidth=o.barHeight=o.barWidth=0,o.scrollbarsClipped=!1,o.lineNumWidth=o.lineNumInnerWidth=o.lineNumChars=null,o.alignWidgets=!1,o.cachedCharWidth=o.cachedTextHeight=o.cachedPaddingH=null,o.maxLine=null,o.maxLineLength=0,o.maxLineChanged=!1,o.wheelDX=o.wheelDY=o.wheelStartX=o.wheelStartY=null,o.shift=!1,o.selForContextMenu=null,o.activeTouch=null,o.gutterSpecs=to(i.gutters,i.lineNumbers),eo(o),r.init(o)}Gi.prototype.signal=function(t,e){_t(t,e)&&this.events.push(arguments)},Gi.prototype.finish=function(){for(var t=0;t<this.events.length;t++)Ct.apply(null,this.events[t])};var io=0,oo=null;function ao(t){var e=t.wheelDeltaX,n=t.wheelDeltaY;return null==e&&t.detail&&t.axis==t.HORIZONTAL_AXIS&&(e=t.detail),null==n&&t.detail&&t.axis==t.VERTICAL_AXIS?n=t.detail:null==n&&(n=t.wheelDelta),{x:e,y:n}}function so(t){var e=ao(t);return e.x*=oo,e.y*=oo,e}function lo(t,e){c&&102==h&&(null==t.display.chromeScrollHack?t.display.sizer.style.pointerEvents="none":clearTimeout(t.display.chromeScrollHack),t.display.chromeScrollHack=setTimeout((function(){t.display.chromeScrollHack=null,t.display.sizer.style.pointerEvents=""}),100));var r=ao(e),i=r.x,o=r.y,a=oo;0===e.deltaMode&&(i=e.deltaX,o=e.deltaY,a=1);var s=t.display,u=s.scroller,f=u.scrollWidth>u.clientWidth,p=u.scrollHeight>u.clientHeight;if(i&&f||o&&p){if(o&&b&&l)t:for(var g=e.target,m=s.view;g!=u;g=g.parentNode)for(var v=0;v<m.length;v++)if(m[v].node==g){t.display.currentWheelTarget=g;break t}if(i&&!n&&!d&&null!=a)return o&&p&&vi(t,Math.max(0,u.scrollTop+o*a)),bi(t,Math.max(0,u.scrollLeft+i*a)),(!o||o&&p)&&At(e),void(s.wheelStartX=null);if(o&&null!=a){var y=o*a,x=t.doc.scrollTop,w=x+s.wrapper.clientHeight;y<0?x=Math.max(0,x+y-50):w=Math.min(t.doc.height,w+y+50),Yi(t,{top:x,bottom:w})}io<20&&0!==e.deltaMode&&(null==s.wheelStartX?(s.wheelStartX=u.scrollLeft,s.wheelStartY=u.scrollTop,s.wheelDX=i,s.wheelDY=o,setTimeout((function(){if(null!=s.wheelStartX){var t=u.scrollLeft-s.wheelStartX,e=u.scrollTop-s.wheelStartY,n=e&&s.wheelDY&&e/s.wheelDY||t&&s.wheelDX&&t/s.wheelDX;s.wheelStartX=s.wheelStartY=null,n&&(oo=(oo*io+n)/(io+1),++io)}}),200)):(s.wheelDX+=i,s.wheelDY+=o))}}a?oo=-.53:n?oo=15:c?oo=-.7:f&&(oo=-1/3);var uo=function(t,e){this.ranges=t,this.primIndex=e};uo.prototype.primary=function(){return this.ranges[this.primIndex]},uo.prototype.equals=function(t){if(t==this)return!0;if(t.primIndex!=this.primIndex||t.ranges.length!=this.ranges.length)return!1;for(var e=0;e<this.ranges.length;e++){var n=this.ranges[e],r=t.ranges[e];if(!de(n.anchor,r.anchor)||!de(n.head,r.head))return!1}return!0},uo.prototype.deepCopy=function(){for(var t=[],e=0;e<this.ranges.length;e++)t[e]=new co(fe(this.ranges[e].anchor),fe(this.ranges[e].head));return new uo(t,this.primIndex)},uo.prototype.somethingSelected=function(){for(var t=0;t<this.ranges.length;t++)if(!this.ranges[t].empty())return!0;return!1},uo.prototype.contains=function(t,e){e||(e=t);for(var n=0;n<this.ranges.length;n++){var r=this.ranges[n];if(he(e,r.from())>=0&&he(t,r.to())<=0)return n}return-1};var co=function(t,e){this.anchor=t,this.head=e};function ho(t,e,n){var r=t&&t.options.selectionsMayTouch,i=e[n];e.sort((function(t,e){return he(t.from(),e.from())})),n=U(e,i);for(var o=1;o<e.length;o++){var a=e[o],s=e[o-1],l=he(s.to(),a.from());if(r&&!a.empty()?l>0:l>=0){var u=ge(s.from(),a.from()),c=pe(s.to(),a.to()),h=s.empty()?a.from()==a.head:s.from()==s.head;o<=n&&--n,e.splice(--o,2,new co(h?c:u,h?u:c))}}return new uo(e,n)}function fo(t,e){return new uo([new co(t,e||t)],0)}function po(t){return t.text?ce(t.from.line+t.text.length-1,tt(t.text).length+(1==t.text.length?t.from.ch:0)):t.to}function go(t,e){if(he(t,e.from)<0)return t;if(he(t,e.to)<=0)return po(e);var n=t.line+e.text.length-(e.to.line-e.from.line)-1,r=t.ch;return t.line==e.to.line&&(r+=po(e).ch-e.to.ch),ce(n,r)}function mo(t,e){for(var n=[],r=0;r<t.sel.ranges.length;r++){var i=t.sel.ranges[r];n.push(new co(go(i.anchor,e),go(i.head,e)))}return ho(t.cm,n,t.sel.primIndex)}function vo(t,e,n){return t.line==e.line?ce(n.line,t.ch-e.ch+n.ch):ce(n.line+(t.line-e.line),t.ch)}function yo(t,e,n){for(var r=[],i=ce(t.first,0),o=i,a=0;a<e.length;a++){var s=e[a],l=vo(s.from,i,o),u=vo(po(s),i,o);if(i=s.to,o=u,"around"==n){var c=t.sel.ranges[a],h=he(c.head,c.anchor)<0;r[a]=new co(h?u:l,h?l:u)}else r[a]=new co(l,l)}return new uo(r,t.sel.primIndex)}function bo(t){t.doc.mode=Vt(t.options,t.doc.modeOption),xo(t)}function xo(t){t.doc.iter((function(t){t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null)})),t.doc.modeFrontier=t.doc.highlightFrontier=t.doc.first,zi(t,100),t.state.modeGen++,t.curOp&&Gr(t)}function wo(t,e){return 0==e.from.ch&&0==e.to.ch&&""==tt(e.text)&&(!t.cm||t.cm.options.wholeLineUpdateBefore)}function Co(t,e,n,r){function i(t){return n?n[t]:null}function o(t,n,i){gn(t,n,i,r),Mn(t,"change",t,e)}function a(t,e){for(var n=[],o=t;o<e;++o)n.push(new pn(u[o],i(o),r));return n}var s=e.from,l=e.to,u=e.text,c=ne(t,s.line),h=ne(t,l.line),d=tt(u),f=i(u.length-1),p=l.line-s.line;if(e.full)t.insert(0,a(0,u.length)),t.remove(u.length,t.size-u.length);else if(wo(t,e)){var g=a(0,u.length-1);o(h,h.text,f),p&&t.remove(s.line,p),g.length&&t.insert(s.line,g)}else if(c==h)if(1==u.length)o(c,c.text.slice(0,s.ch)+d+c.text.slice(l.ch),f);else{var m=a(1,u.length-1);m.push(new pn(d+c.text.slice(l.ch),f,r)),o(c,c.text.slice(0,s.ch)+u[0],i(0)),t.insert(s.line+1,m)}else if(1==u.length)o(c,c.text.slice(0,s.ch)+u[0]+h.text.slice(l.ch),i(0)),t.remove(s.line+1,p);else{o(c,c.text.slice(0,s.ch)+u[0],i(0)),o(h,d+h.text.slice(l.ch),f);var v=a(1,u.length-1);p>1&&t.remove(s.line+1,p-1),t.insert(s.line+1,v)}Mn(t,"change",t,e)}function ko(t,e,n){function r(t,i,o){if(t.linked)for(var a=0;a<t.linked.length;++a){var s=t.linked[a];if(s.doc!=i){var l=o&&s.sharedHist;n&&!l||(e(s.doc,l),r(s.doc,t,l))}}}r(t,null,!0)}function So(t,e){if(e.cm)throw new Error("This document is already in use.");t.doc=e,e.cm=t,jr(t),bo(t),_o(t),t.options.direction=e.direction,t.options.lineWrapping||fn(t),t.options.mode=e.modeOption,Gr(t)}function _o(t){("rtl"==t.doc.direction?M:A)(t.display.lineDiv,"CodeMirror-rtl")}function Do(t){Ni(t,(function(){_o(t),Gr(t)}))}function Ao(t){this.done=[],this.undone=[],this.undoDepth=t?t.undoDepth:1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=t?t.maxGeneration:1}function To(t,e){var n={from:fe(e.from),to:po(e),text:re(t,e.from,e.to)};return Bo(t,n,e.from.line,e.to.line+1),ko(t,(function(t){return Bo(t,n,e.from.line,e.to.line+1)}),!0),n}function Eo(t){for(;t.length&&tt(t).ranges;)t.pop()}function Fo(t,e){return e?(Eo(t.done),tt(t.done)):t.done.length&&!tt(t.done).ranges?tt(t.done):t.done.length>1&&!t.done[t.done.length-2].ranges?(t.done.pop(),tt(t.done)):void 0}function Lo(t,e,n,r){var i=t.history;i.undone.length=0;var o,a,s=+new Date;if((i.lastOp==r||i.lastOrigin==e.origin&&e.origin&&("+"==e.origin.charAt(0)&&i.lastModTime>s-(t.cm?t.cm.options.historyEventDelay:500)||"*"==e.origin.charAt(0)))&&(o=Fo(i,i.lastOp==r)))a=tt(o.changes),0==he(e.from,e.to)&&0==he(e.from,a.to)?a.to=po(e):o.changes.push(To(t,e));else{var l=tt(i.done);for(l&&l.ranges||Mo(t.sel,i.done),o={changes:[To(t,e)],generation:i.generation},i.done.push(o);i.done.length>i.undoDepth;)i.done.shift(),i.done[0].ranges||i.done.shift()}i.done.push(n),i.generation=++i.maxGeneration,i.lastModTime=i.lastSelTime=s,i.lastOp=i.lastSelOp=r,i.lastOrigin=i.lastSelOrigin=e.origin,a||Ct(t,"historyAdded")}function Po(t,e,n,r){var i=e.charAt(0);return"*"==i||"+"==i&&n.ranges.length==r.ranges.length&&n.somethingSelected()==r.somethingSelected()&&new Date-t.history.lastSelTime<=(t.cm?t.cm.options.historyEventDelay:500)}function Oo(t,e,n,r){var i=t.history,o=r&&r.origin;n==i.lastSelOp||o&&i.lastSelOrigin==o&&(i.lastModTime==i.lastSelTime&&i.lastOrigin==o||Po(t,o,tt(i.done),e))?i.done[i.done.length-1]=e:Mo(e,i.done),i.lastSelTime=+new Date,i.lastSelOrigin=o,i.lastSelOp=n,r&&!1!==r.clearRedo&&Eo(i.undone)}function Mo(t,e){var n=tt(e);n&&n.ranges&&n.equals(t)||e.push(t)}function Bo(t,e,n,r){var i=e["spans_"+t.id],o=0;t.iter(Math.max(t.first,n),Math.min(t.first+t.size,r),(function(n){n.markedSpans&&((i||(i=e["spans_"+t.id]={}))[o]=n.markedSpans),++o}))}function No(t){if(!t)return null;for(var e,n=0;n<t.length;++n)t[n].marker.explicitlyCleared?e||(e=t.slice(0,n)):e&&e.push(t[n]);return e?e.length?e:null:t}function Io(t,e){var n=e["spans_"+t.id];if(!n)return null;for(var r=[],i=0;i<e.text.length;++i)r.push(No(n[i]));return r}function Ro(t,e){var n=Io(t,e),r=qe(t,e);if(!n)return r;if(!r)return n;for(var i=0;i<n.length;++i){var o=n[i],a=r[i];if(o&&a)t:for(var s=0;s<a.length;++s){for(var l=a[s],u=0;u<o.length;++u)if(o[u].marker==l.marker)continue t;o.push(l)}else a&&(n[i]=a)}return n}function jo(t,e,n){for(var r=[],i=0;i<t.length;++i){var o=t[i];if(o.ranges)r.push(n?uo.prototype.deepCopy.call(o):o);else{var a=o.changes,s=[];r.push({changes:s});for(var l=0;l<a.length;++l){var u=a[l],c=void 0;if(s.push({from:u.from,to:u.to,text:u.text}),e)for(var h in u)(c=h.match(/^spans_(\d+)$/))&&U(e,Number(c[1]))>-1&&(tt(s)[h]=u[h],delete u[h])}}}return r}function zo(t,e,n,r){if(r){var i=t.anchor;if(n){var o=he(e,i)<0;o!=he(n,i)<0?(i=e,e=n):o!=he(e,n)<0&&(e=n)}return new co(i,e)}return new co(n||e,e)}function Ho(t,e,n,r,i){null==i&&(i=t.cm&&(t.cm.display.shift||t.extend)),$o(t,new uo([zo(t.sel.primary(),e,n,i)],0),r)}function Go(t,e,n){for(var r=[],i=t.cm&&(t.cm.display.shift||t.extend),o=0;o<t.sel.ranges.length;o++)r[o]=zo(t.sel.ranges[o],e[o],null,i);$o(t,ho(t.cm,r,t.sel.primIndex),n)}function Wo(t,e,n,r){var i=t.sel.ranges.slice(0);i[e]=n,$o(t,ho(t.cm,i,t.sel.primIndex),r)}function qo(t,e,n,r){$o(t,fo(e,n),r)}function Uo(t,e,n){var r={ranges:e.ranges,update:function(e){this.ranges=[];for(var n=0;n<e.length;n++)this.ranges[n]=new co(ve(t,e[n].anchor),ve(t,e[n].head))},origin:n&&n.origin};return Ct(t,"beforeSelectionChange",t,r),t.cm&&Ct(t.cm,"beforeSelectionChange",t.cm,r),r.ranges!=e.ranges?ho(t.cm,r.ranges,r.ranges.length-1):e}function Ko(t,e,n){var r=t.history.done,i=tt(r);i&&i.ranges?(r[r.length-1]=e,Yo(t,e,n)):$o(t,e,n)}function $o(t,e,n){Yo(t,e,n),Oo(t,t.sel,t.cm?t.cm.curOp.id:NaN,n)}function Yo(t,e,n){(_t(t,"beforeSelectionChange")||t.cm&&_t(t.cm,"beforeSelectionChange"))&&(e=Uo(t,e,n));var r=n&&n.bias||(he(e.primary().head,t.sel.primary().head)<0?-1:1);Vo(t,Jo(t,e,r,!0)),n&&!1===n.scroll||!t.cm||"nocursor"==t.cm.getOption("readOnly")||di(t.cm)}function Vo(t,e){e.equals(t.sel)||(t.sel=e,t.cm&&(t.cm.curOp.updateInput=1,t.cm.curOp.selectionChanged=!0,St(t.cm)),Mn(t,"cursorActivity",t))}function Xo(t){Vo(t,Jo(t,t.sel,null,!1))}function Jo(t,e,n,r){for(var i,o=0;o<e.ranges.length;o++){var a=e.ranges[o],s=e.ranges.length==t.sel.ranges.length&&t.sel.ranges[o],l=Zo(t,a.anchor,s&&s.anchor,n,r),u=a.head==a.anchor?l:Zo(t,a.head,s&&s.head,n,r);(i||l!=a.anchor||u!=a.head)&&(i||(i=e.ranges.slice(0,o)),i[o]=new co(l,u))}return i?ho(t.cm,i,e.primIndex):e}function Qo(t,e,n,r,i){var o=ne(t,e.line);if(o.markedSpans)for(var a=0;a<o.markedSpans.length;++a){var s=o.markedSpans[a],l=s.marker,u="selectLeft"in l?!l.selectLeft:l.inclusiveLeft,c="selectRight"in l?!l.selectRight:l.inclusiveRight;if((null==s.from||(u?s.from<=e.ch:s.from<e.ch))&&(null==s.to||(c?s.to>=e.ch:s.to>e.ch))){if(i&&(Ct(l,"beforeCursorEnter"),l.explicitlyCleared)){if(o.markedSpans){--a;continue}break}if(!l.atomic)continue;if(n){var h=l.find(r<0?1:-1),d=void 0;if((r<0?c:u)&&(h=ta(t,h,-r,h&&h.line==e.line?o:null)),h&&h.line==e.line&&(d=he(h,n))&&(r<0?d<0:d>0))return Qo(t,h,e,r,i)}var f=l.find(r<0?-1:1);return(r<0?u:c)&&(f=ta(t,f,r,f.line==e.line?o:null)),f?Qo(t,f,e,r,i):null}}return e}function Zo(t,e,n,r,i){var o=r||1,a=Qo(t,e,n,o,i)||!i&&Qo(t,e,n,o,!0)||Qo(t,e,n,-o,i)||!i&&Qo(t,e,n,-o,!0);return a||(t.cantEdit=!0,ce(t.first,0))}function ta(t,e,n,r){return n<0&&0==e.ch?e.line>t.first?ve(t,ce(e.line-1)):null:n>0&&e.ch==(r||ne(t,e.line)).text.length?e.line<t.first+t.size-1?ce(e.line+1,0):null:new ce(e.line,e.ch+n)}function ea(t){t.setSelection(ce(t.firstLine(),0),ce(t.lastLine()),Y)}function na(t,e,n){var r={canceled:!1,from:e.from,to:e.to,text:e.text,origin:e.origin,cancel:function(){return r.canceled=!0}};return n&&(r.update=function(e,n,i,o){e&&(r.from=ve(t,e)),n&&(r.to=ve(t,n)),i&&(r.text=i),void 0!==o&&(r.origin=o)}),Ct(t,"beforeChange",t,r),t.cm&&Ct(t.cm,"beforeChange",t.cm,r),r.canceled?(t.cm&&(t.cm.curOp.updateInput=2),null):{from:r.from,to:r.to,text:r.text,origin:r.origin}}function ra(t,e,n){if(t.cm){if(!t.cm.curOp)return Ii(t.cm,ra)(t,e,n);if(t.cm.state.suppressEdits)return}if(!(_t(t,"beforeChange")||t.cm&&_t(t.cm,"beforeChange"))||(e=na(t,e,!0))){var r=Me&&!n&&Ke(t,e.from,e.to);if(r)for(var i=r.length-1;i>=0;--i)ia(t,{from:r[i].from,to:r[i].to,text:i?[""]:e.text,origin:e.origin});else ia(t,e)}}function ia(t,e){if(1!=e.text.length||""!=e.text[0]||0!=he(e.from,e.to)){var n=mo(t,e);Lo(t,e,n,t.cm?t.cm.curOp.id:NaN),sa(t,e,n,qe(t,e));var r=[];ko(t,(function(t,n){n||-1!=U(r,t.history)||(da(t.history,e),r.push(t.history)),sa(t,e,null,qe(t,e))}))}}function oa(t,e,n){var r=t.cm&&t.cm.state.suppressEdits;if(!r||n){for(var i,o=t.history,a=t.sel,s="undo"==e?o.done:o.undone,l="undo"==e?o.undone:o.done,u=0;u<s.length&&(i=s[u],n?!i.ranges||i.equals(t.sel):i.ranges);u++);if(u!=s.length){for(o.lastOrigin=o.lastSelOrigin=null;;){if(!(i=s.pop()).ranges){if(r)return void s.push(i);break}if(Mo(i,l),n&&!i.equals(t.sel))return void $o(t,i,{clearRedo:!1});a=i}var c=[];Mo(a,l),l.push({changes:c,generation:o.generation}),o.generation=i.generation||++o.maxGeneration;for(var h=_t(t,"beforeChange")||t.cm&&_t(t.cm,"beforeChange"),d=function(n){var r=i.changes[n];if(r.origin=e,h&&!na(t,r,!1))return s.length=0,{};c.push(To(t,r));var o=n?mo(t,r):tt(s);sa(t,r,o,Ro(t,r)),!n&&t.cm&&t.cm.scrollIntoView({from:r.from,to:po(r)});var a=[];ko(t,(function(t,e){e||-1!=U(a,t.history)||(da(t.history,r),a.push(t.history)),sa(t,r,null,Ro(t,r))}))},f=i.changes.length-1;f>=0;--f){var p=d(f);if(p)return p.v}}}}function aa(t,e){if(0!=e&&(t.first+=e,t.sel=new uo(et(t.sel.ranges,(function(t){return new co(ce(t.anchor.line+e,t.anchor.ch),ce(t.head.line+e,t.head.ch))})),t.sel.primIndex),t.cm)){Gr(t.cm,t.first,t.first-e,e);for(var n=t.cm.display,r=n.viewFrom;r<n.viewTo;r++)Wr(t.cm,r,"gutter")}}function sa(t,e,n,r){if(t.cm&&!t.cm.curOp)return Ii(t.cm,sa)(t,e,n,r);if(e.to.line<t.first)aa(t,e.text.length-1-(e.to.line-e.from.line));else if(!(e.from.line>t.lastLine())){if(e.from.line<t.first){var i=e.text.length-1-(t.first-e.from.line);aa(t,i),e={from:ce(t.first,0),to:ce(e.to.line+i,e.to.ch),text:[tt(e.text)],origin:e.origin}}var o=t.lastLine();e.to.line>o&&(e={from:e.from,to:ce(o,ne(t,o).text.length),text:[e.text[0]],origin:e.origin}),e.removed=re(t,e.from,e.to),n||(n=mo(t,e)),t.cm?la(t.cm,e,r):Co(t,e,r),Yo(t,n,Y),t.cantEdit&&Zo(t,ce(t.firstLine(),0))&&(t.cantEdit=!1)}}function la(t,e,n){var r=t.doc,i=t.display,o=e.from,a=e.to,s=!1,l=o.line;t.options.lineWrapping||(l=ae(rn(ne(r,o.line))),r.iter(l,a.line+1,(function(t){if(t==i.maxLine)return s=!0,!0}))),r.sel.contains(e.from,e.to)>-1&&St(t),Co(r,e,n,Rr(t)),t.options.lineWrapping||(r.iter(l,o.line+e.text.length,(function(t){var e=dn(t);e>i.maxLineLength&&(i.maxLine=t,i.maxLineLength=e,i.maxLineChanged=!0,s=!1)})),s&&(t.curOp.updateMaxLine=!0)),Oe(r,o.line),zi(t,400);var u=e.text.length-(a.line-o.line)-1;e.full?Gr(t):o.line!=a.line||1!=e.text.length||wo(t.doc,e)?Gr(t,o.line,a.line+1,u):Wr(t,o.line,"text");var c=_t(t,"changes"),h=_t(t,"change");if(h||c){var d={from:o,to:a,text:e.text,removed:e.removed,origin:e.origin};h&&Mn(t,"change",t,d),c&&(t.curOp.changeObjs||(t.curOp.changeObjs=[])).push(d)}t.display.selForContextMenu=null}function ua(t,e,n,r,i){var o;r||(r=n),he(r,n)<0&&(n=(o=[r,n])[0],r=o[1]),"string"==typeof e&&(e=t.splitLines(e)),ra(t,{from:n,to:r,text:e,origin:i})}function ca(t,e,n,r){n<t.line?t.line+=r:e<t.line&&(t.line=e,t.ch=0)}function ha(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i],a=!0;if(o.ranges){o.copied||((o=t[i]=o.deepCopy()).copied=!0);for(var s=0;s<o.ranges.length;s++)ca(o.ranges[s].anchor,e,n,r),ca(o.ranges[s].head,e,n,r)}else{for(var l=0;l<o.changes.length;++l){var u=o.changes[l];if(n<u.from.line)u.from=ce(u.from.line+r,u.from.ch),u.to=ce(u.to.line+r,u.to.ch);else if(e<=u.to.line){a=!1;break}}a||(t.splice(0,i+1),i=0)}}}function da(t,e){var n=e.from.line,r=e.to.line,i=e.text.length-(r-n)-1;ha(t.done,n,r,i),ha(t.undone,n,r,i)}function fa(t,e,n,r){var i=e,o=e;return"number"==typeof e?o=ne(t,me(t,e)):i=ae(e),null==i?null:(r(o,i)&&t.cm&&Wr(t.cm,i,n),o)}function pa(t){this.lines=t,this.parent=null;for(var e=0,n=0;n<t.length;++n)t[n].parent=this,e+=t[n].height;this.height=e}function ga(t){this.children=t;for(var e=0,n=0,r=0;r<t.length;++r){var i=t[r];e+=i.chunkSize(),n+=i.height,i.parent=this}this.size=e,this.height=n,this.parent=null}co.prototype.from=function(){return ge(this.anchor,this.head)},co.prototype.to=function(){return pe(this.anchor,this.head)},co.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},pa.prototype={chunkSize:function(){return this.lines.length},removeInner:function(t,e){for(var n=t,r=t+e;n<r;++n){var i=this.lines[n];this.height-=i.height,mn(i),Mn(i,"delete")}this.lines.splice(t,e)},collapse:function(t){t.push.apply(t,this.lines)},insertInner:function(t,e,n){this.height+=n,this.lines=this.lines.slice(0,t).concat(e).concat(this.lines.slice(t));for(var r=0;r<e.length;++r)e[r].parent=this},iterN:function(t,e,n){for(var r=t+e;t<r;++t)if(n(this.lines[t]))return!0}},ga.prototype={chunkSize:function(){return this.size},removeInner:function(t,e){this.size-=e;for(var n=0;n<this.children.length;++n){var r=this.children[n],i=r.chunkSize();if(t<i){var o=Math.min(e,i-t),a=r.height;if(r.removeInner(t,o),this.height-=a-r.height,i==o&&(this.children.splice(n--,1),r.parent=null),0==(e-=o))break;t=0}else t-=i}if(this.size-e<25&&(this.children.length>1||!(this.children[0]instanceof pa))){var s=[];this.collapse(s),this.children=[new pa(s)],this.children[0].parent=this}},collapse:function(t){for(var e=0;e<this.children.length;++e)this.children[e].collapse(t)},insertInner:function(t,e,n){this.size+=e.length,this.height+=n;for(var r=0;r<this.children.length;++r){var i=this.children[r],o=i.chunkSize();if(t<=o){if(i.insertInner(t,e,n),i.lines&&i.lines.length>50){for(var a=i.lines.length%25+25,s=a;s<i.lines.length;){var l=new pa(i.lines.slice(s,s+=25));i.height-=l.height,this.children.splice(++r,0,l),l.parent=this}i.lines=i.lines.slice(0,a),this.maybeSpill()}break}t-=o}},maybeSpill:function(){if(!(this.children.length<=10)){var t=this;do{var e=new ga(t.children.splice(t.children.length-5,5));if(t.parent){t.size-=e.size,t.height-=e.height;var n=U(t.parent.children,t);t.parent.children.splice(n+1,0,e)}else{var r=new ga(t.children);r.parent=t,t.children=[r,e],t=r}e.parent=t.parent}while(t.children.length>10);t.parent.maybeSpill()}},iterN:function(t,e,n){for(var r=0;r<this.children.length;++r){var i=this.children[r],o=i.chunkSize();if(t<o){var a=Math.min(e,o-t);if(i.iterN(t,a,n))return!0;if(0==(e-=a))break;t=0}else t-=o}}};var ma=function(t,e,n){if(n)for(var r in n)n.hasOwnProperty(r)&&(this[r]=n[r]);this.doc=t,this.node=e};function va(t,e,n){hn(e)<(t.curOp&&t.curOp.scrollTop||t.doc.scrollTop)&&hi(t,n)}function ya(t,e,n,r){var i=new ma(t,n,r),o=t.cm;return o&&i.noHScroll&&(o.display.alignWidgets=!0),fa(t,e,"widget",(function(e){var n=e.widgets||(e.widgets=[]);if(null==i.insertAt?n.push(i):n.splice(Math.min(n.length,Math.max(0,i.insertAt)),0,i),i.line=e,o&&!un(t,e)){var r=hn(e)<t.scrollTop;oe(e,e.height+Yn(i)),r&&hi(o,i.height),o.curOp.forceUpdate=!0}return!0})),o&&Mn(o,"lineWidgetAdded",o,i,"number"==typeof e?e:ae(e)),i}ma.prototype.clear=function(){var t=this.doc.cm,e=this.line.widgets,n=this.line,r=ae(n);if(null!=r&&e){for(var i=0;i<e.length;++i)e[i]==this&&e.splice(i--,1);e.length||(n.widgets=null);var o=Yn(this);oe(n,Math.max(0,n.height-o)),t&&(Ni(t,(function(){va(t,n,-o),Wr(t,r,"widget")})),Mn(t,"lineWidgetCleared",t,this,r))}},ma.prototype.changed=function(){var t=this,e=this.height,n=this.doc.cm,r=this.line;this.height=null;var i=Yn(this)-e;i&&(un(this.doc,r)||oe(r,r.height+i),n&&Ni(n,(function(){n.curOp.forceUpdate=!0,va(n,r,i),Mn(n,"lineWidgetChanged",n,t,ae(r))})))},Dt(ma);var ba=0,xa=function(t,e){this.lines=[],this.type=e,this.doc=t,this.id=++ba};function wa(t,e,n,r,i){if(r&&r.shared)return ka(t,e,n,r,i);if(t.cm&&!t.cm.curOp)return Ii(t.cm,wa)(t,e,n,r,i);var o=new xa(t,i),a=he(e,n);if(r&&G(r,o,!1),a>0||0==a&&!1!==o.clearWhenEmpty)return o;if(o.replacedWith&&(o.collapsed=!0,o.widgetNode=L("span",[o.replacedWith],"CodeMirror-widget"),r.handleMouseEvents||o.widgetNode.setAttribute("cm-ignore-events","true"),r.insertLeft&&(o.widgetNode.insertLeft=!0)),o.collapsed){if(nn(t,e.line,e,n,o)||e.line!=n.line&&nn(t,n.line,e,n,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");Ie()}o.addToHistory&&Lo(t,{from:e,to:n,origin:"markText"},t.sel,NaN);var s,l=e.line,u=t.cm;if(t.iter(l,n.line+1,(function(r){u&&o.collapsed&&!u.options.lineWrapping&&rn(r)==u.display.maxLine&&(s=!0),o.collapsed&&l!=e.line&&oe(r,0),He(r,new Re(o,l==e.line?e.ch:null,l==n.line?n.ch:null),t.cm&&t.cm.curOp),++l})),o.collapsed&&t.iter(e.line,n.line+1,(function(e){un(t,e)&&oe(e,0)})),o.clearOnEnter&&bt(o,"beforeCursorEnter",(function(){return o.clear()})),o.readOnly&&(Ne(),(t.history.done.length||t.history.undone.length)&&t.clearHistory()),o.collapsed&&(o.id=++ba,o.atomic=!0),u){if(s&&(u.curOp.updateMaxLine=!0),o.collapsed)Gr(u,e.line,n.line+1);else if(o.className||o.startStyle||o.endStyle||o.css||o.attributes||o.title)for(var c=e.line;c<=n.line;c++)Wr(u,c,"text");o.atomic&&Xo(u.doc),Mn(u,"markerAdded",u,o)}return o}xa.prototype.clear=function(){if(!this.explicitlyCleared){var t=this.doc.cm,e=t&&!t.curOp;if(e&&Ti(t),_t(this,"clear")){var n=this.find();n&&Mn(this,"clear",n.from,n.to)}for(var r=null,i=null,o=0;o<this.lines.length;++o){var a=this.lines[o],s=je(a.markedSpans,this);t&&!this.collapsed?Wr(t,ae(a),"text"):t&&(null!=s.to&&(i=ae(a)),null!=s.from&&(r=ae(a))),a.markedSpans=ze(a.markedSpans,s),null==s.from&&this.collapsed&&!un(this.doc,a)&&t&&oe(a,Mr(t.display))}if(t&&this.collapsed&&!t.options.lineWrapping)for(var l=0;l<this.lines.length;++l){var u=rn(this.lines[l]),c=dn(u);c>t.display.maxLineLength&&(t.display.maxLine=u,t.display.maxLineLength=c,t.display.maxLineChanged=!0)}null!=r&&t&&this.collapsed&&Gr(t,r,i+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,t&&Xo(t.doc)),t&&Mn(t,"markerCleared",t,this,r,i),e&&Ei(t),this.parent&&this.parent.clear()}},xa.prototype.find=function(t,e){var n,r;null==t&&"bookmark"==this.type&&(t=1);for(var i=0;i<this.lines.length;++i){var o=this.lines[i],a=je(o.markedSpans,this);if(null!=a.from&&(n=ce(e?o:ae(o),a.from),-1==t))return n;if(null!=a.to&&(r=ce(e?o:ae(o),a.to),1==t))return r}return n&&{from:n,to:r}},xa.prototype.changed=function(){var t=this,e=this.find(-1,!0),n=this,r=this.doc.cm;e&&r&&Ni(r,(function(){var i=e.line,o=ae(e.line),a=ar(r,o);if(a&&(gr(a),r.curOp.selectionChanged=r.curOp.forceUpdate=!0),r.curOp.updateMaxLine=!0,!un(n.doc,i)&&null!=n.height){var s=n.height;n.height=null;var l=Yn(n)-s;l&&oe(i,i.height+l)}Mn(r,"markerChanged",r,t)}))},xa.prototype.attachLine=function(t){if(!this.lines.length&&this.doc.cm){var e=this.doc.cm.curOp;e.maybeHiddenMarkers&&-1!=U(e.maybeHiddenMarkers,this)||(e.maybeUnhiddenMarkers||(e.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(t)},xa.prototype.detachLine=function(t){if(this.lines.splice(U(this.lines,t),1),!this.lines.length&&this.doc.cm){var e=this.doc.cm.curOp;(e.maybeHiddenMarkers||(e.maybeHiddenMarkers=[])).push(this)}},Dt(xa);var Ca=function(t,e){this.markers=t,this.primary=e;for(var n=0;n<t.length;++n)t[n].parent=this};function ka(t,e,n,r,i){(r=G(r)).shared=!1;var o=[wa(t,e,n,r,i)],a=o[0],s=r.widgetNode;return ko(t,(function(t){s&&(r.widgetNode=s.cloneNode(!0)),o.push(wa(t,ve(t,e),ve(t,n),r,i));for(var l=0;l<t.linked.length;++l)if(t.linked[l].isParent)return;a=tt(o)})),new Ca(o,a)}function Sa(t){return t.findMarks(ce(t.first,0),t.clipPos(ce(t.lastLine())),(function(t){return t.parent}))}function _a(t,e){for(var n=0;n<e.length;n++){var r=e[n],i=r.find(),o=t.clipPos(i.from),a=t.clipPos(i.to);if(he(o,a)){var s=wa(t,o,a,r.primary,r.primary.type);r.markers.push(s),s.parent=r}}}function Da(t){for(var e=function(e){var n=t[e],r=[n.primary.doc];ko(n.primary.doc,(function(t){return r.push(t)}));for(var i=0;i<n.markers.length;i++){var o=n.markers[i];-1==U(r,o.doc)&&(o.parent=null,n.markers.splice(i--,1))}},n=0;n<t.length;n++)e(n)}Ca.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var t=0;t<this.markers.length;++t)this.markers[t].clear();Mn(this,"clear")}},Ca.prototype.find=function(t,e){return this.primary.find(t,e)},Dt(Ca);var Aa=0,Ta=function(t,e,n,r,i){if(!(this instanceof Ta))return new Ta(t,e,n,r,i);null==n&&(n=0),ga.call(this,[new pa([new pn("",null)])]),this.first=n,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=n;var o=ce(n,0);this.sel=fo(o),this.history=new Ao(null),this.id=++Aa,this.modeOption=e,this.lineSep=r,this.direction="rtl"==i?"rtl":"ltr",this.extend=!1,"string"==typeof t&&(t=this.splitLines(t)),Co(this,{from:o,to:o,text:t}),$o(this,fo(o),Y)};Ta.prototype=it(ga.prototype,{constructor:Ta,iter:function(t,e,n){n?this.iterN(t-this.first,e-t,n):this.iterN(this.first,this.first+this.size,t)},insert:function(t,e){for(var n=0,r=0;r<e.length;++r)n+=e[r].height;this.insertInner(t-this.first,e,n)},remove:function(t,e){this.removeInner(t-this.first,e)},getValue:function(t){var e=ie(this,this.first,this.first+this.size);return!1===t?e:e.join(t||this.lineSeparator())},setValue:ji((function(t){var e=ce(this.first,0),n=this.first+this.size-1;ra(this,{from:e,to:ce(n,ne(this,n).text.length),text:this.splitLines(t),origin:"setValue",full:!0},!0),this.cm&&fi(this.cm,0,0),$o(this,fo(e),Y)})),replaceRange:function(t,e,n,r){ua(this,t,e=ve(this,e),n=n?ve(this,n):e,r)},getRange:function(t,e,n){var r=re(this,ve(this,t),ve(this,e));return!1===n?r:""===n?r.join(""):r.join(n||this.lineSeparator())},getLine:function(t){var e=this.getLineHandle(t);return e&&e.text},getLineHandle:function(t){if(le(this,t))return ne(this,t)},getLineNumber:function(t){return ae(t)},getLineHandleVisualStart:function(t){return"number"==typeof t&&(t=ne(this,t)),rn(t)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(t){return ve(this,t)},getCursor:function(t){var e=this.sel.primary();return null==t||"head"==t?e.head:"anchor"==t?e.anchor:"end"==t||"to"==t||!1===t?e.to():e.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:ji((function(t,e,n){qo(this,ve(this,"number"==typeof t?ce(t,e||0):t),null,n)})),setSelection:ji((function(t,e,n){qo(this,ve(this,t),ve(this,e||t),n)})),extendSelection:ji((function(t,e,n){Ho(this,ve(this,t),e&&ve(this,e),n)})),extendSelections:ji((function(t,e){Go(this,be(this,t),e)})),extendSelectionsBy:ji((function(t,e){Go(this,be(this,et(this.sel.ranges,t)),e)})),setSelections:ji((function(t,e,n){if(t.length){for(var r=[],i=0;i<t.length;i++)r[i]=new co(ve(this,t[i].anchor),ve(this,t[i].head||t[i].anchor));null==e&&(e=Math.min(t.length-1,this.sel.primIndex)),$o(this,ho(this.cm,r,e),n)}})),addSelection:ji((function(t,e,n){var r=this.sel.ranges.slice(0);r.push(new co(ve(this,t),ve(this,e||t))),$o(this,ho(this.cm,r,r.length-1),n)})),getSelection:function(t){for(var e,n=this.sel.ranges,r=0;r<n.length;r++){var i=re(this,n[r].from(),n[r].to());e=e?e.concat(i):i}return!1===t?e:e.join(t||this.lineSeparator())},getSelections:function(t){for(var e=[],n=this.sel.ranges,r=0;r<n.length;r++){var i=re(this,n[r].from(),n[r].to());!1!==t&&(i=i.join(t||this.lineSeparator())),e[r]=i}return e},replaceSelection:function(t,e,n){for(var r=[],i=0;i<this.sel.ranges.length;i++)r[i]=t;this.replaceSelections(r,e,n||"+input")},replaceSelections:ji((function(t,e,n){for(var r=[],i=this.sel,o=0;o<i.ranges.length;o++){var a=i.ranges[o];r[o]={from:a.from(),to:a.to(),text:this.splitLines(t[o]),origin:n}}for(var s=e&&"end"!=e&&yo(this,r,e),l=r.length-1;l>=0;l--)ra(this,r[l]);s?Ko(this,s):this.cm&&di(this.cm)})),undo:ji((function(){oa(this,"undo")})),redo:ji((function(){oa(this,"redo")})),undoSelection:ji((function(){oa(this,"undo",!0)})),redoSelection:ji((function(){oa(this,"redo",!0)})),setExtending:function(t){this.extend=t},getExtending:function(){return this.extend},historySize:function(){for(var t=this.history,e=0,n=0,r=0;r<t.done.length;r++)t.done[r].ranges||++e;for(var i=0;i<t.undone.length;i++)t.undone[i].ranges||++n;return{undo:e,redo:n}},clearHistory:function(){var t=this;this.history=new Ao(this.history),ko(this,(function(e){return e.history=t.history}),!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(t){return t&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(t){return this.history.generation==(t||this.cleanGeneration)},getHistory:function(){return{done:jo(this.history.done),undone:jo(this.history.undone)}},setHistory:function(t){var e=this.history=new Ao(this.history);e.done=jo(t.done.slice(0),null,!0),e.undone=jo(t.undone.slice(0),null,!0)},setGutterMarker:ji((function(t,e,n){return fa(this,t,"gutter",(function(t){var r=t.gutterMarkers||(t.gutterMarkers={});return r[e]=n,!n&&lt(r)&&(t.gutterMarkers=null),!0}))})),clearGutter:ji((function(t){var e=this;this.iter((function(n){n.gutterMarkers&&n.gutterMarkers[t]&&fa(e,n,"gutter",(function(){return n.gutterMarkers[t]=null,lt(n.gutterMarkers)&&(n.gutterMarkers=null),!0}))}))})),lineInfo:function(t){var e;if("number"==typeof t){if(!le(this,t))return null;if(e=t,!(t=ne(this,t)))return null}else if(null==(e=ae(t)))return null;return{line:e,handle:t,text:t.text,gutterMarkers:t.gutterMarkers,textClass:t.textClass,bgClass:t.bgClass,wrapClass:t.wrapClass,widgets:t.widgets}},addLineClass:ji((function(t,e,n){return fa(this,t,"gutter"==e?"gutter":"class",(function(t){var r="text"==e?"textClass":"background"==e?"bgClass":"gutter"==e?"gutterClass":"wrapClass";if(t[r]){if(_(n).test(t[r]))return!1;t[r]+=" "+n}else t[r]=n;return!0}))})),removeLineClass:ji((function(t,e,n){return fa(this,t,"gutter"==e?"gutter":"class",(function(t){var r="text"==e?"textClass":"background"==e?"bgClass":"gutter"==e?"gutterClass":"wrapClass",i=t[r];if(!i)return!1;if(null==n)t[r]=null;else{var o=i.match(_(n));if(!o)return!1;var a=o.index+o[0].length;t[r]=i.slice(0,o.index)+(o.index&&a!=i.length?" ":"")+i.slice(a)||null}return!0}))})),addLineWidget:ji((function(t,e,n){return ya(this,t,e,n)})),removeLineWidget:function(t){t.clear()},markText:function(t,e,n){return wa(this,ve(this,t),ve(this,e),n,n&&n.type||"range")},setBookmark:function(t,e){var n={replacedWith:e&&(null==e.nodeType?e.widget:e),insertLeft:e&&e.insertLeft,clearWhenEmpty:!1,shared:e&&e.shared,handleMouseEvents:e&&e.handleMouseEvents};return wa(this,t=ve(this,t),t,n,"bookmark")},findMarksAt:function(t){var e=[],n=ne(this,(t=ve(this,t)).line).markedSpans;if(n)for(var r=0;r<n.length;++r){var i=n[r];(null==i.from||i.from<=t.ch)&&(null==i.to||i.to>=t.ch)&&e.push(i.marker.parent||i.marker)}return e},findMarks:function(t,e,n){t=ve(this,t),e=ve(this,e);var r=[],i=t.line;return this.iter(t.line,e.line+1,(function(o){var a=o.markedSpans;if(a)for(var s=0;s<a.length;s++){var l=a[s];null!=l.to&&i==t.line&&t.ch>=l.to||null==l.from&&i!=t.line||null!=l.from&&i==e.line&&l.from>=e.ch||n&&!n(l.marker)||r.push(l.marker.parent||l.marker)}++i})),r},getAllMarks:function(){var t=[];return this.iter((function(e){var n=e.markedSpans;if(n)for(var r=0;r<n.length;++r)null!=n[r].from&&t.push(n[r].marker)})),t},posFromIndex:function(t){var e,n=this.first,r=this.lineSeparator().length;return this.iter((function(i){var o=i.text.length+r;if(o>t)return e=t,!0;t-=o,++n})),ve(this,ce(n,e))},indexFromPos:function(t){var e=(t=ve(this,t)).ch;if(t.line<this.first||t.ch<0)return 0;var n=this.lineSeparator().length;return this.iter(this.first,t.line,(function(t){e+=t.text.length+n})),e},copy:function(t){var e=new Ta(ie(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return e.scrollTop=this.scrollTop,e.scrollLeft=this.scrollLeft,e.sel=this.sel,e.extend=!1,t&&(e.history.undoDepth=this.history.undoDepth,e.setHistory(this.getHistory())),e},linkedDoc:function(t){t||(t={});var e=this.first,n=this.first+this.size;null!=t.from&&t.from>e&&(e=t.from),null!=t.to&&t.to<n&&(n=t.to);var r=new Ta(ie(this,e,n),t.mode||this.modeOption,e,this.lineSep,this.direction);return t.sharedHist&&(r.history=this.history),(this.linked||(this.linked=[])).push({doc:r,sharedHist:t.sharedHist}),r.linked=[{doc:this,isParent:!0,sharedHist:t.sharedHist}],_a(r,Sa(this)),r},unlinkDoc:function(t){if(t instanceof Gs&&(t=t.doc),this.linked)for(var e=0;e<this.linked.length;++e)if(this.linked[e].doc==t){this.linked.splice(e,1),t.unlinkDoc(this),Da(Sa(this));break}if(t.history==this.history){var n=[t.id];ko(t,(function(t){return n.push(t.id)}),!0),t.history=new Ao(null),t.history.done=jo(this.history.done,n),t.history.undone=jo(this.history.undone,n)}},iterLinkedDocs:function(t){ko(this,t)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(t){return this.lineSep?t.split(this.lineSep):jt(t)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:ji((function(t){"rtl"!=t&&(t="ltr"),t!=this.direction&&(this.direction=t,this.iter((function(t){return t.order=null})),this.cm&&Do(this.cm))}))}),Ta.prototype.eachLine=Ta.prototype.iter;var Ea=0;function Fa(t){var e=this;if(Oa(e),!kt(e,t)&&!Vn(e.display,t)){At(t),a&&(Ea=+new Date);var n=zr(e,t,!0),r=t.dataTransfer.files;if(n&&!e.isReadOnly())if(r&&r.length&&window.FileReader&&window.File)for(var i=r.length,o=Array(i),s=0,l=function(){++s==i&&Ii(e,(function(){var t={from:n=ve(e.doc,n),to:n,text:e.doc.splitLines(o.filter((function(t){return null!=t})).join(e.doc.lineSeparator())),origin:"paste"};ra(e.doc,t),Ko(e.doc,fo(ve(e.doc,n),ve(e.doc,po(t))))}))()},u=function(t,n){if(e.options.allowDropFileTypes&&-1==U(e.options.allowDropFileTypes,t.type))l();else{var r=new FileReader;r.onerror=function(){return l()},r.onload=function(){var t=r.result;/[\x00-\x08\x0e-\x1f]{2}/.test(t)||(o[n]=t),l()},r.readAsText(t)}},c=0;c<r.length;c++)u(r[c],c);else{if(e.state.draggingText&&e.doc.sel.contains(n)>-1)return e.state.draggingText(t),void setTimeout((function(){return e.display.input.focus()}),20);try{var h=t.dataTransfer.getData("Text");if(h){var d;if(e.state.draggingText&&!e.state.draggingText.copy&&(d=e.listSelections()),Yo(e.doc,fo(n,n)),d)for(var f=0;f<d.length;++f)ua(e.doc,"",d[f].anchor,d[f].head,"drag");e.replaceSelection(h,"around","paste"),e.display.input.focus()}}catch(t){}}}}function La(t,e){if(a&&(!t.state.draggingText||+new Date-Ea<100))Ft(e);else if(!kt(t,e)&&!Vn(t.display,e)&&(e.dataTransfer.setData("Text",t.getSelection()),e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setDragImage&&!f)){var n=F("img",null,null,"position: fixed; left: 0; top: 0;");n.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",d&&(n.width=n.height=1,t.display.wrapper.appendChild(n),n._top=n.offsetTop),e.dataTransfer.setDragImage(n,0,0),d&&n.parentNode.removeChild(n)}}function Pa(t,e){var n=zr(t,e);if(n){var r=document.createDocumentFragment();Xr(t,n,r),t.display.dragCursor||(t.display.dragCursor=F("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),t.display.lineSpace.insertBefore(t.display.dragCursor,t.display.cursorDiv)),E(t.display.dragCursor,r)}}function Oa(t){t.display.dragCursor&&(t.display.lineSpace.removeChild(t.display.dragCursor),t.display.dragCursor=null)}function Ma(t){if(document.getElementsByClassName){for(var e=document.getElementsByClassName("CodeMirror"),n=[],r=0;r<e.length;r++){var i=e[r].CodeMirror;i&&n.push(i)}n.length&&n[0].operation((function(){for(var e=0;e<n.length;e++)t(n[e])}))}}var Ba=!1;function Na(){Ba||(Ia(),Ba=!0)}function Ia(){var t;bt(window,"resize",(function(){null==t&&(t=setTimeout((function(){t=null,Ma(Ra)}),100))})),bt(window,"blur",(function(){return Ma(ri)}))}function Ra(t){var e=t.display;e.cachedCharWidth=e.cachedTextHeight=e.cachedPaddingH=null,e.scrollbarsClipped=!1,t.setSize()}for(var ja={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},za=0;za<10;za++)ja[za+48]=ja[za+96]=String(za);for(var Ha=65;Ha<=90;Ha++)ja[Ha]=String.fromCharCode(Ha);for(var Ga=1;Ga<=12;Ga++)ja[Ga+111]=ja[Ga+63235]="F"+Ga;var Wa={};function qa(t){var e,n,r,i,o=t.split(/-(?!$)/);t=o[o.length-1];for(var a=0;a<o.length-1;a++){var s=o[a];if(/^(cmd|meta|m)$/i.test(s))i=!0;else if(/^a(lt)?$/i.test(s))e=!0;else if(/^(c|ctrl|control)$/i.test(s))n=!0;else{if(!/^s(hift)?$/i.test(s))throw new Error("Unrecognized modifier name: "+s);r=!0}}return e&&(t="Alt-"+t),n&&(t="Ctrl-"+t),i&&(t="Cmd-"+t),r&&(t="Shift-"+t),t}function Ua(t){var e={};for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if(/^(name|fallthrough|(de|at)tach)$/.test(n))continue;if("..."==r){delete t[n];continue}for(var i=et(n.split(" "),qa),o=0;o<i.length;o++){var a=void 0,s=void 0;o==i.length-1?(s=i.join(" "),a=r):(s=i.slice(0,o+1).join(" "),a="...");var l=e[s];if(l){if(l!=a)throw new Error("Inconsistent bindings for "+s)}else e[s]=a}delete t[n]}for(var u in e)t[u]=e[u];return t}function Ka(t,e,n,r){var i=(e=Xa(e)).call?e.call(t,r):e[t];if(!1===i)return"nothing";if("..."===i)return"multi";if(null!=i&&n(i))return"handled";if(e.fallthrough){if("[object Array]"!=Object.prototype.toString.call(e.fallthrough))return Ka(t,e.fallthrough,n,r);for(var o=0;o<e.fallthrough.length;o++){var a=Ka(t,e.fallthrough[o],n,r);if(a)return a}}}function $a(t){var e="string"==typeof t?t:ja[t.keyCode];return"Ctrl"==e||"Alt"==e||"Shift"==e||"Mod"==e}function Ya(t,e,n){var r=t;return e.altKey&&"Alt"!=r&&(t="Alt-"+t),(k?e.metaKey:e.ctrlKey)&&"Ctrl"!=r&&(t="Ctrl-"+t),(k?e.ctrlKey:e.metaKey)&&"Mod"!=r&&(t="Cmd-"+t),!n&&e.shiftKey&&"Shift"!=r&&(t="Shift-"+t),t}function Va(t,e){if(d&&34==t.keyCode&&t.char)return!1;var n=ja[t.keyCode];return null!=n&&!t.altGraphKey&&(3==t.keyCode&&t.code&&(n=t.code),Ya(n,t,e))}function Xa(t){return"string"==typeof t?Wa[t]:t}function Ja(t,e){for(var n=t.doc.sel.ranges,r=[],i=0;i<n.length;i++){for(var o=e(n[i]);r.length&&he(o.from,tt(r).to)<=0;){var a=r.pop();if(he(a.from,o.from)<0){o.from=a.from;break}}r.push(o)}Ni(t,(function(){for(var e=r.length-1;e>=0;e--)ua(t.doc,"",r[e].from,r[e].to,"+delete");di(t)}))}function Qa(t,e,n){var r=ht(t.text,e+n,n);return r<0||r>t.text.length?null:r}function Za(t,e,n){var r=Qa(t,e.ch,n);return null==r?null:new ce(e.line,r,n<0?"after":"before")}function ts(t,e,n,r,i){if(t){"rtl"==e.doc.direction&&(i=-i);var o=vt(n,e.doc.direction);if(o){var a,s=i<0?tt(o):o[0],l=i<0==(1==s.level)?"after":"before";if(s.level>0||"rtl"==e.doc.direction){var u=sr(e,n);a=i<0?n.text.length-1:0;var c=lr(e,u,a).top;a=dt((function(t){return lr(e,u,t).top==c}),i<0==(1==s.level)?s.from:s.to-1,a),"before"==l&&(a=Qa(n,a,1))}else a=i<0?s.to:s.from;return new ce(r,a,l)}}return new ce(r,i<0?n.text.length:0,i<0?"before":"after")}function es(t,e,n,r){var i=vt(e,t.doc.direction);if(!i)return Za(e,n,r);n.ch>=e.text.length?(n.ch=e.text.length,n.sticky="before"):n.ch<=0&&(n.ch=0,n.sticky="after");var o=gt(i,n.ch,n.sticky),a=i[o];if("ltr"==t.doc.direction&&a.level%2==0&&(r>0?a.to>n.ch:a.from<n.ch))return Za(e,n,r);var s,l=function(t,n){return Qa(e,t instanceof ce?t.ch:t,n)},u=function(n){return t.options.lineWrapping?(s=s||sr(t,e),Er(t,e,s,n)):{begin:0,end:e.text.length}},c=u("before"==n.sticky?l(n,-1):n.ch);if("rtl"==t.doc.direction||1==a.level){var h=1==a.level==r<0,d=l(n,h?1:-1);if(null!=d&&(h?d<=a.to&&d<=c.end:d>=a.from&&d>=c.begin)){var f=h?"before":"after";return new ce(n.line,d,f)}}var p=function(t,e,r){for(var o=function(t,e){return e?new ce(n.line,l(t,1),"before"):new ce(n.line,t,"after")};t>=0&&t<i.length;t+=e){var a=i[t],s=e>0==(1!=a.level),u=s?r.begin:l(r.end,-1);if(a.from<=u&&u<a.to)return o(u,s);if(u=s?a.from:l(a.to,-1),r.begin<=u&&u<r.end)return o(u,s)}},g=p(o+r,r,c);if(g)return g;var m=r>0?c.end:l(c.begin,-1);return null==m||r>0&&m==e.text.length||!(g=p(r>0?0:i.length-1,r,u(m)))?null:g}Wa.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Wa.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Wa.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Wa.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Wa.default=b?Wa.macDefault:Wa.pcDefault;var ns={selectAll:ea,singleSelection:function(t){return t.setSelection(t.getCursor("anchor"),t.getCursor("head"),Y)},killLine:function(t){return Ja(t,(function(e){if(e.empty()){var n=ne(t.doc,e.head.line).text.length;return e.head.ch==n&&e.head.line<t.lastLine()?{from:e.head,to:ce(e.head.line+1,0)}:{from:e.head,to:ce(e.head.line,n)}}return{from:e.from(),to:e.to()}}))},deleteLine:function(t){return Ja(t,(function(e){return{from:ce(e.from().line,0),to:ve(t.doc,ce(e.to().line+1,0))}}))},delLineLeft:function(t){return Ja(t,(function(t){return{from:ce(t.from().line,0),to:t.from()}}))},delWrappedLineLeft:function(t){return Ja(t,(function(e){var n=t.charCoords(e.head,"div").top+5;return{from:t.coordsChar({left:0,top:n},"div"),to:e.from()}}))},delWrappedLineRight:function(t){return Ja(t,(function(e){var n=t.charCoords(e.head,"div").top+5,r=t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:n},"div");return{from:e.from(),to:r}}))},undo:function(t){return t.undo()},redo:function(t){return t.redo()},undoSelection:function(t){return t.undoSelection()},redoSelection:function(t){return t.redoSelection()},goDocStart:function(t){return t.extendSelection(ce(t.firstLine(),0))},goDocEnd:function(t){return t.extendSelection(ce(t.lastLine()))},goLineStart:function(t){return t.extendSelectionsBy((function(e){return rs(t,e.head.line)}),{origin:"+move",bias:1})},goLineStartSmart:function(t){return t.extendSelectionsBy((function(e){return os(t,e.head)}),{origin:"+move",bias:1})},goLineEnd:function(t){return t.extendSelectionsBy((function(e){return is(t,e.head.line)}),{origin:"+move",bias:-1})},goLineRight:function(t){return t.extendSelectionsBy((function(e){var n=t.cursorCoords(e.head,"div").top+5;return t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:n},"div")}),X)},goLineLeft:function(t){return t.extendSelectionsBy((function(e){var n=t.cursorCoords(e.head,"div").top+5;return t.coordsChar({left:0,top:n},"div")}),X)},goLineLeftSmart:function(t){return t.extendSelectionsBy((function(e){var n=t.cursorCoords(e.head,"div").top+5,r=t.coordsChar({left:0,top:n},"div");return r.ch<t.getLine(r.line).search(/\S/)?os(t,e.head):r}),X)},goLineUp:function(t){return t.moveV(-1,"line")},goLineDown:function(t){return t.moveV(1,"line")},goPageUp:function(t){return t.moveV(-1,"page")},goPageDown:function(t){return t.moveV(1,"page")},goCharLeft:function(t){return t.moveH(-1,"char")},goCharRight:function(t){return t.moveH(1,"char")},goColumnLeft:function(t){return t.moveH(-1,"column")},goColumnRight:function(t){return t.moveH(1,"column")},goWordLeft:function(t){return t.moveH(-1,"word")},goGroupRight:function(t){return t.moveH(1,"group")},goGroupLeft:function(t){return t.moveH(-1,"group")},goWordRight:function(t){return t.moveH(1,"word")},delCharBefore:function(t){return t.deleteH(-1,"codepoint")},delCharAfter:function(t){return t.deleteH(1,"char")},delWordBefore:function(t){return t.deleteH(-1,"word")},delWordAfter:function(t){return t.deleteH(1,"word")},delGroupBefore:function(t){return t.deleteH(-1,"group")},delGroupAfter:function(t){return t.deleteH(1,"group")},indentAuto:function(t){return t.indentSelection("smart")},indentMore:function(t){return t.indentSelection("add")},indentLess:function(t){return t.indentSelection("subtract")},insertTab:function(t){return t.replaceSelection("\t")},insertSoftTab:function(t){for(var e=[],n=t.listSelections(),r=t.options.tabSize,i=0;i<n.length;i++){var o=n[i].from(),a=W(t.getLine(o.line),o.ch,r);e.push(Z(r-a%r))}t.replaceSelections(e)},defaultTab:function(t){t.somethingSelected()?t.indentSelection("add"):t.execCommand("insertTab")},transposeChars:function(t){return Ni(t,(function(){for(var e=t.listSelections(),n=[],r=0;r<e.length;r++)if(e[r].empty()){var i=e[r].head,o=ne(t.doc,i.line).text;if(o)if(i.ch==o.length&&(i=new ce(i.line,i.ch-1)),i.ch>0)i=new ce(i.line,i.ch+1),t.replaceRange(o.charAt(i.ch-1)+o.charAt(i.ch-2),ce(i.line,i.ch-2),i,"+transpose");else if(i.line>t.doc.first){var a=ne(t.doc,i.line-1).text;a&&(i=new ce(i.line,1),t.replaceRange(o.charAt(0)+t.doc.lineSeparator()+a.charAt(a.length-1),ce(i.line-1,a.length-1),i,"+transpose"))}n.push(new co(i,i))}t.setSelections(n)}))},newlineAndIndent:function(t){return Ni(t,(function(){for(var e=t.listSelections(),n=e.length-1;n>=0;n--)t.replaceRange(t.doc.lineSeparator(),e[n].anchor,e[n].head,"+input");e=t.listSelections();for(var r=0;r<e.length;r++)t.indentLine(e[r].from().line,null,!0);di(t)}))},openLine:function(t){return t.replaceSelection("\n","start")},toggleOverwrite:function(t){return t.toggleOverwrite()}};function rs(t,e){var n=ne(t.doc,e),r=rn(n);return r!=n&&(e=ae(r)),ts(!0,t,r,e,1)}function is(t,e){var n=ne(t.doc,e),r=on(n);return r!=n&&(e=ae(r)),ts(!0,t,n,e,-1)}function os(t,e){var n=rs(t,e.line),r=ne(t.doc,n.line),i=vt(r,t.doc.direction);if(!i||0==i[0].level){var o=Math.max(n.ch,r.text.search(/\S/)),a=e.line==n.line&&e.ch<=o&&e.ch;return ce(n.line,a?0:o,n.sticky)}return n}function as(t,e,n){if("string"==typeof e&&!(e=ns[e]))return!1;t.display.input.ensurePolled();var r=t.display.shift,i=!1;try{t.isReadOnly()&&(t.state.suppressEdits=!0),n&&(t.display.shift=!1),i=e(t)!=$}finally{t.display.shift=r,t.state.suppressEdits=!1}return i}function ss(t,e,n){for(var r=0;r<t.state.keyMaps.length;r++){var i=Ka(e,t.state.keyMaps[r],n,t);if(i)return i}return t.options.extraKeys&&Ka(e,t.options.extraKeys,n,t)||Ka(e,t.options.keyMap,n,t)}var ls=new q;function us(t,e,n,r){var i=t.state.keySeq;if(i){if($a(e))return"handled";if(/\'$/.test(e)?t.state.keySeq=null:ls.set(50,(function(){t.state.keySeq==i&&(t.state.keySeq=null,t.display.input.reset())})),cs(t,i+" "+e,n,r))return!0}return cs(t,e,n,r)}function cs(t,e,n,r){var i=ss(t,e,r);return"multi"==i&&(t.state.keySeq=e),"handled"==i&&Mn(t,"keyHandled",t,e,n),"handled"!=i&&"multi"!=i||(At(n),Zr(t)),!!i}function hs(t,e){var n=Va(e,!0);return!!n&&(e.shiftKey&&!t.state.keySeq?us(t,"Shift-"+n,e,(function(e){return as(t,e,!0)}))||us(t,n,e,(function(e){if("string"==typeof e?/^go[A-Z]/.test(e):e.motion)return as(t,e)})):us(t,n,e,(function(e){return as(t,e)})))}function ds(t,e,n){return us(t,"'"+n+"'",e,(function(e){return as(t,e,!0)}))}var fs=null;function ps(t){var e=this;if(!(t.target&&t.target!=e.display.input.getField()||(e.curOp.focus=O(R(e)),kt(e,t)))){a&&s<11&&27==t.keyCode&&(t.returnValue=!1);var r=t.keyCode;e.display.shift=16==r||t.shiftKey;var i=hs(e,t);d&&(fs=i?r:null,i||88!=r||Ht||!(b?t.metaKey:t.ctrlKey)||e.replaceSelection("",null,"cut")),n&&!b&&!i&&46==r&&t.shiftKey&&!t.ctrlKey&&document.execCommand&&document.execCommand("cut"),18!=r||/\bCodeMirror-crosshair\b/.test(e.display.lineDiv.className)||gs(e)}}function gs(t){var e=t.display.lineDiv;function n(t){18!=t.keyCode&&t.altKey||(A(e,"CodeMirror-crosshair"),wt(document,"keyup",n),wt(document,"mouseover",n))}M(e,"CodeMirror-crosshair"),bt(document,"keyup",n),bt(document,"mouseover",n)}function ms(t){16==t.keyCode&&(this.doc.sel.shift=!1),kt(this,t)}function vs(t){var e=this;if(!(t.target&&t.target!=e.display.input.getField()||Vn(e.display,t)||kt(e,t)||t.ctrlKey&&!t.altKey||b&&t.metaKey)){var n=t.keyCode,r=t.charCode;if(d&&n==fs)return fs=null,void At(t);if(!d||t.which&&!(t.which<10)||!hs(e,t)){var i=String.fromCharCode(null==r?n:r);"\b"!=i&&(ds(e,t,i)||e.display.input.onKeyPress(t))}}}var ys,bs,xs=400,ws=function(t,e,n){this.time=t,this.pos=e,this.button=n};function Cs(t,e){var n=+new Date;return bs&&bs.compare(n,t,e)?(ys=bs=null,"triple"):ys&&ys.compare(n,t,e)?(bs=new ws(n,t,e),ys=null,"double"):(ys=new ws(n,t,e),bs=null,"single")}function ks(t){var e=this,n=e.display;if(!(kt(e,t)||n.activeTouch&&n.input.supportsTouch()))if(n.input.ensurePolled(),n.shift=t.shiftKey,Vn(n,t))l||(n.scroller.draggable=!1,setTimeout((function(){return n.scroller.draggable=!0}),100));else if(!Ps(e,t)){var r=zr(e,t),i=Pt(t),o=r?Cs(r,i):"single";z(e).focus(),1==i&&e.state.selectingText&&e.state.selectingText(t),r&&Ss(e,i,r,o,t)||(1==i?r?Ds(e,r,o,t):Lt(t)==n.scroller&&At(t):2==i?(r&&Ho(e.doc,r),setTimeout((function(){return n.input.focus()}),20)):3==i&&(S?e.display.input.onContextMenu(t):ei(e)))}}function Ss(t,e,n,r,i){var o="Click";return"double"==r?o="Double"+o:"triple"==r&&(o="Triple"+o),us(t,Ya(o=(1==e?"Left":2==e?"Middle":"Right")+o,i),i,(function(e){if("string"==typeof e&&(e=ns[e]),!e)return!1;var r=!1;try{t.isReadOnly()&&(t.state.suppressEdits=!0),r=e(t,n)!=$}finally{t.state.suppressEdits=!1}return r}))}function _s(t,e,n){var r=t.getOption("configureMouse"),i=r?r(t,e,n):{};if(null==i.unit){var o=x?n.shiftKey&&n.metaKey:n.altKey;i.unit=o?"rectangle":"single"==e?"char":"double"==e?"word":"line"}return(null==i.extend||t.doc.extend)&&(i.extend=t.doc.extend||n.shiftKey),null==i.addNew&&(i.addNew=b?n.metaKey:n.ctrlKey),null==i.moveOnDrag&&(i.moveOnDrag=!(b?n.altKey:n.ctrlKey)),i}function Ds(t,e,n,r){a?setTimeout(H(ti,t),0):t.curOp.focus=O(R(t));var i,o=_s(t,n,r),s=t.doc.sel;t.options.dragDrop&&Bt&&!t.isReadOnly()&&"single"==n&&(i=s.contains(e))>-1&&(he((i=s.ranges[i]).from(),e)<0||e.xRel>0)&&(he(i.to(),e)>0||e.xRel<0)?As(t,r,e,o):Es(t,r,e,o)}function As(t,e,n,r){var i=t.display,o=!1,u=Ii(t,(function(e){l&&(i.scroller.draggable=!1),t.state.draggingText=!1,t.state.delayingBlurEvent&&(t.hasFocus()?t.state.delayingBlurEvent=!1:ei(t)),wt(i.wrapper.ownerDocument,"mouseup",u),wt(i.wrapper.ownerDocument,"mousemove",c),wt(i.scroller,"dragstart",h),wt(i.scroller,"drop",u),o||(At(e),r.addNew||Ho(t.doc,n,null,null,r.extend),l&&!f||a&&9==s?setTimeout((function(){i.wrapper.ownerDocument.body.focus({preventScroll:!0}),i.input.focus()}),20):i.input.focus())})),c=function(t){o=o||Math.abs(e.clientX-t.clientX)+Math.abs(e.clientY-t.clientY)>=10},h=function(){return o=!0};l&&(i.scroller.draggable=!0),t.state.draggingText=u,u.copy=!r.moveOnDrag,bt(i.wrapper.ownerDocument,"mouseup",u),bt(i.wrapper.ownerDocument,"mousemove",c),bt(i.scroller,"dragstart",h),bt(i.scroller,"drop",u),t.state.delayingBlurEvent=!0,setTimeout((function(){return i.input.focus()}),20),i.scroller.dragDrop&&i.scroller.dragDrop()}function Ts(t,e,n){if("char"==n)return new co(e,e);if("word"==n)return t.findWordAt(e);if("line"==n)return new co(ce(e.line,0),ve(t.doc,ce(e.line+1,0)));var r=n(t,e);return new co(r.from,r.to)}function Es(t,e,n,r){a&&ei(t);var i=t.display,o=t.doc;At(e);var s,l,u=o.sel,c=u.ranges;if(r.addNew&&!r.extend?(l=o.sel.contains(n),s=l>-1?c[l]:new co(n,n)):(s=o.sel.primary(),l=o.sel.primIndex),"rectangle"==r.unit)r.addNew||(s=new co(n,n)),n=zr(t,e,!0,!0),l=-1;else{var h=Ts(t,n,r.unit);s=r.extend?zo(s,h.anchor,h.head,r.extend):h}r.addNew?-1==l?(l=c.length,$o(o,ho(t,c.concat([s]),l),{scroll:!1,origin:"*mouse"})):c.length>1&&c[l].empty()&&"char"==r.unit&&!r.extend?($o(o,ho(t,c.slice(0,l).concat(c.slice(l+1)),0),{scroll:!1,origin:"*mouse"}),u=o.sel):Wo(o,l,s,V):(l=0,$o(o,new uo([s],0),V),u=o.sel);var d=n;function f(e){if(0!=he(d,e))if(d=e,"rectangle"==r.unit){for(var i=[],a=t.options.tabSize,c=W(ne(o,n.line).text,n.ch,a),h=W(ne(o,e.line).text,e.ch,a),f=Math.min(c,h),p=Math.max(c,h),g=Math.min(n.line,e.line),m=Math.min(t.lastLine(),Math.max(n.line,e.line));g<=m;g++){var v=ne(o,g).text,y=J(v,f,a);f==p?i.push(new co(ce(g,y),ce(g,y))):v.length>y&&i.push(new co(ce(g,y),ce(g,J(v,p,a))))}i.length||i.push(new co(n,n)),$o(o,ho(t,u.ranges.slice(0,l).concat(i),l),{origin:"*mouse",scroll:!1}),t.scrollIntoView(e)}else{var b,x=s,w=Ts(t,e,r.unit),C=x.anchor;he(w.anchor,C)>0?(b=w.head,C=ge(x.from(),w.anchor)):(b=w.anchor,C=pe(x.to(),w.head));var k=u.ranges.slice(0);k[l]=Fs(t,new co(ve(o,C),b)),$o(o,ho(t,k,l),V)}}var p=i.wrapper.getBoundingClientRect(),g=0;function m(e){var n=++g,a=zr(t,e,!0,"rectangle"==r.unit);if(a)if(0!=he(a,d)){t.curOp.focus=O(R(t)),f(a);var s=ai(i,o);(a.line>=s.to||a.line<s.from)&&setTimeout(Ii(t,(function(){g==n&&m(e)})),150)}else{var l=e.clientY<p.top?-20:e.clientY>p.bottom?20:0;l&&setTimeout(Ii(t,(function(){g==n&&(i.scroller.scrollTop+=l,m(e))})),50)}}function v(e){t.state.selectingText=!1,g=1/0,e&&(At(e),i.input.focus()),wt(i.wrapper.ownerDocument,"mousemove",y),wt(i.wrapper.ownerDocument,"mouseup",b),o.history.lastSelOrigin=null}var y=Ii(t,(function(t){0!==t.buttons&&Pt(t)?m(t):v(t)})),b=Ii(t,v);t.state.selectingText=b,bt(i.wrapper.ownerDocument,"mousemove",y),bt(i.wrapper.ownerDocument,"mouseup",b)}function Fs(t,e){var n=e.anchor,r=e.head,i=ne(t.doc,n.line);if(0==he(n,r)&&n.sticky==r.sticky)return e;var o=vt(i);if(!o)return e;var a=gt(o,n.ch,n.sticky),s=o[a];if(s.from!=n.ch&&s.to!=n.ch)return e;var l,u=a+(s.from==n.ch==(1!=s.level)?0:1);if(0==u||u==o.length)return e;if(r.line!=n.line)l=(r.line-n.line)*("ltr"==t.doc.direction?1:-1)>0;else{var c=gt(o,r.ch,r.sticky),h=c-a||(r.ch-n.ch)*(1==s.level?-1:1);l=c==u-1||c==u?h<0:h>0}var d=o[u+(l?-1:0)],f=l==(1==d.level),p=f?d.from:d.to,g=f?"after":"before";return n.ch==p&&n.sticky==g?e:new co(new ce(n.line,p,g),r)}function Ls(t,e,n,r){var i,o;if(e.touches)i=e.touches[0].clientX,o=e.touches[0].clientY;else try{i=e.clientX,o=e.clientY}catch(t){return!1}if(i>=Math.floor(t.display.gutters.getBoundingClientRect().right))return!1;r&&At(e);var a=t.display,s=a.lineDiv.getBoundingClientRect();if(o>s.bottom||!_t(t,n))return Et(e);o-=s.top-a.viewOffset;for(var l=0;l<t.display.gutterSpecs.length;++l){var u=a.gutters.childNodes[l];if(u&&u.getBoundingClientRect().right>=i)return Ct(t,n,t,se(t.doc,o),t.display.gutterSpecs[l].className,e),Et(e)}}function Ps(t,e){return Ls(t,e,"gutterClick",!0)}function Os(t,e){Vn(t.display,e)||Ms(t,e)||kt(t,e,"contextmenu")||S||t.display.input.onContextMenu(e)}function Ms(t,e){return!!_t(t,"gutterContextMenu")&&Ls(t,e,"gutterContextMenu",!1)}function Bs(t){t.display.wrapper.className=t.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+t.options.theme.replace(/(^|\s)\s*/g," cm-s-"),vr(t)}ws.prototype.compare=function(t,e,n){return this.time+xs>t&&0==he(e,this.pos)&&n==this.button};var Ns={toString:function(){return"CodeMirror.Init"}},Is={},Rs={};function js(t){var e=t.optionHandlers;function n(n,r,i,o){t.defaults[n]=r,i&&(e[n]=o?function(t,e,n){n!=Ns&&i(t,e,n)}:i)}t.defineOption=n,t.Init=Ns,n("value","",(function(t,e){return t.setValue(e)}),!0),n("mode",null,(function(t,e){t.doc.modeOption=e,bo(t)}),!0),n("indentUnit",2,bo,!0),n("indentWithTabs",!1),n("smartIndent",!0),n("tabSize",4,(function(t){xo(t),vr(t),Gr(t)}),!0),n("lineSeparator",null,(function(t,e){if(t.doc.lineSep=e,e){var n=[],r=t.doc.first;t.doc.iter((function(t){for(var i=0;;){var o=t.text.indexOf(e,i);if(-1==o)break;i=o+e.length,n.push(ce(r,o))}r++}));for(var i=n.length-1;i>=0;i--)ua(t.doc,e,n[i],ce(n[i].line,n[i].ch+e.length))}})),n("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\u202d\u202e\u2066\u2067\u2069\ufeff\ufff9-\ufffc]/g,(function(t,e,n){t.state.specialChars=new RegExp(e.source+(e.test("\t")?"":"|\t"),"g"),n!=Ns&&t.refresh()})),n("specialCharPlaceholder",wn,(function(t){return t.refresh()}),!0),n("electricChars",!0),n("inputStyle",y?"contenteditable":"textarea",(function(){throw new Error("inputStyle can not (yet) be changed in a running editor")}),!0),n("spellcheck",!1,(function(t,e){return t.getInputField().spellcheck=e}),!0),n("autocorrect",!1,(function(t,e){return t.getInputField().autocorrect=e}),!0),n("autocapitalize",!1,(function(t,e){return t.getInputField().autocapitalize=e}),!0),n("rtlMoveVisually",!w),n("wholeLineUpdateBefore",!0),n("theme","default",(function(t){Bs(t),no(t)}),!0),n("keyMap","default",(function(t,e,n){var r=Xa(e),i=n!=Ns&&Xa(n);i&&i.detach&&i.detach(t,r),r.attach&&r.attach(t,i||null)})),n("extraKeys",null),n("configureMouse",null),n("lineWrapping",!1,Hs,!0),n("gutters",[],(function(t,e){t.display.gutterSpecs=to(e,t.options.lineNumbers),no(t)}),!0),n("fixedGutter",!0,(function(t,e){t.display.gutters.style.left=e?Ir(t.display)+"px":"0",t.refresh()}),!0),n("coverGutterNextToScrollbar",!1,(function(t){return ki(t)}),!0),n("scrollbarStyle","native",(function(t){Di(t),ki(t),t.display.scrollbars.setScrollTop(t.doc.scrollTop),t.display.scrollbars.setScrollLeft(t.doc.scrollLeft)}),!0),n("lineNumbers",!1,(function(t,e){t.display.gutterSpecs=to(t.options.gutters,e),no(t)}),!0),n("firstLineNumber",1,no,!0),n("lineNumberFormatter",(function(t){return t}),no,!0),n("showCursorWhenSelecting",!1,Yr,!0),n("resetSelectionOnContextMenu",!0),n("lineWiseCopyCut",!0),n("pasteLinesPerSelection",!0),n("selectionsMayTouch",!1),n("readOnly",!1,(function(t,e){"nocursor"==e&&(ri(t),t.display.input.blur()),t.display.input.readOnlyChanged(e)})),n("screenReaderLabel",null,(function(t,e){e=""===e?null:e,t.display.input.screenReaderLabelChanged(e)})),n("disableInput",!1,(function(t,e){e||t.display.input.reset()}),!0),n("dragDrop",!0,zs),n("allowDropFileTypes",null),n("cursorBlinkRate",530),n("cursorScrollMargin",0),n("cursorHeight",1,Yr,!0),n("singleCursorHeightPerLine",!0,Yr,!0),n("workTime",100),n("workDelay",100),n("flattenSpans",!0,xo,!0),n("addModeClass",!1,xo,!0),n("pollInterval",100),n("undoDepth",200,(function(t,e){return t.doc.history.undoDepth=e})),n("historyEventDelay",1250),n("viewportMargin",10,(function(t){return t.refresh()}),!0),n("maxHighlightLength",1e4,xo,!0),n("moveInputWithCursor",!0,(function(t,e){e||t.display.input.resetPosition()})),n("tabindex",null,(function(t,e){return t.display.input.getField().tabIndex=e||""})),n("autofocus",null),n("direction","ltr",(function(t,e){return t.doc.setDirection(e)}),!0),n("phrases",null)}function zs(t,e,n){if(!e!=!(n&&n!=Ns)){var r=t.display.dragFunctions,i=e?bt:wt;i(t.display.scroller,"dragstart",r.start),i(t.display.scroller,"dragenter",r.enter),i(t.display.scroller,"dragover",r.over),i(t.display.scroller,"dragleave",r.leave),i(t.display.scroller,"drop",r.drop)}}function Hs(t){t.options.lineWrapping?(M(t.display.wrapper,"CodeMirror-wrap"),t.display.sizer.style.minWidth="",t.display.sizerWidth=null):(A(t.display.wrapper,"CodeMirror-wrap"),fn(t)),jr(t),Gr(t),vr(t),setTimeout((function(){return ki(t)}),100)}function Gs(t,e){var n=this;if(!(this instanceof Gs))return new Gs(t,e);this.options=e=e?G(e):{},G(Is,e,!1);var r=e.value;"string"==typeof r?r=new Ta(r,e.mode,null,e.lineSeparator,e.direction):e.mode&&(r.modeOption=e.mode),this.doc=r;var i=new Gs.inputStyles[e.inputStyle](this),o=this.display=new ro(t,r,i,e);for(var u in o.wrapper.CodeMirror=this,Bs(this),e.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),Di(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new q,keySeq:null,specialChars:null},e.autofocus&&!y&&o.input.focus(),a&&s<11&&setTimeout((function(){return n.display.input.reset(!0)}),20),Ws(this),Na(),Ti(this),this.curOp.forceUpdate=!0,So(this,r),e.autofocus&&!y||this.hasFocus()?setTimeout((function(){n.hasFocus()&&!n.state.focused&&ni(n)}),20):ri(this),Rs)Rs.hasOwnProperty(u)&&Rs[u](this,e[u],Ns);Zi(this),e.finishInit&&e.finishInit(this);for(var c=0;c<qs.length;++c)qs[c](this);Ei(this),l&&e.lineWrapping&&"optimizelegibility"==getComputedStyle(o.lineDiv).textRendering&&(o.lineDiv.style.textRendering="auto")}function Ws(t){var e=t.display;bt(e.scroller,"mousedown",Ii(t,ks)),bt(e.scroller,"dblclick",a&&s<11?Ii(t,(function(e){if(!kt(t,e)){var n=zr(t,e);if(n&&!Ps(t,e)&&!Vn(t.display,e)){At(e);var r=t.findWordAt(n);Ho(t.doc,r.anchor,r.head)}}})):function(e){return kt(t,e)||At(e)}),bt(e.scroller,"contextmenu",(function(e){return Os(t,e)})),bt(e.input.getField(),"contextmenu",(function(n){e.scroller.contains(n.target)||Os(t,n)}));var n,r={end:0};function i(){e.activeTouch&&(n=setTimeout((function(){return e.activeTouch=null}),1e3),(r=e.activeTouch).end=+new Date)}function o(t){if(1!=t.touches.length)return!1;var e=t.touches[0];return e.radiusX<=1&&e.radiusY<=1}function l(t,e){if(null==e.left)return!0;var n=e.left-t.left,r=e.top-t.top;return n*n+r*r>400}bt(e.scroller,"touchstart",(function(i){if(!kt(t,i)&&!o(i)&&!Ps(t,i)){e.input.ensurePolled(),clearTimeout(n);var a=+new Date;e.activeTouch={start:a,moved:!1,prev:a-r.end<=300?r:null},1==i.touches.length&&(e.activeTouch.left=i.touches[0].pageX,e.activeTouch.top=i.touches[0].pageY)}})),bt(e.scroller,"touchmove",(function(){e.activeTouch&&(e.activeTouch.moved=!0)})),bt(e.scroller,"touchend",(function(n){var r=e.activeTouch;if(r&&!Vn(e,n)&&null!=r.left&&!r.moved&&new Date-r.start<300){var o,a=t.coordsChar(e.activeTouch,"page");o=!r.prev||l(r,r.prev)?new co(a,a):!r.prev.prev||l(r,r.prev.prev)?t.findWordAt(a):new co(ce(a.line,0),ve(t.doc,ce(a.line+1,0))),t.setSelection(o.anchor,o.head),t.focus(),At(n)}i()})),bt(e.scroller,"touchcancel",i),bt(e.scroller,"scroll",(function(){e.scroller.clientHeight&&(vi(t,e.scroller.scrollTop),bi(t,e.scroller.scrollLeft,!0),Ct(t,"scroll",t))})),bt(e.scroller,"mousewheel",(function(e){return lo(t,e)})),bt(e.scroller,"DOMMouseScroll",(function(e){return lo(t,e)})),bt(e.wrapper,"scroll",(function(){return e.wrapper.scrollTop=e.wrapper.scrollLeft=0})),e.dragFunctions={enter:function(e){kt(t,e)||Ft(e)},over:function(e){kt(t,e)||(Pa(t,e),Ft(e))},start:function(e){return La(t,e)},drop:Ii(t,Fa),leave:function(e){kt(t,e)||Oa(t)}};var u=e.input.getField();bt(u,"keyup",(function(e){return ms.call(t,e)})),bt(u,"keydown",Ii(t,ps)),bt(u,"keypress",Ii(t,vs)),bt(u,"focus",(function(e){return ni(t,e)})),bt(u,"blur",(function(e){return ri(t,e)}))}Gs.defaults=Is,Gs.optionHandlers=Rs;var qs=[];function Us(t,e,n,r){var i,o=t.doc;null==n&&(n="add"),"smart"==n&&(o.mode.indent?i=Se(t,e).state:n="prev");var a=t.options.tabSize,s=ne(o,e),l=W(s.text,null,a);s.stateAfter&&(s.stateAfter=null);var u,c=s.text.match(/^\s*/)[0];if(r||/\S/.test(s.text)){if("smart"==n&&((u=o.mode.indent(i,s.text.slice(c.length),s.text))==$||u>150)){if(!r)return;n="prev"}}else u=0,n="not";"prev"==n?u=e>o.first?W(ne(o,e-1).text,null,a):0:"add"==n?u=l+t.options.indentUnit:"subtract"==n?u=l-t.options.indentUnit:"number"==typeof n&&(u=l+n),u=Math.max(0,u);var h="",d=0;if(t.options.indentWithTabs)for(var f=Math.floor(u/a);f;--f)d+=a,h+="\t";if(d<u&&(h+=Z(u-d)),h!=c)return ua(o,h,ce(e,0),ce(e,c.length),"+input"),s.stateAfter=null,!0;for(var p=0;p<o.sel.ranges.length;p++){var g=o.sel.ranges[p];if(g.head.line==e&&g.head.ch<c.length){var m=ce(e,c.length);Wo(o,p,new co(m,m));break}}}Gs.defineInitHook=function(t){return qs.push(t)};var Ks=null;function $s(t){Ks=t}function Ys(t,e,n,r,i){var o=t.doc;t.display.shift=!1,r||(r=o.sel);var a=+new Date-200,s="paste"==i||t.state.pasteIncoming>a,l=jt(e),u=null;if(s&&r.ranges.length>1)if(Ks&&Ks.text.join("\n")==e){if(r.ranges.length%Ks.text.length==0){u=[];for(var c=0;c<Ks.text.length;c++)u.push(o.splitLines(Ks.text[c]))}}else l.length==r.ranges.length&&t.options.pasteLinesPerSelection&&(u=et(l,(function(t){return[t]})));for(var h=t.curOp.updateInput,d=r.ranges.length-1;d>=0;d--){var f=r.ranges[d],p=f.from(),g=f.to();f.empty()&&(n&&n>0?p=ce(p.line,p.ch-n):t.state.overwrite&&!s?g=ce(g.line,Math.min(ne(o,g.line).text.length,g.ch+tt(l).length)):s&&Ks&&Ks.lineWise&&Ks.text.join("\n")==l.join("\n")&&(p=g=ce(p.line,0)));var m={from:p,to:g,text:u?u[d%u.length]:l,origin:i||(s?"paste":t.state.cutIncoming>a?"cut":"+input")};ra(t.doc,m),Mn(t,"inputRead",t,m)}e&&!s&&Xs(t,e),di(t),t.curOp.updateInput<2&&(t.curOp.updateInput=h),t.curOp.typing=!0,t.state.pasteIncoming=t.state.cutIncoming=-1}function Vs(t,e){var n=t.clipboardData&&t.clipboardData.getData("Text");if(n)return t.preventDefault(),e.isReadOnly()||e.options.disableInput||!e.hasFocus()||Ni(e,(function(){return Ys(e,n,0,null,"paste")})),!0}function Xs(t,e){if(t.options.electricChars&&t.options.smartIndent)for(var n=t.doc.sel,r=n.ranges.length-1;r>=0;r--){var i=n.ranges[r];if(!(i.head.ch>100||r&&n.ranges[r-1].head.line==i.head.line)){var o=t.getModeAt(i.head),a=!1;if(o.electricChars){for(var s=0;s<o.electricChars.length;s++)if(e.indexOf(o.electricChars.charAt(s))>-1){a=Us(t,i.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(ne(t.doc,i.head.line).text.slice(0,i.head.ch))&&(a=Us(t,i.head.line,"smart"));a&&Mn(t,"electricInput",t,i.head.line)}}}function Js(t){for(var e=[],n=[],r=0;r<t.doc.sel.ranges.length;r++){var i=t.doc.sel.ranges[r].head.line,o={anchor:ce(i,0),head:ce(i+1,0)};n.push(o),e.push(t.getRange(o.anchor,o.head))}return{text:e,ranges:n}}function Qs(t,e,n,r){t.setAttribute("autocorrect",n?"on":"off"),t.setAttribute("autocapitalize",r?"on":"off"),t.setAttribute("spellcheck",!!e)}function Zs(){var t=F("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none"),e=F("div",[t],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return l?t.style.width="1000px":t.setAttribute("wrap","off"),m&&(t.style.border="1px solid black"),e}function tl(t){var e=t.optionHandlers,n=t.helpers={};t.prototype={constructor:t,focus:function(){z(this).focus(),this.display.input.focus()},setOption:function(t,n){var r=this.options,i=r[t];r[t]==n&&"mode"!=t||(r[t]=n,e.hasOwnProperty(t)&&Ii(this,e[t])(this,n,i),Ct(this,"optionChange",this,t))},getOption:function(t){return this.options[t]},getDoc:function(){return this.doc},addKeyMap:function(t,e){this.state.keyMaps[e?"push":"unshift"](Xa(t))},removeKeyMap:function(t){for(var e=this.state.keyMaps,n=0;n<e.length;++n)if(e[n]==t||e[n].name==t)return e.splice(n,1),!0},addOverlay:Ri((function(e,n){var r=e.token?e:t.getMode(this.options,e);if(r.startState)throw new Error("Overlays may not be stateful.");nt(this.state.overlays,{mode:r,modeSpec:e,opaque:n&&n.opaque,priority:n&&n.priority||0},(function(t){return t.priority})),this.state.modeGen++,Gr(this)})),removeOverlay:Ri((function(t){for(var e=this.state.overlays,n=0;n<e.length;++n){var r=e[n].modeSpec;if(r==t||"string"==typeof t&&r.name==t)return e.splice(n,1),this.state.modeGen++,void Gr(this)}})),indentLine:Ri((function(t,e,n){"string"!=typeof e&&"number"!=typeof e&&(e=null==e?this.options.smartIndent?"smart":"prev":e?"add":"subtract"),le(this.doc,t)&&Us(this,t,e,n)})),indentSelection:Ri((function(t){for(var e=this.doc.sel.ranges,n=-1,r=0;r<e.length;r++){var i=e[r];if(i.empty())i.head.line>n&&(Us(this,i.head.line,t,!0),n=i.head.line,r==this.doc.sel.primIndex&&di(this));else{var o=i.from(),a=i.to(),s=Math.max(n,o.line);n=Math.min(this.lastLine(),a.line-(a.ch?0:1))+1;for(var l=s;l<n;++l)Us(this,l,t);var u=this.doc.sel.ranges;0==o.ch&&e.length==u.length&&u[r].from().ch>0&&Wo(this.doc,r,new co(o,u[r].to()),Y)}}})),getTokenAt:function(t,e){return Ee(this,t,e)},getLineTokens:function(t,e){return Ee(this,ce(t),e,!0)},getTokenTypeAt:function(t){t=ve(this.doc,t);var e,n=ke(this,ne(this.doc,t.line)),r=0,i=(n.length-1)/2,o=t.ch;if(0==o)e=n[2];else for(;;){var a=r+i>>1;if((a?n[2*a-1]:0)>=o)i=a;else{if(!(n[2*a+1]<o)){e=n[2*a+2];break}r=a+1}}var s=e?e.indexOf("overlay "):-1;return s<0?e:0==s?null:e.slice(0,s-1)},getModeAt:function(e){var n=this.doc.mode;return n.innerMode?t.innerMode(n,this.getTokenAt(e).state).mode:n},getHelper:function(t,e){return this.getHelpers(t,e)[0]},getHelpers:function(t,e){var r=[];if(!n.hasOwnProperty(e))return r;var i=n[e],o=this.getModeAt(t);if("string"==typeof o[e])i[o[e]]&&r.push(i[o[e]]);else if(o[e])for(var a=0;a<o[e].length;a++){var s=i[o[e][a]];s&&r.push(s)}else o.helperType&&i[o.helperType]?r.push(i[o.helperType]):i[o.name]&&r.push(i[o.name]);for(var l=0;l<i._global.length;l++){var u=i._global[l];u.pred(o,this)&&-1==U(r,u.val)&&r.push(u.val)}return r},getStateAfter:function(t,e){var n=this.doc;return Se(this,(t=me(n,null==t?n.first+n.size-1:t))+1,e).state},cursorCoords:function(t,e){var n=this.doc.sel.primary();return Sr(this,null==t?n.head:"object"==typeof t?ve(this.doc,t):t?n.from():n.to(),e||"page")},charCoords:function(t,e){return kr(this,ve(this.doc,t),e||"page")},coordsChar:function(t,e){return Ar(this,(t=Cr(this,t,e||"page")).left,t.top)},lineAtHeight:function(t,e){return t=Cr(this,{top:t,left:0},e||"page").top,se(this.doc,t+this.display.viewOffset)},heightAtLine:function(t,e,n){var r,i=!1;if("number"==typeof t){var o=this.doc.first+this.doc.size-1;t<this.doc.first?t=this.doc.first:t>o&&(t=o,i=!0),r=ne(this.doc,t)}else r=t;return wr(this,r,{top:0,left:0},e||"page",n||i).top+(i?this.doc.height-hn(r):0)},defaultTextHeight:function(){return Mr(this.display)},defaultCharWidth:function(){return Br(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(t,e,n,r,i){var o=this.display,a=(t=Sr(this,ve(this.doc,t))).bottom,s=t.left;if(e.style.position="absolute",e.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(e),o.sizer.appendChild(e),"over"==r)a=t.top;else if("above"==r||"near"==r){var l=Math.max(o.wrapper.clientHeight,this.doc.height),u=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==r||t.bottom+e.offsetHeight>l)&&t.top>e.offsetHeight?a=t.top-e.offsetHeight:t.bottom+e.offsetHeight<=l&&(a=t.bottom),s+e.offsetWidth>u&&(s=u-e.offsetWidth)}e.style.top=a+"px",e.style.left=e.style.right="","right"==i?(s=o.sizer.clientWidth-e.offsetWidth,e.style.right="0px"):("left"==i?s=0:"middle"==i&&(s=(o.sizer.clientWidth-e.offsetWidth)/2),e.style.left=s+"px"),n&&ui(this,{left:s,top:a,right:s+e.offsetWidth,bottom:a+e.offsetHeight})},triggerOnKeyDown:Ri(ps),triggerOnKeyPress:Ri(vs),triggerOnKeyUp:ms,triggerOnMouseDown:Ri(ks),execCommand:function(t){if(ns.hasOwnProperty(t))return ns[t].call(null,this)},triggerElectric:Ri((function(t){Xs(this,t)})),findPosH:function(t,e,n,r){var i=1;e<0&&(i=-1,e=-e);for(var o=ve(this.doc,t),a=0;a<e&&!(o=el(this.doc,o,i,n,r)).hitSide;++a);return o},moveH:Ri((function(t,e){var n=this;this.extendSelectionsBy((function(r){return n.display.shift||n.doc.extend||r.empty()?el(n.doc,r.head,t,e,n.options.rtlMoveVisually):t<0?r.from():r.to()}),X)})),deleteH:Ri((function(t,e){var n=this.doc.sel,r=this.doc;n.somethingSelected()?r.replaceSelection("",null,"+delete"):Ja(this,(function(n){var i=el(r,n.head,t,e,!1);return t<0?{from:i,to:n.head}:{from:n.head,to:i}}))})),findPosV:function(t,e,n,r){var i=1,o=r;e<0&&(i=-1,e=-e);for(var a=ve(this.doc,t),s=0;s<e;++s){var l=Sr(this,a,"div");if(null==o?o=l.left:l.left=o,(a=nl(this,l,i,n)).hitSide)break}return a},moveV:Ri((function(t,e){var n=this,r=this.doc,i=[],o=!this.display.shift&&!r.extend&&r.sel.somethingSelected();if(r.extendSelectionsBy((function(a){if(o)return t<0?a.from():a.to();var s=Sr(n,a.head,"div");null!=a.goalColumn&&(s.left=a.goalColumn),i.push(s.left);var l=nl(n,s,t,e);return"page"==e&&a==r.sel.primary()&&hi(n,kr(n,l,"div").top-s.top),l}),X),i.length)for(var a=0;a<r.sel.ranges.length;a++)r.sel.ranges[a].goalColumn=i[a]})),findWordAt:function(t){var e=ne(this.doc,t.line).text,n=t.ch,r=t.ch;if(e){var i=this.getHelper(t,"wordChars");"before"!=t.sticky&&r!=e.length||!n?++r:--n;for(var o=e.charAt(n),a=st(o,i)?function(t){return st(t,i)}:/\s/.test(o)?function(t){return/\s/.test(t)}:function(t){return!/\s/.test(t)&&!st(t)};n>0&&a(e.charAt(n-1));)--n;for(;r<e.length&&a(e.charAt(r));)++r}return new co(ce(t.line,n),ce(t.line,r))},toggleOverwrite:function(t){null!=t&&t==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?M(this.display.cursorDiv,"CodeMirror-overwrite"):A(this.display.cursorDiv,"CodeMirror-overwrite"),Ct(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==O(R(this))},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:Ri((function(t,e){fi(this,t,e)})),getScrollInfo:function(){var t=this.display.scroller;return{left:t.scrollLeft,top:t.scrollTop,height:t.scrollHeight-Zn(this)-this.display.barHeight,width:t.scrollWidth-Zn(this)-this.display.barWidth,clientHeight:er(this),clientWidth:tr(this)}},scrollIntoView:Ri((function(t,e){null==t?(t={from:this.doc.sel.primary().head,to:null},null==e&&(e=this.options.cursorScrollMargin)):"number"==typeof t?t={from:ce(t,0),to:null}:null==t.from&&(t={from:t,to:null}),t.to||(t.to=t.from),t.margin=e||0,null!=t.from.line?pi(this,t):mi(this,t.from,t.to,t.margin)})),setSize:Ri((function(t,e){var n=this,r=function(t){return"number"==typeof t||/^\d+$/.test(String(t))?t+"px":t};null!=t&&(this.display.wrapper.style.width=r(t)),null!=e&&(this.display.wrapper.style.height=r(e)),this.options.lineWrapping&&mr(this);var i=this.display.viewFrom;this.doc.iter(i,this.display.viewTo,(function(t){if(t.widgets)for(var e=0;e<t.widgets.length;e++)if(t.widgets[e].noHScroll){Wr(n,i,"widget");break}++i})),this.curOp.forceUpdate=!0,Ct(this,"refresh",this)})),operation:function(t){return Ni(this,t)},startOperation:function(){return Ti(this)},endOperation:function(){return Ei(this)},refresh:Ri((function(){var t=this.display.cachedTextHeight;Gr(this),this.curOp.forceUpdate=!0,vr(this),fi(this,this.doc.scrollLeft,this.doc.scrollTop),Xi(this.display),(null==t||Math.abs(t-Mr(this.display))>.5||this.options.lineWrapping)&&jr(this),Ct(this,"refresh",this)})),swapDoc:Ri((function(t){var e=this.doc;return e.cm=null,this.state.selectingText&&this.state.selectingText(),So(this,t),vr(this),this.display.input.reset(),fi(this,t.scrollLeft,t.scrollTop),this.curOp.forceScroll=!0,Mn(this,"swapDoc",this,e),e})),phrase:function(t){var e=this.options.phrases;return e&&Object.prototype.hasOwnProperty.call(e,t)?e[t]:t},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Dt(t),t.registerHelper=function(e,r,i){n.hasOwnProperty(e)||(n[e]=t[e]={_global:[]}),n[e][r]=i},t.registerGlobalHelper=function(e,r,i,o){t.registerHelper(e,r,o),n[e]._global.push({pred:i,val:o})}}function el(t,e,n,r,i){var o=e,a=n,s=ne(t,e.line),l=i&&"rtl"==t.direction?-n:n;function u(){var n=e.line+l;return!(n<t.first||n>=t.first+t.size)&&(e=new ce(n,e.ch,e.sticky),s=ne(t,n))}function c(o){var a;if("codepoint"==r){var c=s.text.charCodeAt(e.ch+(n>0?0:-1));if(isNaN(c))a=null;else{var h=n>0?c>=55296&&c<56320:c>=56320&&c<57343;a=new ce(e.line,Math.max(0,Math.min(s.text.length,e.ch+n*(h?2:1))),-n)}}else a=i?es(t.cm,s,e,n):Za(s,e,n);if(null==a){if(o||!u())return!1;e=ts(i,t.cm,s,e.line,l)}else e=a;return!0}if("char"==r||"codepoint"==r)c();else if("column"==r)c(!0);else if("word"==r||"group"==r)for(var h=null,d="group"==r,f=t.cm&&t.cm.getHelper(e,"wordChars"),p=!0;!(n<0)||c(!p);p=!1){var g=s.text.charAt(e.ch)||"\n",m=st(g,f)?"w":d&&"\n"==g?"n":!d||/\s/.test(g)?null:"p";if(!d||p||m||(m="s"),h&&h!=m){n<0&&(n=1,c(),e.sticky="after");break}if(m&&(h=m),n>0&&!c(!p))break}var v=Zo(t,e,o,a,!0);return de(o,v)&&(v.hitSide=!0),v}function nl(t,e,n,r){var i,o,a=t.doc,s=e.left;if("page"==r){var l=Math.min(t.display.wrapper.clientHeight,z(t).innerHeight||a(t).documentElement.clientHeight),u=Math.max(l-.5*Mr(t.display),3);i=(n>0?e.bottom:e.top)+n*u}else"line"==r&&(i=n>0?e.bottom+3:e.top-3);for(;(o=Ar(t,s,i)).outside;){if(n<0?i<=0:i>=a.height){o.hitSide=!0;break}i+=5*n}return o}var rl=function(t){this.cm=t,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new q,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};function il(t,e){var n=ar(t,e.line);if(!n||n.hidden)return null;var r=ne(t.doc,e.line),i=rr(n,r,e.line),o=vt(r,t.doc.direction),a="left";o&&(a=gt(o,e.ch)%2?"right":"left");var s=hr(i.map,e.ch,a);return s.offset="right"==s.collapse?s.end:s.start,s}function ol(t){for(var e=t;e;e=e.parentNode)if(/CodeMirror-gutter-wrapper/.test(e.className))return!0;return!1}function al(t,e){return e&&(t.bad=!0),t}function sl(t,e,n,r,i){var o="",a=!1,s=t.doc.lineSeparator(),l=!1;function u(t){return function(e){return e.id==t}}function c(){a&&(o+=s,l&&(o+=s),a=l=!1)}function h(t){t&&(c(),o+=t)}function d(e){if(1==e.nodeType){var n=e.getAttribute("cm-text");if(n)return void h(n);var o,f=e.getAttribute("cm-marker");if(f){var p=t.findMarks(ce(r,0),ce(i+1,0),u(+f));return void(p.length&&(o=p[0].find(0))&&h(re(t.doc,o.from,o.to).join(s)))}if("false"==e.getAttribute("contenteditable"))return;var g=/^(pre|div|p|li|table|br)$/i.test(e.nodeName);if(!/^br$/i.test(e.nodeName)&&0==e.textContent.length)return;g&&c();for(var m=0;m<e.childNodes.length;m++)d(e.childNodes[m]);/^(pre|p)$/i.test(e.nodeName)&&(l=!0),g&&(a=!0)}else 3==e.nodeType&&h(e.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;d(e),e!=n;)e=e.nextSibling,l=!1;return o}function ll(t,e,n){var r;if(e==t.display.lineDiv){if(!(r=t.display.lineDiv.childNodes[n]))return al(t.clipPos(ce(t.display.viewTo-1)),!0);e=null,n=0}else for(r=e;;r=r.parentNode){if(!r||r==t.display.lineDiv)return null;if(r.parentNode&&r.parentNode==t.display.lineDiv)break}for(var i=0;i<t.display.view.length;i++){var o=t.display.view[i];if(o.node==r)return ul(o,e,n)}}function ul(t,e,n){var r=t.text.firstChild,i=!1;if(!e||!P(r,e))return al(ce(ae(t.line),0),!0);if(e==r&&(i=!0,e=r.childNodes[n],n=0,!e)){var o=t.rest?tt(t.rest):t.line;return al(ce(ae(o),o.text.length),i)}var a=3==e.nodeType?e:null,s=e;for(a||1!=e.childNodes.length||3!=e.firstChild.nodeType||(a=e.firstChild,n&&(n=a.nodeValue.length));s.parentNode!=r;)s=s.parentNode;var l=t.measure,u=l.maps;function c(e,n,r){for(var i=-1;i<(u?u.length:0);i++)for(var o=i<0?l.map:u[i],a=0;a<o.length;a+=3){var s=o[a+2];if(s==e||s==n){var c=ae(i<0?t.line:t.rest[i]),h=o[a]+r;return(r<0||s!=e)&&(h=o[a+(r?1:0)]),ce(c,h)}}}var h=c(a,s,n);if(h)return al(h,i);for(var d=s.nextSibling,f=a?a.nodeValue.length-n:0;d;d=d.nextSibling){if(h=c(d,d.firstChild,0))return al(ce(h.line,h.ch-f),i);f+=d.textContent.length}for(var p=s.previousSibling,g=n;p;p=p.previousSibling){if(h=c(p,p.firstChild,-1))return al(ce(h.line,h.ch+g),i);g+=p.textContent.length}}rl.prototype.init=function(t){var e=this,n=this,r=n.cm,i=n.div=t.lineDiv;function o(t){for(var e=t.target;e;e=e.parentNode){if(e==i)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(e.className))break}return!1}function a(t){if(o(t)&&!kt(r,t)){if(r.somethingSelected())$s({lineWise:!1,text:r.getSelections()}),"cut"==t.type&&r.replaceSelection("",null,"cut");else{if(!r.options.lineWiseCopyCut)return;var e=Js(r);$s({lineWise:!0,text:e.text}),"cut"==t.type&&r.operation((function(){r.setSelections(e.ranges,0,Y),r.replaceSelection("",null,"cut")}))}if(t.clipboardData){t.clipboardData.clearData();var a=Ks.text.join("\n");if(t.clipboardData.setData("Text",a),t.clipboardData.getData("Text")==a)return void t.preventDefault()}var s=Zs(),l=s.firstChild;Qs(l),r.display.lineSpace.insertBefore(s,r.display.lineSpace.firstChild),l.value=Ks.text.join("\n");var u=O(j(i));N(l),setTimeout((function(){r.display.lineSpace.removeChild(s),u.focus(),u==i&&n.showPrimarySelection()}),50)}}i.contentEditable=!0,Qs(i,r.options.spellcheck,r.options.autocorrect,r.options.autocapitalize),bt(i,"paste",(function(t){!o(t)||kt(r,t)||Vs(t,r)||s<=11&&setTimeout(Ii(r,(function(){return e.updateFromDOM()})),20)})),bt(i,"compositionstart",(function(t){e.composing={data:t.data,done:!1}})),bt(i,"compositionupdate",(function(t){e.composing||(e.composing={data:t.data,done:!1})})),bt(i,"compositionend",(function(t){e.composing&&(t.data!=e.composing.data&&e.readFromDOMSoon(),e.composing.done=!0)})),bt(i,"touchstart",(function(){return n.forceCompositionEnd()})),bt(i,"input",(function(){e.composing||e.readFromDOMSoon()})),bt(i,"copy",a),bt(i,"cut",a)},rl.prototype.screenReaderLabelChanged=function(t){t?this.div.setAttribute("aria-label",t):this.div.removeAttribute("aria-label")},rl.prototype.prepareSelection=function(){var t=Vr(this.cm,!1);return t.focus=O(j(this.div))==this.div,t},rl.prototype.showSelection=function(t,e){t&&this.cm.display.view.length&&((t.focus||e)&&this.showPrimarySelection(),this.showMultipleSelections(t))},rl.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},rl.prototype.showPrimarySelection=function(){var t=this.getSelection(),e=this.cm,r=e.doc.sel.primary(),i=r.from(),o=r.to();if(e.display.viewTo==e.display.viewFrom||i.line>=e.display.viewTo||o.line<e.display.viewFrom)t.removeAllRanges();else{var a=ll(e,t.anchorNode,t.anchorOffset),s=ll(e,t.focusNode,t.focusOffset);if(!a||a.bad||!s||s.bad||0!=he(ge(a,s),i)||0!=he(pe(a,s),o)){var l=e.display.view,u=i.line>=e.display.viewFrom&&il(e,i)||{node:l[0].measure.map[2],offset:0},c=o.line<e.display.viewTo&&il(e,o);if(!c){var h=l[l.length-1].measure,d=h.maps?h.maps[h.maps.length-1]:h.map;c={node:d[d.length-1],offset:d[d.length-2]-d[d.length-3]}}if(u&&c){var f,p=t.rangeCount&&t.getRangeAt(0);try{f=D(u.node,u.offset,c.offset,c.node)}catch(t){}f&&(!n&&e.state.focused?(t.collapse(u.node,u.offset),f.collapsed||(t.removeAllRanges(),t.addRange(f))):(t.removeAllRanges(),t.addRange(f)),p&&null==t.anchorNode?t.addRange(p):n&&this.startGracePeriod()),this.rememberSelection()}else t.removeAllRanges()}}},rl.prototype.startGracePeriod=function(){var t=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout((function(){t.gracePeriod=!1,t.selectionChanged()&&t.cm.operation((function(){return t.cm.curOp.selectionChanged=!0}))}),20)},rl.prototype.showMultipleSelections=function(t){E(this.cm.display.cursorDiv,t.cursors),E(this.cm.display.selectionDiv,t.selection)},rl.prototype.rememberSelection=function(){var t=this.getSelection();this.lastAnchorNode=t.anchorNode,this.lastAnchorOffset=t.anchorOffset,this.lastFocusNode=t.focusNode,this.lastFocusOffset=t.focusOffset},rl.prototype.selectionInEditor=function(){var t=this.getSelection();if(!t.rangeCount)return!1;var e=t.getRangeAt(0).commonAncestorContainer;return P(this.div,e)},rl.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()&&O(j(this.div))==this.div||this.showSelection(this.prepareSelection(),!0),this.div.focus())},rl.prototype.blur=function(){this.div.blur()},rl.prototype.getField=function(){return this.div},rl.prototype.supportsTouch=function(){return!0},rl.prototype.receivedFocus=function(){var t=this,e=this;function n(){e.cm.state.focused&&(e.pollSelection(),e.polling.set(e.cm.options.pollInterval,n))}this.selectionInEditor()?setTimeout((function(){return t.pollSelection()}),20):Ni(this.cm,(function(){return e.cm.curOp.selectionChanged=!0})),this.polling.set(this.cm.options.pollInterval,n)},rl.prototype.selectionChanged=function(){var t=this.getSelection();return t.anchorNode!=this.lastAnchorNode||t.anchorOffset!=this.lastAnchorOffset||t.focusNode!=this.lastFocusNode||t.focusOffset!=this.lastFocusOffset},rl.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var t=this.getSelection(),e=this.cm;if(v&&c&&this.cm.display.gutterSpecs.length&&ol(t.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var n=ll(e,t.anchorNode,t.anchorOffset),r=ll(e,t.focusNode,t.focusOffset);n&&r&&Ni(e,(function(){$o(e.doc,fo(n,r),Y),(n.bad||r.bad)&&(e.curOp.selectionChanged=!0)}))}}},rl.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var t,e,n,r=this.cm,i=r.display,o=r.doc.sel.primary(),a=o.from(),s=o.to();if(0==a.ch&&a.line>r.firstLine()&&(a=ce(a.line-1,ne(r.doc,a.line-1).length)),s.ch==ne(r.doc,s.line).text.length&&s.line<r.lastLine()&&(s=ce(s.line+1,0)),a.line<i.viewFrom||s.line>i.viewTo-1)return!1;a.line==i.viewFrom||0==(t=Hr(r,a.line))?(e=ae(i.view[0].line),n=i.view[0].node):(e=ae(i.view[t].line),n=i.view[t-1].node.nextSibling);var l,u,c=Hr(r,s.line);if(c==i.view.length-1?(l=i.viewTo-1,u=i.lineDiv.lastChild):(l=ae(i.view[c+1].line)-1,u=i.view[c+1].node.previousSibling),!n)return!1;for(var h=r.doc.splitLines(sl(r,n,u,e,l)),d=re(r.doc,ce(e,0),ce(l,ne(r.doc,l).text.length));h.length>1&&d.length>1;)if(tt(h)==tt(d))h.pop(),d.pop(),l--;else{if(h[0]!=d[0])break;h.shift(),d.shift(),e++}for(var f=0,p=0,g=h[0],m=d[0],v=Math.min(g.length,m.length);f<v&&g.charCodeAt(f)==m.charCodeAt(f);)++f;for(var y=tt(h),b=tt(d),x=Math.min(y.length-(1==h.length?f:0),b.length-(1==d.length?f:0));p<x&&y.charCodeAt(y.length-p-1)==b.charCodeAt(b.length-p-1);)++p;if(1==h.length&&1==d.length&&e==a.line)for(;f&&f>a.ch&&y.charCodeAt(y.length-p-1)==b.charCodeAt(b.length-p-1);)f--,p++;h[h.length-1]=y.slice(0,y.length-p).replace(/^\u200b+/,""),h[0]=h[0].slice(f).replace(/\u200b+$/,"");var w=ce(e,f),C=ce(l,d.length?tt(d).length-p:0);return h.length>1||h[0]||he(w,C)?(ua(r.doc,h,w,C,"+input"),!0):void 0},rl.prototype.ensurePolled=function(){this.forceCompositionEnd()},rl.prototype.reset=function(){this.forceCompositionEnd()},rl.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},rl.prototype.readFromDOMSoon=function(){var t=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout((function(){if(t.readDOMTimeout=null,t.composing){if(!t.composing.done)return;t.composing=null}t.updateFromDOM()}),80))},rl.prototype.updateFromDOM=function(){var t=this;!this.cm.isReadOnly()&&this.pollContent()||Ni(this.cm,(function(){return Gr(t.cm)}))},rl.prototype.setUneditable=function(t){t.contentEditable="false"},rl.prototype.onKeyPress=function(t){0==t.charCode||this.composing||(t.preventDefault(),this.cm.isReadOnly()||Ii(this.cm,Ys)(this.cm,String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),0))},rl.prototype.readOnlyChanged=function(t){this.div.contentEditable=String("nocursor"!=t)},rl.prototype.onContextMenu=function(){},rl.prototype.resetPosition=function(){},rl.prototype.needsContentAttribute=!0;var cl=function(t){this.cm=t,this.prevInput="",this.pollingFast=!1,this.polling=new q,this.hasSelection=!1,this.composing=null,this.resetting=!1};function hl(t,e){if((e=e?G(e):{}).value=t.value,!e.tabindex&&t.tabIndex&&(e.tabindex=t.tabIndex),!e.placeholder&&t.placeholder&&(e.placeholder=t.placeholder),null==e.autofocus){var n=O(j(t));e.autofocus=n==t||null!=t.getAttribute("autofocus")&&n==document.body}function r(){t.value=s.getValue()}var i;if(t.form&&(bt(t.form,"submit",r),!e.leaveSubmitMethodAlone)){var o=t.form;i=o.submit;try{var a=o.submit=function(){r(),o.submit=i,o.submit(),o.submit=a}}catch(t){}}e.finishInit=function(n){n.save=r,n.getTextArea=function(){return t},n.toTextArea=function(){n.toTextArea=isNaN,r(),t.parentNode.removeChild(n.getWrapperElement()),t.style.display="",t.form&&(wt(t.form,"submit",r),e.leaveSubmitMethodAlone||"function"!=typeof t.form.submit||(t.form.submit=i))}},t.style.display="none";var s=Gs((function(e){return t.parentNode.insertBefore(e,t.nextSibling)}),e);return s}function dl(t){t.off=wt,t.on=bt,t.wheelEventPixels=so,t.Doc=Ta,t.splitLines=jt,t.countColumn=W,t.findColumn=J,t.isWordChar=at,t.Pass=$,t.signal=Ct,t.Line=pn,t.changeEnd=po,t.scrollbarModel=_i,t.Pos=ce,t.cmpPos=he,t.modes=qt,t.mimeModes=Ut,t.resolveMode=Yt,t.getMode=Vt,t.modeExtensions=Xt,t.extendMode=Jt,t.copyState=Qt,t.startState=te,t.innerMode=Zt,t.commands=ns,t.keyMap=Wa,t.keyName=Va,t.isModifierKey=$a,t.lookupKey=Ka,t.normalizeKeyMap=Ua,t.StringStream=ee,t.SharedTextMarker=Ca,t.TextMarker=xa,t.LineWidget=ma,t.e_preventDefault=At,t.e_stopPropagation=Tt,t.e_stop=Ft,t.addClass=M,t.contains=P,t.rmClass=A,t.keyNames=ja}cl.prototype.init=function(t){var e=this,n=this,r=this.cm;this.createField(t);var i=this.textarea;function o(t){if(!kt(r,t)){if(r.somethingSelected())$s({lineWise:!1,text:r.getSelections()});else{if(!r.options.lineWiseCopyCut)return;var e=Js(r);$s({lineWise:!0,text:e.text}),"cut"==t.type?r.setSelections(e.ranges,null,Y):(n.prevInput="",i.value=e.text.join("\n"),N(i))}"cut"==t.type&&(r.state.cutIncoming=+new Date)}}t.wrapper.insertBefore(this.wrapper,t.wrapper.firstChild),m&&(i.style.width="0px"),bt(i,"input",(function(){a&&s>=9&&e.hasSelection&&(e.hasSelection=null),n.poll()})),bt(i,"paste",(function(t){kt(r,t)||Vs(t,r)||(r.state.pasteIncoming=+new Date,n.fastPoll())})),bt(i,"cut",o),bt(i,"copy",o),bt(t.scroller,"paste",(function(e){if(!Vn(t,e)&&!kt(r,e)){if(!i.dispatchEvent)return r.state.pasteIncoming=+new Date,void n.focus();var o=new Event("paste");o.clipboardData=e.clipboardData,i.dispatchEvent(o)}})),bt(t.lineSpace,"selectstart",(function(e){Vn(t,e)||At(e)})),bt(i,"compositionstart",(function(){var t=r.getCursor("from");n.composing&&n.composing.range.clear(),n.composing={start:t,range:r.markText(t,r.getCursor("to"),{className:"CodeMirror-composing"})}})),bt(i,"compositionend",(function(){n.composing&&(n.poll(),n.composing.range.clear(),n.composing=null)}))},cl.prototype.createField=function(t){this.wrapper=Zs(),this.textarea=this.wrapper.firstChild;var e=this.cm.options;Qs(this.textarea,e.spellcheck,e.autocorrect,e.autocapitalize)},cl.prototype.screenReaderLabelChanged=function(t){t?this.textarea.setAttribute("aria-label",t):this.textarea.removeAttribute("aria-label")},cl.prototype.prepareSelection=function(){var t=this.cm,e=t.display,n=t.doc,r=Vr(t);if(t.options.moveInputWithCursor){var i=Sr(t,n.sel.primary().head,"div"),o=e.wrapper.getBoundingClientRect(),a=e.lineDiv.getBoundingClientRect();r.teTop=Math.max(0,Math.min(e.wrapper.clientHeight-10,i.top+a.top-o.top)),r.teLeft=Math.max(0,Math.min(e.wrapper.clientWidth-10,i.left+a.left-o.left))}return r},cl.prototype.showSelection=function(t){var e=this.cm.display;E(e.cursorDiv,t.cursors),E(e.selectionDiv,t.selection),null!=t.teTop&&(this.wrapper.style.top=t.teTop+"px",this.wrapper.style.left=t.teLeft+"px")},cl.prototype.reset=function(t){if(!(this.contextMenuPending||this.composing&&t)){var e=this.cm;if(this.resetting=!0,e.somethingSelected()){this.prevInput="";var n=e.getSelection();this.textarea.value=n,e.state.focused&&N(this.textarea),a&&s>=9&&(this.hasSelection=n)}else t||(this.prevInput=this.textarea.value="",a&&s>=9&&(this.hasSelection=null));this.resetting=!1}},cl.prototype.getField=function(){return this.textarea},cl.prototype.supportsTouch=function(){return!1},cl.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!y||O(j(this.textarea))!=this.textarea))try{this.textarea.focus()}catch(t){}},cl.prototype.blur=function(){this.textarea.blur()},cl.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},cl.prototype.receivedFocus=function(){this.slowPoll()},cl.prototype.slowPoll=function(){var t=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,(function(){t.poll(),t.cm.state.focused&&t.slowPoll()}))},cl.prototype.fastPoll=function(){var t=!1,e=this;function n(){e.poll()||t?(e.pollingFast=!1,e.slowPoll()):(t=!0,e.polling.set(60,n))}e.pollingFast=!0,e.polling.set(20,n)},cl.prototype.poll=function(){var t=this,e=this.cm,n=this.textarea,r=this.prevInput;if(this.contextMenuPending||this.resetting||!e.state.focused||zt(n)&&!r&&!this.composing||e.isReadOnly()||e.options.disableInput||e.state.keySeq)return!1;var i=n.value;if(i==r&&!e.somethingSelected())return!1;if(a&&s>=9&&this.hasSelection===i||b&&/[\uf700-\uf7ff]/.test(i))return e.display.input.reset(),!1;if(e.doc.sel==e.display.selForContextMenu){var o=i.charCodeAt(0);if(8203!=o||r||(r="​"),8666==o)return this.reset(),this.cm.execCommand("undo")}for(var l=0,u=Math.min(r.length,i.length);l<u&&r.charCodeAt(l)==i.charCodeAt(l);)++l;return Ni(e,(function(){Ys(e,i.slice(l),r.length-l,null,t.composing?"*compose":null),i.length>1e3||i.indexOf("\n")>-1?n.value=t.prevInput="":t.prevInput=i,t.composing&&(t.composing.range.clear(),t.composing.range=e.markText(t.composing.start,e.getCursor("to"),{className:"CodeMirror-composing"}))})),!0},cl.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},cl.prototype.onKeyPress=function(){a&&s>=9&&(this.hasSelection=null),this.fastPoll()},cl.prototype.onContextMenu=function(t){var e=this,n=e.cm,r=n.display,i=e.textarea;e.contextMenuPending&&e.contextMenuPending();var o=zr(n,t),u=r.scroller.scrollTop;if(o&&!d){n.options.resetSelectionOnContextMenu&&-1==n.doc.sel.contains(o)&&Ii(n,$o)(n.doc,fo(o),Y);var c,h=i.style.cssText,f=e.wrapper.style.cssText,p=e.wrapper.offsetParent.getBoundingClientRect();if(e.wrapper.style.cssText="position: static",i.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(t.clientY-p.top-5)+"px; left: "+(t.clientX-p.left-5)+"px;\n      z-index: 1000; background: "+(a?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",l&&(c=i.ownerDocument.defaultView.scrollY),r.input.focus(),l&&i.ownerDocument.defaultView.scrollTo(null,c),r.input.reset(),n.somethingSelected()||(i.value=e.prevInput=" "),e.contextMenuPending=v,r.selForContextMenu=n.doc.sel,clearTimeout(r.detectingSelectAll),a&&s>=9&&m(),S){Ft(t);var g=function(){wt(window,"mouseup",g),setTimeout(v,20)};bt(window,"mouseup",g)}else setTimeout(v,50)}function m(){if(null!=i.selectionStart){var t=n.somethingSelected(),o="​"+(t?i.value:"");i.value="⇚",i.value=o,e.prevInput=t?"":"​",i.selectionStart=1,i.selectionEnd=o.length,r.selForContextMenu=n.doc.sel}}function v(){if(e.contextMenuPending==v&&(e.contextMenuPending=!1,e.wrapper.style.cssText=f,i.style.cssText=h,a&&s<9&&r.scrollbars.setScrollTop(r.scroller.scrollTop=u),null!=i.selectionStart)){(!a||a&&s<9)&&m();var t=0,o=function(){r.selForContextMenu==n.doc.sel&&0==i.selectionStart&&i.selectionEnd>0&&"​"==e.prevInput?Ii(n,ea)(n):t++<10?r.detectingSelectAll=setTimeout(o,500):(r.selForContextMenu=null,r.input.reset())};r.detectingSelectAll=setTimeout(o,200)}}},cl.prototype.readOnlyChanged=function(t){t||this.reset(),this.textarea.disabled="nocursor"==t,this.textarea.readOnly=!!t},cl.prototype.setUneditable=function(){},cl.prototype.needsContentAttribute=!1,js(Gs),tl(Gs);var fl="iter insert remove copy getEditor constructor".split(" ");for(var pl in Ta.prototype)Ta.prototype.hasOwnProperty(pl)&&U(fl,pl)<0&&(Gs.prototype[pl]=function(t){return function(){return t.apply(this.doc,arguments)}}(Ta.prototype[pl]));return Dt(Ta),Gs.inputStyles={textarea:cl,contenteditable:rl},Gs.defineMode=function(t){Gs.defaults.mode||"null"==t||(Gs.defaults.mode=t),Kt.apply(this,arguments)},Gs.defineMIME=$t,Gs.defineMode("null",(function(){return{token:function(t){return t.skipToEnd()}}})),Gs.defineMIME("text/plain","null"),Gs.defineExtension=function(t,e){Gs.prototype[t]=e},Gs.defineDocExtension=function(t,e){Ta.prototype[t]=e},Gs.fromTextArea=hl,dl(Gs),Gs.version="5.65.19",Gs}()},1983:(t,e,n)=>{var r,i;r=[n,e,n(4954)],i=function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;var r=function(){function t(){}return t.prototype.setAppFactory=function(t){this.appFactory=t},t.prototype.createAppBus=function(){var t=new n.AppBus,e=this.appFactory.getComponentsFactory();t.setComponentsFactory2(e);var r=this.appFactory.getStorageFactory();return t.setStorageFactory(r),t},t}();e.Factory=r}.apply(e,r),void 0===i||(t.exports=i)},2058:(t,e,n)=>{var r;r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AppComamnds=void 0;var n=function(){function t(){}return t.prototype.setBoardsStorage=function(t){this.boardsStorage=t},t.prototype.setNotesStorage=function(t){this.notesStorage=t},t.prototype.setNotesLinksStorage=function(t){this.notesLinksStorage=t},t.prototype.setTagsStorage=function(t){this.tagsStorage=t},t.prototype.setTagsLinksStorage=function(t){this.tagsLinksStorage=t},t.prototype.setLayersStorage=function(t){this.layersStorage=t},t.prototype.update=function(t){return this.boardsStorage.update(t).then((function(){return Promise.resolve(t)}))},t.prototype.deleteBoard=function(t){return this.boardsStorage.delete(t).then((function(){return Promise.resolve({success:!0,errors:[]})}))},t.prototype.createNote=function(t){return this.notesStorage.createNote(t).then((function(){return Promise.resolve({success:!0,errors:[],note:t})}))},t.prototype.updateNote=function(t){return this.notesStorage.updateNote(t).then((function(){return Promise.resolve({success:!0,errors:[],note:t})}))},t.prototype.getBoard=function(t){return this.boardsStorage.getById(t).then((function(t){return Promise.resolve({success:!0,errors:[],board:t[0]||null})}))},t.prototype.getNotes=function(t){return this.notesStorage.getNotes(t).then((function(t){return Promise.resolve({success:!0,errors:[],notes:t})}))},t.prototype.link=function(t,e,n,r){return this.notesLinksStorage.link(t,e,n,r).then((function(n){return Promise.resolve({success:!0,errors:[],link:{id:n,from:t,to:e}})}))},t.prototype.unlink=function(t,e,n){return this.notesLinksStorage.unlink(t,e,n).then((function(){return Promise.resolve({success:!0,errors:[]})}))},t.prototype.getLinks=function(t){return this.notesLinksStorage.getList(t).then((function(t){return Promise.resolve({success:!0,errors:[],links:t})}))},t.prototype.moveNode=function(t,e,n){return this.notesStorage.updateNote({id:t,x:e,y:n}).then((function(){return Promise.resolve({success:!0,errors:[]})}))},t.prototype.deleteNode=function(t){return this.notesStorage.deleteNode(t).then((function(){return Promise.resolve({success:!0,errors:[]})}))},t.prototype.createTag=function(t){return this.tagsStorage.createTag(t).then((function(){return Promise.resolve({success:!0,errors:[],tag:t})}))},t.prototype.updateTag=function(t){return this.tagsStorage.updateTag(t).then((function(){return Promise.resolve({success:!0,errors:[],tag:t})}))},t.prototype.getTags=function(){return this.tagsStorage.getTagsWithLinks().then((function(t){return Promise.resolve({success:!0,errors:[],tags:t})}))},t.prototype.moveTag=function(t,e,n){return this.tagsStorage.updateTag({id:t,x:e,y:n}).then((function(t){return Promise.resolve({success:!0,errors:[],tags:t})}))},t.prototype.linkTags=function(t,e){return this.tagsLinksStorage.link(t,e).then((function(n){return Promise.resolve({success:!0,errors:[],link:{id:n,from:t,to:e}})}))},t.prototype.unlinkTags=function(t,e){return this.tagsLinksStorage.unlink(t,e).then((function(){return Promise.resolve({success:!0,errors:[]})}))},t.prototype.getTagsLinks=function(){return this.tagsLinksStorage.getList().then((function(t){return Promise.resolve({success:!0,errors:[],links:t})}))},t.prototype.deleteTag=function(t){return this.tagsStorage.deleteTag(t).then((function(t){return Promise.resolve({success:!0,errors:[]})}))},t.prototype.getTagsWithLinks=function(){return this.tagsStorage.getTagsWithLinks().then((function(t){return Promise.resolve({success:!0,errors:[],tags:t})}))},t.prototype.createLayer=function(t,e){return this.layersStorage.create(t,e).then((function(t){return Promise.resolve({success:!0,errors:[],layer:{id:t,name:e}})}))},t.prototype.deleteLayer=function(t){return this.layersStorage.delete(t).then((function(t){return Promise.resolve({success:!0,errors:[]})}))},t.prototype.getLayers=function(t){return this.layersStorage.getList(t).then((function(t){return Promise.resolve({success:!0,errors:[],layers:t})}))},t}();e.AppComamnds=n}.apply(e,[n,e]),void 0===r||(t.exports=r)},2095:(t,e,n)=>{var r;r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TagsLinksStorage=void 0;var n=function(){function t(){}return t.prototype.setDb=function(t){this.db=t},t.prototype.getList=function(){return this.db.tagsLinks.toArray()},t.prototype.link=function(t,e){return this.db.tagsLinks.add({id:"link_"+this.getRandomString(32),from:t,to:e})},t.prototype.unlink=function(t,e){return this.db.tagsLinks.where("from").equals(t).and((function(t){return t.to==e})).delete()},t.prototype.getRandomString=function(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;r<t;r++)n+=e.charAt(Math.floor(62*Math.random()));return n},t.prototype.deleteFor=function(t){var e=this.db.tagsLinks;e.where("from").equals(t).delete(),(e=this.db.tagsLinks).where("to").equals(t).delete()},t}();e.TagsLinksStorage=n}.apply(e,[n,e]),void 0===r||(t.exports=r)},2347:(t,e,n)=>{var r;r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AppContainer=void 0;var n=function(){function t(){this.isTagsLoades=!1}return t.prototype.setMainMenu=function(t){this.mainMenu=t},t.prototype.getMainMenu=function(){return this.mainMenu},t.prototype.setCurrentBoard=function(t){var e=this;this.currentBoard=t,this.mainMenu.getLayersPanel().clear(),this.mainMenu.getLayersPanel().setCurrentBoard(t),this.pane.loadSettings(t),this.appCommands.getNotes(t.id).then((function(t){t.success&&(e.mainMenu.getNavigationPanel().clear(),e.pane.clear(),e.mainMenu.getNavigationPanel().loadNotes(t.notes),e.pane.loadNotes(t.notes))})),this.appCommands.getLinks(t.id).then((function(t){t.success&&e.pane.loadLinks(t.links)})),this.appCommands.getTagsWithLinks().then((function(t){t.success&&(e.tagsLinks=t.tags,e.mainMenu.getNavigationPanel().load(t.tags))}))},t.prototype.updateNavigatonPanel=function(){var t=this;this.appCommands.getNotes(this.currentBoard.id).then((function(e){e.success&&(t.mainMenu.getNavigationPanel().clear(),t.mainMenu.getNavigationPanel().loadNotes(e.notes))})),this.appCommands.getTagsWithLinks().then((function(e){e.success&&(t.tagsLinks=e.tags,t.mainMenu.getNavigationPanel().load(e.tags))}))},t.prototype.getTagsLinks=function(){return this.tagsLinks},t.prototype.setAppCommands=function(t){this.appCommands=t},t.prototype.setAppBus=function(t){this.appBus=t},t.prototype.setPane=function(t){this.pane=t},t.prototype.setTagsPane=function(t){this.tagsPane=t},t.prototype.init=function(t){var e=this;this.container=t,this.mainBtn=this.container.querySelector(".js-main-btn");var n=this.container.querySelector(".js-main-menu");this.mainMenu.init(n),this.mainBtn.onclick=function(){e.mainMenu.toggleOpen()};var r=this.container.querySelector(".js-notes");this.pane.init(r);this.container.querySelector(".js-tags")},t.prototype.updateNode=function(t){this.pane.getStorage().getById(t.id).load(t)},t.prototype.highlightForTagId=function(t){var e=this.extractBranchFromRoot(this.tagsLinks,t).map((function(t){return t.id})),n=this.pane.getStorage().getShapes();for(var r in n){var i=n[r],o=i.hasTags(e);i.higlight(o)}},t.prototype.highligtNote=function(t){var e=this.pane.getStorage().getShapes();for(var n in e){var r=e[n],i=r.getId()==t;if(r.higlight(i),i){var o=this.pane.getWidth(),a=this.pane.getHeight(),s=r.getCoordinates(),l=this.pane.getStage().scale(),u=o/2-s.x*l.x,c=a/2-s.y*l.y;this.pane.getStage().position({x:u-r.getWidth()*l.x/2,y:c-r.getHeight()*l.y/2})}}},t.prototype.highligtNodesByTags=function(t){var e=this.pane.getStorage().getShapes();for(var n in e){var r=e[n],i=r.hasTags(t);r.higlight(i)}},t.prototype.extractBranchFromRoot=function(t,e){var n=new Map,r=[];return t.forEach((function(t){return n.set(t.id,t)})),function t(e){var i=n.get(e);i&&!r.find((function(t){return t.id===e}))&&(r.push(i),i.links&&i.links.length>0&&i.links.forEach((function(e){return t(e.to)})))}(e),r},t.prototype.showTagsPanel=function(){var t=this;this.container.querySelector(".js-notes").classList.add("hide");var e=this.container.querySelector(".js-tags");e.classList.remove("hide"),this.tagsPane.init(e),this.isTagsLoades||this.appCommands.getTags().then((function(e){if(e.success)return t.tagsPane.loadNotes(e.tags),Promise.resolve()})).then((function(){return t.appCommands.getTagsLinks()})).then((function(e){e.success&&(t.tagsPane.getLinker().setCurrentLayerTag("*"),t.tagsPane.loadLinks(e.links),t.isTagsLoades=!0)}))},t.prototype.showNotesPanel=function(){this.container.querySelector(".js-notes").classList.remove("hide"),this.container.querySelector(".js-tags").classList.add("hide")},t}();e.AppContainer=n}.apply(e,[n,e]),void 0===r||(t.exports=r)},2401:(t,e,n)=>{var r;r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractShapesFactory=void 0;var n=function(){function t(){}return t.prototype.setStorageFactory=function(t){this.storageFactory=t},t}();e.AbstractShapesFactory=n}.apply(e,[n,e]),void 0===r||(t.exports=r)},2907:(t,e,n)=>{var r,i;r=[n,e,n(2347),n(5887),n(485),n(1269),n(8160),n(4996)],i=function(t,e,n,r,i,o,a,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;var l=function(){function t(){}return t.prototype.setAppFactory=function(t){this.appFactory=t},t.prototype.init=function(t){this.appContainer=new n.AppContainer;var e=this.createMainMenu();this.appContainer.setMainMenu(e);var r=this.appFactory.getCommandsFactory().getAppCommands();this.appContainer.setAppCommands(r);var i=this.appFactory.getCanvasFactory().getBusFactory().getAppBus();this.appContainer.setAppBus(i);var o=this.appFactory.getCanvasFactory().getComponentsFactory().getPane();this.appContainer.setPane(o);var a=this.appFactory.getTagsCanvasFactory().getComponentsFactory().getPane();this.appContainer.setTagsPane(a),this.appContainer.init(t)},t.prototype.getAppContainer=function(){return this.appContainer},t.prototype.createMainMenu=function(){var t=new r.MainMenu,e=this.createNavigationPanel();t.setNavigationPanel(e);var n=this.createLayersPanel();t.setLayersPanel(n);var i=this.createBoardsPanel();t.setBoardsPanel(i);var o=this.appFactory.getCanvasFactory().getBusFactory().getAppBus();t.setAppBus(o);var a=this.appFactory.getStorageFactory().getBoardsStorage();return t.setBoardsStorage(a),t},t.prototype.createNavigationPanel=function(){var t=new i.NavigationPanel,e=this.appFactory.getCanvasFactory().getBusFactory().getAppBus();return t.setAppBus(e),t},t.prototype.createLayersPanel=function(){var t=new o.LayersPanel,e=this.appFactory.getCommandsFactory().getAppCommands();t.setAppCommands(e);var n=this.appFactory.getCanvasFactory().getBusFactory().getAppBus();return t.setAppBus(n),t},t.prototype.createBoardsPanel=function(){var t=new s.BoardsPanel,e=this.appFactory.getStorageFactory().getBoardsStorage();t.setBoardsStorage(e);var n=this.appFactory.getCanvasFactory().getBusFactory().getAppBus();t.setAppBus(n);var r=this.appFactory.getCommandsFactory().getAppCommands();return t.setAppCommands(r),t},t.prototype.getNodeModal=function(){if(this.nodeModal)return this.nodeModal;this.nodeModal=new a.NodeModal;var t=this.appFactory.getCommandsFactory().getAppCommands();this.nodeModal.setAppCommands(t);var e=this.appFactory.getCanvasFactory().getBusFactory().getAppBus();this.nodeModal.setAppBus(e);var n=document.querySelector(".js-node-modal");return this.nodeModal.init(n),this.nodeModal},t}();e.Factory=l}.apply(e,r),void 0===i||(t.exports=i)},3197:(t,e,n)=>{var r;r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AppBus=void 0;var n=function(){function t(){}return t.prototype.setComponentsFactory=function(t){this.componentsFactory=t},t.prototype.onMoveShape=function(t){this.componentsFactory.getPane().getLinker().drawLinesFor(t)},t.prototype.moveToTop=function(t){this.componentsFactory.getPane().getStorage().moveToTop(t)},t.prototype.remove=function(t){this.componentsFactory.getPane().getStorage().remove(t),t.remove(),this.componentsFactory.getPane().getLinker().removeFor(t)},t.prototype.addShape=function(t,e){var n=this.componentsFactory.getAppFactory().getStorageFactory().getAbstractShapesFactory().createShape(t);n.init(e),n.load(e);var r=this.componentsFactory.getPane().getLayer();n.addToLayer(r),this.componentsFactory.getPane().getStorage().pushShape(n)},t.prototype.link=function(t,e){var n=this.componentsFactory.getAppFactory().getStorageFactory().getStorage(),r=n.getById(t),i=n.getById(e);this.componentsFactory.getPane().getLinker().linkShapes(r,i),this.componentsFactory.getPane().getLinker().drawLines()},t.prototype.unlink=function(t,e){this.componentsFactory.getPane().getLinker().unlinkShapes(t,e)},t}();e.AppBus=n}.apply(e,[n,e]),void 0===r||(t.exports=r)},3314:(t,e,n)=>{var r;r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Storage=void 0;var n=function(){function t(){this.shapes={}}return t.prototype.pushShape=function(t){this.shapes[t.getId()]=t},t.prototype.moveToTop=function(t){for(var e in this.shapes)if(e==t.getId()){t.moveToTop();break}},t.prototype.remove=function(t){delete this.shapes[t.getId()]},t.prototype.getByCoords=function(t){for(var e in this.shapes)if(this.shapes[e].isThis(t))return this.shapes[e];return null},t.prototype.getById=function(t){return this.shapes[t]},t.prototype.getShapes=function(){return this.shapes},t.prototype.clear=function(){this.shapes={}},t}();e.Storage=n}.apply(e,[n,e]),void 0===r||(t.exports=r)},3366:(t,e,n)=>{!function(t){"use strict";t.overlayMode=function(e,n,r){return{startState:function(){return{base:t.startState(e),overlay:t.startState(n),basePos:0,baseCur:null,overlayPos:0,overlayCur:null,streamSeen:null}},copyState:function(r){return{base:t.copyState(e,r.base),overlay:t.copyState(n,r.overlay),basePos:r.basePos,baseCur:null,overlayPos:r.overlayPos,overlayCur:null}},token:function(t,i){return(t!=i.streamSeen||Math.min(i.basePos,i.overlayPos)<t.start)&&(i.streamSeen=t,i.basePos=i.overlayPos=t.start),t.start==i.basePos&&(i.baseCur=e.token(t,i.base),i.basePos=t.pos),t.start==i.overlayPos&&(t.pos=t.start,i.overlayCur=n.token(t,i.overlay),i.overlayPos=t.pos),t.pos=Math.min(i.basePos,i.overlayPos),null==i.overlayCur?i.baseCur:null!=i.baseCur&&i.overlay.combineTokens||r&&null==i.overlay.combineTokens?i.baseCur+" "+i.overlayCur:i.overlayCur},indent:e.indent&&function(t,n,r){return e.indent(t.base,n,r)},electricChars:e.electricChars,innerMode:function(t){return{state:t.base,mode:e}},blankLine:function(t){var i,o;return e.blankLine&&(i=e.blankLine(t.base)),n.blankLine&&(o=n.blankLine(t.overlay)),null==o?i:r&&null!=i?i+" "+o:o}}}}(n(1719))},3533:(t,e,n)=>{"use strict";var r=n(8549);function i(t){"function"==typeof(t=t||{}).codeMirrorInstance&&"function"==typeof t.codeMirrorInstance.defineMode?(String.prototype.includes||(String.prototype.includes=function(){return-1!==String.prototype.indexOf.apply(this,arguments)}),t.codeMirrorInstance.defineMode("spell-checker",(function(e){if(!i.aff_loading){i.aff_loading=!0;var n=new XMLHttpRequest;n.open("GET","https://cdn.jsdelivr.net/codemirror.spell-checker/latest/en_US.aff",!0),n.onload=function(){4===n.readyState&&200===n.status&&(i.aff_data=n.responseText,i.num_loaded++,2==i.num_loaded&&(i.typo=new r("en_US",i.aff_data,i.dic_data,{platform:"any"})))},n.send(null)}if(!i.dic_loading){i.dic_loading=!0;var o=new XMLHttpRequest;o.open("GET","https://cdn.jsdelivr.net/codemirror.spell-checker/latest/en_US.dic",!0),o.onload=function(){4===o.readyState&&200===o.status&&(i.dic_data=o.responseText,i.num_loaded++,2==i.num_loaded&&(i.typo=new r("en_US",i.aff_data,i.dic_data,{platform:"any"})))},o.send(null)}var a='!"#$%&()*+,-./:;<=>?@[\\]^_`{|}~ ',s={token:function(t){var e=t.peek(),n="";if(a.includes(e))return t.next(),null;for(;null!=(e=t.peek())&&!a.includes(e);)n+=e,t.next();return i.typo&&!i.typo.check(n)?"spell-error":null}},l=t.codeMirrorInstance.getMode(e,e.backdrop||"text/plain");return t.codeMirrorInstance.overlayMode(l,s,!0)}))):console.log("CodeMirror Spell Checker: You must provide an instance of CodeMirror via the option `codeMirrorInstance`")}i.num_loaded=0,i.aff_loading=!1,i.dic_loading=!1,i.aff_data="",i.dic_data="",i.typo,t.exports=i},3880:(t,e,n)=>{var r,i;r=[n,e,n(4143),n(5532),n(9825),n(1453),n(6410),n(2095),n(916)],i=function(t,e,n,r,i,o,a,s,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;var u=function(){function t(){this.isInited=!1}return t.prototype.setAppFactory=function(t){this.appFactory=t},t.prototype.init=function(){var t=this;this.db=new n.Dexie("boards"),this.db.version(1).stores({boards:"id,title,scale,x,y",layers:"id,boardId,name",notesLinks:"id,boardId,layerId,from,to",notes:"id,boardId,x,y,preview,content,isCrypted,tags,createdAt,updatedAt",tagsLinks:"id,from,to",tags:"id,x,y,title"}),this.db.open().then((function(){t.isInited=!0}))},t.prototype.getBoardsStorage=function(){if(this.boardsStorage)return this.boardsStorage;this.boardsStorage=new r.BoardsStorage,this.boardsStorage.setDb(this.db);var t=this.getLayersStorage();this.boardsStorage.setLayersStorage(t);var e=this.getNotesLinksStorage();this.boardsStorage.setNotesLinksStorage(e);var n=this.getNotesStorage();return this.boardsStorage.setNotesStorage(n),this.boardsStorage},t.prototype.getLayersStorage=function(){if(this.layersStorage)return this.layersStorage;this.layersStorage=new i.LayersStorage,this.layersStorage.setDb(this.db);var t=this.getNotesLinksStorage();return this.layersStorage.setNotesLinksStorage(t),this.layersStorage},t.prototype.getNotesLinksStorage=function(){return this.notesLinksStorage||(this.notesLinksStorage=new o.NotesLinksStorage,this.notesLinksStorage.setDb(this.db)),this.notesLinksStorage},t.prototype.getNotesStorage=function(){if(this.notesStorage)return this.notesStorage;this.notesStorage=new a.NotesStorage,this.notesStorage.setDb(this.db);var t=this.getNotesLinksStorage();return this.notesStorage.setNotesLinksStorage(t),this.notesStorage},t.prototype.getTagsLinksStorage=function(){return this.tagsLinksStorage||(this.tagsLinksStorage=new s.TagsLinksStorage,this.tagsLinksStorage.setDb(this.db)),this.tagsLinksStorage},t.prototype.getTagsStorage=function(){if(this.tagsStorage)return this.tagsStorage;this.tagsStorage=new l.TagsStorage,this.tagsStorage.setDb(this.db);var t=this.getTagsLinksStorage();return this.tagsStorage.setTagsLinksStorage(t),this.tagsStorage},t}();e.Factory=u}.apply(e,r),void 0===i||(t.exports=i)},3904:(t,e,n)=>{var r=n(1719);r.commands.tabAndIndentMarkdownList=function(t){var e=t.listSelections()[0].head;if(!1!==t.getStateAfter(e.line).list)t.execCommand("indentMore");else if(t.options.indentWithTabs)t.execCommand("insertTab");else{var n=Array(t.options.tabSize+1).join(" ");t.replaceSelection(n)}},r.commands.shiftTabAndUnindentMarkdownList=function(t){var e=t.listSelections()[0].head;if(!1!==t.getStateAfter(e.line).list)t.execCommand("indentLess");else if(t.options.indentWithTabs)t.execCommand("insertTab");else{var n=Array(t.options.tabSize+1).join(" ");t.replaceSelection(n)}}},4143:(t,e,n)=>{"use strict";n.r(e),n.d(e,{Dexie:()=>o,Entity:()=>h,PropModification:()=>d,RangeSet:()=>u,add:()=>p,cmp:()=>c,default:()=>m,liveQuery:()=>a,mergeRanges:()=>s,rangesOverlap:()=>l,remove:()=>g,replacePrefix:()=>f});var r=n(7966);const i=Symbol.for("Dexie"),o=globalThis[i]||(globalThis[i]=r);if(r.semVer!==o.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${r.semVer} and ${o.semVer}`);const{liveQuery:a,mergeRanges:s,rangesOverlap:l,RangeSet:u,cmp:c,Entity:h,PropModification:d,replacePrefix:f,add:p,remove:g}=o,m=o},4163:function(t,e,n){var r,i,o,a=this&&this.__extends||(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},l=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))};r=[n,e,n(7280),n(7159)],i=function(t,e,n,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Tag=void 0;var i=function(t){function e(){var e=t.apply(this,l([],s(arguments),!1))||this;return e.width=200,e.height=40,e}return a(e,t),e.prototype.setAppBus=function(t){this.bus=t},e.prototype.getWidth=function(){return this.width},e.prototype.getHeight=function(){return this.height},e.prototype.getId=function(){return this.id},e.prototype.setAppCommands=function(t){this.appCommands=t},e.prototype.init=function(t){var e=this;this.coordinates=t,this.group=new r.default.Group({x:this.coordinates.x,y:this.coordinates.y,draggable:!0}),this.rect=new r.default.Rect({x:0,y:0,width:this.width,height:this.height,fill:"white",stroke:"black",strokeWidth:4,shadowColor:"black",shadowOpacity:.5,cornerRadius:10}),this.group.add(this.rect),this.text=new r.default.Text({x:10,y:10,text:"",fontSize:22,fontFamily:"RobotoMono"}),this.group.add(this.text),this.group.on("mouseenter",(function(){e.layer.getStage().container().style.cursor="pointer",e.rect.shadowBlur(10),e.rect.shadowOffset({x:5,y:5})})),this.group.on("mouseleave",(function(){e.layer.getStage().container().style.cursor="default",e.rect.shadowBlur(0),e.rect.shadowOffset({x:0,y:0})})),this.group.on("dragstart",(function(){e.layer.getStage().container().style.cursor="move"})),this.group.on("dragmove",(function(t){e.coordinates={x:t.target.attrs.x,y:t.target.attrs.y},e.bus.onMoveShape(e)})),this.group.on("dragend",(function(){e.layer.getStage().container().style.cursor="pointer",e.appCommands.moveTag(e.id,e.coordinates.x,e.coordinates.y)}))},e.prototype.splitLongWords=function(t){for(var e=[],n=0;n<t.length;n++)if(t[n].trim().length>16){var r=0,i="",o=[];do{var a=t[n].trim().slice(16*r,16*(r+1));i=a,a&&o.push(a),r++}while(i);e=e.concat(o)}else e.push(t[n].trim());return e},e.prototype.getLines=function(t){if(!t)return[];var e=t.split(" ");if(0==(e=e.filter((function(t){return t}))).length)return[];e=this.splitLongWords(e);for(var n=[],r="",i=0;i<e.length;i++)28!=e[i].trim().length?(r+" "+e[i].trim()).length>28?(n.push(r.trim()),r=e[i].trim()):r+=" "+e[i].trim():(r&&(n.push(r),r=""),n.push(e[i].trim()));return n.push(r.trim()),n},e.prototype.load=function(t){this.id=t.id,this.data=t,this.text.setText(this.data.title)},e.prototype.getData=function(){return this.data},e.prototype.moveToTop=function(){this.group.moveToTop()},e.prototype.isThis=function(t){return this.coordinates.x<t.x&&this.coordinates.y<t.y&&this.coordinates.x+this.width>t.x&&this.coordinates.y+this.height>t.y},e.prototype.remove=function(){this.group.remove()},e.prototype.addToLayer=function(t){this.layer=t,this.group.remove(),this.layer.add(this.group),this.group.draw()},e}(n.AbstractShape);e.Tag=i}.apply(e,r),void 0===i||(t.exports=i)},4235:(t,e,n)=>{var r;r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Linker=void 0;var n=function(){function t(){this.lines={},this.fromShapes={},this.toShapes={},this.visibleLayers=[]}return t.prototype.setLineCreator=function(t){this.lineCreator=t},t.prototype.setLinesLayer=function(t){this.linesLayer=t},t.prototype.setCurrentLayerTag=function(t){this.currentLayerTag=t},t.prototype.setVisibleLayers=function(t){this.visibleLayers=t},t.prototype.linkShapes=function(t,e,n){if(t.getId()!=e.getId()){var r=this.lineCreator();r.setFromShape(t),r.setToShape(e),r.setLayerTag(n||this.currentLayerTag),this.lines[r.getId()]=r}},t.prototype.unlinkShapes=function(t,e){for(var n in this.lines)this.lines[n].getFromShape().getId()==t.getId()&&this.lines[n].getToShape().getId()==e.getId()&&this.lines[n].getLayerTag()==this.currentLayerTag&&(this.lines[n].remove(),delete this.lines[n])},t.prototype.removeFor=function(t){for(var e in this.lines)this.lines[e].getFromShape().getId()!=t.getId()&&this.lines[e].getToShape().getId()!=t.getId()||(this.lines[e].remove(),delete this.lines[e])},t.prototype.highlightFor=function(t){for(var e in this.lines)this.lines[e].setHighlight(!1),(this.lines[e].getFromShape().getId()==t.getId()||this.lines[e].getToShape().getId()==t.getId()&&this.lines[e].getLayerTag()==this.currentLayerTag)&&this.lines[e].setHighlight(!0)},t.prototype.removeFrom=function(t){for(var e in this.lines)this.lines[e].getFromShape().getId()==t.getId()&&(this.lines[e].remove(),delete this.lines[e])},t.prototype.isLinked=function(t,e){for(var n in this.lines)if(this.lines[n].getFromShape().getId()==t.getId()&&this.lines[n].getToShape().getId()==e.getId()&&this.lines[n].getLayerTag()==this.currentLayerTag||this.lines[n].getFromShape().getId()==e.getId()&&this.lines[n].getToShape().getId()==t.getId()&&this.lines[n].getLayerTag()==this.currentLayerTag)return!0;return!1},t.prototype.drawLines=function(){for(var t in this.lines)this.isLineVisible(this.lines[t])?this.lines[t].draw(this.linesLayer):this.lines[t].remove()},t.prototype.isLineVisible=function(t){var e=t.getLayerTag();return-1!=this.visibleLayers.indexOf(e)||"*"==e},t.prototype.drawLinesFor=function(t){for(var e in this.lines){var n=this.isLineVisible(this.lines[e]);(this.lines[e].getFromShape().getId()==t.getId()&&n||this.lines[e].getToShape().getId()==t.getId()&&n)&&this.lines[e].draw(this.linesLayer)}},t.prototype.clear=function(){for(var t in this.lines)this.lines[t].remove();this.lines={}},t}();e.Linker=n}.apply(e,[n,e]),void 0===r||(t.exports=r)},4570:(t,e,n)=>{!function(t){"use strict";var e=/^((?:(?:aaas?|about|acap|adiumxtra|af[ps]|aim|apt|attachment|aw|beshare|bitcoin|bolo|callto|cap|chrome(?:-extension)?|cid|coap|com-eventbrite-attendee|content|crid|cvs|data|dav|dict|dlna-(?:playcontainer|playsingle)|dns|doi|dtn|dvb|ed2k|facetime|feed|file|finger|fish|ftp|geo|gg|git|gizmoproject|go|gopher|gtalk|h323|hcp|https?|iax|icap|icon|im|imap|info|ipn|ipp|irc[6s]?|iris(?:\.beep|\.lwz|\.xpc|\.xpcs)?|itms|jar|javascript|jms|keyparc|lastfm|ldaps?|magnet|mailto|maps|market|message|mid|mms|ms-help|msnim|msrps?|mtqp|mumble|mupdate|mvn|news|nfs|nih?|nntp|notes|oid|opaquelocktoken|palm|paparazzi|platform|pop|pres|proxy|psyc|query|res(?:ource)?|rmi|rsync|rtmp|rtsp|secondlife|service|session|sftp|sgn|shttp|sieve|sips?|skype|sm[bs]|snmp|soap\.beeps?|soldat|spotify|ssh|steam|svn|tag|teamspeak|tel(?:net)?|tftp|things|thismessage|tip|tn3270|tv|udp|unreal|urn|ut2004|vemmi|ventrilo|view-source|webcal|wss?|wtai|wyciwyg|xcon(?:-userid)?|xfire|xmlrpc\.beeps?|xmpp|xri|ymsgr|z39\.50[rs]?):(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]|\([^\s()<>]*\))+(?:\([^\s()<>]*\)|[^\s`*!()\[\]{};:'".,<>?«»“”‘’]))/i;t.defineMode("gfm",(function(n,r){var i=0;function o(t){return t.code=!1,null}var a={startState:function(){return{code:!1,codeBlock:!1,ateSpace:!1}},copyState:function(t){return{code:t.code,codeBlock:t.codeBlock,ateSpace:t.ateSpace}},token:function(t,n){if(n.combineTokens=null,n.codeBlock)return t.match(/^```+/)?(n.codeBlock=!1,null):(t.skipToEnd(),null);if(t.sol()&&(n.code=!1),t.sol()&&t.match(/^```+/))return t.skipToEnd(),n.codeBlock=!0,null;if("`"===t.peek()){t.next();var o=t.pos;t.eatWhile("`");var a=1+t.pos-o;return n.code?a===i&&(n.code=!1):(i=a,n.code=!0),null}if(n.code)return t.next(),null;if(t.eatSpace())return n.ateSpace=!0,null;if((t.sol()||n.ateSpace)&&(n.ateSpace=!1,!1!==r.gitHubSpice)){if(t.match(/^(?:[a-zA-Z0-9\-_]+\/)?(?:[a-zA-Z0-9\-_]+@)?(?=.{0,6}\d)(?:[a-f0-9]{7,40}\b)/))return n.combineTokens=!0,"link";if(t.match(/^(?:[a-zA-Z0-9\-_]+\/)?(?:[a-zA-Z0-9\-_]+)?#[0-9]+\b/))return n.combineTokens=!0,"link"}return t.match(e)&&"]("!=t.string.slice(t.start-2,t.start)&&(0==t.start||/\W/.test(t.string.charAt(t.start-1)))?(n.combineTokens=!0,"link"):(t.next(),null)},blankLine:o},s={taskLists:!0,strikethrough:!0,emoji:!0};for(var l in r)s[l]=r[l];return s.name="markdown",t.overlayMode(t.getMode(n,s),a)}),"markdown"),t.defineMIME("text/x-gfm","gfm")}(n(1719),n(6158),n(3366))},4954:function(t,e,n){var r,i,o,a=this&&this.__extends||(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});r=[n,e,n(3197)],i=function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AppBus=void 0;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.setComponentsFactory2=function(t){this.componentsFactory2=t},e.prototype.setStorageFactory=function(t){this.storageFactory=t},e.prototype.onNodeClick=function(t){},e.prototype.onNodeUpdate=function(t){this.componentsFactory2.getAppContainer().updateNode(t)},e.prototype.execNodeModal=function(t){var e=this.componentsFactory2.getNodeModal(),n=this.componentsFactory2.getAppContainer().getTagsLinks();e.setTagsLinks(n),e.show(t)},e.prototype.highligtForTag=function(t){this.componentsFactory2.getAppContainer().highlightForTagId(t)},e.prototype.highligtNote=function(t){this.componentsFactory2.getAppContainer().highligtNote(t)},e.prototype.setCurrentLayer=function(t){this.componentsFactory.getPane().setCurrentLayerTag(t)},e.prototype.setVisibleLayers=function(t){var e=this.componentsFactory.getPane().getLinker();e.setVisibleLayers(t),e.drawLines()},e.prototype.setCurrentBoard=function(t){this.componentsFactory2.getAppContainer().setCurrentBoard(t)},e.prototype.export=function(){this.storageFactory.getBoardsStorage().export()},e.prototype.import=function(t){this.storageFactory.getBoardsStorage().import(t)},e.prototype.showTagsPanel=function(){this.componentsFactory2.getAppContainer().showTagsPanel()},e.prototype.showNotesPanel=function(){this.componentsFactory2.getAppContainer().showNotesPanel()},e.prototype.updateNavigatonPanel=function(){this.componentsFactory2.getAppContainer().updateNavigatonPanel()},e.prototype.toggleMenu=function(t){this.componentsFactory2.getAppContainer().getMainMenu().toggleOpen(t)},e}(n.AppBus);e.AppBus=r}.apply(e,r),void 0===i||(t.exports=i)},4996:function(t,e,n){var r,i=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BoardsPanel=void 0;var n=function(){function t(){this.items=[]}return t.prototype.setBoardsStorage=function(t){this.boardsStorage=t},t.prototype.setAppBus=function(t){this.appBus=t},t.prototype.setAppCommands=function(t){this.appCommands=t},t.prototype.init=function(t){var e=this;this.container=t,this.content=this.container.querySelector(".js-content"),this.createBtn=this.container.querySelector(".js-create-button"),this.createBtn.onclick=function(){var t=prompt("Title");if(t){var n={id:"board_"+e.getRandomString(32),title:t,scale:1,x:0,y:0};e.boardsStorage.add(n);var r=e.createItem();r.load(n),e.content.append(r.getTemplate()),r.eventsListen(),r.setOnClick((function(t){var n,r;e.appBus.setCurrentBoard(t.getData());try{for(var o=i(e.items),a=o.next();!a.done;a=o.next()){a.value.setActive(!1)}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}t.setActive(!0)})),r.setOnDeleted((function(t){for(var n in e.items)if(e.items[n].getData().id==t.getData().id){e.items[n].getTemplate().remove(),delete e.items[n];break}})),e.items.push(r)}},this.items=[],this.boardsStorage.getList().then((function(t){var n,r;try{for(var o=i(t),a=o.next();!a.done;a=o.next()){var s=a.value,l=e.createItem();l.load(s),e.content.append(l.getTemplate()),l.eventsListen(),l.setOnClick((function(t){e.appCommands.getBoard(t.getData().id).then((function(n){var r,o;e.appBus.setCurrentBoard(n.board);try{for(var a=(r=void 0,i(e.items)),s=a.next();!s.done;s=a.next()){s.value.setActive(!1)}}catch(t){r={error:t}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}t.setActive(!0)}))})),l.setOnDeleted((function(t){for(var n in e.items)if(e.items[n].getData().id==t.getData().id){e.items[n].getTemplate().remove(),delete e.items[n];break}})),e.items.push(l)}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}))},t.prototype.getRandomString=function(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;r<t;r++)n+=e.charAt(Math.floor(62*Math.random()));return n},t.prototype.createItem=function(){var t=new r;return t.setAppCommands(this.appCommands),t},t}();e.BoardsPanel=n;var r=function(){function t(){this.html='\n        <div class="board-item" style="display: flex;">\n            <div class="board-title"></div>\n            <div class="board-delete-btn" style="margin-left: 10px;">×</div>\n        </div>\n    ',this.template=document.createElement("div"),this.template.innerHTML=this.html.trim(),this.template=this.template.firstChild,this.title=this.template.querySelector(".board-title"),this.deleteBtn=this.template.querySelector(".board-delete-btn")}return t.prototype.setOnClick=function(t){this.onClick=t},t.prototype.setOnDeleted=function(t){this.onDeleted=t},t.prototype.getTemplate=function(){return this.template},t.prototype.getData=function(){return this.data},t.prototype.setAppCommands=function(t){this.appCommands=t},t.prototype.load=function(t){this.data=t,this.title.innerText=t.title},t.prototype.eventsListen=function(){var t=this;this.template.onclick=function(){t.onClick(t)},this.deleteBtn.onclick=function(e){confirm("Delete Board?")&&(e.stopPropagation(),t.appCommands.deleteBoard(t.data.id),t.onDeleted(t))}},t.prototype.setActive=function(t){t?this.template.style.fontWeight="bold":this.template.style.removeProperty("font-weight")},t}()}.apply(e,[n,e]),void 0===r||(t.exports=r)},5002:(t,e,n)=>{var r,i;r=[n,e,n(2907),n(8131),n(5637),n(1713),n(1983),n(7235),n(7018),n(3880)],i=function(t,e,n,r,i,o,a,s,l,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;var c=function(){function t(){this.canvasFactory=null,this.tagsCanvasFactory=null,this.storageFactory=null}return t.prototype.getComponentsFactory=function(){return this.componentsFactory||(this.componentsFactory=new n.Factory,this.componentsFactory.setAppFactory(this)),this.componentsFactory},t.prototype.getCommandsFactory=function(){return this.commandsFactory||(this.commandsFactory=new o.Factory,this.commandsFactory.setAppFactory(this)),this.commandsFactory},t.prototype.getBusFactory=function(){return this.busFactory||(this.busFactory=new a.Factory,this.busFactory.setAppFactory(this)),this.busFactory},t.prototype.init=function(t){this.canvasFactory=new r.Factory;var e=new i.Factory;e.setTreeFcatory(this.canvasFactory),e.setAppFactory(this);var n=new s.Pane,o=this.getCommandsFactory().getAppCommands();n.setAppCommands(o);var a={components:{pane:n},storage:{shapesFactory:e},bus:{appBus:this.getBusFactory().createAppBus()}};this.canvasFactory.init(a),this.tagsCanvasFactory=new r.Factory,(e=new i.Factory).setTreeFcatory(this.tagsCanvasFactory),e.setAppFactory(this);var u=new l.TagsPane;u.setAppCommands(o);var c={components:{pane:u},storage:{shapesFactory:e},bus:{appBus:this.getBusFactory().createAppBus()}};this.tagsCanvasFactory.init(c),this.getComponentsFactory().init(t)},t.prototype.getCanvasFactory=function(){return this.canvasFactory},t.prototype.getTagsCanvasFactory=function(){return this.tagsCanvasFactory},t.prototype.getStorageFactory=function(){return this.storageFactory||(this.storageFactory=new u.Factory,this.storageFactory.setAppFactory(this),this.storageFactory.init()),this.storageFactory},t}();e.Factory=c}.apply(e,r),void 0===i||(t.exports=i)},5039:(t,e,n)=>{!function(t){"use strict";function e(e,r){function i(){e.display.wrapper.offsetHeight?(n(e,r),e.display.lastWrapHeight!=e.display.wrapper.clientHeight&&e.refresh()):r.timeout=setTimeout(i,r.delay)}r.timeout=setTimeout(i,r.delay),r.hurry=function(){clearTimeout(r.timeout),r.timeout=setTimeout(i,50)},t.on(window,"mouseup",r.hurry),t.on(window,"keyup",r.hurry)}function n(e,n){clearTimeout(n.timeout),t.off(window,"mouseup",n.hurry),t.off(window,"keyup",n.hurry)}t.defineOption("autoRefresh",!1,(function(t,r){t.state.autoRefresh&&(n(t,t.state.autoRefresh),t.state.autoRefresh=null),r&&0==t.display.wrapper.offsetHeight&&e(t,t.state.autoRefresh={delay:r.delay||250})}))}(n(1719))},5298:(t,e,n)=>{var r,i;r=[n,e,n(3197)],i=function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;var r=function(){function t(){this.appBus=null}return t.prototype.init=function(t){this.conf={appBus:null},this.appFactory.objectReplaceRecursive(this.conf,t)},t.prototype.setAppFactory=function(t){this.appFactory=t},t.prototype.getAppBus=function(){if(null===this.appBus){this.appBus=this.conf.appBus||new n.AppBus;var t=this.appFactory.getComponentsFactory();this.appBus.setComponentsFactory(t)}return this.appBus},t}();e.Factory=r}.apply(e,r),void 0===i||(t.exports=i)},5532:function(t,e,n){var r,i,o=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};r=[n,e,n(9764)],i=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BoardsStorage=void 0;var n=function(){function t(){}return t.prototype.setDb=function(t){this.db=t},t.prototype.setLayersStorage=function(t){this.layersStorage=t},t.prototype.setNotesLinksStorage=function(t){this.notesLinksStorage=t},t.prototype.setNotesStorage=function(t){this.notesStorage=t},t.prototype.add=function(t){this.db.boards.add(t)},t.prototype.getById=function(t){return this.db.boards.where("id").equals(t).toArray()},t.prototype.getList=function(){return this.db.boards.toArray()},t.prototype.update=function(t){return this.db.boards.update(t.id,t)},t.prototype.export=function(){this.db.export().then((function(t){var e=URL.createObjectURL(t),n=document.createElement("a");n.href=e,n.download="database-export.json",document.body.appendChild(n),n.click(),document.body.removeChild(n)}))},t.prototype.import=function(t){var e=this,n=new FileReader;n.onload=function(t){var n,r;try{var i=JSON.parse(t.target.result).data.data;console.log(i);try{for(var a=o(i),s=a.next();!s.done;s=a.next()){var l=s.value,u=l.tableName;if("notes"!=u)e.db[u].bulkAdd(l.rows);else for(var c in l.rows){var h=l.rows[c];delete h.$types,e.db[u].add({id:h.id}),e.db[u].update(h.id,h)}}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}catch(t){console.error("Некорректный формат файла:",t)}},n.readAsText(t)},t.prototype.delete=function(t){return this.layersStorage.deleteForBoard(t),this.notesLinksStorage.deleteForBoard(t),this.notesStorage.deleteForBoard(t),this.db.boards.where("id").equals(t).delete()},t}();e.BoardsStorage=n}.apply(e,r),void 0===i||(t.exports=i)},5637:function(t,e,n){var r,i,o,a=this&&this.__extends||(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});r=[n,e,n(2401),n(6378),n(4163)],i=function(t,e,n,r,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.setTreeFcatory=function(t){this.treeFactory=t},e.prototype.setAppFactory=function(t){this.appFactory=t},e.prototype.createShape=function(t){if(1==t){var e=new r.Rectangle,n=this.treeFactory.getBusFactory().getAppBus();e.setAppBus(n);var o=this.appFactory.getCommandsFactory().getAppCommands();return e.setAppCommands(o),e}if(2==t){e=new i.Tag,n=this.treeFactory.getBusFactory().getAppBus();e.setAppBus(n);o=this.appFactory.getCommandsFactory().getAppCommands();return e.setAppCommands(o),e}},e}(n.AbstractShapesFactory);e.Factory=o}.apply(e,r),void 0===i||(t.exports=i)},5887:(t,e,n)=>{var r;r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MainMenu=void 0;var n=function(){function t(){}return t.prototype.getSubItemContainer=function(){return this.subitem},t.prototype.init=function(t){var e=this;this.container=t,this.subitem=this.container.querySelector(".js-subitem"),this.container.onclick=function(t){t.stopPropagation(),e.subitem.style.maxHeight?e.subitem.style.maxHeight=null:e.subitem.style.maxHeight="100vh"},this.subitem&&(this.subitem.onclick=function(t){t.stopPropagation()})},t}(),r=function(){function t(){}return t.prototype.setNavigationPanel=function(t){this.navigationPanel=t},t.prototype.getNavigationPanel=function(){return this.navigationPanel},t.prototype.setLayersPanel=function(t){this.layersPanel=t},t.prototype.getLayersPanel=function(){return this.layersPanel},t.prototype.setBoardsPanel=function(t){this.boardsPanel=t},t.prototype.getBoardsPanel=function(){return this.boardsPanel},t.prototype.setAppBus=function(t){this.appBus=t},t.prototype.setBoardsStorage=function(t){this.boardsStorage=t},t.prototype.init=function(t){var e=this;this.container=t,this.container.querySelectorAll(".js-item").forEach((function(t){e.createItem().init(t)}));var n=this.container.querySelector(".js-navigation-panel");this.navigationPanel.init(n);var r=this.container.querySelector(".js-layers-panel");this.layersPanel.init(r);var i=this.container.querySelector(".js-boards-panel");this.boardsPanel.init(i),this.notesBtn=this.container.querySelector(".js-notes-btn"),this.notesBtn.onclick=function(t){t.stopPropagation(),e.appBus.showNotesPanel(),window.innerWidth<500&&e.toggleOpen(!1)},this.tagsBtn=this.container.querySelector(".js-tags-btn"),this.tagsBtn.onclick=function(t){t.stopPropagation(),e.appBus.showTagsPanel(),window.innerWidth<500&&e.toggleOpen(!1)},this.exportBtn=this.container.querySelector(".js-export-btn"),this.exportBtn.onclick=function(){e.boardsStorage.export()},this.importFileInput=this.container.querySelector(".js-import-fi"),this.importFileInput.onchange=function(){e.importFileInput.files.length>0&&e.boardsStorage.import(e.importFileInput.files[0])}},t.prototype.toggleOpen=function(t){void 0!==t?this.container.classList.toggle("open",t):this.container.classList.toggle("open")},t.prototype.createItem=function(){return new n},t}();e.MainMenu=r}.apply(e,[n,e]),void 0===r||(t.exports=r)},6158:(t,e,n)=>{!function(t){"use strict";t.defineMode("markdown",(function(e,n){var r=t.getMode(e,"text/html"),i="null"==r.name;function o(n){if(t.findModeByName){var r=t.findModeByName(n);r&&(n=r.mime||r.mimes[0])}var i=t.getMode(e,n);return"null"==i.name?null:i}void 0===n.highlightFormatting&&(n.highlightFormatting=!1),void 0===n.maxBlockquoteDepth&&(n.maxBlockquoteDepth=0),void 0===n.taskLists&&(n.taskLists=!1),void 0===n.strikethrough&&(n.strikethrough=!1),void 0===n.emoji&&(n.emoji=!1),void 0===n.fencedCodeBlockHighlighting&&(n.fencedCodeBlockHighlighting=!0),void 0===n.fencedCodeBlockDefaultMode&&(n.fencedCodeBlockDefaultMode="text/plain"),void 0===n.xml&&(n.xml=!0),void 0===n.tokenTypeOverrides&&(n.tokenTypeOverrides={});var a={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"image",imageAltText:"image-alt-text",imageMarker:"image-marker",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough",emoji:"builtin"};for(var s in a)a.hasOwnProperty(s)&&n.tokenTypeOverrides[s]&&(a[s]=n.tokenTypeOverrides[s]);var l=/^([*\-_])(?:\s*\1){2,}\s*$/,u=/^(?:[*\-+]|^[0-9]+([.)]))\s+/,c=/^\[(x| )\](?=\s)/i,h=n.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,d=/^ {0,3}(?:\={1,}|-{2,})\s*$/,f=/^[^#!\[\]*_\\<>` "'(~:]+/,p=/^(~~~+|```+)[ \t]*([\w\/+#-]*)[^\n`]*$/,g=/^\s*\[[^\]]+?\]:.*$/,m=/[!"#$%&'()*+,\-.\/:;<=>?@\[\\\]^_`{|}~\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E42\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDF3C-\uDF3E]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]/,v="    ";function y(t,e,n){return e.f=e.inline=n,n(t,e)}function b(t,e,n){return e.f=e.block=n,n(t,e)}function x(t){return!t||!/\S/.test(t.string)}function w(e){if(e.linkTitle=!1,e.linkHref=!1,e.linkText=!1,e.em=!1,e.strong=!1,e.strikethrough=!1,e.quote=0,e.indentedCode=!1,e.f==k){var n=i;if(!n){var o=t.innerMode(r,e.htmlState);n="xml"==o.mode.name&&null===o.state.tagStart&&!o.state.context&&o.state.tokenize.isInText}n&&(e.f=A,e.block=C,e.htmlState=null)}return e.trailingSpace=0,e.trailingSpaceNewLine=!1,e.prevLine=e.thisLine,e.thisLine={stream:null},null}function C(e,r){var i=e.column()===r.indentation,s=x(r.prevLine.stream),f=r.indentedCode,m=r.prevLine.hr,v=!1!==r.list,b=(r.listStack[r.listStack.length-1]||0)+3;r.indentedCode=!1;var w=r.indentation;if(null===r.indentationDiff&&(r.indentationDiff=r.indentation,v)){for(r.list=null;w<r.listStack[r.listStack.length-1];)r.listStack.pop(),r.listStack.length?r.indentation=r.listStack[r.listStack.length-1]:r.list=!1;!1!==r.list&&(r.indentationDiff=w-r.listStack[r.listStack.length-1])}var C=!(s||m||r.prevLine.header||v&&f||r.prevLine.fencedCodeEnd),k=(!1===r.list||m||s)&&r.indentation<=b&&e.match(l),D=null;if(r.indentationDiff>=4&&(f||r.prevLine.fencedCodeEnd||r.prevLine.header||s))return e.skipToEnd(),r.indentedCode=!0,a.code;if(e.eatSpace())return null;if(i&&r.indentation<=b&&(D=e.match(h))&&D[1].length<=6)return r.quote=0,r.header=D[1].length,r.thisLine.header=!0,n.highlightFormatting&&(r.formatting="header"),r.f=r.inline,_(r);if(r.indentation<=b&&e.eat(">"))return r.quote=i?1:r.quote+1,n.highlightFormatting&&(r.formatting="quote"),e.eatSpace(),_(r);if(!k&&!r.setext&&i&&r.indentation<=b&&(D=e.match(u))){var A=D[1]?"ol":"ul";return r.indentation=w+e.current().length,r.list=!0,r.quote=0,r.listStack.push(r.indentation),r.em=!1,r.strong=!1,r.code=!1,r.strikethrough=!1,n.taskLists&&e.match(c,!1)&&(r.taskList=!0),r.f=r.inline,n.highlightFormatting&&(r.formatting=["list","list-"+A]),_(r)}return i&&r.indentation<=b&&(D=e.match(p,!0))?(r.quote=0,r.fencedEndRE=new RegExp(D[1]+"+ *$"),r.localMode=n.fencedCodeBlockHighlighting&&o(D[2]||n.fencedCodeBlockDefaultMode),r.localMode&&(r.localState=t.startState(r.localMode)),r.f=r.block=S,n.highlightFormatting&&(r.formatting="code-block"),r.code=-1,_(r)):r.setext||!(C&&v||r.quote||!1!==r.list||r.code||k||g.test(e.string))&&(D=e.lookAhead(1))&&(D=D.match(d))?(r.setext?(r.header=r.setext,r.setext=0,e.skipToEnd(),n.highlightFormatting&&(r.formatting="header")):(r.header="="==D[0].charAt(0)?1:2,r.setext=r.header),r.thisLine.header=!0,r.f=r.inline,_(r)):k?(e.skipToEnd(),r.hr=!0,r.thisLine.hr=!0,a.hr):"["===e.peek()?y(e,r,P):y(e,r,r.inline)}function k(e,n){var o=r.token(e,n.htmlState);if(!i){var a=t.innerMode(r,n.htmlState);("xml"==a.mode.name&&null===a.state.tagStart&&!a.state.context&&a.state.tokenize.isInText||n.md_inside&&e.current().indexOf(">")>-1)&&(n.f=A,n.block=C,n.htmlState=null)}return o}function S(t,e){var r,i=e.listStack[e.listStack.length-1]||0,o=e.indentation<i,s=i+3;return e.fencedEndRE&&e.indentation<=s&&(o||t.match(e.fencedEndRE))?(n.highlightFormatting&&(e.formatting="code-block"),o||(r=_(e)),e.localMode=e.localState=null,e.block=C,e.f=A,e.fencedEndRE=null,e.code=0,e.thisLine.fencedCodeEnd=!0,o?b(t,e,e.block):r):e.localMode?e.localMode.token(t,e.localState):(t.skipToEnd(),a.code)}function _(t){var e=[];if(t.formatting){e.push(a.formatting),"string"==typeof t.formatting&&(t.formatting=[t.formatting]);for(var r=0;r<t.formatting.length;r++)e.push(a.formatting+"-"+t.formatting[r]),"header"===t.formatting[r]&&e.push(a.formatting+"-"+t.formatting[r]+"-"+t.header),"quote"===t.formatting[r]&&(!n.maxBlockquoteDepth||n.maxBlockquoteDepth>=t.quote?e.push(a.formatting+"-"+t.formatting[r]+"-"+t.quote):e.push("error"))}if(t.taskOpen)return e.push("meta"),e.length?e.join(" "):null;if(t.taskClosed)return e.push("property"),e.length?e.join(" "):null;if(t.linkHref?e.push(a.linkHref,"url"):(t.strong&&e.push(a.strong),t.em&&e.push(a.em),t.strikethrough&&e.push(a.strikethrough),t.emoji&&e.push(a.emoji),t.linkText&&e.push(a.linkText),t.code&&e.push(a.code),t.image&&e.push(a.image),t.imageAltText&&e.push(a.imageAltText,"link"),t.imageMarker&&e.push(a.imageMarker)),t.header&&e.push(a.header,a.header+"-"+t.header),t.quote&&(e.push(a.quote),!n.maxBlockquoteDepth||n.maxBlockquoteDepth>=t.quote?e.push(a.quote+"-"+t.quote):e.push(a.quote+"-"+n.maxBlockquoteDepth)),!1!==t.list){var i=(t.listStack.length-1)%3;i?1===i?e.push(a.list2):e.push(a.list3):e.push(a.list1)}return t.trailingSpaceNewLine?e.push("trailing-space-new-line"):t.trailingSpace&&e.push("trailing-space-"+(t.trailingSpace%2?"a":"b")),e.length?e.join(" "):null}function D(t,e){if(t.match(f,!0))return _(e)}function A(e,i){var o=i.text(e,i);if(void 0!==o)return o;if(i.list)return i.list=null,_(i);if(i.taskList)return" "===e.match(c,!0)[1]?i.taskOpen=!0:i.taskClosed=!0,n.highlightFormatting&&(i.formatting="task"),i.taskList=!1,_(i);if(i.taskOpen=!1,i.taskClosed=!1,i.header&&e.match(/^#+$/,!0))return n.highlightFormatting&&(i.formatting="header"),_(i);var s=e.next();if(i.linkTitle){i.linkTitle=!1;var l=s;"("===s&&(l=")");var u="^\\s*(?:[^"+(l=(l+"").replace(/([.?*+^\[\]\\(){}|-])/g,"\\$1"))+"\\\\]+|\\\\\\\\|\\\\.)"+l;if(e.match(new RegExp(u),!0))return a.linkHref}if("`"===s){var h=i.formatting;n.highlightFormatting&&(i.formatting="code"),e.eatWhile("`");var d=e.current().length;if(0!=i.code||i.quote&&1!=d){if(d==i.code){var f=_(i);return i.code=0,f}return i.formatting=h,_(i)}return i.code=d,_(i)}if(i.code)return _(i);if("\\"===s&&(e.next(),n.highlightFormatting)){var p=_(i),g=a.formatting+"-escape";return p?p+" "+g:g}if("!"===s&&e.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return i.imageMarker=!0,i.image=!0,n.highlightFormatting&&(i.formatting="image"),_(i);if("["===s&&i.imageMarker&&e.match(/[^\]]*\](\(.*?\)| ?\[.*?\])/,!1))return i.imageMarker=!1,i.imageAltText=!0,n.highlightFormatting&&(i.formatting="image"),_(i);if("]"===s&&i.imageAltText){n.highlightFormatting&&(i.formatting="image");var p=_(i);return i.imageAltText=!1,i.image=!1,i.inline=i.f=E,p}if("["===s&&!i.image)return i.linkText&&e.match(/^.*?\]/)||(i.linkText=!0,n.highlightFormatting&&(i.formatting="link")),_(i);if("]"===s&&i.linkText){n.highlightFormatting&&(i.formatting="link");var p=_(i);return i.linkText=!1,i.inline=i.f=e.match(/\(.*?\)| ?\[.*?\]/,!1)?E:A,p}if("<"===s&&e.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1))return i.f=i.inline=T,n.highlightFormatting&&(i.formatting="link"),(p=_(i))?p+=" ":p="",p+a.linkInline;if("<"===s&&e.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1))return i.f=i.inline=T,n.highlightFormatting&&(i.formatting="link"),(p=_(i))?p+=" ":p="",p+a.linkEmail;if(n.xml&&"<"===s&&e.match(/^(!--|\?|!\[CDATA\[|[a-z][a-z0-9-]*(?:\s+[a-z_:.\-]+(?:\s*=\s*[^>]+)?)*\s*(?:>|$))/i,!1)){var v=e.string.indexOf(">",e.pos);if(-1!=v){var y=e.string.substring(e.start,v);/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(y)&&(i.md_inside=!0)}return e.backUp(1),i.htmlState=t.startState(r),b(e,i,k)}if(n.xml&&"<"===s&&e.match(/^\/\w*?>/))return i.md_inside=!1,"tag";if("*"===s||"_"===s){for(var x=1,w=1==e.pos?" ":e.string.charAt(e.pos-2);x<3&&e.eat(s);)x++;var C=e.peek()||" ",S=!/\s/.test(C)&&(!m.test(C)||/\s/.test(w)||m.test(w)),D=!/\s/.test(w)&&(!m.test(w)||/\s/.test(C)||m.test(C)),F=null,L=null;if(x%2&&(i.em||!S||"*"!==s&&D&&!m.test(w)?i.em!=s||!D||"*"!==s&&S&&!m.test(C)||(F=!1):F=!0),x>1&&(i.strong||!S||"*"!==s&&D&&!m.test(w)?i.strong!=s||!D||"*"!==s&&S&&!m.test(C)||(L=!1):L=!0),null!=L||null!=F)return n.highlightFormatting&&(i.formatting=null==F?"strong":null==L?"em":"strong em"),!0===F&&(i.em=s),!0===L&&(i.strong=s),f=_(i),!1===F&&(i.em=!1),!1===L&&(i.strong=!1),f}else if(" "===s&&(e.eat("*")||e.eat("_"))){if(" "===e.peek())return _(i);e.backUp(1)}if(n.strikethrough)if("~"===s&&e.eatWhile(s)){if(i.strikethrough)return n.highlightFormatting&&(i.formatting="strikethrough"),f=_(i),i.strikethrough=!1,f;if(e.match(/^[^\s]/,!1))return i.strikethrough=!0,n.highlightFormatting&&(i.formatting="strikethrough"),_(i)}else if(" "===s&&e.match("~~",!0)){if(" "===e.peek())return _(i);e.backUp(2)}if(n.emoji&&":"===s&&e.match(/^(?:[a-z_\d+][a-z_\d+-]*|\-[a-z_\d+][a-z_\d+-]*):/)){i.emoji=!0,n.highlightFormatting&&(i.formatting="emoji");var P=_(i);return i.emoji=!1,P}return" "===s&&(e.match(/^ +$/,!1)?i.trailingSpace++:i.trailingSpace&&(i.trailingSpaceNewLine=!0)),_(i)}function T(t,e){if(">"===t.next()){e.f=e.inline=A,n.highlightFormatting&&(e.formatting="link");var r=_(e);return r?r+=" ":r="",r+a.linkInline}return t.match(/^[^>]+/,!0),a.linkInline}function E(t,e){if(t.eatSpace())return null;var r=t.next();return"("===r||"["===r?(e.f=e.inline=L("("===r?")":"]"),n.highlightFormatting&&(e.formatting="link-string"),e.linkHref=!0,_(e)):"error"}var F={")":/^(?:[^\\\(\)]|\\.|\((?:[^\\\(\)]|\\.)*\))*?(?=\))/,"]":/^(?:[^\\\[\]]|\\.|\[(?:[^\\\[\]]|\\.)*\])*?(?=\])/};function L(t){return function(e,r){if(e.next()===t){r.f=r.inline=A,n.highlightFormatting&&(r.formatting="link-string");var i=_(r);return r.linkHref=!1,i}return e.match(F[t]),r.linkHref=!0,_(r)}}function P(t,e){return t.match(/^([^\]\\]|\\.)*\]:/,!1)?(e.f=O,t.next(),n.highlightFormatting&&(e.formatting="link"),e.linkText=!0,_(e)):y(t,e,A)}function O(t,e){if(t.match("]:",!0)){e.f=e.inline=M,n.highlightFormatting&&(e.formatting="link");var r=_(e);return e.linkText=!1,r}return t.match(/^([^\]\\]|\\.)+/,!0),a.linkText}function M(t,e){return t.eatSpace()?null:(t.match(/^[^\s]+/,!0),void 0===t.peek()?e.linkTitle=!0:t.match(/^(?:\s+(?:"(?:[^"\\]|\\.)+"|'(?:[^'\\]|\\.)+'|\((?:[^)\\]|\\.)+\)))?/,!0),e.f=e.inline=A,a.linkHref+" url")}var B={startState:function(){return{f:C,prevLine:{stream:null},thisLine:{stream:null},block:C,htmlState:null,indentation:0,inline:A,text:D,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,code:0,em:!1,strong:!1,header:0,setext:0,hr:!1,taskList:!1,list:!1,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1,emoji:!1,fencedEndRE:null}},copyState:function(e){return{f:e.f,prevLine:e.prevLine,thisLine:e.thisLine,block:e.block,htmlState:e.htmlState&&t.copyState(r,e.htmlState),indentation:e.indentation,localMode:e.localMode,localState:e.localMode?t.copyState(e.localMode,e.localState):null,inline:e.inline,text:e.text,formatting:!1,linkText:e.linkText,linkTitle:e.linkTitle,linkHref:e.linkHref,code:e.code,em:e.em,strong:e.strong,strikethrough:e.strikethrough,emoji:e.emoji,header:e.header,setext:e.setext,hr:e.hr,taskList:e.taskList,list:e.list,listStack:e.listStack.slice(0),quote:e.quote,indentedCode:e.indentedCode,trailingSpace:e.trailingSpace,trailingSpaceNewLine:e.trailingSpaceNewLine,md_inside:e.md_inside,fencedEndRE:e.fencedEndRE}},token:function(t,e){if(e.formatting=!1,t!=e.thisLine.stream){if(e.header=0,e.hr=!1,t.match(/^\s*$/,!0))return w(e),null;if(e.prevLine=e.thisLine,e.thisLine={stream:t},e.taskList=!1,e.trailingSpace=0,e.trailingSpaceNewLine=!1,!e.localState&&(e.f=e.block,e.f!=k)){var n=t.match(/^\s*/,!0)[0].replace(/\t/g,v).length;if(e.indentation=n,e.indentationDiff=null,n>0)return null}}return e.f(t,e)},innerMode:function(t){return t.block==k?{state:t.htmlState,mode:r}:t.localState?{state:t.localState,mode:t.localMode}:{state:t,mode:B}},indent:function(e,n,i){return e.block==k&&r.indent?r.indent(e.htmlState,n,i):e.localState&&e.localMode.indent?e.localMode.indent(e.localState,n,i):t.Pass},blankLine:w,getType:_,blockCommentStart:"\x3c!--",blockCommentEnd:"--\x3e",closeBrackets:"()[]{}''\"\"``",fold:"markdown"};return B}),"xml"),t.defineMIME("text/markdown","markdown"),t.defineMIME("text/x-markdown","markdown")}(n(1719),n(1262),n(9896))},6378:function(t,e,n){var r,i,o,a=this&&this.__extends||(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},l=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))};r=[n,e,n(7280),n(7159)],i=function(t,e,n,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Rectangle=void 0;var i=function(t){function e(){var e=t.apply(this,l([],s(arguments),!1))||this;return e.width=300,e.height=100,e}return a(e,t),e.prototype.setAppBus=function(t){this.bus=t},e.prototype.getWidth=function(){return this.width},e.prototype.getHeight=function(){return this.height},e.prototype.getId=function(){return this.id},e.prototype.setAppCommands=function(t){this.appCommands=t},e.prototype.init=function(t){var e=this;this.coordinates=t,this.group=new r.default.Group({x:this.coordinates.x,y:this.coordinates.y,draggable:!0}),this.rect=new r.default.Rect({x:0,y:0,width:this.width,height:this.height,fill:"white",stroke:"black",strokeWidth:4,shadowColor:"black",shadowOpacity:.5,cornerRadius:10}),this.group.add(this.rect),this.text=new r.default.Text({x:10,y:10,text:"",fontSize:22,fontFamily:"RobotoMono"}),this.group.add(this.text),this.group.on("mouseenter",(function(){e.layer.getStage().container().style.cursor="pointer",e.rect.shadowBlur(10),e.rect.shadowOffset({x:5,y:5})})),this.group.on("mouseleave",(function(){e.layer.getStage().container().style.cursor="default",e.rect.shadowBlur(0),e.rect.shadowOffset({x:0,y:0})})),this.group.on("dragstart",(function(){e.layer.getStage().container().style.cursor="move"})),this.group.on("dragmove",(function(t){e.coordinates={x:t.target.attrs.x,y:t.target.attrs.y},e.bus.onMoveShape(e)})),this.group.on("dragend",(function(){e.layer.getStage().container().style.cursor="pointer",e.appCommands.moveNode(e.id,e.coordinates.x,e.coordinates.y)}))},e.prototype.splitLongWords=function(t){for(var e=[],n=0;n<t.length;n++)if(t[n].trim().length>16){var r=0,i="",o=[];do{var a=t[n].trim().slice(16*r,16*(r+1));i=a,a&&o.push(a),r++}while(i);e=e.concat(o)}else e.push(t[n].trim());return e},e.prototype.getLines=function(t){if(!t)return[];var e=t.split(" ");if(0==(e=e.filter((function(t){return t}))).length)return[];e=this.splitLongWords(e);for(var n=[],r="",i=0;i<e.length;i++)28!=e[i].trim().length?(r+" "+e[i].trim()).length>28?(n.push(r.trim()),r=e[i].trim()):r+=" "+e[i].trim():(r&&(n.push(r),r=""),n.push(e[i].trim()));return n.push(r.trim()),n},e.prototype.load=function(t){this.id=t.id,this.data=t;var e=this.getLines(t.preview);this.text.setText(e.join("\n"));var n=22*e.length+20;n>this.height&&(this.height=n,this.rect.height(this.height))},e.prototype.getData=function(){return this.data},e.prototype.moveToTop=function(){this.group.moveToTop()},e.prototype.isThis=function(t){return this.coordinates.x<t.x&&this.coordinates.y<t.y&&this.coordinates.x+this.width>t.x&&this.coordinates.y+this.height>t.y},e.prototype.remove=function(){this.group.remove()},e.prototype.addToLayer=function(t){this.layer=t,this.group.remove(),this.layer.add(this.group),this.group.draw()},e.prototype.hasTags=function(t){return Object.values(this.data.tags||{}).some((function(e){return t.includes(e.id)}))},e.prototype.higlight=function(t){t?this.rect.fill("#ccc"):this.rect.fill("white")},e}(n.AbstractShape);e.Rectangle=i}.apply(e,r),void 0===i||(t.exports=i)},6410:(t,e,n)=>{var r;r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NotesStorage=void 0;var n=function(){function t(){}return t.prototype.setDb=function(t){this.db=t},t.prototype.setNotesLinksStorage=function(t){this.notesLinksStorage=t},t.prototype.getNotes=function(t){return this.db.notes.where("boardId").equals(t).toArray()},t.prototype.createNote=function(t){return this.db.notes.add(t)},t.prototype.updateNote=function(t){return this.db.notes.update(t.id,t)},t.prototype.deleteNode=function(t){return this.notesLinksStorage.deleteFor(t),this.db.notes.where("id").equals(t).delete()},t.prototype.deleteForBoard=function(t){return this.db.notesLinks.where("boardId").equals(t).delete()},t}();e.NotesStorage=n}.apply(e,[n,e]),void 0===r||(t.exports=r)},6709:(t,e)=>{"use strict";function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(i=r.key,o=void 0,"symbol"==typeof(o=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(i,"string"))?o:String(o)),r)}var i,o}function r(){return r=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},r.apply(this,arguments)}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function o(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}e.NT={async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1};var s=/[&<>"']/,l=new RegExp(s.source,"g"),u=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,c=new RegExp(u.source,"g"),h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},d=function(t){return h[t]};function f(t,e){if(e){if(s.test(t))return t.replace(l,d)}else if(u.test(t))return t.replace(c,d);return t}var p=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi;function g(t){return t.replace(p,(function(t,e){return"colon"===(e=e.toLowerCase())?":":"#"===e.charAt(0)?"x"===e.charAt(1)?String.fromCharCode(parseInt(e.substring(2),16)):String.fromCharCode(+e.substring(1)):""}))}var m=/(^|[^\[])\^/g;function v(t,e){t="string"==typeof t?t:t.source,e=e||"";var n={replace:function(e,r){return r=(r=r.source||r).replace(m,"$1"),t=t.replace(e,r),n},getRegex:function(){return new RegExp(t,e)}};return n}var y=/[^\w:]/g,b=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function x(t,e,n){if(t){var r;try{r=decodeURIComponent(g(n)).replace(y,"").toLowerCase()}catch(t){return null}if(0===r.indexOf("javascript:")||0===r.indexOf("vbscript:")||0===r.indexOf("data:"))return null}e&&!b.test(n)&&(n=function(t,e){w[" "+t]||(C.test(t)?w[" "+t]=t+"/":w[" "+t]=A(t,"/",!0));t=w[" "+t];var n=-1===t.indexOf(":");return"//"===e.substring(0,2)?n?e:t.replace(k,"$1")+e:"/"===e.charAt(0)?n?e:t.replace(S,"$1")+e:t+e}(e,n));try{n=encodeURI(n).replace(/%25/g,"%")}catch(t){return null}return n}var w={},C=/^[^:]+:\/*[^/]*$/,k=/^([^:]+:)[\s\S]*$/,S=/^([^:]+:\/*[^/]*)[\s\S]*$/;var _={exec:function(){}};function D(t,e){var n=t.replace(/\|/g,(function(t,e,n){for(var r=!1,i=e;--i>=0&&"\\"===n[i];)r=!r;return r?"|":" |"})).split(/ \|/),r=0;if(n[0].trim()||n.shift(),n.length>0&&!n[n.length-1].trim()&&n.pop(),n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;r<n.length;r++)n[r]=n[r].trim().replace(/\\\|/g,"|");return n}function A(t,e,n){var r=t.length;if(0===r)return"";for(var i=0;i<r;){var o=t.charAt(r-i-1);if(o!==e||n){if(o===e||!n)break;i++}else i++}return t.slice(0,r-i)}function T(t,e){if(e<1)return"";for(var n="";e>1;)1&e&&(n+=t),e>>=1,t+=t;return n+t}function E(t,e,n,r){var i=e.href,o=e.title?f(e.title):null,a=t[1].replace(/\\([\[\]])/g,"$1");if("!"!==t[0].charAt(0)){r.state.inLink=!0;var s={type:"link",raw:n,href:i,title:o,text:a,tokens:r.inlineTokens(a)};return r.state.inLink=!1,s}return{type:"image",raw:n,href:i,title:o,text:f(a)}}var F=function(){function t(t){this.options=t||e.NT}var n=t.prototype;return n.space=function(t){var e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}},n.code=function(t){var e=this.rules.block.code.exec(t);if(e){var n=e[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:A(n,"\n")}}},n.fences=function(t){var e=this.rules.block.fences.exec(t);if(e){var n=e[0],r=function(t,e){var n=t.match(/^(\s+)(?:```)/);if(null===n)return e;var r=n[1];return e.split("\n").map((function(t){var e=t.match(/^\s+/);return null===e?t:e[0].length>=r.length?t.slice(r.length):t})).join("\n")}(n,e[3]||"");return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline._escapes,"$1"):e[2],text:r}}},n.heading=function(t){var e=this.rules.block.heading.exec(t);if(e){var n=e[2].trim();if(/#$/.test(n)){var r=A(n,"#");this.options.pedantic?n=r.trim():r&&!/ $/.test(r)||(n=r.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}},n.hr=function(t){var e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:e[0]}},n.blockquote=function(t){var e=this.rules.block.blockquote.exec(t);if(e){var n=e[0].replace(/^ *>[ \t]?/gm,""),r=this.lexer.state.top;this.lexer.state.top=!0;var i=this.lexer.blockTokens(n);return this.lexer.state.top=r,{type:"blockquote",raw:e[0],tokens:i,text:n}}},n.list=function(t){var e=this.rules.block.list.exec(t);if(e){var n,r,i,o,a,s,l,u,c,h,d,f,p=e[1].trim(),g=p.length>1,m={type:"list",raw:"",ordered:g,start:g?+p.slice(0,-1):"",loose:!1,items:[]};p=g?"\\d{1,9}\\"+p.slice(-1):"\\"+p,this.options.pedantic&&(p=g?p:"[*+-]");for(var v=new RegExp("^( {0,3}"+p+")((?:[\t ][^\\n]*)?(?:\\n|$))");t&&(f=!1,e=v.exec(t))&&!this.rules.block.hr.test(t);){if(n=e[0],t=t.substring(n.length),u=e[2].split("\n",1)[0].replace(/^\t+/,(function(t){return" ".repeat(3*t.length)})),c=t.split("\n",1)[0],this.options.pedantic?(o=2,d=u.trimLeft()):(o=(o=e[2].search(/[^ ]/))>4?1:o,d=u.slice(o),o+=e[1].length),s=!1,!u&&/^ *$/.test(c)&&(n+=c+"\n",t=t.substring(c.length+1),f=!0),!f)for(var y=new RegExp("^ {0,"+Math.min(3,o-1)+"}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))"),b=new RegExp("^ {0,"+Math.min(3,o-1)+"}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)"),x=new RegExp("^ {0,"+Math.min(3,o-1)+"}(?:```|~~~)"),w=new RegExp("^ {0,"+Math.min(3,o-1)+"}#");t&&(c=h=t.split("\n",1)[0],this.options.pedantic&&(c=c.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!x.test(c))&&!w.test(c)&&!y.test(c)&&!b.test(t);){if(c.search(/[^ ]/)>=o||!c.trim())d+="\n"+c.slice(o);else{if(s)break;if(u.search(/[^ ]/)>=4)break;if(x.test(u))break;if(w.test(u))break;if(b.test(u))break;d+="\n"+c}s||c.trim()||(s=!0),n+=h+"\n",t=t.substring(h.length+1),u=c.slice(o)}m.loose||(l?m.loose=!0:/\n *\n *$/.test(n)&&(l=!0)),this.options.gfm&&(r=/^\[[ xX]\] /.exec(d))&&(i="[ ] "!==r[0],d=d.replace(/^\[[ xX]\] +/,"")),m.items.push({type:"list_item",raw:n,task:!!r,checked:i,loose:!1,text:d}),m.raw+=n}m.items[m.items.length-1].raw=n.trimRight(),m.items[m.items.length-1].text=d.trimRight(),m.raw=m.raw.trimRight();var C=m.items.length;for(a=0;a<C;a++)if(this.lexer.state.top=!1,m.items[a].tokens=this.lexer.blockTokens(m.items[a].text,[]),!m.loose){var k=m.items[a].tokens.filter((function(t){return"space"===t.type})),S=k.length>0&&k.some((function(t){return/\n.*\n/.test(t.raw)}));m.loose=S}if(m.loose)for(a=0;a<C;a++)m.items[a].loose=!0;return m}},n.html=function(t){var e=this.rules.block.html.exec(t);if(e){var n={type:"html",raw:e[0],pre:!this.options.sanitizer&&("pre"===e[1]||"script"===e[1]||"style"===e[1]),text:e[0]};if(this.options.sanitize){var r=this.options.sanitizer?this.options.sanitizer(e[0]):f(e[0]);n.type="paragraph",n.text=r,n.tokens=this.lexer.inline(r)}return n}},n.def=function(t){var e=this.rules.block.def.exec(t);if(e){var n=e[1].toLowerCase().replace(/\s+/g," "),r=e[2]?e[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",i=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline._escapes,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:r,title:i}}},n.table=function(t){var e=this.rules.block.table.exec(t);if(e){var n={type:"table",header:D(e[1]).map((function(t){return{text:t}})),align:e[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:e[3]&&e[3].trim()?e[3].replace(/\n[ \t]*$/,"").split("\n"):[]};if(n.header.length===n.align.length){n.raw=e[0];var r,i,o,a,s=n.align.length;for(r=0;r<s;r++)/^ *-+: *$/.test(n.align[r])?n.align[r]="right":/^ *:-+: *$/.test(n.align[r])?n.align[r]="center":/^ *:-+ *$/.test(n.align[r])?n.align[r]="left":n.align[r]=null;for(s=n.rows.length,r=0;r<s;r++)n.rows[r]=D(n.rows[r],n.header.length).map((function(t){return{text:t}}));for(s=n.header.length,i=0;i<s;i++)n.header[i].tokens=this.lexer.inline(n.header[i].text);for(s=n.rows.length,i=0;i<s;i++)for(a=n.rows[i],o=0;o<a.length;o++)a[o].tokens=this.lexer.inline(a[o].text);return n}}},n.lheading=function(t){var e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:"="===e[2].charAt(0)?1:2,text:e[1],tokens:this.lexer.inline(e[1])}},n.paragraph=function(t){var e=this.rules.block.paragraph.exec(t);if(e){var n="\n"===e[1].charAt(e[1].length-1)?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}},n.text=function(t){var e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}},n.escape=function(t){var e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:f(e[1])}},n.tag=function(t){var e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&/^<a /i.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(e[0]):f(e[0]):e[0]}},n.link=function(t){var e=this.rules.inline.link.exec(t);if(e){var n=e[2].trim();if(!this.options.pedantic&&/^</.test(n)){if(!/>$/.test(n))return;var r=A(n.slice(0,-1),"\\");if((n.length-r.length)%2==0)return}else{var i=function(t,e){if(-1===t.indexOf(e[1]))return-1;for(var n=t.length,r=0,i=0;i<n;i++)if("\\"===t[i])i++;else if(t[i]===e[0])r++;else if(t[i]===e[1]&&--r<0)return i;return-1}(e[2],"()");if(i>-1){var o=(0===e[0].indexOf("!")?5:4)+e[1].length+i;e[2]=e[2].substring(0,i),e[0]=e[0].substring(0,o).trim(),e[3]=""}}var a=e[2],s="";if(this.options.pedantic){var l=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(a);l&&(a=l[1],s=l[3])}else s=e[3]?e[3].slice(1,-1):"";return a=a.trim(),/^</.test(a)&&(a=this.options.pedantic&&!/>$/.test(n)?a.slice(1):a.slice(1,-1)),E(e,{href:a?a.replace(this.rules.inline._escapes,"$1"):a,title:s?s.replace(this.rules.inline._escapes,"$1"):s},e[0],this.lexer)}},n.reflink=function(t,e){var n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){var r=(n[2]||n[1]).replace(/\s+/g," ");if(!(r=e[r.toLowerCase()])){var i=n[0].charAt(0);return{type:"text",raw:i,text:i}}return E(n,r,n[0],this.lexer)}},n.emStrong=function(t,e,n){void 0===n&&(n="");var r=this.rules.inline.emStrong.lDelim.exec(t);if(r&&(!r[3]||!n.match(/(?:[0-9A-Za-z\xAA\xB2\xB3\xB5\xB9\xBA\xBC-\xBE\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u0660-\u0669\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07C0-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0966-\u096F\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09E6-\u09F1\u09F4-\u09F9\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A66-\u0A6F\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AE6-\u0AEF\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B66-\u0B6F\u0B71-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0BE6-\u0BF2\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C66-\u0C6F\u0C78-\u0C7E\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CE6-\u0CEF\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D58-\u0D61\u0D66-\u0D78\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DE6-\u0DEF\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F20-\u0F33\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F-\u1049\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u1090-\u1099\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1369-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A16\u1A20-\u1A54\u1A80-\u1A89\u1A90-\u1A99\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B50-\u1B59\u1B83-\u1BA0\u1BAE-\u1BE5\u1C00-\u1C23\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2070\u2071\u2074-\u2079\u207F-\u2089\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2150-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u3192-\u3195\u31A0-\u31BF\u31F0-\u31FF\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA830-\uA835\uA840-\uA873\uA882-\uA8B3\uA8D0-\uA8D9\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA900-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF-\uA9D9\uA9E0-\uA9E4\uA9E6-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA50-\uAA59\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDE80-\uDE9C\uDEA0-\uDED0\uDEE1-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC58-\uDC76\uDC79-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE60-\uDE7E\uDE80-\uDE9F\uDEC0-\uDEC7\uDEC9-\uDEE4\uDEEB-\uDEEF\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD23\uDD30-\uDD39\uDE60-\uDE7E\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF27\uDF30-\uDF45\uDF51-\uDF54\uDF70-\uDF81\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC52-\uDC6F\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD03-\uDD26\uDD36-\uDD3F\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDD0-\uDDDA\uDDDC\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDEF0-\uDEF9\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC50-\uDC59\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE50-\uDE59\uDE80-\uDEAA\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF30-\uDF3B\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC50-\uDC6C\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF2\uDFB0\uDFC0-\uDFD4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDE70-\uDEBE\uDEC0-\uDEC9\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE96\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD40-\uDD49\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB\uDEF0-\uDEF9]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCCF\uDD00-\uDD43\uDD4B\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/))){var i=r[1]||r[2]||"";if(!i||i&&(""===n||this.rules.inline.punctuation.exec(n))){var o,a,s=r[0].length-1,l=s,u=0,c="*"===r[0][0]?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(c.lastIndex=0,e=e.slice(-1*t.length+s);null!=(r=c.exec(e));)if(o=r[1]||r[2]||r[3]||r[4]||r[5]||r[6])if(a=o.length,r[3]||r[4])l+=a;else if(!((r[5]||r[6])&&s%3)||(s+a)%3){if(!((l-=a)>0)){a=Math.min(a,a+l+u);var h=t.slice(0,s+r.index+(r[0].length-o.length)+a);if(Math.min(s,a)%2){var d=h.slice(1,-1);return{type:"em",raw:h,text:d,tokens:this.lexer.inlineTokens(d)}}var f=h.slice(2,-2);return{type:"strong",raw:h,text:f,tokens:this.lexer.inlineTokens(f)}}}else u+=a}}},n.codespan=function(t){var e=this.rules.inline.code.exec(t);if(e){var n=e[2].replace(/\n/g," "),r=/[^ ]/.test(n),i=/^ /.test(n)&&/ $/.test(n);return r&&i&&(n=n.substring(1,n.length-1)),n=f(n,!0),{type:"codespan",raw:e[0],text:n}}},n.br=function(t){var e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}},n.del=function(t){var e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}},n.autolink=function(t,e){var n,r,i=this.rules.inline.autolink.exec(t);if(i)return r="@"===i[2]?"mailto:"+(n=f(this.options.mangle?e(i[1]):i[1])):n=f(i[1]),{type:"link",raw:i[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}},n.url=function(t,e){var n;if(n=this.rules.inline.url.exec(t)){var r,i;if("@"===n[2])i="mailto:"+(r=f(this.options.mangle?e(n[0]):n[0]));else{var o;do{o=n[0],n[0]=this.rules.inline._backpedal.exec(n[0])[0]}while(o!==n[0]);r=f(n[0]),i="www."===n[1]?"http://"+n[0]:n[0]}return{type:"link",raw:n[0],text:r,href:i,tokens:[{type:"text",raw:r,text:r}]}}},n.inlineText=function(t,e){var n,r=this.rules.inline.text.exec(t);if(r)return n=this.lexer.state.inRawBlock?this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):f(r[0]):r[0]:f(this.options.smartypants?e(r[0]):r[0]),{type:"text",raw:r[0],text:n}},t}(),L={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:_,lheading:/^((?:.|\n(?!\n))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/,_label:/(?!\s*\])(?:\\.|[^\[\]\\])+/,_title:/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/};L.def=v(L.def).replace("label",L._label).replace("title",L._title).getRegex(),L.bullet=/(?:[*+-]|\d{1,9}[.)])/,L.listItemStart=v(/^( *)(bull) */).replace("bull",L.bullet).getRegex(),L.list=v(L.list).replace(/bull/g,L.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+L.def.source+")").getRegex(),L._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",L._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,L.html=v(L.html,"i").replace("comment",L._comment).replace("tag",L._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),L.paragraph=v(L._paragraph).replace("hr",L.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",L._tag).getRegex(),L.blockquote=v(L.blockquote).replace("paragraph",L.paragraph).getRegex(),L.normal=r({},L),L.gfm=r({},L.normal,{table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"}),L.gfm.table=v(L.gfm.table).replace("hr",L.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",L._tag).getRegex(),L.gfm.paragraph=v(L._paragraph).replace("hr",L.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",L.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",L._tag).getRegex(),L.pedantic=r({},L.normal,{html:v("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",L._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:_,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:v(L.normal._paragraph).replace("hr",L.hr).replace("heading"," *#{1,6} *[^\n]").replace("lheading",L.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});var P={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:_,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^(?:[^_*\\]|\\.)*?\_\_(?:[^_*\\]|\\.)*?\*(?:[^_*\\]|\\.)*?(?=\_\_)|(?:[^*\\]|\\.)+(?=[^*])|[punct_](\*+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|(?:[^punct*_\s\\]|\\.)(\*+)(?=[^punct*_\s])/,rDelimUnd:/^(?:[^_*\\]|\\.)*?\*\*(?:[^_*\\]|\\.)*?\_(?:[^_*\\]|\\.)*?(?=\*\*)|(?:[^_\\]|\\.)+(?=[^_])|[punct*](\_+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:_,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};function O(t){return t.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…")}function M(t){var e,n,r="",i=t.length;for(e=0;e<i;e++)n=t.charCodeAt(e),Math.random()>.5&&(n="x"+n.toString(16)),r+="&#"+n+";";return r}P._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~",P.punctuation=v(P.punctuation).replace(/punctuation/g,P._punctuation).getRegex(),P.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g,P.escapedEmSt=/(?:^|[^\\])(?:\\\\)*\\[*_]/g,P._comment=v(L._comment).replace("(?:--\x3e|$)","--\x3e").getRegex(),P.emStrong.lDelim=v(P.emStrong.lDelim).replace(/punct/g,P._punctuation).getRegex(),P.emStrong.rDelimAst=v(P.emStrong.rDelimAst,"g").replace(/punct/g,P._punctuation).getRegex(),P.emStrong.rDelimUnd=v(P.emStrong.rDelimUnd,"g").replace(/punct/g,P._punctuation).getRegex(),P._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g,P._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,P._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,P.autolink=v(P.autolink).replace("scheme",P._scheme).replace("email",P._email).getRegex(),P._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,P.tag=v(P.tag).replace("comment",P._comment).replace("attribute",P._attribute).getRegex(),P._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,P._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/,P._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,P.link=v(P.link).replace("label",P._label).replace("href",P._href).replace("title",P._title).getRegex(),P.reflink=v(P.reflink).replace("label",P._label).replace("ref",L._label).getRegex(),P.nolink=v(P.nolink).replace("ref",L._label).getRegex(),P.reflinkSearch=v(P.reflinkSearch,"g").replace("reflink",P.reflink).replace("nolink",P.nolink).getRegex(),P.normal=r({},P),P.pedantic=r({},P.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:v(/^!?\[(label)\]\((.*?)\)/).replace("label",P._label).getRegex(),reflink:v(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",P._label).getRegex()}),P.gfm=r({},P.normal,{escape:v(P.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/}),P.gfm.url=v(P.gfm.url,"i").replace("email",P.gfm._extended_email).getRegex(),P.breaks=r({},P.gfm,{br:v(P.br).replace("{2,}","*").getRegex(),text:v(P.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});var B=function(){function t(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||e.NT,this.options.tokenizer=this.options.tokenizer||new F,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};var n={block:L.normal,inline:P.normal};this.options.pedantic?(n.block=L.pedantic,n.inline=P.pedantic):this.options.gfm&&(n.block=L.gfm,this.options.breaks?n.inline=P.breaks:n.inline=P.gfm),this.tokenizer.rules=n}t.lex=function(e,n){return new t(n).lex(e)},t.lexInline=function(e,n){return new t(n).inlineTokens(e)};var r,i,o,a=t.prototype;return a.lex=function(t){var e;for(t=t.replace(/\r\n|\r/g,"\n"),this.blockTokens(t,this.tokens);e=this.inlineQueue.shift();)this.inlineTokens(e.src,e.tokens);return this.tokens},a.blockTokens=function(t,e){var n,r,i,o,a=this;for(void 0===e&&(e=[]),t=this.options.pedantic?t.replace(/\t/g,"    ").replace(/^ +$/gm,""):t.replace(/^( *)(\t+)/gm,(function(t,e,n){return e+"    ".repeat(n.length)}));t;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some((function(r){return!!(n=r.call({lexer:a},t,e))&&(t=t.substring(n.raw.length),e.push(n),!0)}))))if(n=this.tokenizer.space(t))t=t.substring(n.raw.length),1===n.raw.length&&e.length>0?e[e.length-1].raw+="\n":e.push(n);else if(n=this.tokenizer.code(t))t=t.substring(n.raw.length),!(r=e[e.length-1])||"paragraph"!==r.type&&"text"!==r.type?e.push(n):(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue[this.inlineQueue.length-1].src=r.text);else if(n=this.tokenizer.fences(t))t=t.substring(n.raw.length),e.push(n);else if(n=this.tokenizer.heading(t))t=t.substring(n.raw.length),e.push(n);else if(n=this.tokenizer.hr(t))t=t.substring(n.raw.length),e.push(n);else if(n=this.tokenizer.blockquote(t))t=t.substring(n.raw.length),e.push(n);else if(n=this.tokenizer.list(t))t=t.substring(n.raw.length),e.push(n);else if(n=this.tokenizer.html(t))t=t.substring(n.raw.length),e.push(n);else if(n=this.tokenizer.def(t))t=t.substring(n.raw.length),!(r=e[e.length-1])||"paragraph"!==r.type&&"text"!==r.type?this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title}):(r.raw+="\n"+n.raw,r.text+="\n"+n.raw,this.inlineQueue[this.inlineQueue.length-1].src=r.text);else if(n=this.tokenizer.table(t))t=t.substring(n.raw.length),e.push(n);else if(n=this.tokenizer.lheading(t))t=t.substring(n.raw.length),e.push(n);else if(i=t,this.options.extensions&&this.options.extensions.startBlock&&function(){var e=1/0,n=t.slice(1),r=void 0;a.options.extensions.startBlock.forEach((function(t){"number"==typeof(r=t.call({lexer:this},n))&&r>=0&&(e=Math.min(e,r))})),e<1/0&&e>=0&&(i=t.substring(0,e+1))}(),this.state.top&&(n=this.tokenizer.paragraph(i)))r=e[e.length-1],o&&"paragraph"===r.type?(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):e.push(n),o=i.length!==t.length,t=t.substring(n.raw.length);else if(n=this.tokenizer.text(t))t=t.substring(n.raw.length),(r=e[e.length-1])&&"text"===r.type?(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):e.push(n);else if(t){var s="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(s);break}throw new Error(s)}return this.state.top=!0,e},a.inline=function(t,e){return void 0===e&&(e=[]),this.inlineQueue.push({src:t,tokens:e}),e},a.inlineTokens=function(t,e){var n,r,i,o=this;void 0===e&&(e=[]);var a,s,l,u=t;if(this.tokens.links){var c=Object.keys(this.tokens.links);if(c.length>0)for(;null!=(a=this.tokenizer.rules.inline.reflinkSearch.exec(u));)c.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(u=u.slice(0,a.index)+"["+T("a",a[0].length-2)+"]"+u.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(a=this.tokenizer.rules.inline.blockSkip.exec(u));)u=u.slice(0,a.index)+"["+T("a",a[0].length-2)+"]"+u.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;null!=(a=this.tokenizer.rules.inline.escapedEmSt.exec(u));)u=u.slice(0,a.index+a[0].length-2)+"++"+u.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex),this.tokenizer.rules.inline.escapedEmSt.lastIndex--;for(;t;)if(s||(l=""),s=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some((function(r){return!!(n=r.call({lexer:o},t,e))&&(t=t.substring(n.raw.length),e.push(n),!0)}))))if(n=this.tokenizer.escape(t))t=t.substring(n.raw.length),e.push(n);else if(n=this.tokenizer.tag(t))t=t.substring(n.raw.length),(r=e[e.length-1])&&"text"===n.type&&"text"===r.type?(r.raw+=n.raw,r.text+=n.text):e.push(n);else if(n=this.tokenizer.link(t))t=t.substring(n.raw.length),e.push(n);else if(n=this.tokenizer.reflink(t,this.tokens.links))t=t.substring(n.raw.length),(r=e[e.length-1])&&"text"===n.type&&"text"===r.type?(r.raw+=n.raw,r.text+=n.text):e.push(n);else if(n=this.tokenizer.emStrong(t,u,l))t=t.substring(n.raw.length),e.push(n);else if(n=this.tokenizer.codespan(t))t=t.substring(n.raw.length),e.push(n);else if(n=this.tokenizer.br(t))t=t.substring(n.raw.length),e.push(n);else if(n=this.tokenizer.del(t))t=t.substring(n.raw.length),e.push(n);else if(n=this.tokenizer.autolink(t,M))t=t.substring(n.raw.length),e.push(n);else if(this.state.inLink||!(n=this.tokenizer.url(t,M))){if(i=t,this.options.extensions&&this.options.extensions.startInline&&function(){var e=1/0,n=t.slice(1),r=void 0;o.options.extensions.startInline.forEach((function(t){"number"==typeof(r=t.call({lexer:this},n))&&r>=0&&(e=Math.min(e,r))})),e<1/0&&e>=0&&(i=t.substring(0,e+1))}(),n=this.tokenizer.inlineText(i,O))t=t.substring(n.raw.length),"_"!==n.raw.slice(-1)&&(l=n.raw.slice(-1)),s=!0,(r=e[e.length-1])&&"text"===r.type?(r.raw+=n.raw,r.text+=n.text):e.push(n);else if(t){var h="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(h);break}throw new Error(h)}}else t=t.substring(n.raw.length),e.push(n);return e},r=t,o=[{key:"rules",get:function(){return{block:L,inline:P}}}],(i=null)&&n(r.prototype,i),o&&n(r,o),Object.defineProperty(r,"prototype",{writable:!1}),t}(),N=function(){function t(t){this.options=t||e.NT}var n=t.prototype;return n.code=function(t,e,n){var r=(e||"").match(/\S*/)[0];if(this.options.highlight){var i=this.options.highlight(t,r);null!=i&&i!==t&&(n=!0,t=i)}return t=t.replace(/\n$/,"")+"\n",r?'<pre><code class="'+this.options.langPrefix+f(r)+'">'+(n?t:f(t,!0))+"</code></pre>\n":"<pre><code>"+(n?t:f(t,!0))+"</code></pre>\n"},n.blockquote=function(t){return"<blockquote>\n"+t+"</blockquote>\n"},n.html=function(t){return t},n.heading=function(t,e,n,r){return this.options.headerIds?"<h"+e+' id="'+(this.options.headerPrefix+r.slug(n))+'">'+t+"</h"+e+">\n":"<h"+e+">"+t+"</h"+e+">\n"},n.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},n.list=function(t,e,n){var r=e?"ol":"ul";return"<"+r+(e&&1!==n?' start="'+n+'"':"")+">\n"+t+"</"+r+">\n"},n.listitem=function(t){return"<li>"+t+"</li>\n"},n.checkbox=function(t){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "},n.paragraph=function(t){return"<p>"+t+"</p>\n"},n.table=function(t,e){return e&&(e="<tbody>"+e+"</tbody>"),"<table>\n<thead>\n"+t+"</thead>\n"+e+"</table>\n"},n.tablerow=function(t){return"<tr>\n"+t+"</tr>\n"},n.tablecell=function(t,e){var n=e.header?"th":"td";return(e.align?"<"+n+' align="'+e.align+'">':"<"+n+">")+t+"</"+n+">\n"},n.strong=function(t){return"<strong>"+t+"</strong>"},n.em=function(t){return"<em>"+t+"</em>"},n.codespan=function(t){return"<code>"+t+"</code>"},n.br=function(){return this.options.xhtml?"<br/>":"<br>"},n.del=function(t){return"<del>"+t+"</del>"},n.link=function(t,e,n){if(null===(t=x(this.options.sanitize,this.options.baseUrl,t)))return n;var r='<a href="'+t+'"';return e&&(r+=' title="'+e+'"'),r+=">"+n+"</a>"},n.image=function(t,e,n){if(null===(t=x(this.options.sanitize,this.options.baseUrl,t)))return n;var r='<img src="'+t+'" alt="'+n+'"';return e&&(r+=' title="'+e+'"'),r+=this.options.xhtml?"/>":">"},n.text=function(t){return t},t}(),I=function(){function t(){}var e=t.prototype;return e.strong=function(t){return t},e.em=function(t){return t},e.codespan=function(t){return t},e.del=function(t){return t},e.html=function(t){return t},e.text=function(t){return t},e.link=function(t,e,n){return""+n},e.image=function(t,e,n){return""+n},e.br=function(){return""},t}(),R=function(){function t(){this.seen={}}var e=t.prototype;return e.serialize=function(t){return t.toLowerCase().trim().replace(/<[!\/a-z].*?>/gi,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")},e.getNextSafeSlug=function(t,e){var n=t,r=0;if(this.seen.hasOwnProperty(n)){r=this.seen[t];do{n=t+"-"+ ++r}while(this.seen.hasOwnProperty(n))}return e||(this.seen[t]=r,this.seen[n]=0),n},e.slug=function(t,e){void 0===e&&(e={});var n=this.serialize(t);return this.getNextSafeSlug(n,e.dryrun)},t}(),j=function(){function t(t){this.options=t||e.NT,this.options.renderer=this.options.renderer||new N,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new I,this.slugger=new R}t.parse=function(e,n){return new t(n).parse(e)},t.parseInline=function(e,n){return new t(n).parseInline(e)};var n=t.prototype;return n.parse=function(t,e){void 0===e&&(e=!0);var n,r,i,o,a,s,l,u,c,h,d,f,p,m,v,y,b,x,w,C="",k=t.length;for(n=0;n<k;n++)if(h=t[n],!(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[h.type])||!1===(w=this.options.extensions.renderers[h.type].call({parser:this},h))&&["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(h.type))switch(h.type){case"space":continue;case"hr":C+=this.renderer.hr();continue;case"heading":C+=this.renderer.heading(this.parseInline(h.tokens),h.depth,g(this.parseInline(h.tokens,this.textRenderer)),this.slugger);continue;case"code":C+=this.renderer.code(h.text,h.lang,h.escaped);continue;case"table":for(u="",l="",o=h.header.length,r=0;r<o;r++)l+=this.renderer.tablecell(this.parseInline(h.header[r].tokens),{header:!0,align:h.align[r]});for(u+=this.renderer.tablerow(l),c="",o=h.rows.length,r=0;r<o;r++){for(l="",a=(s=h.rows[r]).length,i=0;i<a;i++)l+=this.renderer.tablecell(this.parseInline(s[i].tokens),{header:!1,align:h.align[i]});c+=this.renderer.tablerow(l)}C+=this.renderer.table(u,c);continue;case"blockquote":c=this.parse(h.tokens),C+=this.renderer.blockquote(c);continue;case"list":for(d=h.ordered,f=h.start,p=h.loose,o=h.items.length,c="",r=0;r<o;r++)y=(v=h.items[r]).checked,b=v.task,m="",v.task&&(x=this.renderer.checkbox(y),p?v.tokens.length>0&&"paragraph"===v.tokens[0].type?(v.tokens[0].text=x+" "+v.tokens[0].text,v.tokens[0].tokens&&v.tokens[0].tokens.length>0&&"text"===v.tokens[0].tokens[0].type&&(v.tokens[0].tokens[0].text=x+" "+v.tokens[0].tokens[0].text)):v.tokens.unshift({type:"text",text:x}):m+=x),m+=this.parse(v.tokens,p),c+=this.renderer.listitem(m,b,y);C+=this.renderer.list(c,d,f);continue;case"html":C+=this.renderer.html(h.text);continue;case"paragraph":C+=this.renderer.paragraph(this.parseInline(h.tokens));continue;case"text":for(c=h.tokens?this.parseInline(h.tokens):h.text;n+1<k&&"text"===t[n+1].type;)c+="\n"+((h=t[++n]).tokens?this.parseInline(h.tokens):h.text);C+=e?this.renderer.paragraph(c):c;continue;default:var S='Token with "'+h.type+'" type was not found.';if(this.options.silent)return void console.error(S);throw new Error(S)}else C+=w||"";return C},n.parseInline=function(t,e){e=e||this.renderer;var n,r,i,o="",a=t.length;for(n=0;n<a;n++)if(r=t[n],!(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[r.type])||!1===(i=this.options.extensions.renderers[r.type].call({parser:this},r))&&["escape","html","link","image","strong","em","codespan","br","del","text"].includes(r.type))switch(r.type){case"escape":case"text":o+=e.text(r.text);break;case"html":o+=e.html(r.text);break;case"link":o+=e.link(r.href,r.title,this.parseInline(r.tokens,e));break;case"image":o+=e.image(r.href,r.title,r.text);break;case"strong":o+=e.strong(this.parseInline(r.tokens,e));break;case"em":o+=e.em(this.parseInline(r.tokens,e));break;case"codespan":o+=e.codespan(r.text);break;case"br":o+=e.br();break;case"del":o+=e.del(this.parseInline(r.tokens,e));break;default:var s='Token with "'+r.type+'" type was not found.';if(this.options.silent)return void console.error(s);throw new Error(s)}else o+=i||"";return o},t}(),z=function(){function t(t){this.options=t||e.NT}var n=t.prototype;return n.preprocess=function(t){return t},n.postprocess=function(t){return t},t}();function H(t,e){return function(n,i,o){"function"==typeof i&&(o=i,i=null);var a=r({},i),s=function(t,e,n){return function(r){if(r.message+="\nPlease report this to https://github.com/markedjs/marked.",t){var i="<p>An error occurred:</p><pre>"+f(r.message+"",!0)+"</pre>";return e?Promise.resolve(i):n?void n(null,i):i}if(e)return Promise.reject(r);if(!n)throw r;n(r)}}((i=r({},G.defaults,a)).silent,i.async,o);if(null==n)return s(new Error("marked(): input parameter is undefined or null"));if("string"!=typeof n)return s(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));if(function(t){t&&t.sanitize&&!t.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}(i),i.hooks&&(i.hooks.options=i),o){var l,u=i.highlight;try{i.hooks&&(n=i.hooks.preprocess(n)),l=t(n,i)}catch(t){return s(t)}var c=function(t){var n;if(!t)try{i.walkTokens&&G.walkTokens(l,i.walkTokens),n=e(l,i),i.hooks&&(n=i.hooks.postprocess(n))}catch(e){t=e}return i.highlight=u,t?s(t):o(null,n)};if(!u||u.length<3)return c();if(delete i.highlight,!l.length)return c();var h=0;return G.walkTokens(l,(function(t){"code"===t.type&&(h++,setTimeout((function(){u(t.text,t.lang,(function(e,n){if(e)return c(e);null!=n&&n!==t.text&&(t.text=n,t.escaped=!0),0===--h&&c()}))}),0))})),void(0===h&&c())}if(i.async)return Promise.resolve(i.hooks?i.hooks.preprocess(n):n).then((function(e){return t(e,i)})).then((function(t){return i.walkTokens?Promise.all(G.walkTokens(t,i.walkTokens)).then((function(){return t})):t})).then((function(t){return e(t,i)})).then((function(t){return i.hooks?i.hooks.postprocess(t):t})).catch(s);try{i.hooks&&(n=i.hooks.preprocess(n));var d=t(n,i);i.walkTokens&&G.walkTokens(d,i.walkTokens);var p=e(d,i);return i.hooks&&(p=i.hooks.postprocess(p)),p}catch(t){return s(t)}}}function G(t,e,n){return H(B.lex,j.parse)(t,e,n)}z.passThroughHooks=new Set(["preprocess","postprocess"]),G.options=G.setOptions=function(t){var n;return G.defaults=r({},G.defaults,t),n=G.defaults,e.NT=n,G},G.getDefaults=a,G.defaults=e.NT,G.use=function(){for(var t=G.defaults.extensions||{renderers:{},childTokens:{}},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach((function(e){var n=r({},e);if(n.async=G.defaults.async||n.async||!1,e.extensions&&(e.extensions.forEach((function(e){if(!e.name)throw new Error("extension name required");if(e.renderer){var n=t.renderers[e.name];t.renderers[e.name]=n?function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var o=e.renderer.apply(this,r);return!1===o&&(o=n.apply(this,r)),o}:e.renderer}if(e.tokenizer){if(!e.level||"block"!==e.level&&"inline"!==e.level)throw new Error("extension level must be 'block' or 'inline'");t[e.level]?t[e.level].unshift(e.tokenizer):t[e.level]=[e.tokenizer],e.start&&("block"===e.level?t.startBlock?t.startBlock.push(e.start):t.startBlock=[e.start]:"inline"===e.level&&(t.startInline?t.startInline.push(e.start):t.startInline=[e.start]))}e.childTokens&&(t.childTokens[e.name]=e.childTokens)})),n.extensions=t),e.renderer&&function(){var t=G.defaults.renderer||new N,r=function(n){var r=t[n];t[n]=function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];var s=e.renderer[n].apply(t,o);return!1===s&&(s=r.apply(t,o)),s}};for(var i in e.renderer)r(i);n.renderer=t}(),e.tokenizer&&function(){var t=G.defaults.tokenizer||new F,r=function(n){var r=t[n];t[n]=function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];var s=e.tokenizer[n].apply(t,o);return!1===s&&(s=r.apply(t,o)),s}};for(var i in e.tokenizer)r(i);n.tokenizer=t}(),e.hooks&&function(){var t=G.defaults.hooks||new z,r=function(n){var r=t[n];z.passThroughHooks.has(n)?t[n]=function(i){if(G.defaults.async)return Promise.resolve(e.hooks[n].call(t,i)).then((function(e){return r.call(t,e)}));var o=e.hooks[n].call(t,i);return r.call(t,o)}:t[n]=function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];var s=e.hooks[n].apply(t,o);return!1===s&&(s=r.apply(t,o)),s}};for(var i in e.hooks)r(i);n.hooks=t}(),e.walkTokens){var i=G.defaults.walkTokens;n.walkTokens=function(t){var n=[];return n.push(e.walkTokens.call(this,t)),i&&(n=n.concat(i.call(this,t))),n}}G.setOptions(n)}))},G.walkTokens=function(t,e){for(var n,r=[],i=function(){var t=n.value;switch(r=r.concat(e.call(G,t)),t.type){case"table":for(var i,a=o(t.header);!(i=a()).done;){var s=i.value;r=r.concat(G.walkTokens(s.tokens,e))}for(var l,u=o(t.rows);!(l=u()).done;)for(var c,h=o(l.value);!(c=h()).done;){var d=c.value;r=r.concat(G.walkTokens(d.tokens,e))}break;case"list":r=r.concat(G.walkTokens(t.items,e));break;default:G.defaults.extensions&&G.defaults.extensions.childTokens&&G.defaults.extensions.childTokens[t.type]?G.defaults.extensions.childTokens[t.type].forEach((function(n){r=r.concat(G.walkTokens(t[n],e))})):t.tokens&&(r=r.concat(G.walkTokens(t.tokens,e)))}},a=o(t);!(n=a()).done;)i();return r},G.parseInline=H(B.lexInline,j.parseInline),G.Parser=j,G.parser=j.parse,G.Renderer=N,G.TextRenderer=I,G.Lexer=B,G.lexer=B.lex,G.Tokenizer=F,G.Slugger=R,G.Hooks=z,G.parse=G;var W=G.options,q=G.setOptions,U=G.use,K=G.walkTokens,$=G.parseInline,Y=G,V=j.parse,X=B.lex;e.xI=G},7018:function(t,e,n){var r,i,o,a=this&&this.__extends||(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},l=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))},u=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};r=[n,e,n(9180)],i=function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TagsPane=void 0;var r=function(t){function e(){var e=t.apply(this,l([],s(arguments),!1))||this;return e.from=null,e.waitDbClickNode=null,e._isInited=!1,e}return a(e,t),e.prototype.setAppCommands=function(t){this.appCommands=t},e.prototype.onResize=function(){this.stage.width(this.width),this.stage.height(this.height)},e.prototype.isInited=function(){return this._isInited},e.prototype.init=function(e){this._isInited||(this.width=window.innerWidth,this.height=window.innerHeight,t.prototype.init.call(this,e),this._isInited=!0)},e.prototype.longTouch=function(t,e){var n=this,r=this.storage.getByCoords(t);if(null!==this.from||!r)return this.from==r?(confirm("Удалить?")&&this.appCommands.deleteTag(r.getId()).then((function(t){t.success&&(n.getStorage().remove(r),r.remove(),n.linker.removeFor(r),n.appBus.updateNavigatonPanel())})),void(this.from=null)):this.from&&r&&!this.linker.isLinked(this.from,r)?(this.appCommands.linkTags(this.from.getId(),r.getId()).then((function(t){if(t.success){var e=t.link.from,r=t.link.to;n.appBus.link(e,r),n.from=null,n.appBus.updateNavigatonPanel()}})),void(this.from=null)):this.from&&r&&this.linker.isLinked(this.from,r)?(this.appCommands.unlinkTags(this.from.getId(),r.getId()).then((function(t){t.success&&(n.appBus.unlink(n.from,r),n.from=null,n.appBus.updateNavigatonPanel())})),void(this.from=null)):void 0;this.from=r},e.prototype.click=function(t,e){var n=this,r=this.storage.getByCoords(t);if(r&&e.evt.ctrlKey)return null===this.from&&r?void(this.from=r):this.from==r?(confirm("Удалить?")&&this.appCommands.deleteTag(r.getId()).then((function(t){t.success&&(n.getStorage().remove(r),r.remove(),n.linker.removeFor(r),n.appBus.updateNavigatonPanel())})),void(this.from=null)):this.from&&r&&!this.linker.isLinked(this.from,r)?(this.appCommands.linkTags(this.from.getId(),r.getId()).then((function(t){if(t.success){var e=t.link.from,r=t.link.to;n.appBus.link(e,r),n.from=null,n.appBus.updateNavigatonPanel()}})),void(this.from=null)):this.from&&r&&this.linker.isLinked(this.from,r)?(this.appCommands.unlinkTags(this.from.getId(),r.getId()).then((function(t){t.success&&(n.appBus.unlink(n.from,r),n.from=null,n.appBus.updateNavigatonPanel())})),void(this.from=null)):void 0;if(r){if(r&&(this.linker.highlightFor(r),this.linker.drawLines()),r&&!this.waitDbClickNode)return this.waitDbClickNode=r,void setTimeout((function(){n.waitDbClickNode=null}),200);if(r==this.waitDbClickNode){var i=prompt("Тэг"),o=r.getData();i&&(o.title=i,this.appCommands.updateTag(o).then((function(t){t.success&&(r.load(o),n.appBus.updateNavigatonPanel())}))),this.waitDbClickNode=null}}else this.appCommands.createTag({id:"tag_"+this.getRandomString(32),x:t.x,y:t.y,title:""}).then((function(e){e.success&&n.appBus.addShape(2,{id:e.tag.id,x:t.x,y:t.y})}))},e.prototype.getRandomString=function(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;r<t;r++)n+=e.charAt(Math.floor(62*Math.random()));return n},e.prototype.update=function(t){},e.prototype.loadNotes=function(t){var e,n;try{for(var r=u(t),i=r.next();!i.done;i=r.next()){var o=i.value,a=this.shapesFactory.createShape(2);a.init(o),a.load(o),this.storage.pushShape(a),a.addToLayer(this.layer)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},e.prototype.loadLinks=function(t){var e,n;try{for(var r=u(t),i=r.next();!i.done;i=r.next()){var o=i.value,a=this.storage.getById(o.from),s=this.storage.getById(o.to);a&&s&&this.linker.linkShapes(a,s)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}this.linker.drawLines()},e}(n.AbstractPane);e.TagsPane=r}.apply(e,r),void 0===i||(t.exports=i)},7159:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>sn});var r=Math.PI/180;const i="undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope?self:{},o={_global:i,version:"8.4.3",isBrowser:"undefined"!=typeof window&&("[object Window]"==={}.toString.call(window)||"[object global]"==={}.toString.call(window)),isUnminified:/param/.test(function(t){}.toString()),dblClickWindow:400,getAngle:t=>o.angleDeg?t*r:t,enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,pixelRatio:"undefined"!=typeof window&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging:()=>o.DD.isDragging,isDragReady:()=>!!o.DD.node,releaseCanvasOnDestroy:!0,document:i.document,_injectGlobal(t){i.Konva=t}},a=t=>{o[t.prototype.getClassName()]=t};o._injectGlobal(o);class s{constructor(t=[1,0,0,1,0,0]){this.dirty=!1,this.m=t&&t.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new s(this.m)}copyInto(t){t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5]}point(t){var e=this.m;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}}translate(t,e){return this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e,this}scale(t,e){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e,this}rotate(t){var e=Math.cos(t),n=Math.sin(t),r=this.m[0]*e+this.m[2]*n,i=this.m[1]*e+this.m[3]*n,o=this.m[0]*-n+this.m[2]*e,a=this.m[1]*-n+this.m[3]*e;return this.m[0]=r,this.m[1]=i,this.m[2]=o,this.m[3]=a,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(t,e){var n=this.m[0]+this.m[2]*e,r=this.m[1]+this.m[3]*e,i=this.m[2]+this.m[0]*t,o=this.m[3]+this.m[1]*t;return this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=o,this}multiply(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],n=this.m[1]*t.m[0]+this.m[3]*t.m[1],r=this.m[0]*t.m[2]+this.m[2]*t.m[3],i=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],a=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=e,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=o,this.m[5]=a,this}invert(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,n=-this.m[1]*t,r=-this.m[2]*t,i=this.m[0]*t,o=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),a=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=e,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=o,this.m[5]=a,this}getMatrix(){return this.m}decompose(){var t=this.m[0],e=this.m[1],n=this.m[2],r=this.m[3],i=t*r-e*n;let o={x:this.m[4],y:this.m[5],rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(0!=t||0!=e){var a=Math.sqrt(t*t+e*e);o.rotation=e>0?Math.acos(t/a):-Math.acos(t/a),o.scaleX=a,o.scaleY=i/a,o.skewX=(t*n+e*r)/i,o.skewY=0}else if(0!=n||0!=r){var s=Math.sqrt(n*n+r*r);o.rotation=Math.PI/2-(r>0?Math.acos(-n/s):-Math.acos(n/s)),o.scaleX=i/s,o.scaleY=s,o.skewX=0,o.skewY=(t*n+e*r)/i}return o.rotation=g._getRotation(o.rotation),o}}var l=Math.PI/180,u=180/Math.PI,c="Konva error: ",h={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},d=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,f=[];const p="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||function(t){setTimeout(t,60)},g={_isElement:t=>!(!t||1!=t.nodeType),_isFunction:t=>!!(t&&t.constructor&&t.call&&t.apply),_isPlainObject:t=>!!t&&t.constructor===Object,_isArray:t=>"[object Array]"===Object.prototype.toString.call(t),_isNumber:t=>"[object Number]"===Object.prototype.toString.call(t)&&!isNaN(t)&&isFinite(t),_isString:t=>"[object String]"===Object.prototype.toString.call(t),_isBoolean:t=>"[object Boolean]"===Object.prototype.toString.call(t),isObject:t=>t instanceof Object,isValidSelector(t){if("string"!=typeof t)return!1;var e=t[0];return"#"===e||"."===e||e===e.toUpperCase()},_sign:t=>0===t||t>0?1:-1,requestAnimFrame(t){f.push(t),1===f.length&&p((function(){const t=f;f=[],t.forEach((function(t){t()}))}))},createCanvasElement(){var t=document.createElement("canvas");try{t.style=t.style||{}}catch(t){}return t},createImageElement:()=>document.createElement("img"),_isInDocument(t){for(;t=t.parentNode;)if(t==document)return!0;return!1},_urlToImage(t,e){var n=g.createImageElement();n.onload=function(){e(n)},n.src=t},_rgbToHex:(t,e,n)=>((1<<24)+(t<<16)+(e<<8)+n).toString(16).slice(1),_hexToRgb(t){t=t.replace("#","");var e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e}},getRandomColor(){for(var t=(16777215*Math.random()|0).toString(16);t.length<6;)t="0"+t;return"#"+t},getRGB(t){var e;return t in h?{r:(e=h[t])[0],g:e[1],b:e[2]}:"#"===t[0]?this._hexToRgb(t.substring(1)):"rgb("===t.substr(0,4)?(e=d.exec(t.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},colorToRGBA:t=>(t=t||"black",g._namedColorToRBA(t)||g._hex3ColorToRGBA(t)||g._hex4ColorToRGBA(t)||g._hex6ColorToRGBA(t)||g._hex8ColorToRGBA(t)||g._rgbColorToRGBA(t)||g._rgbaColorToRGBA(t)||g._hslColorToRGBA(t)),_namedColorToRBA(t){var e=h[t.toLowerCase()];return e?{r:e[0],g:e[1],b:e[2],a:1}:null},_rgbColorToRGBA(t){if(0===t.indexOf("rgb(")){var e=(t=t.match(/rgb\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:1}}},_rgbaColorToRGBA(t){if(0===t.indexOf("rgba(")){var e=(t=t.match(/rgba\(([^)]+)\)/)[1]).split(/ *, */).map(((t,e)=>"%"===t.slice(-1)?3===e?parseInt(t)/100:parseInt(t)/100*255:Number(t)));return{r:e[0],g:e[1],b:e[2],a:e[3]}}},_hex8ColorToRGBA(t){if("#"===t[0]&&9===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:parseInt(t.slice(7,9),16)/255}},_hex6ColorToRGBA(t){if("#"===t[0]&&7===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:1}},_hex4ColorToRGBA(t){if("#"===t[0]&&5===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:parseInt(t[4]+t[4],16)/255}},_hex3ColorToRGBA(t){if("#"===t[0]&&4===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1}},_hslColorToRGBA(t){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(t)){const[e,...n]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t),r=Number(n[0])/360,i=Number(n[1])/100,o=Number(n[2])/100;let a,s,l;if(0===i)return l=255*o,{r:Math.round(l),g:Math.round(l),b:Math.round(l),a:1};a=o<.5?o*(1+i):o+i-o*i;const u=2*o-a,c=[0,0,0];for(let t=0;t<3;t++)s=r+1/3*-(t-1),s<0&&s++,s>1&&s--,l=6*s<1?u+6*(a-u)*s:2*s<1?a:3*s<2?u+(a-u)*(2/3-s)*6:u,c[t]=255*l;return{r:Math.round(c[0]),g:Math.round(c[1]),b:Math.round(c[2]),a:1}}},haveIntersection:(t,e)=>!(e.x>t.x+t.width||e.x+e.width<t.x||e.y>t.y+t.height||e.y+e.height<t.y),cloneObject(t){var e={};for(var n in t)this._isPlainObject(t[n])?e[n]=this.cloneObject(t[n]):this._isArray(t[n])?e[n]=this.cloneArray(t[n]):e[n]=t[n];return e},cloneArray:t=>t.slice(0),degToRad:t=>t*l,radToDeg:t=>t*u,_degToRad:t=>(g.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),g.degToRad(t)),_radToDeg:t=>(g.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),g.radToDeg(t)),_getRotation:t=>o.angleDeg?g.radToDeg(t):t,_capitalize:t=>t.charAt(0).toUpperCase()+t.slice(1),throw(t){throw new Error(c+t)},error(t){console.error(c+t)},warn(t){o.showWarnings&&console.warn("Konva warning: "+t)},each(t,e){for(var n in t)e(n,t[n])},_inRange:(t,e,n)=>e<=t&&t<n,_getProjectionToSegment(t,e,n,r,i,o){var a,s,l,u=(t-n)*(t-n)+(e-r)*(e-r);if(0==u)a=t,s=e,l=(i-n)*(i-n)+(o-r)*(o-r);else{var c=((i-t)*(n-t)+(o-e)*(r-e))/u;c<0?(a=t,s=e,l=(t-i)*(t-i)+(e-o)*(e-o)):c>1?(a=n,s=r,l=(n-i)*(n-i)+(r-o)*(r-o)):l=((a=t+c*(n-t))-i)*(a-i)+((s=e+c*(r-e))-o)*(s-o)}return[a,s,l]},_getProjectionToLine(t,e,n){var r=g.cloneObject(t),i=Number.MAX_VALUE;return e.forEach((function(o,a){if(n||a!==e.length-1){var s=e[(a+1)%e.length],l=g._getProjectionToSegment(o.x,o.y,s.x,s.y,t.x,t.y),u=l[0],c=l[1],h=l[2];h<i&&(r.x=u,r.y=c,i=h)}})),r},_prepareArrayForTween(t,e,n){var r,i=[],o=[];if(t.length>e.length){var a=e;e=t,t=a}for(r=0;r<t.length;r+=2)i.push({x:t[r],y:t[r+1]});for(r=0;r<e.length;r+=2)o.push({x:e[r],y:e[r+1]});var s=[];return o.forEach((function(t){var e=g._getProjectionToLine(t,i,n);s.push(e.x),s.push(e.y)})),s},_prepareToStringify(t){var e;for(var n in t.visitedByCircularReferenceRemoval=!0,t)if(t.hasOwnProperty(n)&&t[n]&&"object"==typeof t[n])if(e=Object.getOwnPropertyDescriptor(t,n),t[n].visitedByCircularReferenceRemoval||g._isElement(t[n])){if(!e.configurable)return null;delete t[n]}else if(null===g._prepareToStringify(t[n])){if(!e.configurable)return null;delete t[n]}return delete t.visitedByCircularReferenceRemoval,t},_assign(t,e){for(var n in e)t[n]=e[n];return t},_getFirstPointerId:t=>t.touches?t.changedTouches[0].identifier:t.pointerId||999,releaseCanvas(...t){o.releaseCanvasOnDestroy&&t.forEach((t=>{t.width=0,t.height=0}))},drawRoundedRectPath(t,e,n,r){let i=0,o=0,a=0,s=0;"number"==typeof r?i=o=a=s=Math.min(r,e/2,n/2):(i=Math.min(r[0]||0,e/2,n/2),o=Math.min(r[1]||0,e/2,n/2),s=Math.min(r[2]||0,e/2,n/2),a=Math.min(r[3]||0,e/2,n/2)),t.moveTo(i,0),t.lineTo(e-o,0),t.arc(e-o,o,o,3*Math.PI/2,0,!1),t.lineTo(e,n-s),t.arc(e-s,n-s,s,0,Math.PI/2,!1),t.lineTo(a,n),t.arc(a,n-a,a,Math.PI/2,Math.PI,!1),t.lineTo(0,i),t.arc(i,i,i,Math.PI,3*Math.PI/2,!1)}};function m(t){return g._isString(t)?'"'+t+'"':"[object Number]"===Object.prototype.toString.call(t)||g._isBoolean(t)?t:Object.prototype.toString.call(t)}function v(t){return t>255?255:t<0?0:Math.round(t)}function y(){if(o.isUnminified)return function(t,e){return g._isNumber(t)||g.warn(m(t)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),t}}function b(t){if(o.isUnminified)return function(e,n){let r=g._isNumber(e),i=g._isArray(e)&&e.length==t;return r||i||g.warn(m(e)+' is a not valid value for "'+n+'" attribute. The value should be a number or Array<number>('+t+")"),e}}function x(){if(o.isUnminified)return function(t,e){return g._isNumber(t)||"auto"===t||g.warn(m(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),t}}function w(){if(o.isUnminified)return function(t,e){return g._isString(t)||g.warn(m(t)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),t}}function C(){if(o.isUnminified)return function(t,e){const n=g._isString(t),r="[object CanvasGradient]"===Object.prototype.toString.call(t)||t&&t.addColorStop;return n||r||g.warn(m(t)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),t}}function k(){if(o.isUnminified)return function(t,e){return!0===t||!1===t||g.warn(m(t)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),t}}var S="get",_="set";const D={addGetterSetter(t,e,n,r,i){D.addGetter(t,e,n),D.addSetter(t,e,r,i),D.addOverloadedGetterSetter(t,e)},addGetter(t,e,n){var r=S+g._capitalize(e);t.prototype[r]=t.prototype[r]||function(){var t=this.attrs[e];return void 0===t?n:t}},addSetter(t,e,n,r){var i=_+g._capitalize(e);t.prototype[i]||D.overWriteSetter(t,e,n,r)},overWriteSetter(t,e,n,r){var i=_+g._capitalize(e);t.prototype[i]=function(t){return n&&null!=t&&(t=n.call(this,t,e)),this._setAttr(e,t),r&&r.call(this),this}},addComponentsGetterSetter(t,e,n,r,i){var a,s,l=n.length,u=g._capitalize,c=S+u(e),h=_+u(e);t.prototype[c]=function(){var t={};for(a=0;a<l;a++)t[s=n[a]]=this.getAttr(e+u(s));return t};var d=function(t){if(o.isUnminified)return function(e,n){return null==e||g.isObject(e)||g.warn(m(e)+' is a not valid value for "'+n+'" attribute. The value should be an object with properties '+t),e}}(n);t.prototype[h]=function(t){var o,a=this.attrs[e];for(o in r&&(t=r.call(this,t)),d&&d.call(this,t,e),t)t.hasOwnProperty(o)&&this._setAttr(e+u(o),t[o]);return t||n.forEach((t=>{this._setAttr(e+u(t),void 0)})),this._fireChangeEvent(e,a,t),i&&i.call(this),this},D.addOverloadedGetterSetter(t,e)},addOverloadedGetterSetter(t,e){var n=g._capitalize(e),r=_+n,i=S+n;t.prototype[e]=function(){return arguments.length?(this[r](arguments[0]),this):this[i]()}},addDeprecatedGetterSetter(t,e,n,r){g.error("Adding deprecated "+e);var i=S+g._capitalize(e),o=e+" property is deprecated and will be removed soon. Look at Konva change log for more information.";t.prototype[i]=function(){g.error(o);var t=this.attrs[e];return void 0===t?n:t},D.addSetter(t,e,r,(function(){g.error(o)})),D.addOverloadedGetterSetter(t,e)},backCompat(t,e){g.each(e,(function(e,n){var r=t.prototype[n],i=S+g._capitalize(e),o=_+g._capitalize(e);function a(){r.apply(this,arguments),g.error('"'+e+'" method is deprecated and will be removed soon. Use ""'+n+'" instead.')}t.prototype[e]=a,t.prototype[i]=a,t.prototype[o]=a}))},afterSetFilter(){this._filterUpToDate=!1}};var A=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];class T{constructor(t){this.canvas=t,o.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(t){t.fillEnabled()&&this._fill(t)}_fill(t){}strokeShape(t){t.hasStroke()&&this._stroke(t)}_stroke(t){}fillStrokeShape(t){t.attrs.fillAfterStrokeEnabled?(this.strokeShape(t),this.fillShape(t)):(this.fillShape(t),this.strokeShape(t))}getTrace(t,e){var n,r,i,o,a=this.traceArr,s=a.length,l="";for(n=0;n<s;n++)(i=(r=a[n]).method)?(o=r.args,l+=i,t?l+="()":g._isArray(o[0])?l+="(["+o.join(",")+"])":(e&&(o=o.map((t=>"number"==typeof t?Math.floor(t):t))),l+="("+o.join(",")+")")):(l+=r.property,t||(l+="="+r.val)),l+=";";return l}clearTrace(){this.traceArr=[]}_trace(t){var e=this.traceArr;e.push(t),e.length>=100&&e.shift()}reset(){var t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)}getCanvas(){return this.canvas}clear(t){var e=this.getCanvas();t?this.clearRect(t.x||0,t.y||0,t.width||0,t.height||0):this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)}_applyLineCap(t){const e=t.attrs.lineCap;e&&this.setAttr("lineCap",e)}_applyOpacity(t){var e=t.getAbsoluteOpacity();1!==e&&this.setAttr("globalAlpha",e)}_applyLineJoin(t){const e=t.attrs.lineJoin;e&&this.setAttr("lineJoin",e)}setAttr(t,e){this._context[t]=e}arc(t,e,n,r,i,o){this._context.arc(t,e,n,r,i,o)}arcTo(t,e,n,r,i){this._context.arcTo(t,e,n,r,i)}beginPath(){this._context.beginPath()}bezierCurveTo(t,e,n,r,i,o){this._context.bezierCurveTo(t,e,n,r,i,o)}clearRect(t,e,n,r){this._context.clearRect(t,e,n,r)}clip(){this._context.clip()}closePath(){this._context.closePath()}createImageData(t,e){var n=arguments;return 2===n.length?this._context.createImageData(t,e):1===n.length?this._context.createImageData(t):void 0}createLinearGradient(t,e,n,r){return this._context.createLinearGradient(t,e,n,r)}createPattern(t,e){return this._context.createPattern(t,e)}createRadialGradient(t,e,n,r,i,o){return this._context.createRadialGradient(t,e,n,r,i,o)}drawImage(t,e,n,r,i,o,a,s,l){var u=arguments,c=this._context;3===u.length?c.drawImage(t,e,n):5===u.length?c.drawImage(t,e,n,r,i):9===u.length&&c.drawImage(t,e,n,r,i,o,a,s,l)}ellipse(t,e,n,r,i,o,a,s){this._context.ellipse(t,e,n,r,i,o,a,s)}isPointInPath(t,e,n,r){return n?this._context.isPointInPath(n,t,e,r):this._context.isPointInPath(t,e,r)}fill(t){t?this._context.fill(t):this._context.fill()}fillRect(t,e,n,r){this._context.fillRect(t,e,n,r)}strokeRect(t,e,n,r){this._context.strokeRect(t,e,n,r)}fillText(t,e,n,r){r?this._context.fillText(t,e,n,r):this._context.fillText(t,e,n)}measureText(t){return this._context.measureText(t)}getImageData(t,e,n,r){return this._context.getImageData(t,e,n,r)}lineTo(t,e){this._context.lineTo(t,e)}moveTo(t,e){this._context.moveTo(t,e)}rect(t,e,n,r){this._context.rect(t,e,n,r)}putImageData(t,e,n){this._context.putImageData(t,e,n)}quadraticCurveTo(t,e,n,r){this._context.quadraticCurveTo(t,e,n,r)}restore(){this._context.restore()}rotate(t){this._context.rotate(t)}save(){this._context.save()}scale(t,e){this._context.scale(t,e)}setLineDash(t){this._context.setLineDash?this._context.setLineDash(t):"mozDash"in this._context?this._context.mozDash=t:"webkitLineDash"in this._context&&(this._context.webkitLineDash=t)}getLineDash(){return this._context.getLineDash()}setTransform(t,e,n,r,i,o){this._context.setTransform(t,e,n,r,i,o)}stroke(t){t?this._context.stroke(t):this._context.stroke()}strokeText(t,e,n,r){this._context.strokeText(t,e,n,r)}transform(t,e,n,r,i,o){this._context.transform(t,e,n,r,i,o)}translate(t,e){this._context.translate(t,e)}_enableTrace(){var t,e,n=this,r=A.length,i=this.setAttr,o=function(t){var r,i=n[t];n[t]=function(){return e=function(t){var e,n,r=[],i=t.length,o=g;for(e=0;e<i;e++)n=t[e],o._isNumber(n)?n=Math.round(1e3*n)/1e3:o._isString(n)||(n+=""),r.push(n);return r}(Array.prototype.slice.call(arguments,0)),r=i.apply(n,arguments),n._trace({method:t,args:e}),r}};for(t=0;t<r;t++)o(A[t]);n.setAttr=function(){i.apply(n,arguments);var t=arguments[0],e=arguments[1];"shadowOffsetX"!==t&&"shadowOffsetY"!==t&&"shadowBlur"!==t||(e/=this.canvas.getPixelRatio()),n._trace({property:t,val:e})}}_applyGlobalCompositeOperation(t){const e=t.attrs.globalCompositeOperation;!e||"source-over"===e||this.setAttr("globalCompositeOperation",e)}}["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"].forEach((function(t){Object.defineProperty(T.prototype,t,{get(){return this._context[t]},set(e){this._context[t]=e}})}));class E extends T{constructor(t){super(t),this._context=t._canvas.getContext("2d")}_fillColor(t){var e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)}_fillPattern(t){this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)}_fillLinearGradient(t){var e=t._getLinearGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fillRadialGradient(t){const e=t._getRadialGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fill(t){const e=t.fill(),n=t.getFillPriority();if(e&&"color"===n)return void this._fillColor(t);const r=t.getFillPatternImage();if(r&&"pattern"===n)return void this._fillPattern(t);const i=t.getFillLinearGradientColorStops();if(i&&"linear-gradient"===n)return void this._fillLinearGradient(t);const o=t.getFillRadialGradientColorStops();o&&"radial-gradient"===n?this._fillRadialGradient(t):e?this._fillColor(t):r?this._fillPattern(t):i?this._fillLinearGradient(t):o&&this._fillRadialGradient(t)}_strokeLinearGradient(t){const e=t.getStrokeLinearGradientStartPoint(),n=t.getStrokeLinearGradientEndPoint(),r=t.getStrokeLinearGradientColorStops(),i=this.createLinearGradient(e.x,e.y,n.x,n.y);if(r){for(var o=0;o<r.length;o+=2)i.addColorStop(r[o],r[o+1]);this.setAttr("strokeStyle",i)}}_stroke(t){var e=t.dash(),n=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!n){this.save();var r=this.getCanvas().getPixelRatio();this.setTransform(r,0,0,r,0,0)}this._applyLineCap(t),e&&t.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),t.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),n||this.restore()}}_applyShadow(t){var e,n,r,i=null!==(e=t.getShadowRGBA())&&void 0!==e?e:"black",o=null!==(n=t.getShadowBlur())&&void 0!==n?n:5,a=null!==(r=t.getShadowOffset())&&void 0!==r?r:{x:0,y:0},s=t.getAbsoluteScale(),l=this.canvas.getPixelRatio(),u=s.x*l,c=s.y*l;this.setAttr("shadowColor",i),this.setAttr("shadowBlur",o*Math.min(Math.abs(u),Math.abs(c))),this.setAttr("shadowOffsetX",a.x*u),this.setAttr("shadowOffsetY",a.y*c)}}class F extends T{constructor(t){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:!0})}_fill(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()}strokeShape(t){t.hasHitStroke()&&this._stroke(t)}_stroke(t){if(t.hasHitStroke()){const i=t.getStrokeScaleEnabled();if(!i){this.save();var e=this.getCanvas().getPixelRatio();this.setTransform(e,0,0,e,0,0)}this._applyLineCap(t);var n=t.hitStrokeWidth(),r="auto"===n?t.strokeWidth():n;this.setAttr("lineWidth",r),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),i||this.restore()}}}var L;class P{constructor(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var e=(t||{}).pixelRatio||o.pixelRatio||function(){if(L)return L;var t=g.createCanvasElement(),e=t.getContext("2d");return L=(o._global.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1),g.releaseCanvas(t),L}();this.pixelRatio=e,this._canvas=g.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(t){var e=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/e,this.getHeight()/e)}setWidth(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";var e=this.pixelRatio;this.getContext()._context.scale(e,e)}setHeight(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";var e=this.pixelRatio;this.getContext()._context.scale(e,e)}getWidth(){return this.width}getHeight(){return this.height}setSize(t,e){this.setWidth(t||0),this.setHeight(e||0)}toDataURL(t,e){try{return this._canvas.toDataURL(t,e)}catch(t){try{return this._canvas.toDataURL()}catch(t){return g.error("Unable to get data URL. "+t.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}D.addGetterSetter(P,"pixelRatio",void 0,y());class O extends P{constructor(t={width:0,height:0}){super(t),this.context=new E(this),this.setSize(t.width,t.height)}}class M extends P{constructor(t={width:0,height:0}){super(t),this.hitCanvas=!0,this.context=new F(this),this.setSize(t.width,t.height)}}const B={get isDragging(){var t=!1;return B._dragElements.forEach((e=>{"dragging"===e.dragStatus&&(t=!0)})),t},justDragged:!1,get node(){var t;return B._dragElements.forEach((e=>{t=e.node})),t},_dragElements:new Map,_drag(t){const e=[];B._dragElements.forEach(((n,r)=>{const{node:i}=n,o=i.getStage();o.setPointersPositions(t),void 0===n.pointerId&&(n.pointerId=g._getFirstPointerId(t));const a=o._changedPointerPositions.find((t=>t.id===n.pointerId));if(a){if("dragging"!==n.dragStatus){var s=i.dragDistance();if(Math.max(Math.abs(a.x-n.startPointerPos.x),Math.abs(a.y-n.startPointerPos.y))<s)return;if(i.startDrag({evt:t}),!i.isDragging())return}i._setDragPosition(t,n),e.push(i)}})),e.forEach((e=>{e.fire("dragmove",{type:"dragmove",target:e,evt:t},!0)}))},_endDragBefore(t){const e=[];B._dragElements.forEach((n=>{const{node:r}=n,i=r.getStage();t&&i.setPointersPositions(t);if(!i._changedPointerPositions.find((t=>t.id===n.pointerId)))return;"dragging"!==n.dragStatus&&"stopped"!==n.dragStatus||(B.justDragged=!0,o._mouseListenClick=!1,o._touchListenClick=!1,o._pointerListenClick=!1,n.dragStatus="stopped");const a=n.node.getLayer()||n.node instanceof o.Stage&&n.node;a&&-1===e.indexOf(a)&&e.push(a)})),e.forEach((t=>{t.draw()}))},_endDragAfter(t){B._dragElements.forEach(((e,n)=>{"stopped"===e.dragStatus&&e.node.fire("dragend",{type:"dragend",target:e.node,evt:t},!0),"dragging"!==e.dragStatus&&B._dragElements.delete(n)}))}};o.isBrowser&&(window.addEventListener("mouseup",B._endDragBefore,!0),window.addEventListener("touchend",B._endDragBefore,!0),window.addEventListener("mousemove",B._drag),window.addEventListener("touchmove",B._drag),window.addEventListener("mouseup",B._endDragAfter,!1),window.addEventListener("touchend",B._endDragAfter,!1));var N="absoluteOpacity",I="allEventListeners",R="absoluteTransform",j="absoluteScale",z="canvas",H="listening",G="mouseenter",W="mouseleave",q="Shape",U=" ",K="stage",$="transform",Y="visible",V=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(U);let X=1;class J{constructor(t){this._id=X++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(t),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(t){t!==$&&t!==R||!this._cache.get(t)?t?this._cache.delete(t):this._cache.clear():this._cache.get(t).dirty=!0}_getCache(t,e){var n=this._cache.get(t);return(void 0===n||(t===$||t===R)&&!0===n.dirty)&&(n=e.call(this),this._cache.set(t,n)),n}_calculate(t,e,n){if(!this._attachedDepsListeners.get(t)){const n=e.map((t=>t+"Change.konva")).join(U);this.on(n,(()=>{this._clearCache(t)})),this._attachedDepsListeners.set(t,!0)}return this._getCache(t,n)}_getCanvasCache(){return this._cache.get(z)}_clearSelfAndDescendantCache(t){this._clearCache(t),t===R&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(z)){const{scene:t,filter:e,hit:n}=this._cache.get(z);g.releaseCanvas(t,e,n),this._cache.delete(z)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(t){var e=t||{},n={};void 0!==e.x&&void 0!==e.y&&void 0!==e.width&&void 0!==e.height||(n=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()}));var r=Math.ceil(e.width||n.width),i=Math.ceil(e.height||n.height),o=e.pixelRatio,a=void 0===e.x?Math.floor(n.x):e.x,s=void 0===e.y?Math.floor(n.y):e.y,l=e.offset||0,u=e.drawBorder||!1,c=e.hitCanvasPixelRatio||1;if(r&&i){a-=l,s-=l;var h=new O({pixelRatio:o,width:r+=2*l+1,height:i+=2*l+1}),d=new O({pixelRatio:o,width:0,height:0}),f=new M({pixelRatio:c,width:r,height:i}),p=h.getContext(),m=f.getContext();return f.isCache=!0,h.isCache=!0,this._cache.delete(z),this._filterUpToDate=!1,!1===e.imageSmoothingEnabled&&(h.getContext()._context.imageSmoothingEnabled=!1,d.getContext()._context.imageSmoothingEnabled=!1),p.save(),m.save(),p.translate(-a,-s),m.translate(-a,-s),this._isUnderCache=!0,this._clearSelfAndDescendantCache(N),this._clearSelfAndDescendantCache(j),this.drawScene(h,this),this.drawHit(f,this),this._isUnderCache=!1,p.restore(),m.restore(),u&&(p.save(),p.beginPath(),p.rect(0,0,r,i),p.closePath(),p.setAttr("strokeStyle","red"),p.setAttr("lineWidth",5),p.stroke(),p.restore()),this._cache.set(z,{scene:h,filter:d,hit:f,x:a,y:s}),this._requestDraw(),this}g.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.")}isCached(){return this._cache.has(z)}getClientRect(t){throw new Error('abstract "getClientRect" method call')}_transformedRect(t,e){var n,r,i,o,a=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}],s=this.getAbsoluteTransform(e);return a.forEach((function(t){var e=s.point(t);void 0===n&&(n=i=e.x,r=o=e.y),n=Math.min(n,e.x),r=Math.min(r,e.y),i=Math.max(i,e.x),o=Math.max(o,e.y)})),{x:n,y:r,width:i-n,height:o-r}}_drawCachedSceneCanvas(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this);const e=this._getCanvasCache();t.translate(e.x,e.y);var n=this._getCachedSceneCanvas(),r=n.pixelRatio;t.drawImage(n._canvas,0,0,n.width/r,n.height/r),t.restore()}_drawCachedHitCanvas(t){var e=this._getCanvasCache(),n=e.hit;t.save(),t.translate(e.x,e.y),t.drawImage(n._canvas,0,0,n.width/n.pixelRatio,n.height/n.pixelRatio),t.restore()}_getCachedSceneCanvas(){var t,e,n,r,i=this.filters(),o=this._getCanvasCache(),a=o.scene,s=o.filter,l=s.getContext();if(i){if(!this._filterUpToDate){var u=a.pixelRatio;s.setSize(a.width/a.pixelRatio,a.height/a.pixelRatio);try{for(t=i.length,l.clear(),l.drawImage(a._canvas,0,0,a.getWidth()/u,a.getHeight()/u),e=l.getImageData(0,0,s.getWidth(),s.getHeight()),n=0;n<t;n++)"function"==typeof(r=i[n])?(r.call(this,e),l.putImageData(e,0,0)):g.error("Filter should be type of function, but got "+typeof r+" instead. Please check correct filters")}catch(t){g.error("Unable to apply filter. "+t.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return s}return a}on(t,e){if(this._cache&&this._cache.delete(I),3===arguments.length)return this._delegate.apply(this,arguments);var n,r,i,o,a=t.split(U),s=a.length;for(n=0;n<s;n++)i=(r=a[n].split("."))[0],o=r[1]||"",this.eventListeners[i]||(this.eventListeners[i]=[]),this.eventListeners[i].push({name:o,handler:e});return this}off(t,e){var n,r,i,o,a,s=(t||"").split(U),l=s.length;if(this._cache&&this._cache.delete(I),!t)for(r in this.eventListeners)this._off(r);for(n=0;n<l;n++)if(o=(i=s[n].split("."))[0],a=i[1],o)this.eventListeners[o]&&this._off(o,a,e);else for(r in this.eventListeners)this._off(r,a,e);return this}dispatchEvent(t){var e={target:this,type:t.type,evt:t};return this.fire(t.type,e),this}addEventListener(t,e){return this.on(t,(function(t){e.call(this,t.evt)})),this}removeEventListener(t){return this.off(t),this}_delegate(t,e,n){var r=this;this.on(t,(function(t){for(var i=t.target.findAncestors(e,!0,r),o=0;o<i.length;o++)(t=g.cloneObject(t)).currentTarget=i[o],n.call(i[o],t)}))}remove(){return this.isDragging()&&this.stopDrag(),B._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(R),this._clearSelfAndDescendantCache(N),this._clearSelfAndDescendantCache(j),this._clearSelfAndDescendantCache(K),this._clearSelfAndDescendantCache(Y),this._clearSelfAndDescendantCache(H)}_remove(){this._clearCaches();var t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(t){var e="get"+g._capitalize(t);return g._isFunction(this[e])?this[e]():this.attrs[t]}getAncestors(){for(var t=this.getParent(),e=[];t;)e.push(t),t=t.getParent();return e}getAttrs(){return this.attrs||{}}setAttrs(t){return this._batchTransformChanges((()=>{var e,n;if(!t)return this;for(e in t)"children"!==e&&(n="set"+g._capitalize(e),g._isFunction(this[n])?this[n](t[e]):this._setAttr(e,t[e]))})),this}isListening(){return this._getCache(H,this._isListening)}_isListening(t){if(!this.listening())return!1;const e=this.getParent();return!e||e===t||this===t||e._isListening(t)}isVisible(){return this._getCache(Y,this._isVisible)}_isVisible(t){if(!this.visible())return!1;const e=this.getParent();return!e||e===t||this===t||e._isVisible(t)}shouldDrawHit(t,e=!1){if(t)return this._isVisible(t)&&this._isListening(t);var n=this.getLayer(),r=!1;B._dragElements.forEach((t=>{"dragging"===t.dragStatus&&("Stage"===t.node.nodeType||t.node.getLayer()===n)&&(r=!0)}));var i=!e&&!o.hitOnDragEnabled&&r;return this.isListening()&&this.isVisible()&&!i}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){var t,e,n,r,i=this.getDepth(),o=this,a=0;return"Stage"!==o.nodeType&&function s(l){for(t=[],e=l.length,n=0;n<e;n++)r=l[n],a++,r.nodeType!==q&&(t=t.concat(r.getChildren().slice())),r._id===o._id&&(n=e);t.length>0&&t[0].getDepth()<=i&&s(t)}(o.getStage().getChildren()),a}getDepth(){for(var t=0,e=this.parent;e;)t++,e=e.parent;return t}_batchTransformChanges(t){this._batchingTransformChange=!0,t(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache($),this._clearSelfAndDescendantCache(R)),this._needClearTransformCache=!1}setPosition(t){return this._batchTransformChanges((()=>{this.x(t.x),this.y(t.y)})),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){if(!this.getStage())return null;var t=this.getStage().getPointerPosition();if(!t)return null;var e=this.getAbsoluteTransform().copy();return e.invert(),e.point(t)}getAbsolutePosition(t){let e=!1,n=this.parent;for(;n;){if(n.isCached()){e=!0;break}n=n.parent}e&&!t&&(t=!0);var r=this.getAbsoluteTransform(t).getMatrix(),i=new s,o=this.offset();return i.m=r.slice(),i.translate(o.x,o.y),i.getTranslation()}setAbsolutePosition(t){var e=this._clearTransform();this.attrs.x=e.x,this.attrs.y=e.y,delete e.x,delete e.y,this._clearCache($);var n=this._getAbsoluteTransform().copy();return n.invert(),n.translate(t.x,t.y),t={x:this.attrs.x+n.getTranslation().x,y:this.attrs.y+n.getTranslation().y},this._setTransform(e),this.setPosition({x:t.x,y:t.y}),this._clearCache($),this._clearSelfAndDescendantCache(R),this}_setTransform(t){var e;for(e in t)this.attrs[e]=t[e]}_clearTransform(){var t={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,t}move(t){var e=t.x,n=t.y,r=this.x(),i=this.y();return void 0!==e&&(r+=e),void 0!==n&&(i+=n),this.setPosition({x:r,y:i}),this}_eachAncestorReverse(t,e){var n,r,i=[],o=this.getParent();if(!e||e._id!==this._id){for(i.unshift(this);o&&(!e||o._id!==e._id);)i.unshift(o),o=o.parent;for(n=i.length,r=0;r<n;r++)t(i[r])}}rotate(t){return this.rotation(this.rotation()+t),this}moveToTop(){if(!this.parent)return g.warn("Node has no parent. moveToTop function is ignored."),!1;var t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0)}moveUp(){if(!this.parent)return g.warn("Node has no parent. moveUp function is ignored."),!1;var t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0)}moveDown(){if(!this.parent)return g.warn("Node has no parent. moveDown function is ignored."),!1;var t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0)}moveToBottom(){if(!this.parent)return g.warn("Node has no parent. moveToBottom function is ignored."),!1;var t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)}setZIndex(t){if(!this.parent)return g.warn("Node has no parent. zIndex parameter is ignored."),this;(t<0||t>=this.parent.children.length)&&g.warn("Unexpected value "+t+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(N,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){var t=this.opacity(),e=this.getParent();return e&&!e._isUnderCache&&(t*=e.getAbsoluteOpacity()),t}moveTo(t){return this.getParent()!==t&&(this._remove(),t.add(this)),this}toObject(){var t,e,n,r,i={},o=this.getAttrs();for(t in i.attrs={},o)e=o[t],g.isObject(e)&&!g._isPlainObject(e)&&!g._isArray(e)||(n="function"==typeof this[t]&&this[t],delete o[t],r=n?n.call(this):null,o[t]=e,r!==e&&(i.attrs[t]=e));return i.className=this.getClassName(),g._prepareToStringify(i)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(t,e,n){var r=[];e&&this._isMatch(t)&&r.push(this);for(var i=this.parent;i;){if(i===n)return r;i._isMatch(t)&&r.push(i),i=i.parent}return r}isAncestorOf(t){return!1}findAncestor(t,e,n){return this.findAncestors(t,e,n)[0]}_isMatch(t){if(!t)return!1;if("function"==typeof t)return t(this);var e,n,r=t.replace(/ /g,"").split(","),i=r.length;for(e=0;e<i;e++)if(n=r[e],g.isValidSelector(n)||(g.warn('Selector "'+n+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),g.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),g.warn("Konva is awesome, right?")),"#"===n.charAt(0)){if(this.id()===n.slice(1))return!0}else if("."===n.charAt(0)){if(this.hasName(n.slice(1)))return!0}else if(this.className===n||this.nodeType===n)return!0;return!1}getLayer(){var t=this.getParent();return t?t.getLayer():null}getStage(){return this._getCache(K,this._getStage)}_getStage(){var t=this.getParent();return t?t.getStage():void 0}fire(t,e={},n){return e.target=e.target||this,n?this._fireAndBubble(t,e):this._fire(t,e),this}getAbsoluteTransform(t){return t?this._getAbsoluteTransform(t):this._getCache(R,this._getAbsoluteTransform)}_getAbsoluteTransform(t){var e;if(t)return e=new s,this._eachAncestorReverse((function(t){var n=t.transformsEnabled();"all"===n?e.multiply(t.getTransform()):"position"===n&&e.translate(t.x()-t.offsetX(),t.y()-t.offsetY())}),t),e;e=this._cache.get(R)||new s,this.parent?this.parent.getAbsoluteTransform().copyInto(e):e.reset();var n=this.transformsEnabled();if("all"===n)e.multiply(this.getTransform());else if("position"===n){const t=this.attrs.x||0,n=this.attrs.y||0,r=this.attrs.offsetX||0,i=this.attrs.offsetY||0;e.translate(t-r,n-i)}return e.dirty=!1,e}getAbsoluteScale(t){for(var e=this;e;)e._isUnderCache&&(t=e),e=e.getParent();const n=this.getAbsoluteTransform(t).decompose();return{x:n.scaleX,y:n.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache($,this._getTransform)}_getTransform(){var t,e,n=this._cache.get($)||new s;n.reset();var r=this.x(),i=this.y(),a=o.getAngle(this.rotation()),l=null!==(t=this.attrs.scaleX)&&void 0!==t?t:1,u=null!==(e=this.attrs.scaleY)&&void 0!==e?e:1,c=this.attrs.skewX||0,h=this.attrs.skewY||0,d=this.attrs.offsetX||0,f=this.attrs.offsetY||0;return 0===r&&0===i||n.translate(r,i),0!==a&&n.rotate(a),0===c&&0===h||n.skew(c,h),1===l&&1===u||n.scale(l,u),0===d&&0===f||n.translate(-1*d,-1*f),n.dirty=!1,n}clone(t){var e,n,r,i,o,a=g.cloneObject(this.attrs);for(e in t)a[e]=t[e];var s=new this.constructor(a);for(e in this.eventListeners)for(r=(n=this.eventListeners[e]).length,i=0;i<r;i++)(o=n[i]).name.indexOf("konva")<0&&(s.eventListeners[e]||(s.eventListeners[e]=[]),s.eventListeners[e].push(o));return s}_toKonvaCanvas(t){t=t||{};var e=this.getClientRect(),n=this.getStage(),r=void 0!==t.x?t.x:Math.floor(e.x),i=void 0!==t.y?t.y:Math.floor(e.y),o=t.pixelRatio||1,a=new O({width:t.width||Math.ceil(e.width)||(n?n.width():0),height:t.height||Math.ceil(e.height)||(n?n.height():0),pixelRatio:o}),s=a.getContext();return!1===t.imageSmoothingEnabled&&(s._context.imageSmoothingEnabled=!1),s.save(),(r||i)&&s.translate(-1*r,-1*i),this.drawScene(a),s.restore(),a}toCanvas(t){return this._toKonvaCanvas(t)._canvas}toDataURL(t){var e=(t=t||{}).mimeType||null,n=t.quality||null,r=this._toKonvaCanvas(t).toDataURL(e,n);return t.callback&&t.callback(r),r}toImage(t){return new Promise(((e,n)=>{try{const n=null==t?void 0:t.callback;n&&delete t.callback,g._urlToImage(this.toDataURL(t),(function(t){e(t),null==n||n(t)}))}catch(t){n(t)}}))}toBlob(t){return new Promise(((e,n)=>{try{const n=null==t?void 0:t.callback;n&&delete t.callback,this.toCanvas(t).toBlob((t=>{e(t),null==n||n(t)}))}catch(t){n(t)}}))}setSize(t){return this.width(t.width),this.height(t.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():o.dragDistance}_off(t,e,n){var r,i,o,a=this.eventListeners[t];for(r=0;r<a.length;r++)if(i=a[r].name,o=a[r].handler,!("konva"===i&&"konva"!==e||e&&i!==e||n&&n!==o)){if(a.splice(r,1),0===a.length){delete this.eventListeners[t];break}r--}}_fireChangeEvent(t,e,n){this._fire(t+"Change",{oldVal:e,newVal:n})}addName(t){if(!this.hasName(t)){var e=this.name(),n=e?e+" "+t:t;this.name(n)}return this}hasName(t){if(!t)return!1;const e=this.name();return!!e&&-1!==(e||"").split(/\s/g).indexOf(t)}removeName(t){var e=(this.name()||"").split(/\s/g),n=e.indexOf(t);return-1!==n&&(e.splice(n,1),this.name(e.join(" "))),this}setAttr(t,e){var n=this["set"+g._capitalize(t)];return g._isFunction(n)?n.call(this,e):this._setAttr(t,e),this}_requestDraw(){if(o.autoDrawEnabled){const t=this.getLayer()||this.getStage();null==t||t.batchDraw()}}_setAttr(t,e){var n=this.attrs[t];(n!==e||g.isObject(e))&&(null==e?delete this.attrs[t]:this.attrs[t]=e,this._shouldFireChangeEvents&&this._fireChangeEvent(t,n,e),this._requestDraw())}_setComponentAttr(t,e,n){var r;void 0!==n&&((r=this.attrs[t])||(this.attrs[t]=this.getAttr(t)),this.attrs[t][e]=n,this._fireChangeEvent(t,r,n))}_fireAndBubble(t,e,n){if(e&&this.nodeType===q&&(e.target=this),!((t===G||t===W)&&(n&&(this===n||this.isAncestorOf&&this.isAncestorOf(n))||"Stage"===this.nodeType&&!n))){this._fire(t,e);var r=(t===G||t===W)&&n&&n.isAncestorOf&&n.isAncestorOf(this)&&!n.isAncestorOf(this.parent);(e&&!e.cancelBubble||!e)&&this.parent&&this.parent.isListening()&&!r&&(n&&n.parent?this._fireAndBubble.call(this.parent,t,e,n):this._fireAndBubble.call(this.parent,t,e))}}_getProtoListeners(t){let e=this._cache.get(I);if(!e){e={};let t=Object.getPrototypeOf(this);for(;t;)if(t.eventListeners){for(var n in t.eventListeners){const r=t.eventListeners[n],i=e[n]||[];e[n]=r.concat(i)}t=Object.getPrototypeOf(t)}else t=Object.getPrototypeOf(t);this._cache.set(I,e)}return e[t]}_fire(t,e){(e=e||{}).currentTarget=this,e.type=t;const n=this._getProtoListeners(t);if(n)for(var r=0;r<n.length;r++)n[r].handler.call(this,e);const i=this.eventListeners[t];if(i)for(r=0;r<i.length;r++)i[r].handler.call(this,e)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(t){var e=t?t.pointerId:void 0,n=this.getStage(),r=this.getAbsolutePosition(),i=n._getPointerById(e)||n._changedPointerPositions[0]||r;B._dragElements.set(this._id,{node:this,startPointerPos:i,offset:{x:i.x-r.x,y:i.y-r.y},dragStatus:"ready",pointerId:e})}startDrag(t,e=!0){B._dragElements.has(this._id)||this._createDragElement(t);B._dragElements.get(this._id).dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:t&&t.evt},e)}_setDragPosition(t,e){const n=this.getStage()._getPointerById(e.pointerId);if(n){var r={x:n.x-e.offset.x,y:n.y-e.offset.y},i=this.dragBoundFunc();if(void 0!==i){const e=i.call(this,r,t);e?r=e:g.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}this._lastPos&&this._lastPos.x===r.x&&this._lastPos.y===r.y||(this.setAbsolutePosition(r),this._requestDraw()),this._lastPos=r}}stopDrag(t){const e=B._dragElements.get(this._id);e&&(e.dragStatus="stopped"),B._endDragBefore(t),B._endDragAfter(t)}setDraggable(t){this._setAttr("draggable",t),this._dragChange()}isDragging(){const t=B._dragElements.get(this._id);return!!t&&"dragging"===t.dragStatus}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",(function(t){if((!(void 0!==t.evt.button)||o.dragButtons.indexOf(t.evt.button)>=0)&&!this.isDragging()){var e=!1;B._dragElements.forEach((t=>{this.isAncestorOf(t.node)&&(e=!0)})),e||this._createDragElement(t)}}))}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const t=B._dragElements.get(this._id),e=t&&"dragging"===t.dragStatus,n=t&&"ready"===t.dragStatus;e?this.stopDrag():n&&B._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(t={x:0,y:0}){const e=this.getStage();if(!e)return!1;const n={x:-t.x,y:-t.y,width:e.width()+2*t.x,height:e.height()+2*t.y};return g.haveIntersection(n,this.getClientRect())}static create(t,e){return g._isString(t)&&(t=JSON.parse(t)),this._createNode(t,e)}static _createNode(t,e){var n,r,i,a=J.prototype.getClassName.call(t),s=t.children;e&&(t.attrs.container=e),o[a]||(g.warn('Can not find a node with class name "'+a+'". Fallback to "Shape".'),a="Shape");if(n=new(0,o[a])(t.attrs),s)for(r=s.length,i=0;i<r;i++)n.add(J._createNode(s[i]));return n}}J.prototype.nodeType="Node",J.prototype._attrsAffectingSize=[],J.prototype.eventListeners={},J.prototype.on.call(J.prototype,V,(function(){this._batchingTransformChange?this._needClearTransformCache=!0:(this._clearCache($),this._clearSelfAndDescendantCache(R))})),J.prototype.on.call(J.prototype,"visibleChange.konva",(function(){this._clearSelfAndDescendantCache(Y)})),J.prototype.on.call(J.prototype,"listeningChange.konva",(function(){this._clearSelfAndDescendantCache(H)})),J.prototype.on.call(J.prototype,"opacityChange.konva",(function(){this._clearSelfAndDescendantCache(N)}));const Q=D.addGetterSetter;Q(J,"zIndex"),Q(J,"absolutePosition"),Q(J,"position"),Q(J,"x",0,y()),Q(J,"y",0,y()),Q(J,"globalCompositeOperation","source-over",w()),Q(J,"opacity",1,y()),Q(J,"name","",w()),Q(J,"id","",w()),Q(J,"rotation",0,y()),D.addComponentsGetterSetter(J,"scale",["x","y"]),Q(J,"scaleX",1,y()),Q(J,"scaleY",1,y()),D.addComponentsGetterSetter(J,"skew",["x","y"]),Q(J,"skewX",0,y()),Q(J,"skewY",0,y()),D.addComponentsGetterSetter(J,"offset",["x","y"]),Q(J,"offsetX",0,y()),Q(J,"offsetY",0,y()),Q(J,"dragDistance",null,y()),Q(J,"width",0,y()),Q(J,"height",0,y()),Q(J,"listening",!0,k()),Q(J,"preventDefault",!0,k()),Q(J,"filters",null,(function(t){return this._filterUpToDate=!1,t})),Q(J,"visible",!0,k()),Q(J,"transformsEnabled","all",w()),Q(J,"size"),Q(J,"dragBoundFunc"),Q(J,"draggable",!1,k()),D.backCompat(J,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});class Z extends J{constructor(){super(...arguments),this.children=[]}getChildren(t){if(!t)return this.children||[];const e=this.children||[];var n=[];return e.forEach((function(e){t(e)&&n.push(e)})),n}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach((t=>{t.parent=null,t.index=0,t.remove()})),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach((t=>{t.parent=null,t.index=0,t.destroy()})),this.children=[],this._requestDraw(),this}add(...t){if(0===t.length)return this;if(t.length>1){for(var e=0;e<t.length;e++)this.add(t[e]);return this}const n=t[0];return n.getParent()?(n.moveTo(this),this):(this._validateAdd(n),n.index=this.getChildren().length,n.parent=this,n._clearCaches(),this.getChildren().push(n),this._fire("add",{child:n}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(t){return this._generalFind(t,!1)}findOne(t){var e=this._generalFind(t,!0);return e.length>0?e[0]:void 0}_generalFind(t,e){var n=[];return this._descendants((r=>{const i=r._isMatch(t);return i&&n.push(r),!(!i||!e)})),n}_descendants(t){let e=!1;const n=this.getChildren();for(const r of n){if(e=t(r),e)return!0;if(r.hasChildren()&&(e=r._descendants(t),e))return!0}return!1}toObject(){var t=J.prototype.toObject.call(this);return t.children=[],this.getChildren().forEach((e=>{t.children.push(e.toObject())})),t}isAncestorOf(t){for(var e=t.getParent();e;){if(e._id===this._id)return!0;e=e.getParent()}return!1}clone(t){var e=J.prototype.clone.call(this,t);return this.getChildren().forEach((function(t){e.add(t.clone())})),e}getAllIntersections(t){var e=[];return this.find("Shape").forEach((function(n){n.isVisible()&&n.intersects(t)&&e.push(n)})),e}_clearSelfAndDescendantCache(t){var e;super._clearSelfAndDescendantCache(t),this.isCached()||null===(e=this.children)||void 0===e||e.forEach((function(e){e._clearSelfAndDescendantCache(t)}))}_setChildrenIndices(){var t;null===(t=this.children)||void 0===t||t.forEach((function(t,e){t.index=e})),this._requestDraw()}drawScene(t,e){var n=this.getLayer(),r=t||n&&n.getCanvas(),i=r&&r.getContext(),o=this._getCanvasCache(),a=o&&o.scene,s=r&&r.isCache;if(!this.isVisible()&&!s)return this;if(a){i.save();var l=this.getAbsoluteTransform(e).getMatrix();i.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._drawCachedSceneCanvas(i),i.restore()}else this._drawChildren("drawScene",r,e);return this}drawHit(t,e){if(!this.shouldDrawHit(e))return this;var n=this.getLayer(),r=t||n&&n.hitCanvas,i=r&&r.getContext(),o=this._getCanvasCache();if(o&&o.hit){i.save();var a=this.getAbsoluteTransform(e).getMatrix();i.transform(a[0],a[1],a[2],a[3],a[4],a[5]),this._drawCachedHitCanvas(i),i.restore()}else this._drawChildren("drawHit",r,e);return this}_drawChildren(t,e,n){var r,i=e&&e.getContext(),o=this.clipWidth(),a=this.clipHeight(),s=this.clipFunc(),l=o&&a||s;const u=n===this;if(l){i.save();var c=this.getAbsoluteTransform(n),h=c.getMatrix();if(i.transform(h[0],h[1],h[2],h[3],h[4],h[5]),i.beginPath(),s)s.call(this,i,this);else{var d=this.clipX(),f=this.clipY();i.rect(d,f,o,a)}i.clip(),h=c.copy().invert().getMatrix(),i.transform(h[0],h[1],h[2],h[3],h[4],h[5])}var p=!u&&"source-over"!==this.globalCompositeOperation()&&"drawScene"===t;p&&(i.save(),i._applyGlobalCompositeOperation(this)),null===(r=this.children)||void 0===r||r.forEach((function(r){r[t](e,n)})),p&&i.restore(),l&&i.restore()}getClientRect(t){var e,n,r,i,o,a=(t=t||{}).skipTransform,s=t.relativeTo,l={x:1/0,y:1/0,width:0,height:0},u=this;null===(e=this.children)||void 0===e||e.forEach((function(e){if(e.visible()){var a=e.getClientRect({relativeTo:u,skipShadow:t.skipShadow,skipStroke:t.skipStroke});0===a.width&&0===a.height||(void 0===n?(n=a.x,r=a.y,i=a.x+a.width,o=a.y+a.height):(n=Math.min(n,a.x),r=Math.min(r,a.y),i=Math.max(i,a.x+a.width),o=Math.max(o,a.y+a.height)))}}));for(var c=this.find("Shape"),h=!1,d=0;d<c.length;d++){if(c[d]._isVisible(this)){h=!0;break}}return l=h&&void 0!==n?{x:n,y:r,width:i-n,height:o-r}:{x:0,y:0,width:0,height:0},a?l:this._transformedRect(l,s)}}D.addComponentsGetterSetter(Z,"clip",["x","y","width","height"]),D.addGetterSetter(Z,"clipX",void 0,y()),D.addGetterSetter(Z,"clipY",void 0,y()),D.addGetterSetter(Z,"clipWidth",void 0,y()),D.addGetterSetter(Z,"clipHeight",void 0,y()),D.addGetterSetter(Z,"clipFunc");const tt=new Map,et=void 0!==o._global.PointerEvent;function nt(t){return tt.get(t)}function rt(t){return{evt:t,pointerId:t.pointerId}}function it(t,e){return tt.get(t)===e}function ot(t,e){at(t);e.getStage()&&(tt.set(t,e),et&&e._fire("gotpointercapture",rt(new PointerEvent("gotpointercapture"))))}function at(t,e){const n=tt.get(t);if(!n)return;const r=n.getStage();r&&r.content,tt.delete(t),et&&n._fire("lostpointercapture",rt(new PointerEvent("lostpointercapture")))}var st="mouseleave",lt="mouseover",ut="mouseenter",ct="mousemove",ht="mousedown",dt="mouseup",ft="pointermove",pt="pointerdown",gt="pointerup",mt="pointercancel",vt="pointerout",yt="pointerleave",bt="pointerover",xt="pointerenter",wt="contextmenu",Ct="touchstart",kt="touchend",St="touchmove",_t="touchcancel",Dt="wheel",At=[[ut,"_pointerenter"],[ht,"_pointerdown"],[ct,"_pointermove"],[dt,"_pointerup"],[st,"_pointerleave"],[Ct,"_pointerdown"],[St,"_pointermove"],[kt,"_pointerup"],[_t,"_pointercancel"],[lt,"_pointerover"],[Dt,"_wheel"],[wt,"_contextmenu"],[pt,"_pointerdown"],[ft,"_pointermove"],[gt,"_pointerup"],[mt,"_pointercancel"],["lostpointercapture","_lostpointercapture"]];const Tt={mouse:{[vt]:"mouseout",[yt]:st,[bt]:lt,[xt]:ut,[ft]:ct,[pt]:ht,[gt]:dt,[mt]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[vt]:"touchout",[yt]:"touchleave",[bt]:"touchover",[xt]:"touchenter",[ft]:St,[pt]:Ct,[gt]:kt,[mt]:_t,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[vt]:vt,[yt]:yt,[bt]:bt,[xt]:xt,[ft]:ft,[pt]:pt,[gt]:gt,[mt]:mt,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},Et=t=>t.indexOf("pointer")>=0?"pointer":t.indexOf("touch")>=0?"touch":"mouse",Ft=t=>{const e=Et(t);return"pointer"===e?o.pointerEventsEnabled&&Tt.pointer:"touch"===e?Tt.touch:"mouse"===e?Tt.mouse:void 0};function Lt(t={}){return(t.clipFunc||t.clipWidth||t.clipHeight)&&g.warn("Stage does not support clipping. Please use clip for Layers or Groups."),t}const Pt=[];class Ot extends Z{constructor(t){super(Lt(t)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),Pt.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",(()=>{Lt(this.attrs)})),this._checkVisibility()}_validateAdd(t){const e="Layer"===t.getType(),n="FastLayer"===t.getType();e||n||g.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const t=this.visible()?"":"none";this.content.style.display=t}setContainer(t){if("string"==typeof t){if("."===t.charAt(0)){var e=t.slice(1);t=document.getElementsByClassName(e)[0]}else{var n;n="#"!==t.charAt(0)?t:t.slice(1),t=document.getElementById(n)}if(!t)throw"Can not find container in document with id "+n}return this._setAttr("container",t),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),t.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){var t,e=this.children,n=e.length;for(t=0;t<n;t++)e[t].clear();return this}clone(t){return t||(t={}),t.container="undefined"!=typeof document&&document.createElement("div"),Z.prototype.clone.call(this,t)}destroy(){super.destroy();var t=this.content;t&&g._isInDocument(t)&&this.container().removeChild(t);var e=Pt.indexOf(this);return e>-1&&Pt.splice(e,1),g.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const t=this._pointerPositions[0]||this._changedPointerPositions[0];return t?{x:t.x,y:t.y}:(g.warn("Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);"),null)}_getPointerById(t){return this._pointerPositions.find((e=>e.id===t))}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(t){(t=t||{}).x=t.x||0,t.y=t.y||0,t.width=t.width||this.width(),t.height=t.height||this.height();var e=new O({width:t.width,height:t.height,pixelRatio:t.pixelRatio||1}),n=e.getContext()._context,r=this.children;return(t.x||t.y)&&n.translate(-1*t.x,-1*t.y),r.forEach((function(e){if(e.isVisible()){var r=e._toKonvaCanvas(t);n.drawImage(r._canvas,t.x,t.y,r.getWidth()/r.getPixelRatio(),r.getHeight()/r.getPixelRatio())}})),e}getIntersection(t){if(!t)return null;var e,n=this.children;for(e=n.length-1;e>=0;e--){const r=n[e].getIntersection(t);if(r)return r}return null}_resizeDOM(){var t=this.width(),e=this.height();this.content&&(this.content.style.width=t+"px",this.content.style.height=e+"px"),this.bufferCanvas.setSize(t,e),this.bufferHitCanvas.setSize(t,e),this.children.forEach((n=>{n.setSize({width:t,height:e}),n.draw()}))}add(t,...e){if(arguments.length>1){for(var n=0;n<arguments.length;n++)this.add(arguments[n]);return this}super.add(t);var r=this.children.length;return r>5&&g.warn("The stage has "+r+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),t.setSize({width:this.width(),height:this.height()}),t.draw(),o.isBrowser&&this.content.appendChild(t.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(t){return it(t,this)}setPointerCapture(t){ot(t,this)}releaseCapture(t){at(t)}getLayers(){return this.children}_bindContentEvents(){o.isBrowser&&At.forEach((([t,e])=>{this.content.addEventListener(t,(t=>{this[e](t)}),{passive:!1})}))}_pointerenter(t){this.setPointersPositions(t);const e=Ft(t.type);this._fire(e.pointerenter,{evt:t,target:this,currentTarget:this})}_pointerover(t){this.setPointersPositions(t);const e=Ft(t.type);this._fire(e.pointerover,{evt:t,target:this,currentTarget:this})}_getTargetShape(t){let e=this[t+"targetShape"];return e&&!e.getStage()&&(e=null),e}_pointerleave(t){const e=Ft(t.type),n=Et(t.type);if(e){this.setPointersPositions(t);var r=this._getTargetShape(n),i=!B.isDragging||o.hitOnDragEnabled;r&&i?(r._fireAndBubble(e.pointerout,{evt:t}),r._fireAndBubble(e.pointerleave,{evt:t}),this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this[n+"targetShape"]=null):i&&(this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this._fire(e.pointerout,{evt:t,target:this,currentTarget:this})),this.pointerPos=void 0,this._pointerPositions=[]}}_pointerdown(t){const e=Ft(t.type),n=Et(t.type);if(e){this.setPointersPositions(t);var r=!1;this._changedPointerPositions.forEach((i=>{var a=this.getIntersection(i);B.justDragged=!1,o["_"+n+"ListenClick"]=!0;if(!(a&&a.isListening()))return;o.capturePointerEventsEnabled&&a.setPointerCapture(i.id),this[n+"ClickStartShape"]=a,a._fireAndBubble(e.pointerdown,{evt:t,pointerId:i.id}),r=!0;const s=t.type.indexOf("touch")>=0;a.preventDefault()&&t.cancelable&&s&&t.preventDefault()})),r||this._fire(e.pointerdown,{evt:t,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}}_pointermove(t){const e=Ft(t.type),n=Et(t.type);if(!e)return;if(B.isDragging&&B.node.preventDefault()&&t.cancelable&&t.preventDefault(),this.setPointersPositions(t),!(!B.isDragging||o.hitOnDragEnabled))return;var r={};let i=!1;var a=this._getTargetShape(n);this._changedPointerPositions.forEach((o=>{const s=nt(o.id)||this.getIntersection(o),l=o.id,u={evt:t,pointerId:l};var c=a!==s;if(c&&a&&(a._fireAndBubble(e.pointerout,Object.assign({},u),s),a._fireAndBubble(e.pointerleave,Object.assign({},u),s)),s){if(r[s._id])return;r[s._id]=!0}s&&s.isListening()?(i=!0,c&&(s._fireAndBubble(e.pointerover,Object.assign({},u),a),s._fireAndBubble(e.pointerenter,Object.assign({},u),a),this[n+"targetShape"]=s),s._fireAndBubble(e.pointermove,Object.assign({},u))):a&&(this._fire(e.pointerover,{evt:t,target:this,currentTarget:this,pointerId:l}),this[n+"targetShape"]=null)})),i||this._fire(e.pointermove,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(t){const e=Ft(t.type),n=Et(t.type);if(!e)return;this.setPointersPositions(t);const r=this[n+"ClickStartShape"],i=this[n+"ClickEndShape"];var a={};let s=!1;this._changedPointerPositions.forEach((l=>{const u=nt(l.id)||this.getIntersection(l);if(u){if(u.releaseCapture(l.id),a[u._id])return;a[u._id]=!0}const c=l.id,h={evt:t,pointerId:c};let d=!1;o["_"+n+"InDblClickWindow"]?(d=!0,clearTimeout(this[n+"DblTimeout"])):B.justDragged||(o["_"+n+"InDblClickWindow"]=!0,clearTimeout(this[n+"DblTimeout"])),this[n+"DblTimeout"]=setTimeout((function(){o["_"+n+"InDblClickWindow"]=!1}),o.dblClickWindow),u&&u.isListening()?(s=!0,this[n+"ClickEndShape"]=u,u._fireAndBubble(e.pointerup,Object.assign({},h)),o["_"+n+"ListenClick"]&&r&&r===u&&(u._fireAndBubble(e.pointerclick,Object.assign({},h)),d&&i&&i===u&&u._fireAndBubble(e.pointerdblclick,Object.assign({},h)))):(this[n+"ClickEndShape"]=null,o["_"+n+"ListenClick"]&&this._fire(e.pointerclick,{evt:t,target:this,currentTarget:this,pointerId:c}),d&&this._fire(e.pointerdblclick,{evt:t,target:this,currentTarget:this,pointerId:c}))})),s||this._fire(e.pointerup,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),o["_"+n+"ListenClick"]=!1,t.cancelable&&"touch"!==n&&t.preventDefault()}_contextmenu(t){this.setPointersPositions(t);var e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(wt,{evt:t}):this._fire(wt,{evt:t,target:this,currentTarget:this})}_wheel(t){this.setPointersPositions(t);var e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(Dt,{evt:t}):this._fire(Dt,{evt:t,target:this,currentTarget:this})}_pointercancel(t){this.setPointersPositions(t);const e=nt(t.pointerId)||this.getIntersection(this.getPointerPosition());e&&e._fireAndBubble(gt,rt(t)),at(t.pointerId)}_lostpointercapture(t){at(t.pointerId)}setPointersPositions(t){var e=this._getContentPosition(),n=null,r=null;void 0!==(t=t||window.event).touches?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(t.touches,(t=>{this._pointerPositions.push({id:t.identifier,x:(t.clientX-e.left)/e.scaleX,y:(t.clientY-e.top)/e.scaleY})})),Array.prototype.forEach.call(t.changedTouches||t.touches,(t=>{this._changedPointerPositions.push({id:t.identifier,x:(t.clientX-e.left)/e.scaleX,y:(t.clientY-e.top)/e.scaleY})}))):(n=(t.clientX-e.left)/e.scaleX,r=(t.clientY-e.top)/e.scaleY,this.pointerPos={x:n,y:r},this._pointerPositions=[{x:n,y:r,id:g._getFirstPointerId(t)}],this._changedPointerPositions=[{x:n,y:r,id:g._getFirstPointerId(t)}])}_setPointerPosition(t){g.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(t)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var t=this.content.getBoundingClientRect();return{top:t.top,left:t.left,scaleX:t.width/this.content.clientWidth||1,scaleY:t.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new O({width:this.width(),height:this.height()}),this.bufferHitCanvas=new M({pixelRatio:1,width:this.width(),height:this.height()}),o.isBrowser){var t=this.container();if(!t)throw"Stage has no container. A container is required.";t.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),t.appendChild(this.content),this._resizeDOM()}}cache(){return g.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach((function(t){t.batchDraw()})),this}}Ot.prototype.nodeType="Stage",a(Ot),D.addGetterSetter(Ot,"container");var Mt="hasShadow",Bt="shadowRGBA",Nt="patternImage",It="linearGradient",Rt="radialGradient";let jt;function zt(){return jt||(jt=g.createCanvasElement().getContext("2d"),jt)}const Ht={};class Gt extends J{constructor(t){let e;for(super(t);e=g.getRandomColor(),!e||e in Ht;);this.colorKey=e,Ht[e]=this}getContext(){return g.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return g.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(Mt,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&0!==this.shadowOpacity()&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(Nt,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const t=zt().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(t&&t.setTransform){const e=new s;e.translate(this.fillPatternX(),this.fillPatternY()),e.rotate(o.getAngle(this.fillPatternRotation())),e.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),e.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const n=e.getMatrix(),r="undefined"==typeof DOMMatrix?{a:n[0],b:n[1],c:n[2],d:n[3],e:n[4],f:n[5]}:new DOMMatrix(n);t.setTransform(r)}return t}}_getLinearGradient(){return this._getCache(It,this.__getLinearGradient)}__getLinearGradient(){var t=this.fillLinearGradientColorStops();if(t){for(var e=zt(),n=this.fillLinearGradientStartPoint(),r=this.fillLinearGradientEndPoint(),i=e.createLinearGradient(n.x,n.y,r.x,r.y),o=0;o<t.length;o+=2)i.addColorStop(t[o],t[o+1]);return i}}_getRadialGradient(){return this._getCache(Rt,this.__getRadialGradient)}__getRadialGradient(){var t=this.fillRadialGradientColorStops();if(t){for(var e=zt(),n=this.fillRadialGradientStartPoint(),r=this.fillRadialGradientEndPoint(),i=e.createRadialGradient(n.x,n.y,this.fillRadialGradientStartRadius(),r.x,r.y,this.fillRadialGradientEndRadius()),o=0;o<t.length;o+=2)i.addColorStop(t[o],t[o+1]);return i}}getShadowRGBA(){return this._getCache(Bt,this._getShadowRGBA)}_getShadowRGBA(){if(this.hasShadow()){var t=g.colorToRGBA(this.shadowColor());return t?"rgba("+t.r+","+t.g+","+t.b+","+t.a*(this.shadowOpacity()||1)+")":void 0}}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],(()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops())))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],(()=>this.strokeEnabled()&&this.strokeWidth()&&!(!this.stroke()&&!this.strokeLinearGradientColorStops())))}hasHitStroke(){const t=this.hitStrokeWidth();return"auto"===t?this.hasStroke():this.strokeEnabled()&&!!t}intersects(t){var e=this.getStage().bufferHitCanvas;return e.getContext().clear(),this.drawHit(e,null,!0),e.context.getImageData(Math.round(t.x),Math.round(t.y),1,1).data[3]>0}destroy(){return J.prototype.destroy.call(this),delete Ht[this.colorKey],delete this.colorKey,this}_useBufferCanvas(t){var e;if(!this.getStage())return!1;if(!(null===(e=this.attrs.perfectDrawEnabled)||void 0===e||e))return!1;const n=t||this.hasFill(),r=this.hasStroke(),i=1!==this.getAbsoluteOpacity();if(n&&r&&i)return!0;const o=this.hasShadow(),a=this.shadowForStrokeEnabled();return!!(n&&r&&o&&a)}setStrokeHitEnabled(t){g.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),t?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return 0!==this.hitStrokeWidth()}getSelfRect(){var t=this.size();return{x:this._centroid?-t.width/2:0,y:this._centroid?-t.height/2:0,width:t.width,height:t.height}}getClientRect(t={}){const e=t.skipTransform,n=t.relativeTo,r=this.getSelfRect(),i=!t.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,o=r.width+i,a=r.height+i,s=!t.skipShadow&&this.hasShadow(),l=s?this.shadowOffsetX():0,u=s?this.shadowOffsetY():0,c=o+Math.abs(l),h=a+Math.abs(u),d=s&&this.shadowBlur()||0,f={width:c+2*d,height:h+2*d,x:-(i/2+d)+Math.min(l,0)+r.x,y:-(i/2+d)+Math.min(u,0)+r.y};return e?f:this._transformedRect(f,n)}drawScene(t,e){var n,r,i=this.getLayer(),o=t||i.getCanvas(),a=o.getContext(),s=this._getCanvasCache(),l=this.getSceneFunc(),u=this.hasShadow(),c=o.isCache,h=e===this;if(!this.isVisible()&&!h)return this;if(s){a.save();var d=this.getAbsoluteTransform(e).getMatrix();return a.transform(d[0],d[1],d[2],d[3],d[4],d[5]),this._drawCachedSceneCanvas(a),a.restore(),this}if(!l)return this;if(a.save(),this._useBufferCanvas()&&!c){(r=(n=this.getStage().bufferCanvas).getContext()).clear(),r.save(),r._applyLineJoin(this);var f=this.getAbsoluteTransform(e).getMatrix();r.transform(f[0],f[1],f[2],f[3],f[4],f[5]),l.call(this,r,this),r.restore();var p=n.pixelRatio;u&&a._applyShadow(this),a._applyOpacity(this),a._applyGlobalCompositeOperation(this),a.drawImage(n._canvas,0,0,n.width/p,n.height/p)}else{if(a._applyLineJoin(this),!h){f=this.getAbsoluteTransform(e).getMatrix();a.transform(f[0],f[1],f[2],f[3],f[4],f[5]),a._applyOpacity(this),a._applyGlobalCompositeOperation(this)}u&&a._applyShadow(this),l.call(this,a,this)}return a.restore(),this}drawHit(t,e,n=!1){if(!this.shouldDrawHit(e,n))return this;var r=this.getLayer(),i=t||r.hitCanvas,o=i&&i.getContext(),a=this.hitFunc()||this.sceneFunc(),s=this._getCanvasCache(),l=s&&s.hit;if(this.colorKey||g.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),l){o.save();var u=this.getAbsoluteTransform(e).getMatrix();return o.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this._drawCachedHitCanvas(o),o.restore(),this}if(!a)return this;o.save(),o._applyLineJoin(this);if(!(this===e)){var c=this.getAbsoluteTransform(e).getMatrix();o.transform(c[0],c[1],c[2],c[3],c[4],c[5])}return a.call(this,o,this),o.restore(),this}drawHitFromCache(t=0){var e,n,r,i,o,a=this._getCanvasCache(),s=this._getCachedSceneCanvas(),l=a.hit,u=l.getContext(),c=l.getWidth(),h=l.getHeight();u.clear(),u.drawImage(s._canvas,0,0,c,h);try{for(r=(n=(e=u.getImageData(0,0,c,h)).data).length,i=g._hexToRgb(this.colorKey),o=0;o<r;o+=4)n[o+3]>t?(n[o]=i.r,n[o+1]=i.g,n[o+2]=i.b,n[o+3]=255):n[o+3]=0;u.putImageData(e,0,0)}catch(t){g.error("Unable to draw hit graph from cached scene canvas. "+t.message)}return this}hasPointerCapture(t){return it(t,this)}setPointerCapture(t){ot(t,this)}releaseCapture(t){at(t)}}Gt.prototype._fillFunc=function(t){t.fill()},Gt.prototype._strokeFunc=function(t){t.stroke()},Gt.prototype._fillFuncHit=function(t){t.fill()},Gt.prototype._strokeFuncHit=function(t){t.stroke()},Gt.prototype._centroid=!1,Gt.prototype.nodeType="Shape",a(Gt),Gt.prototype.eventListeners={},Gt.prototype.on.call(Gt.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",(function(){this._clearCache(Mt)})),Gt.prototype.on.call(Gt.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",(function(){this._clearCache(Bt)})),Gt.prototype.on.call(Gt.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",(function(){this._clearCache(Nt)})),Gt.prototype.on.call(Gt.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",(function(){this._clearCache(It)})),Gt.prototype.on.call(Gt.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",(function(){this._clearCache(Rt)})),D.addGetterSetter(Gt,"stroke",void 0,C()),D.addGetterSetter(Gt,"strokeWidth",2,y()),D.addGetterSetter(Gt,"fillAfterStrokeEnabled",!1),D.addGetterSetter(Gt,"hitStrokeWidth","auto",x()),D.addGetterSetter(Gt,"strokeHitEnabled",!0,k()),D.addGetterSetter(Gt,"perfectDrawEnabled",!0,k()),D.addGetterSetter(Gt,"shadowForStrokeEnabled",!0,k()),D.addGetterSetter(Gt,"lineJoin"),D.addGetterSetter(Gt,"lineCap"),D.addGetterSetter(Gt,"sceneFunc"),D.addGetterSetter(Gt,"hitFunc"),D.addGetterSetter(Gt,"dash"),D.addGetterSetter(Gt,"dashOffset",0,y()),D.addGetterSetter(Gt,"shadowColor",void 0,w()),D.addGetterSetter(Gt,"shadowBlur",0,y()),D.addGetterSetter(Gt,"shadowOpacity",1,y()),D.addComponentsGetterSetter(Gt,"shadowOffset",["x","y"]),D.addGetterSetter(Gt,"shadowOffsetX",0,y()),D.addGetterSetter(Gt,"shadowOffsetY",0,y()),D.addGetterSetter(Gt,"fillPatternImage"),D.addGetterSetter(Gt,"fill",void 0,C()),D.addGetterSetter(Gt,"fillPatternX",0,y()),D.addGetterSetter(Gt,"fillPatternY",0,y()),D.addGetterSetter(Gt,"fillLinearGradientColorStops"),D.addGetterSetter(Gt,"strokeLinearGradientColorStops"),D.addGetterSetter(Gt,"fillRadialGradientStartRadius",0),D.addGetterSetter(Gt,"fillRadialGradientEndRadius",0),D.addGetterSetter(Gt,"fillRadialGradientColorStops"),D.addGetterSetter(Gt,"fillPatternRepeat","repeat"),D.addGetterSetter(Gt,"fillEnabled",!0),D.addGetterSetter(Gt,"strokeEnabled",!0),D.addGetterSetter(Gt,"shadowEnabled",!0),D.addGetterSetter(Gt,"dashEnabled",!0),D.addGetterSetter(Gt,"strokeScaleEnabled",!0),D.addGetterSetter(Gt,"fillPriority","color"),D.addComponentsGetterSetter(Gt,"fillPatternOffset",["x","y"]),D.addGetterSetter(Gt,"fillPatternOffsetX",0,y()),D.addGetterSetter(Gt,"fillPatternOffsetY",0,y()),D.addComponentsGetterSetter(Gt,"fillPatternScale",["x","y"]),D.addGetterSetter(Gt,"fillPatternScaleX",1,y()),D.addGetterSetter(Gt,"fillPatternScaleY",1,y()),D.addComponentsGetterSetter(Gt,"fillLinearGradientStartPoint",["x","y"]),D.addComponentsGetterSetter(Gt,"strokeLinearGradientStartPoint",["x","y"]),D.addGetterSetter(Gt,"fillLinearGradientStartPointX",0),D.addGetterSetter(Gt,"strokeLinearGradientStartPointX",0),D.addGetterSetter(Gt,"fillLinearGradientStartPointY",0),D.addGetterSetter(Gt,"strokeLinearGradientStartPointY",0),D.addComponentsGetterSetter(Gt,"fillLinearGradientEndPoint",["x","y"]),D.addComponentsGetterSetter(Gt,"strokeLinearGradientEndPoint",["x","y"]),D.addGetterSetter(Gt,"fillLinearGradientEndPointX",0),D.addGetterSetter(Gt,"strokeLinearGradientEndPointX",0),D.addGetterSetter(Gt,"fillLinearGradientEndPointY",0),D.addGetterSetter(Gt,"strokeLinearGradientEndPointY",0),D.addComponentsGetterSetter(Gt,"fillRadialGradientStartPoint",["x","y"]),D.addGetterSetter(Gt,"fillRadialGradientStartPointX",0),D.addGetterSetter(Gt,"fillRadialGradientStartPointY",0),D.addComponentsGetterSetter(Gt,"fillRadialGradientEndPoint",["x","y"]),D.addGetterSetter(Gt,"fillRadialGradientEndPointX",0),D.addGetterSetter(Gt,"fillRadialGradientEndPointY",0),D.addGetterSetter(Gt,"fillPatternRotation",0),D.backCompat(Gt,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});var Wt=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],qt=Wt.length;class Ut extends Z{constructor(t){super(t),this.canvas=new O,this.hitCanvas=new M({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(t){return this.getContext().clear(t),this.getHitCanvas().getContext().clear(t),this}setZIndex(t){super.setZIndex(t);var e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),t<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[t+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){J.prototype.moveToTop.call(this);var t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!J.prototype.moveUp.call(this))return!1;var t=this.getStage();return!(!t||!t.content)&&(t.content.removeChild(this.getNativeCanvasElement()),this.index<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[this.index+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(J.prototype.moveDown.call(this)){var t=this.getStage();if(t){var e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(J.prototype.moveToBottom.call(this)){var t=this.getStage();if(t){var e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){var t=this.getNativeCanvasElement();return J.prototype.remove.call(this),t&&t.parentNode&&g._isInDocument(t)&&t.parentNode.removeChild(t),this}getStage(){return this.parent}setSize({width:t,height:e}){return this.canvas.setSize(t,e),this.hitCanvas.setSize(t,e),this._setSmoothEnabled(),this}_validateAdd(t){var e=t.getType();"Group"!==e&&"Shape"!==e&&g.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(t){return(t=t||{}).width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=void 0!==t.x?t.x:this.x(),t.y=void 0!==t.y?t.y:this.y(),J.prototype._toKonvaCanvas.call(this,t)}_checkVisibility(){const t=this.visible();this.canvas._canvas.style.display=t?"block":"none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){g.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){g.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,g.requestAnimFrame((()=>{this.draw(),this._waitingForDraw=!1}))),this}getIntersection(t){if(!this.isListening()||!this.isVisible())return null;for(var e=1,n=!1;;){for(let r=0;r<qt;r++){const i=Wt[r],o=this._getIntersection({x:t.x+i.x*e,y:t.y+i.y*e}),a=o.shape;if(a)return a;if(n=!!o.antialiased,!o.antialiased)break}if(!n)return null;e+=1}}_getIntersection(t){const e=this.hitCanvas.pixelRatio,n=this.hitCanvas.context.getImageData(Math.round(t.x*e),Math.round(t.y*e),1,1).data,r=n[3];if(255===r){const t=g._rgbToHex(n[0],n[1],n[2]),e=Ht["#"+t];return e?{shape:e}:{antialiased:!0}}return r>0?{antialiased:!0}:{}}drawScene(t,e){var n=this.getLayer(),r=t||n&&n.getCanvas();return this._fire("beforeDraw",{node:this}),this.clearBeforeDraw()&&r.getContext().clear(),Z.prototype.drawScene.call(this,r,e),this._fire("draw",{node:this}),this}drawHit(t,e){var n=this.getLayer(),r=t||n&&n.hitCanvas;return n&&n.clearBeforeDraw()&&n.getHitCanvas().getContext().clear(),Z.prototype.drawHit.call(this,r,e),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(t){g.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(t)}getHitGraphEnabled(t){return g.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(this.parent&&this.parent.content){var t=this.parent;!!this.hitCanvas._canvas.parentNode?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}}destroy(){return g.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}Ut.prototype.nodeType="Layer",a(Ut),D.addGetterSetter(Ut,"imageSmoothingEnabled",!0),D.addGetterSetter(Ut,"clearBeforeDraw",!0),D.addGetterSetter(Ut,"hitGraphEnabled",!0,k());class Kt extends Ut{constructor(t){super(t),this.listening(!1),g.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}Kt.prototype.nodeType="FastLayer",a(Kt);class $t extends Z{_validateAdd(t){var e=t.getType();"Group"!==e&&"Shape"!==e&&g.throw("You may only add groups and shapes to groups.")}}$t.prototype.nodeType="Group",a($t);var Yt=i.performance&&i.performance.now?function(){return i.performance.now()}:function(){return(new Date).getTime()};class Vt{constructor(t,e){this.id=Vt.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:Yt(),frameRate:0},this.func=t,this.setLayers(e)}setLayers(t){var e=[];return e=t?t.length>0?t:[t]:[],this.layers=e,this}getLayers(){return this.layers}addLayer(t){var e,n=this.layers,r=n.length;for(e=0;e<r;e++)if(n[e]._id===t._id)return!1;return this.layers.push(t),!0}isRunning(){var t,e=Vt.animations,n=e.length;for(t=0;t<n;t++)if(e[t].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=Yt(),Vt._addAnimation(this),this}stop(){return Vt._removeAnimation(this),this}_updateFrameObject(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(t){this.animations.push(t),this._handleAnimation()}static _removeAnimation(t){var e,n=t.id,r=this.animations,i=r.length;for(e=0;e<i;e++)if(r[e].id===n){this.animations.splice(e,1);break}}static _runFrames(){var t,e,n,r,i,o,a,s,l={},u=this.animations;for(r=0;r<u.length;r++)if(e=(t=u[r]).layers,n=t.func,t._updateFrameObject(Yt()),o=e.length,!n||!1!==n.call(t,t.frame))for(i=0;i<o;i++)void 0!==(a=e[i])._id&&(l[a._id]=a);for(s in l)l.hasOwnProperty(s)&&l[s].batchDraw()}static _animationLoop(){var t=Vt;t.animations.length?(t._runFrames(),g.requestAnimFrame(t._animationLoop)):t.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,g.requestAnimFrame(this._animationLoop))}}Vt.animations=[],Vt.animIdCounter=0,Vt.animRunning=!1;var Xt={node:1,duration:1,easing:1,onFinish:1,yoyo:1},Jt=0,Qt=["fill","stroke","shadowColor"];class Zt{constructor(t,e,n,r,i,o,a){this.prop=t,this.propFunc=e,this.begin=r,this._pos=r,this.duration=o,this._change=0,this.prevPos=0,this.yoyo=a,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=n,this._change=i-this.begin,this.pause()}fire(t){var e=this[t];e&&e()}setTime(t){t>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():t<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=t,this.update())}getTime(){return this._time}setPosition(t){this.prevPos=this._pos,this.propFunc(t),this._pos=t}getPosition(t){return void 0===t&&(t=this._time),this.func(t,this.begin,this._change,this.duration)}play(){this.state=2,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=3,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(t){this.pause(),this._time=t,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){var t=this.getTimer()-this._startTime;2===this.state?this.setTime(t):3===this.state&&this.setTime(this.duration-t)}pause(){this.state=1,this.fire("onPause")}getTimer(){return(new Date).getTime()}}class te{constructor(t){var e,n,r=this,i=t.node,a=i._id,s=t.easing||ee.Linear,l=!!t.yoyo;e=void 0===t.duration?.3:0===t.duration?.001:t.duration,this.node=i,this._id=Jt++;var u=i.getLayer()||(i instanceof o.Stage?i.getLayers():null);for(n in u||g.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new Vt((function(){r.tween.onEnterFrame()}),u),this.tween=new Zt(n,(function(t){r._tweenFunc(t)}),s,0,1,1e3*e,l),this._addListeners(),te.attrs[a]||(te.attrs[a]={}),te.attrs[a][this._id]||(te.attrs[a][this._id]={}),te.tweens[a]||(te.tweens[a]={}),t)void 0===Xt[n]&&this._addAttr(n,t[n]);this.reset(),this.onFinish=t.onFinish,this.onReset=t.onReset,this.onUpdate=t.onUpdate}_addAttr(t,e){var n,r,i,o,a,s,l,u,c=this.node,h=c._id;if((i=te.tweens[h][t])&&delete te.attrs[h][i][t],n=c.getAttr(t),g._isArray(e))if(r=[],a=Math.max(e.length,n.length),"points"===t&&e.length!==n.length&&(e.length>n.length?(l=n,n=g._prepareArrayForTween(n,e,c.closed())):(s=e,e=g._prepareArrayForTween(e,n,c.closed()))),0===t.indexOf("fill"))for(o=0;o<a;o++)if(o%2==0)r.push(e[o]-n[o]);else{var d=g.colorToRGBA(n[o]);u=g.colorToRGBA(e[o]),n[o]=d,r.push({r:u.r-d.r,g:u.g-d.g,b:u.b-d.b,a:u.a-d.a})}else for(o=0;o<a;o++)r.push(e[o]-n[o]);else-1!==Qt.indexOf(t)?(n=g.colorToRGBA(n),r={r:(u=g.colorToRGBA(e)).r-n.r,g:u.g-n.g,b:u.b-n.b,a:u.a-n.a}):r=e-n;te.attrs[h][this._id][t]={start:n,diff:r,end:e,trueEnd:s,trueStart:l},te.tweens[h][t]=this._id}_tweenFunc(t){var e,n,r,i,o,a,s,l,u=this.node,c=te.attrs[u._id][this._id];for(e in c){if(r=(n=c[e]).start,i=n.diff,l=n.end,g._isArray(r))if(o=[],s=Math.max(r.length,l.length),0===e.indexOf("fill"))for(a=0;a<s;a++)a%2==0?o.push((r[a]||0)+i[a]*t):o.push("rgba("+Math.round(r[a].r+i[a].r*t)+","+Math.round(r[a].g+i[a].g*t)+","+Math.round(r[a].b+i[a].b*t)+","+(r[a].a+i[a].a*t)+")");else for(a=0;a<s;a++)o.push((r[a]||0)+i[a]*t);else o=-1!==Qt.indexOf(e)?"rgba("+Math.round(r.r+i.r*t)+","+Math.round(r.g+i.g*t)+","+Math.round(r.b+i.b*t)+","+(r.a+i.a*t)+")":r+i*t;u.setAttr(e,o)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{var t=this.node,e=te.attrs[t._id][this._id];e.points&&e.points.trueEnd&&t.setAttr("points",e.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{var t=this.node,e=te.attrs[t._id][this._id];e.points&&e.points.trueStart&&t.points(e.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(t){return this.tween.seek(1e3*t),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){var t,e=this.node._id,n=this._id,r=te.tweens[e];for(t in this.pause(),r)delete te.tweens[e][t];delete te.attrs[e][n]}}te.attrs={},te.tweens={},J.prototype.to=function(t){var e=t.onFinish;t.node=this,t.onFinish=function(){this.destroy(),e&&e()},new te(t).play()};const ee={BackEaseIn(t,e,n,r){var i=1.70158;return n*(t/=r)*t*((i+1)*t-i)+e},BackEaseOut(t,e,n,r){var i=1.70158;return n*((t=t/r-1)*t*((i+1)*t+i)+1)+e},BackEaseInOut(t,e,n,r){var i=1.70158;return(t/=r/2)<1?n/2*(t*t*((1+(i*=1.525))*t-i))+e:n/2*((t-=2)*t*((1+(i*=1.525))*t+i)+2)+e},ElasticEaseIn(t,e,n,r,i,o){var a=0;return 0===t?e:1==(t/=r)?e+n:(o||(o=.3*r),!i||i<Math.abs(n)?(i=n,a=o/4):a=o/(2*Math.PI)*Math.asin(n/i),-i*Math.pow(2,10*(t-=1))*Math.sin((t*r-a)*(2*Math.PI)/o)+e)},ElasticEaseOut(t,e,n,r,i,o){var a=0;return 0===t?e:1==(t/=r)?e+n:(o||(o=.3*r),!i||i<Math.abs(n)?(i=n,a=o/4):a=o/(2*Math.PI)*Math.asin(n/i),i*Math.pow(2,-10*t)*Math.sin((t*r-a)*(2*Math.PI)/o)+n+e)},ElasticEaseInOut(t,e,n,r,i,o){var a=0;return 0===t?e:2==(t/=r/2)?e+n:(o||(o=r*(.3*1.5)),!i||i<Math.abs(n)?(i=n,a=o/4):a=o/(2*Math.PI)*Math.asin(n/i),t<1?i*Math.pow(2,10*(t-=1))*Math.sin((t*r-a)*(2*Math.PI)/o)*-.5+e:i*Math.pow(2,-10*(t-=1))*Math.sin((t*r-a)*(2*Math.PI)/o)*.5+n+e)},BounceEaseOut:(t,e,n,r)=>(t/=r)<1/2.75?n*(7.5625*t*t)+e:t<2/2.75?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e,BounceEaseIn:(t,e,n,r)=>n-ee.BounceEaseOut(r-t,0,n,r)+e,BounceEaseInOut:(t,e,n,r)=>t<r/2?.5*ee.BounceEaseIn(2*t,0,n,r)+e:.5*ee.BounceEaseOut(2*t-r,0,n,r)+.5*n+e,EaseIn:(t,e,n,r)=>n*(t/=r)*t+e,EaseOut:(t,e,n,r)=>-n*(t/=r)*(t-2)+e,EaseInOut:(t,e,n,r)=>(t/=r/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e,StrongEaseIn:(t,e,n,r)=>n*(t/=r)*t*t*t*t+e,StrongEaseOut:(t,e,n,r)=>n*((t=t/r-1)*t*t*t*t+1)+e,StrongEaseInOut:(t,e,n,r)=>(t/=r/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e,Linear:(t,e,n,r)=>n*t/r+e},ne=g._assign(o,{Util:g,Transform:s,Node:J,Container:Z,Stage:Ot,stages:Pt,Layer:Ut,FastLayer:Kt,Group:$t,DD:B,Shape:Gt,shapes:Ht,Animation:Vt,Tween:te,Easings:ee,Context:T,Canvas:P});class re extends Gt{_sceneFunc(t){var e=o.getAngle(this.angle()),n=this.clockwise();t.beginPath(),t.arc(0,0,this.outerRadius(),0,e,n),t.arc(0,0,this.innerRadius(),e,0,!n),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}getSelfRect(){const t=this.innerRadius(),e=this.outerRadius(),n=this.clockwise(),r=o.getAngle(n?360-this.angle():this.angle()),i=Math.cos(Math.min(r,Math.PI)),a=Math.sin(Math.min(Math.max(Math.PI,r),3*Math.PI/2)),s=Math.sin(Math.min(r,Math.PI/2)),l=i*(i>0?t:e),u=a*(a>0?t:e),c=s*(s>0?e:t);return{x:l,y:n?-1*c:u,width:1*e-l,height:c-u}}}function ie(t,e,n,r,i,o,a){var s=Math.sqrt(Math.pow(n-t,2)+Math.pow(r-e,2)),l=Math.sqrt(Math.pow(i-n,2)+Math.pow(o-r,2)),u=a*s/(s+l),c=a*l/(s+l);return[n-u*(i-t),r-u*(o-e),n+c*(i-t),r+c*(o-e)]}function oe(t,e){var n,r,i=t.length,o=[];for(n=2;n<i-2;n+=2)r=ie(t[n-2],t[n-1],t[n],t[n+1],t[n+2],t[n+3],e),isNaN(r[0])||(o.push(r[0]),o.push(r[1]),o.push(t[n]),o.push(t[n+1]),o.push(r[2]),o.push(r[3]));return o}re.prototype._centroid=!0,re.prototype.className="Arc",re.prototype._attrsAffectingSize=["innerRadius","outerRadius"],a(re),D.addGetterSetter(re,"innerRadius",0,y()),D.addGetterSetter(re,"outerRadius",0,y()),D.addGetterSetter(re,"angle",0,y()),D.addGetterSetter(re,"clockwise",!1,k());class ae extends Gt{constructor(t){super(t),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",(function(){this._clearCache("tensionPoints")}))}_sceneFunc(t){var e,n,r,i=this.points(),o=i.length,a=this.tension(),s=this.closed(),l=this.bezier();if(o){if(t.beginPath(),t.moveTo(i[0],i[1]),0!==a&&o>4){for(n=(e=this.getTensionPoints()).length,r=s?0:4,s||t.quadraticCurveTo(e[0],e[1],e[2],e[3]);r<n-2;)t.bezierCurveTo(e[r++],e[r++],e[r++],e[r++],e[r++],e[r++]);s||t.quadraticCurveTo(e[n-2],e[n-1],i[o-2],i[o-1])}else if(l)for(r=2;r<o;)t.bezierCurveTo(i[r++],i[r++],i[r++],i[r++],i[r++],i[r++]);else for(r=2;r<o;r+=2)t.lineTo(i[r],i[r+1]);s?(t.closePath(),t.fillStrokeShape(this)):t.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():oe(this.points(),this.tension())}_getTensionPointsClosed(){var t=this.points(),e=t.length,n=this.tension(),r=ie(t[e-2],t[e-1],t[0],t[1],t[2],t[3],n),i=ie(t[e-4],t[e-3],t[e-2],t[e-1],t[0],t[1],n),o=oe(t,n);return[r[2],r[3]].concat(o).concat([i[0],i[1],t[e-2],t[e-1],i[2],i[3],r[0],r[1],t[0],t[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){var t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};for(var e,n,r=(t=0!==this.tension()?[t[0],t[1],...this._getTensionPoints(),t[t.length-2],t[t.length-1]]:this.points())[0],i=t[0],o=t[1],a=t[1],s=0;s<t.length/2;s++)e=t[2*s],n=t[2*s+1],r=Math.min(r,e),i=Math.max(i,e),o=Math.min(o,n),a=Math.max(a,n);return{x:r,y:o,width:i-r,height:a-o}}}ae.prototype.className="Line",ae.prototype._attrsAffectingSize=["points","bezier","tension"],a(ae),D.addGetterSetter(ae,"closed",!1),D.addGetterSetter(ae,"bezier",!1),D.addGetterSetter(ae,"tension",0,y()),D.addGetterSetter(ae,"points",[],function(){if(o.isUnminified)return function(t,e){const n=Int8Array?Object.getPrototypeOf(Int8Array):null;return n&&t instanceof n||(g._isArray(t)?t.forEach((function(t){g._isNumber(t)||g.warn('"'+e+'" attribute has non numeric element '+t+". Make sure that all elements are numbers.")})):g.warn(m(t)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.')),t}}());class se extends Gt{constructor(t){super(t),this.dataArray=[],this.pathLength=0,this.dataArray=se.parsePathData(this.data()),this.pathLength=0;for(var e=0;e<this.dataArray.length;++e)this.pathLength+=this.dataArray[e].pathLength;this.on("dataChange.konva",(function(){this.dataArray=se.parsePathData(this.data()),this.pathLength=0;for(var t=0;t<this.dataArray.length;++t)this.pathLength+=this.dataArray[t].pathLength}))}_sceneFunc(t){var e=this.dataArray;t.beginPath();for(var n=!1,r=0;r<e.length;r++){var i=e[r].command,o=e[r].points;switch(i){case"L":t.lineTo(o[0],o[1]);break;case"M":t.moveTo(o[0],o[1]);break;case"C":t.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case"Q":t.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case"A":var a=o[0],s=o[1],l=o[2],u=o[3],c=o[4],h=o[5],d=o[6],f=o[7],p=l>u?l:u,g=l>u?1:l/u,m=l>u?u/l:1;t.translate(a,s),t.rotate(d),t.scale(g,m),t.arc(0,0,p,c,c+h,1-f),t.scale(1/g,1/m),t.rotate(-d),t.translate(-a,-s);break;case"z":n=!0,t.closePath()}}n||this.hasFill()?t.fillStrokeShape(this):t.strokeShape(this)}getSelfRect(){var t=[];this.dataArray.forEach((function(e){if("A"===e.command){var n=e.points[4],r=e.points[5],i=e.points[4]+r,o=Math.PI/180;if(Math.abs(n-i)<o&&(o=Math.abs(n-i)),r<0)for(let r=n-o;r>i;r-=o){const n=se.getPointOnEllipticalArc(e.points[0],e.points[1],e.points[2],e.points[3],r,0);t.push(n.x,n.y)}else for(let r=n+o;r<i;r+=o){const n=se.getPointOnEllipticalArc(e.points[0],e.points[1],e.points[2],e.points[3],r,0);t.push(n.x,n.y)}}else if("C"===e.command)for(let n=0;n<=1;n+=.01){const r=se.getPointOnCubicBezier(n,e.start.x,e.start.y,e.points[0],e.points[1],e.points[2],e.points[3],e.points[4],e.points[5]);t.push(r.x,r.y)}else t=t.concat(e.points)}));for(var e,n,r=t[0],i=t[0],o=t[1],a=t[1],s=0;s<t.length/2;s++)e=t[2*s],n=t[2*s+1],isNaN(e)||(r=Math.min(r,e),i=Math.max(i,e)),isNaN(n)||(o=Math.min(o,n),a=Math.max(a,n));return{x:r,y:o,width:i-r,height:a-o}}getLength(){return this.pathLength}getPointAtLength(t){var e,n=0,r=this.dataArray.length;if(!r)return null;for(;n<r&&t>this.dataArray[n].pathLength;)t-=this.dataArray[n].pathLength,++n;if(n===r)return{x:(e=this.dataArray[n-1].points.slice(-2))[0],y:e[1]};if(t<.01)return{x:(e=this.dataArray[n].points.slice(0,2))[0],y:e[1]};var i=this.dataArray[n],o=i.points;switch(i.command){case"L":return se.getPointOnLine(t,i.start.x,i.start.y,o[0],o[1]);case"C":return se.getPointOnCubicBezier(t/i.pathLength,i.start.x,i.start.y,o[0],o[1],o[2],o[3],o[4],o[5]);case"Q":return se.getPointOnQuadraticBezier(t/i.pathLength,i.start.x,i.start.y,o[0],o[1],o[2],o[3]);case"A":var a=o[0],s=o[1],l=o[2],u=o[3],c=o[4],h=o[5],d=o[6];return c+=h*t/i.pathLength,se.getPointOnEllipticalArc(a,s,l,u,c,d)}return null}static getLineLength(t,e,n,r){return Math.sqrt((n-t)*(n-t)+(r-e)*(r-e))}static getPointOnLine(t,e,n,r,i,o,a){void 0===o&&(o=e),void 0===a&&(a=n);var s=(i-n)/(r-e+1e-8),l=Math.sqrt(t*t/(1+s*s));r<e&&(l*=-1);var u,c=s*l;if(r===e)u={x:o,y:a+c};else if((a-n)/(o-e+1e-8)===s)u={x:o+l,y:a+c};else{var h,d,f=this.getLineLength(e,n,r,i),p=(o-e)*(r-e)+(a-n)*(i-n);h=e+(p/=f*f)*(r-e),d=n+p*(i-n);var g=this.getLineLength(o,a,h,d),m=Math.sqrt(t*t-g*g);l=Math.sqrt(m*m/(1+s*s)),r<e&&(l*=-1),u={x:h+l,y:d+(c=s*l)}}return u}static getPointOnCubicBezier(t,e,n,r,i,o,a,s,l){function u(t){return t*t*t}function c(t){return 3*t*t*(1-t)}function h(t){return 3*t*(1-t)*(1-t)}function d(t){return(1-t)*(1-t)*(1-t)}return{x:s*u(t)+o*c(t)+r*h(t)+e*d(t),y:l*u(t)+a*c(t)+i*h(t)+n*d(t)}}static getPointOnQuadraticBezier(t,e,n,r,i,o,a){function s(t){return t*t}function l(t){return 2*t*(1-t)}function u(t){return(1-t)*(1-t)}return{x:o*s(t)+r*l(t)+e*u(t),y:a*s(t)+i*l(t)+n*u(t)}}static getPointOnEllipticalArc(t,e,n,r,i,o){var a=Math.cos(o),s=Math.sin(o),l=n*Math.cos(i),u=r*Math.sin(i);return{x:t+(l*a-u*s),y:e+(l*s+u*a)}}static parsePathData(t){if(!t)return[];var e=t,n=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];e=e.replace(new RegExp(" ","g"),",");for(var r=0;r<n.length;r++)e=e.replace(new RegExp(n[r],"g"),"|"+n[r]);var i,o=e.split("|"),a=[],s=[],l=0,u=0,c=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;for(r=1;r<o.length;r++){var h=o[r],d=h.charAt(0);for(h=h.slice(1),s.length=0;i=c.exec(h);)s.push(i[0]);for(var f=[],p=0,g=s.length;p<g;p++)if("00"!==s[p]){var m=parseFloat(s[p]);isNaN(m)?f.push(0):f.push(m)}else f.push(0,0);for(;f.length>0&&!isNaN(f[0]);){var v,y,b,x,w,C,k,S,_,D,A=null,T=[],E=l,F=u;switch(d){case"l":l+=f.shift(),u+=f.shift(),A="L",T.push(l,u);break;case"L":l=f.shift(),u=f.shift(),T.push(l,u);break;case"m":var L=f.shift(),P=f.shift();if(l+=L,u+=P,A="M",a.length>2&&"z"===a[a.length-1].command)for(var O=a.length-2;O>=0;O--)if("M"===a[O].command){l=a[O].points[0]+L,u=a[O].points[1]+P;break}T.push(l,u),d="l";break;case"M":l=f.shift(),u=f.shift(),A="M",T.push(l,u),d="L";break;case"h":l+=f.shift(),A="L",T.push(l,u);break;case"H":l=f.shift(),A="L",T.push(l,u);break;case"v":u+=f.shift(),A="L",T.push(l,u);break;case"V":u=f.shift(),A="L",T.push(l,u);break;case"C":T.push(f.shift(),f.shift(),f.shift(),f.shift()),l=f.shift(),u=f.shift(),T.push(l,u);break;case"c":T.push(l+f.shift(),u+f.shift(),l+f.shift(),u+f.shift()),l+=f.shift(),u+=f.shift(),A="C",T.push(l,u);break;case"S":y=l,b=u,"C"===(v=a[a.length-1]).command&&(y=l+(l-v.points[2]),b=u+(u-v.points[3])),T.push(y,b,f.shift(),f.shift()),l=f.shift(),u=f.shift(),A="C",T.push(l,u);break;case"s":y=l,b=u,"C"===(v=a[a.length-1]).command&&(y=l+(l-v.points[2]),b=u+(u-v.points[3])),T.push(y,b,l+f.shift(),u+f.shift()),l+=f.shift(),u+=f.shift(),A="C",T.push(l,u);break;case"Q":T.push(f.shift(),f.shift()),l=f.shift(),u=f.shift(),T.push(l,u);break;case"q":T.push(l+f.shift(),u+f.shift()),l+=f.shift(),u+=f.shift(),A="Q",T.push(l,u);break;case"T":y=l,b=u,"Q"===(v=a[a.length-1]).command&&(y=l+(l-v.points[0]),b=u+(u-v.points[1])),l=f.shift(),u=f.shift(),A="Q",T.push(y,b,l,u);break;case"t":y=l,b=u,"Q"===(v=a[a.length-1]).command&&(y=l+(l-v.points[0]),b=u+(u-v.points[1])),l+=f.shift(),u+=f.shift(),A="Q",T.push(y,b,l,u);break;case"A":x=f.shift(),w=f.shift(),C=f.shift(),k=f.shift(),S=f.shift(),_=l,D=u,l=f.shift(),u=f.shift(),A="A",T=this.convertEndpointToCenterParameterization(_,D,l,u,k,S,x,w,C);break;case"a":x=f.shift(),w=f.shift(),C=f.shift(),k=f.shift(),S=f.shift(),_=l,D=u,l+=f.shift(),u+=f.shift(),A="A",T=this.convertEndpointToCenterParameterization(_,D,l,u,k,S,x,w,C)}a.push({command:A||d,points:T,start:{x:E,y:F},pathLength:this.calcLength(E,F,A||d,T)})}"z"!==d&&"Z"!==d||a.push({command:"z",points:[],start:void 0,pathLength:0})}return a}static calcLength(t,e,n,r){var i,o,a,s,l=se;switch(n){case"L":return l.getLineLength(t,e,r[0],r[1]);case"C":for(i=0,o=l.getPointOnCubicBezier(0,t,e,r[0],r[1],r[2],r[3],r[4],r[5]),s=.01;s<=1;s+=.01)a=l.getPointOnCubicBezier(s,t,e,r[0],r[1],r[2],r[3],r[4],r[5]),i+=l.getLineLength(o.x,o.y,a.x,a.y),o=a;return i;case"Q":for(i=0,o=l.getPointOnQuadraticBezier(0,t,e,r[0],r[1],r[2],r[3]),s=.01;s<=1;s+=.01)a=l.getPointOnQuadraticBezier(s,t,e,r[0],r[1],r[2],r[3]),i+=l.getLineLength(o.x,o.y,a.x,a.y),o=a;return i;case"A":i=0;var u=r[4],c=r[5],h=r[4]+c,d=Math.PI/180;if(Math.abs(u-h)<d&&(d=Math.abs(u-h)),o=l.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],u,0),c<0)for(s=u-d;s>h;s-=d)a=l.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],s,0),i+=l.getLineLength(o.x,o.y,a.x,a.y),o=a;else for(s=u+d;s<h;s+=d)a=l.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],s,0),i+=l.getLineLength(o.x,o.y,a.x,a.y),o=a;return a=l.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],h,0),i+=l.getLineLength(o.x,o.y,a.x,a.y)}return 0}static convertEndpointToCenterParameterization(t,e,n,r,i,o,a,s,l){var u=l*(Math.PI/180),c=Math.cos(u)*(t-n)/2+Math.sin(u)*(e-r)/2,h=-1*Math.sin(u)*(t-n)/2+Math.cos(u)*(e-r)/2,d=c*c/(a*a)+h*h/(s*s);d>1&&(a*=Math.sqrt(d),s*=Math.sqrt(d));var f=Math.sqrt((a*a*(s*s)-a*a*(h*h)-s*s*(c*c))/(a*a*(h*h)+s*s*(c*c)));i===o&&(f*=-1),isNaN(f)&&(f=0);var p=f*a*h/s,g=f*-s*c/a,m=(t+n)/2+Math.cos(u)*p-Math.sin(u)*g,v=(e+r)/2+Math.sin(u)*p+Math.cos(u)*g,y=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},b=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(y(t)*y(e))},x=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(b(t,e))},w=x([1,0],[(c-p)/a,(h-g)/s]),C=[(c-p)/a,(h-g)/s],k=[(-1*c-p)/a,(-1*h-g)/s],S=x(C,k);return b(C,k)<=-1&&(S=Math.PI),b(C,k)>=1&&(S=0),0===o&&S>0&&(S-=2*Math.PI),1===o&&S<0&&(S+=2*Math.PI),[m,v,a,s,w,S,u,o]}}se.prototype.className="Path",se.prototype._attrsAffectingSize=["data"],a(se),D.addGetterSetter(se,"data");class le extends ae{_sceneFunc(t){super._sceneFunc(t);var e=2*Math.PI,n=this.points(),r=n,i=0!==this.tension()&&n.length>4;i&&(r=this.getTensionPoints());var o,a,s=this.pointerLength(),l=n.length;if(i){const t=[r[r.length-4],r[r.length-3],r[r.length-2],r[r.length-1],n[l-2],n[l-1]],e=se.calcLength(r[r.length-4],r[r.length-3],"C",t),i=se.getPointOnQuadraticBezier(Math.min(1,1-s/e),t[0],t[1],t[2],t[3],t[4],t[5]);o=n[l-2]-i.x,a=n[l-1]-i.y}else o=n[l-2]-n[l-4],a=n[l-1]-n[l-3];var u=(Math.atan2(a,o)+e)%e,c=this.pointerWidth();this.pointerAtEnding()&&(t.save(),t.beginPath(),t.translate(n[l-2],n[l-1]),t.rotate(u),t.moveTo(0,0),t.lineTo(-s,c/2),t.lineTo(-s,-c/2),t.closePath(),t.restore(),this.__fillStroke(t)),this.pointerAtBeginning()&&(t.save(),t.beginPath(),t.translate(n[0],n[1]),i?(o=(r[0]+r[2])/2-n[0],a=(r[1]+r[3])/2-n[1]):(o=n[2]-n[0],a=n[3]-n[1]),t.rotate((Math.atan2(-a,-o)+e)%e),t.moveTo(0,0),t.lineTo(-s,c/2),t.lineTo(-s,-c/2),t.closePath(),t.restore(),this.__fillStroke(t))}__fillStroke(t){var e=this.dashEnabled();e&&(this.attrs.dashEnabled=!1,t.setLineDash([])),t.fillStrokeShape(this),e&&(this.attrs.dashEnabled=!0)}getSelfRect(){const t=super.getSelfRect(),e=this.pointerWidth()/2;return{x:t.x-e,y:t.y-e,width:t.width+2*e,height:t.height+2*e}}}le.prototype.className="Arrow",a(le),D.addGetterSetter(le,"pointerLength",10,y()),D.addGetterSetter(le,"pointerWidth",10,y()),D.addGetterSetter(le,"pointerAtBeginning",!1),D.addGetterSetter(le,"pointerAtEnding",!0);class ue extends Gt{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.attrs.radius||0,0,2*Math.PI,!1),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(t){this.radius()!==t/2&&this.radius(t/2)}setHeight(t){this.radius()!==t/2&&this.radius(t/2)}}ue.prototype._centroid=!0,ue.prototype.className="Circle",ue.prototype._attrsAffectingSize=["radius"],a(ue),D.addGetterSetter(ue,"radius",0,y());class ce extends Gt{_sceneFunc(t){var e=this.radiusX(),n=this.radiusY();t.beginPath(),t.save(),e!==n&&t.scale(1,n/e),t.arc(0,0,e,0,2*Math.PI,!1),t.restore(),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.radiusX()}getHeight(){return 2*this.radiusY()}setWidth(t){this.radiusX(t/2)}setHeight(t){this.radiusY(t/2)}}ce.prototype.className="Ellipse",ce.prototype._centroid=!0,ce.prototype._attrsAffectingSize=["radiusX","radiusY"],a(ce),D.addComponentsGetterSetter(ce,"radius",["x","y"]),D.addGetterSetter(ce,"radiusX",0,y()),D.addGetterSetter(ce,"radiusY",0,y());class he extends Gt{constructor(t){super(t),this.on("imageChange.konva",(()=>{this._setImageLoad()})),this._setImageLoad()}_setImageLoad(){const t=this.image();t&&t.complete||t&&4===t.readyState||t&&t.addEventListener&&t.addEventListener("load",(()=>{this._requestDraw()}))}_useBufferCanvas(){return super._useBufferCanvas(!0)}_sceneFunc(t){const e=this.getWidth(),n=this.getHeight(),r=this.cornerRadius(),i=this.attrs.image;let o;if(i){const t=this.attrs.cropWidth,r=this.attrs.cropHeight;o=t&&r?[i,this.cropX(),this.cropY(),t,r,0,0,e,n]:[i,0,0,e,n]}(this.hasFill()||this.hasStroke()||r)&&(t.beginPath(),r?g.drawRoundedRectPath(t,e,n,r):t.rect(0,0,e,n),t.closePath(),t.fillStrokeShape(this)),i&&(r&&t.clip(),t.drawImage.apply(t,o))}_hitFunc(t){var e=this.width(),n=this.height(),r=this.cornerRadius();t.beginPath(),r?g.drawRoundedRectPath(t,e,n,r):t.rect(0,0,e,n),t.closePath(),t.fillStrokeShape(this)}getWidth(){var t,e;return null!==(t=this.attrs.width)&&void 0!==t?t:null===(e=this.image())||void 0===e?void 0:e.width}getHeight(){var t,e;return null!==(t=this.attrs.height)&&void 0!==t?t:null===(e=this.image())||void 0===e?void 0:e.height}static fromURL(t,e,n=null){var r=g.createImageElement();r.onload=function(){var t=new he({image:r});e(t)},r.onerror=n,r.crossOrigin="Anonymous",r.src=t}}he.prototype.className="Image",a(he),D.addGetterSetter(he,"cornerRadius",0,b(4)),D.addGetterSetter(he,"image"),D.addComponentsGetterSetter(he,"crop",["x","y","width","height"]),D.addGetterSetter(he,"cropX",0,y()),D.addGetterSetter(he,"cropY",0,y()),D.addGetterSetter(he,"cropWidth",0,y()),D.addGetterSetter(he,"cropHeight",0,y());var de=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],fe="up",pe="right",ge="down",me="left",ve=de.length;class ye extends $t{constructor(t){super(t),this.on("add.konva",(function(t){this._addListeners(t.child),this._sync()}))}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(t){var e,n=this,r=function(){n._sync()};for(e=0;e<ve;e++)t.on(de[e]+"Change.konva",r)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){var t,e,n,r,i,o,a,s=this.getText(),l=this.getTag();if(s&&l){switch(t=s.width(),e=s.height(),n=l.pointerDirection(),r=l.pointerWidth(),a=l.pointerHeight(),i=0,o=0,n){case fe:i=t/2,o=-1*a;break;case pe:i=t+r,o=e/2;break;case ge:i=t/2,o=e+a;break;case me:i=-1*r,o=e/2}l.setAttrs({x:-1*i,y:-1*o,width:t,height:e}),s.setAttrs({x:-1*i,y:-1*o})}}}ye.prototype.className="Label",a(ye);class be extends Gt{_sceneFunc(t){var e=this.width(),n=this.height(),r=this.pointerDirection(),i=this.pointerWidth(),o=this.pointerHeight(),a=this.cornerRadius();let s=0,l=0,u=0,c=0;"number"==typeof a?s=l=u=c=Math.min(a,e/2,n/2):(s=Math.min(a[0]||0,e/2,n/2),l=Math.min(a[1]||0,e/2,n/2),c=Math.min(a[2]||0,e/2,n/2),u=Math.min(a[3]||0,e/2,n/2)),t.beginPath(),t.moveTo(s,0),r===fe&&(t.lineTo((e-i)/2,0),t.lineTo(e/2,-1*o),t.lineTo((e+i)/2,0)),t.lineTo(e-l,0),t.arc(e-l,l,l,3*Math.PI/2,0,!1),r===pe&&(t.lineTo(e,(n-o)/2),t.lineTo(e+i,n/2),t.lineTo(e,(n+o)/2)),t.lineTo(e,n-c),t.arc(e-c,n-c,c,0,Math.PI/2,!1),r===ge&&(t.lineTo((e+i)/2,n),t.lineTo(e/2,n+o),t.lineTo((e-i)/2,n)),t.lineTo(u,n),t.arc(u,n-u,u,Math.PI/2,Math.PI,!1),r===me&&(t.lineTo(0,(n+o)/2),t.lineTo(-1*i,n/2),t.lineTo(0,(n-o)/2)),t.lineTo(0,s),t.arc(s,s,s,Math.PI,3*Math.PI/2,!1),t.closePath(),t.fillStrokeShape(this)}getSelfRect(){var t=0,e=0,n=this.pointerWidth(),r=this.pointerHeight(),i=this.pointerDirection(),o=this.width(),a=this.height();return i===fe?(e-=r,a+=r):i===ge?a+=r:i===me?(t-=1.5*n,o+=n):i===pe&&(o+=1.5*n),{x:t,y:e,width:o,height:a}}}be.prototype.className="Tag",a(be),D.addGetterSetter(be,"pointerDirection","none"),D.addGetterSetter(be,"pointerWidth",0,y()),D.addGetterSetter(be,"pointerHeight",0,y()),D.addGetterSetter(be,"cornerRadius",0,b(4));class xe extends Gt{_sceneFunc(t){var e=this.cornerRadius(),n=this.width(),r=this.height();t.beginPath(),e?g.drawRoundedRectPath(t,n,r,e):t.rect(0,0,n,r),t.closePath(),t.fillStrokeShape(this)}}xe.prototype.className="Rect",a(xe),D.addGetterSetter(xe,"cornerRadius",0,b(4));class we extends Gt{_sceneFunc(t){const e=this._getPoints();t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var n=1;n<e.length;n++)t.lineTo(e[n].x,e[n].y);t.closePath(),t.fillStrokeShape(this)}_getPoints(){const t=this.attrs.sides,e=this.attrs.radius||0,n=[];for(var r=0;r<t;r++)n.push({x:e*Math.sin(2*r*Math.PI/t),y:-1*e*Math.cos(2*r*Math.PI/t)});return n}getSelfRect(){const t=this._getPoints();var e=t[0].x,n=t[0].y,r=t[0].x,i=t[0].y;return t.forEach((t=>{e=Math.min(e,t.x),n=Math.max(n,t.x),r=Math.min(r,t.y),i=Math.max(i,t.y)})),{x:e,y:r,width:n-e,height:i-r}}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(t){this.radius(t/2)}setHeight(t){this.radius(t/2)}}we.prototype.className="RegularPolygon",we.prototype._centroid=!0,we.prototype._attrsAffectingSize=["radius"],a(we),D.addGetterSetter(we,"radius",0,y()),D.addGetterSetter(we,"sides",0,y());var Ce=2*Math.PI;class ke extends Gt{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.innerRadius(),0,Ce,!1),t.moveTo(this.outerRadius(),0),t.arc(0,0,this.outerRadius(),Ce,0,!0),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}}ke.prototype.className="Ring",ke.prototype._centroid=!0,ke.prototype._attrsAffectingSize=["innerRadius","outerRadius"],a(ke),D.addGetterSetter(ke,"innerRadius",0,y()),D.addGetterSetter(ke,"outerRadius",0,y());class Se extends Gt{constructor(t){super(t),this._updated=!0,this.anim=new Vt((()=>{var t=this._updated;return this._updated=!1,t})),this.on("animationChange.konva",(function(){this.frameIndex(0)})),this.on("frameIndexChange.konva",(function(){this._updated=!0})),this.on("frameRateChange.konva",(function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())}))}_sceneFunc(t){var e=this.animation(),n=this.frameIndex(),r=4*n,i=this.animations()[e],o=this.frameOffsets(),a=i[r+0],s=i[r+1],l=i[r+2],u=i[r+3],c=this.image();if((this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,l,u),t.closePath(),t.fillStrokeShape(this)),c)if(o){var h=o[e],d=2*n;t.drawImage(c,a,s,l,u,h[d+0],h[d+1],l,u)}else t.drawImage(c,a,s,l,u,0,0,l,u)}_hitFunc(t){var e=this.animation(),n=this.frameIndex(),r=4*n,i=this.animations()[e],o=this.frameOffsets(),a=i[r+2],s=i[r+3];if(t.beginPath(),o){var l=o[e],u=2*n;t.rect(l[u+0],l[u+1],a,s)}else t.rect(0,0,a,s);t.closePath(),t.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){var t=this;this.interval=setInterval((function(){t._updateIndex()}),1e3/this.frameRate())}start(){if(!this.isRunning()){var t=this.getLayer();this.anim.setLayers(t),this._setInterval(),this.anim.start()}}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){var t=this.frameIndex(),e=this.animation();t<this.animations()[e].length/4-1?this.frameIndex(t+1):this.frameIndex(0)}}Se.prototype.className="Sprite",a(Se),D.addGetterSetter(Se,"animation"),D.addGetterSetter(Se,"animations"),D.addGetterSetter(Se,"frameOffsets"),D.addGetterSetter(Se,"image"),D.addGetterSetter(Se,"frameIndex",0,y()),D.addGetterSetter(Se,"frameRate",17,y()),D.backCompat(Se,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});class _e extends Gt{_sceneFunc(t){var e=this.innerRadius(),n=this.outerRadius(),r=this.numPoints();t.beginPath(),t.moveTo(0,0-n);for(var i=1;i<2*r;i++){var o=i%2==0?n:e,a=o*Math.sin(i*Math.PI/r),s=-1*o*Math.cos(i*Math.PI/r);t.lineTo(a,s)}t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}}function De(t){return Array.from(t)}_e.prototype.className="Star",_e.prototype._centroid=!0,_e.prototype._attrsAffectingSize=["innerRadius","outerRadius"],a(_e),D.addGetterSetter(_e,"numPoints",5,y()),D.addGetterSetter(_e,"innerRadius",0,y()),D.addGetterSetter(_e,"outerRadius",0,y());var Ae,Te="auto",Ee="justify",Fe="left",Le="middle",Pe="normal",Oe=" ",Me="none",Be=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],Ne=Be.length;function Ie(){return Ae||(Ae=g.createCanvasElement().getContext("2d"))}class Re extends Gt{constructor(t){super(function(t){return(t=t||{}).fillLinearGradientColorStops||t.fillRadialGradientColorStops||t.fillPatternImage||(t.fill=t.fill||"black"),t}(t)),this._partialTextX=0,this._partialTextY=0;for(var e=0;e<Ne;e++)this.on(Be[e]+"Change.konva",this._setTextData);this._setTextData()}_sceneFunc(t){var e=this.textArr,n=e.length;if(this.text()){var r,i=this.padding(),o=this.fontSize(),a=this.lineHeight()*o,s=this.verticalAlign(),l=0,u=this.align(),c=this.getWidth(),h=this.letterSpacing(),d=this.fill(),f=this.textDecoration(),p=-1!==f.indexOf("underline"),g=-1!==f.indexOf("line-through"),m=0,v=(m=a/2,0),y=0;for(t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",Le),t.setAttr("textAlign",Fe),s===Le?l=(this.getHeight()-n*a-2*i)/2:"bottom"===s&&(l=this.getHeight()-n*a-2*i),t.translate(i,l+i),r=0;r<n;r++){v=0,y=0;var b,x,w,C=e[r],k=C.text,S=C.width,_=C.lastInParagraph;if(t.save(),"right"===u?v+=c-S-2*i:"center"===u&&(v+=(c-S-2*i)/2),p){t.save(),t.beginPath(),t.moveTo(v,m+y+Math.round(o/2)),x=0===(b=k.split(" ").length-1),w=u!==Ee||_?S:c-2*i,t.lineTo(v+Math.round(w),m+y+Math.round(o/2)),t.lineWidth=o/15;const e=this._getLinearGradient();t.strokeStyle=e||d,t.stroke(),t.restore()}if(g){t.save(),t.beginPath(),t.moveTo(v,m+y),x=0===(b=k.split(" ").length-1),w=u===Ee&&_&&!x?c-2*i:S,t.lineTo(v+Math.round(w),m+y),t.lineWidth=o/15;const e=this._getLinearGradient();t.strokeStyle=e||d,t.stroke(),t.restore()}if(0!==h||u===Ee){b=k.split(" ").length-1;for(var D=De(k),A=0;A<D.length;A++){var T=D[A];" "!==T||_||u!==Ee||(v+=(c-2*i-S)/b),this._partialTextX=v,this._partialTextY=m+y,this._partialText=T,t.fillStrokeShape(this),v+=this.measureSize(T).width+h}}else this._partialTextX=v,this._partialTextY=m+y,this._partialText=k,t.fillStrokeShape(this);t.restore(),n>1&&(m+=a)}}}_hitFunc(t){var e=this.getWidth(),n=this.getHeight();t.beginPath(),t.rect(0,0,e,n),t.closePath(),t.fillStrokeShape(this)}setText(t){var e=g._isString(t)?t:null==t?"":t+"";return this._setAttr("text",e),this}getWidth(){return this.attrs.width===Te||void 0===this.attrs.width?this.getTextWidth()+2*this.padding():this.attrs.width}getHeight(){return this.attrs.height===Te||void 0===this.attrs.height?this.fontSize()*this.textArr.length*this.lineHeight()+2*this.padding():this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return g.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(t){var e,n=Ie(),r=this.fontSize();return n.save(),n.font=this._getContextFont(),e=n.measureText(t),n.restore(),{width:e.width,height:r}}_getContextFont(){return this.fontStyle()+Oe+this.fontVariant()+Oe+(this.fontSize()+"px ")+this.fontFamily().split(",").map((t=>{const e=(t=t.trim()).indexOf(" ")>=0,n=t.indexOf('"')>=0||t.indexOf("'")>=0;return e&&!n&&(t=`"${t}"`),t})).join(", ")}_addTextLine(t){this.align()===Ee&&(t=t.trim());var e=this._getTextWidth(t);return this.textArr.push({text:t,width:e,lastInParagraph:!1})}_getTextWidth(t){var e=this.letterSpacing(),n=t.length;return Ie().measureText(t).width+(n?e*(n-1):0)}_setTextData(){var t=this.text().split("\n"),e=+this.fontSize(),n=0,r=this.lineHeight()*e,i=this.attrs.width,o=this.attrs.height,a=i!==Te&&void 0!==i,s=o!==Te&&void 0!==o,l=this.padding(),u=i-2*l,c=o-2*l,h=0,d=this.wrap(),f="char"!==d&&d!==Me,p=this.ellipsis();this.textArr=[],Ie().font=this._getContextFont();for(var g=p?this._getTextWidth("…"):0,m=0,v=t.length;m<v;++m){var y=t[m],b=this._getTextWidth(y);if(a&&b>u)for(;y.length>0;){for(var x=0,w=y.length,C="",k=0;x<w;){var S=x+w>>>1,_=y.slice(0,S+1),D=this._getTextWidth(_)+g;D<=u?(x=S+1,C=_,k=D):w=S}if(!C)break;if(f){var A,T=y[C.length];(A=(T===Oe||"-"===T)&&k<=u?C.length:Math.max(C.lastIndexOf(Oe),C.lastIndexOf("-"))+1)>0&&(x=A,C=C.slice(0,x),k=this._getTextWidth(C))}if(C=C.trimRight(),this._addTextLine(C),n=Math.max(n,k),h+=r,this._shouldHandleEllipsis(h)){this._tryToAddEllipsisToLastLine();break}if((y=(y=y.slice(x)).trimLeft()).length>0&&(b=this._getTextWidth(y))<=u){this._addTextLine(y),h+=r,n=Math.max(n,b);break}}else this._addTextLine(y),h+=r,n=Math.max(n,b),this._shouldHandleEllipsis(h)&&m<v-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),s&&h+r>c)break}this.textHeight=e,this.textWidth=n}_shouldHandleEllipsis(t){var e=+this.fontSize(),n=this.lineHeight()*e,r=this.attrs.height,i=r!==Te&&void 0!==r,o=r-2*this.padding();return!(this.wrap()!==Me)||i&&t+n>o}_tryToAddEllipsisToLastLine(){var t=this.attrs.width,e=t!==Te&&void 0!==t,n=t-2*this.padding(),r=this.ellipsis(),i=this.textArr[this.textArr.length-1];if(i&&r){if(e)this._getTextWidth(i.text+"…")<n||(i.text=i.text.slice(0,i.text.length-3));this.textArr.splice(this.textArr.length-1,1),this._addTextLine(i.text+"…")}}getStrokeScaleEnabled(){return!0}}Re.prototype._fillFunc=function(t){t.fillText(this._partialText,this._partialTextX,this._partialTextY)},Re.prototype._strokeFunc=function(t){t.strokeText(this._partialText,this._partialTextX,this._partialTextY)},Re.prototype.className="Text",Re.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],a(Re),D.overWriteSetter(Re,"width",x()),D.overWriteSetter(Re,"height",x()),D.addGetterSetter(Re,"fontFamily","Arial"),D.addGetterSetter(Re,"fontSize",12,y()),D.addGetterSetter(Re,"fontStyle",Pe),D.addGetterSetter(Re,"fontVariant",Pe),D.addGetterSetter(Re,"padding",0,y()),D.addGetterSetter(Re,"align",Fe),D.addGetterSetter(Re,"verticalAlign","top"),D.addGetterSetter(Re,"lineHeight",1,y()),D.addGetterSetter(Re,"wrap","word"),D.addGetterSetter(Re,"ellipsis",!1,k()),D.addGetterSetter(Re,"letterSpacing",0,y()),D.addGetterSetter(Re,"text","",w()),D.addGetterSetter(Re,"textDecoration","");var je="normal";function ze(t){t.fillText(this.partialText,0,0)}function He(t){t.strokeText(this.partialText,0,0)}class Ge extends Gt{constructor(t){super(t),this.dummyCanvas=g.createCanvasElement(),this.dataArray=[],this.dataArray=se.parsePathData(this.attrs.data),this.on("dataChange.konva",(function(){this.dataArray=se.parsePathData(this.attrs.data),this._setTextData()})),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_sceneFunc(t){t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",this.textBaseline()),t.setAttr("textAlign","left"),t.save();var e=this.textDecoration(),n=this.fill(),r=this.fontSize(),i=this.glyphInfo;"underline"===e&&t.beginPath();for(var o=0;o<i.length;o++){t.save();var a=i[o].p0;t.translate(a.x,a.y),t.rotate(i[o].rotation),this.partialText=i[o].text,t.fillStrokeShape(this),"underline"===e&&(0===o&&t.moveTo(0,r/2+1),t.lineTo(r,r/2+1)),t.restore()}"underline"===e&&(t.strokeStyle=n,t.lineWidth=r/20,t.stroke()),t.restore()}_hitFunc(t){t.beginPath();var e=this.glyphInfo;if(e.length>=1){var n=e[0].p0;t.moveTo(n.x,n.y)}for(var r=0;r<e.length;r++){var i=e[r].p1;t.lineTo(i.x,i.y)}t.setAttr("lineWidth",this.fontSize()),t.setAttr("strokeStyle",this.colorKey),t.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return g.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(t){return Re.prototype.setText.call(this,t)}_getContextFont(){return Re.prototype._getContextFont.call(this)}_getTextSize(t){var e=this.dummyCanvas.getContext("2d");e.save(),e.font=this._getContextFont();var n=e.measureText(t);return e.restore(),{width:n.width,height:parseInt(this.attrs.fontSize,10)}}_setTextData(){var t=this,e=this._getTextSize(this.attrs.text),n=this.letterSpacing(),r=this.align(),i=this.kerningFunc();this.textWidth=e.width,this.textHeight=e.height;var o=Math.max(this.textWidth+((this.attrs.text||"").length-1)*n,0);this.glyphInfo=[];for(var a=0,s=0;s<t.dataArray.length;s++)t.dataArray[s].pathLength>0&&(a+=t.dataArray[s].pathLength);var l=0;"center"===r&&(l=Math.max(0,a/2-o/2)),"right"===r&&(l=Math.max(0,a-o));for(var u,c,h,d=De(this.text()),f=this.text().split(" ").length-1,p=-1,g=0,m=function(){g=0;for(var e=t.dataArray,n=p+1;n<e.length;n++){if(e[n].pathLength>0)return p=n,e[n];"M"===e[n].command&&(u={x:e[n].points[0],y:e[n].points[1]})}return{}},v=function(e){var i=t._getTextSize(e).width+n;" "===e&&"justify"===r&&(i+=(a-o)/f);var s=0,l=0;for(c=void 0;Math.abs(i-s)/i>.01&&l<20;){l++;for(var d=s;void 0===h;)(h=m())&&d+h.pathLength<i&&(d+=h.pathLength,h=void 0);if(0===Object.keys(h).length||void 0===u)return;var p=!1;switch(h.command){case"L":se.getLineLength(u.x,u.y,h.points[0],h.points[1])>i?c=se.getPointOnLine(i,u.x,u.y,h.points[0],h.points[1],u.x,u.y):h=void 0;break;case"A":var v=h.points[4],y=h.points[5],b=h.points[4]+y;0===g?g=v+1e-8:i>s?g+=Math.PI/180*y/Math.abs(y):g-=Math.PI/360*y/Math.abs(y),(y<0&&g<b||y>=0&&g>b)&&(g=b,p=!0),c=se.getPointOnEllipticalArc(h.points[0],h.points[1],h.points[2],h.points[3],g,h.points[6]);break;case"C":0===g?g=i>h.pathLength?1e-8:i/h.pathLength:i>s?g+=(i-s)/h.pathLength/2:g=Math.max(g-(s-i)/h.pathLength/2,0),g>1&&(g=1,p=!0),c=se.getPointOnCubicBezier(g,h.start.x,h.start.y,h.points[0],h.points[1],h.points[2],h.points[3],h.points[4],h.points[5]);break;case"Q":0===g?g=i/h.pathLength:i>s?g+=(i-s)/h.pathLength:g-=(s-i)/h.pathLength,g>1&&(g=1,p=!0),c=se.getPointOnQuadraticBezier(g,h.start.x,h.start.y,h.points[0],h.points[1],h.points[2],h.points[3])}void 0!==c&&(s=se.getLineLength(u.x,u.y,c.x,c.y)),p&&(p=!1,h=void 0)}},y=l/(t._getTextSize("C").width+n)-1,b=0;b<y&&(v("C"),void 0!==u&&void 0!==c);b++)u=c;for(var x=0;x<d.length&&(v(d[x]),void 0!==u&&void 0!==c);x++){var w=se.getLineLength(u.x,u.y,c.x,c.y),C=0;if(i)try{C=i(d[x-1],d[x])*this.fontSize()}catch(t){C=0}u.x+=C,c.x+=C,this.textWidth+=C;var k=se.getPointOnLine(C+w/2,u.x,u.y,c.x,c.y),S=Math.atan2(c.y-u.y,c.x-u.x);this.glyphInfo.push({transposeX:k.x,transposeY:k.y,text:d[x],rotation:S,p0:u,p1:c}),u=c}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};var t=[];this.glyphInfo.forEach((function(e){t.push(e.p0.x),t.push(e.p0.y),t.push(e.p1.x),t.push(e.p1.y)}));for(var e,n,r=t[0]||0,i=t[0]||0,o=t[1]||0,a=t[1]||0,s=0;s<t.length/2;s++)e=t[2*s],n=t[2*s+1],r=Math.min(r,e),i=Math.max(i,e),o=Math.min(o,n),a=Math.max(a,n);var l=this.fontSize();return{x:r-l/2,y:o-l/2,width:i-r+l,height:a-o+l}}destroy(){return g.releaseCanvas(this.dummyCanvas),super.destroy()}}Ge.prototype._fillFunc=ze,Ge.prototype._strokeFunc=He,Ge.prototype._fillFuncHit=ze,Ge.prototype._strokeFuncHit=He,Ge.prototype.className="TextPath",Ge.prototype._attrsAffectingSize=["text","fontSize","data"],a(Ge),D.addGetterSetter(Ge,"data"),D.addGetterSetter(Ge,"fontFamily","Arial"),D.addGetterSetter(Ge,"fontSize",12,y()),D.addGetterSetter(Ge,"fontStyle",je),D.addGetterSetter(Ge,"align","left"),D.addGetterSetter(Ge,"letterSpacing",0,y()),D.addGetterSetter(Ge,"textBaseline","middle"),D.addGetterSetter(Ge,"fontVariant",je),D.addGetterSetter(Ge,"text",""),D.addGetterSetter(Ge,"textDecoration",null),D.addGetterSetter(Ge,"kerningFunc",null);var We="tr-konva",qe=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange"].map((t=>t+`.${We}`)).join(" "),Ue="nodesRect",Ke=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],$e={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135};const Ye="ontouchstart"in o._global;var Ve=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function Xe(t,e,n){const r=n.x+(t.x-n.x)*Math.cos(e)-(t.y-n.y)*Math.sin(e),i=n.y+(t.x-n.x)*Math.sin(e)+(t.y-n.y)*Math.cos(e);return Object.assign(Object.assign({},t),{rotation:t.rotation+e,x:r,y:i})}function Je(t,e){const n=function(t){return{x:t.x+t.width/2*Math.cos(t.rotation)+t.height/2*Math.sin(-t.rotation),y:t.y+t.height/2*Math.cos(t.rotation)+t.width/2*Math.sin(t.rotation)}}(t);return Xe(t,e,n)}class Qe extends $t{constructor(t){super(t),this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(qe,this.update),this.getNode()&&this.update()}attachTo(t){return this.setNode(t),this}setNode(t){return g.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([t])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return We+this._id}setNodes(t=[]){this._nodes&&this._nodes.length&&this.detach();const e=t.filter((t=>!t.isAncestorOf(this)||(g.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1)));return this._nodes=t=e,1===t.length&&this.useSingleNodeRotation()?this.rotation(t[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach((t=>{const e=()=>{1===this.nodes().length&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),this._transforming||this.isDragging()||this.update()},n=t._attrsAffectingSize.map((t=>t+"Change."+this._getEventNamespace())).join(" ");t.on(n,e),t.on(Ke.map((t=>t+`.${this._getEventNamespace()}`)).join(" "),e),t.on(`absoluteTransformChange.${this._getEventNamespace()}`,e),this._proxyDrag(t)})),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(t){let e;t.on(`dragstart.${this._getEventNamespace()}`,(n=>{e=t.getAbsolutePosition(),this.isDragging()||t===this.findOne(".back")||this.startDrag(n,!1)})),t.on(`dragmove.${this._getEventNamespace()}`,(n=>{if(!e)return;const r=t.getAbsolutePosition(),i=r.x-e.x,o=r.y-e.y;this.nodes().forEach((e=>{if(e===t)return;if(e.isDragging())return;const r=e.getAbsolutePosition();e.setAbsolutePosition({x:r.x+i,y:r.y+o}),e.startDrag(n)})),e=null}))}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach((t=>{t.off("."+this._getEventNamespace())})),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(Ue),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(Ue,this.__getNodeRect)}__getNodeShape(t,e=this.rotation(),n){var r=t.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),i=t.getAbsoluteScale(n),a=t.getAbsolutePosition(n),s=r.x*i.x-t.offsetX()*i.x,l=r.y*i.y-t.offsetY()*i.y;const u=(o.getAngle(t.getAbsoluteRotation())+2*Math.PI)%(2*Math.PI);return Xe({x:a.x+s*Math.cos(u)+l*Math.sin(-u),y:a.y+l*Math.cos(u)+s*Math.sin(u),width:r.width*i.x,height:r.height*i.y,rotation:u},-o.getAngle(e),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const t=[];this.nodes().map((e=>{const n=e.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()});var r=[{x:n.x,y:n.y},{x:n.x+n.width,y:n.y},{x:n.x+n.width,y:n.y+n.height},{x:n.x,y:n.y+n.height}],i=e.getAbsoluteTransform();r.forEach((function(e){var n=i.point(e);t.push(n)}))}));const e=new s;var n,r,i,a;e.rotate(-o.getAngle(this.rotation())),t.forEach((function(t){var o=e.point(t);void 0===n&&(n=i=o.x,r=a=o.y),n=Math.min(n,o.x),r=Math.min(r,o.y),i=Math.max(i,o.x),a=Math.max(a,o.y)})),e.invert();const l=e.point({x:n,y:r});return{x:l.x,y:l.y,width:i-n,height:a-r,rotation:o.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),Ve.forEach(function(t){this._createAnchor(t)}.bind(this)),this._createAnchor("rotater")}_createAnchor(t){var e=new xe({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:t+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:Ye?10:"auto"}),n=this;e.on("mousedown touchstart",(function(t){n._handleMouseDown(t)})),e.on("dragstart",(t=>{e.stopDrag(),t.cancelBubble=!0})),e.on("dragend",(t=>{t.cancelBubble=!0})),e.on("mouseenter",(()=>{var n=o.getAngle(this.rotation()),r=function(t,e){if("rotater"===t)return"crosshair";e+=g.degToRad($e[t]||0);var n=(g.radToDeg(e)%360+360)%360;return g._inRange(n,337.5,360)||g._inRange(n,0,22.5)?"ns-resize":g._inRange(n,22.5,67.5)?"nesw-resize":g._inRange(n,67.5,112.5)?"ew-resize":g._inRange(n,112.5,157.5)?"nwse-resize":g._inRange(n,157.5,202.5)?"ns-resize":g._inRange(n,202.5,247.5)?"nesw-resize":g._inRange(n,247.5,292.5)?"ew-resize":g._inRange(n,292.5,337.5)?"nwse-resize":(g.error("Transformer has unknown angle for cursor detection: "+n),"pointer")}(t,n);e.getStage().content&&(e.getStage().content.style.cursor=r),this._cursorChange=!0})),e.on("mouseout",(()=>{e.getStage().content&&(e.getStage().content.style.cursor=""),this._cursorChange=!1})),this.add(e)}_createBack(){var t=new Gt({name:"back",width:0,height:0,draggable:!0,sceneFunc(t){var e=this.getParent(),n=e.padding();t.beginPath(),t.rect(-n,-n,this.width()+2*n,this.height()+2*n),t.moveTo(this.width()/2,-n),e.rotateEnabled()&&t.lineTo(this.width()/2,-e.rotateAnchorOffset()*g._sign(this.height())-n),t.fillStrokeShape(this)},hitFunc:(t,e)=>{if(this.shouldOverdrawWholeArea()){var n=this.padding();t.beginPath(),t.rect(-n,-n,e.width()+2*n,e.height()+2*n),t.fillStrokeShape(e)}}});this.add(t),this._proxyDrag(t),t.on("dragstart",(t=>{t.cancelBubble=!0})),t.on("dragmove",(t=>{t.cancelBubble=!0})),t.on("dragend",(t=>{t.cancelBubble=!0})),this.on("dragmove",(t=>{this.update()}))}_handleMouseDown(t){this._movingAnchorName=t.target.name().split(" ")[0];var e=this._getNodeRect(),n=e.width,r=e.height,i=Math.sqrt(Math.pow(n,2)+Math.pow(r,2));this.sin=Math.abs(r/i),this.cos=Math.abs(n/i),"undefined"!=typeof window&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;var o=t.target.getAbsolutePosition(),a=t.target.getStage().getPointerPosition();this._anchorDragOffset={x:a.x-o.x,y:a.y-o.y},this._fire("transformstart",{evt:t.evt,target:this.getNode()}),this._nodes.forEach((e=>{e._fire("transformstart",{evt:t.evt,target:e})}))}_handleMouseMove(t){var e,n,r,i=this.findOne("."+this._movingAnchorName),a=i.getStage();a.setPointersPositions(t);const s=a.getPointerPosition();let l={x:s.x-this._anchorDragOffset.x,y:s.y-this._anchorDragOffset.y};const u=i.getAbsolutePosition();this.anchorDragBoundFunc()&&(l=this.anchorDragBoundFunc()(u,l,t)),i.setAbsolutePosition(l);const c=i.getAbsolutePosition();if(u.x!==c.x||u.y!==c.y)if("rotater"!==this._movingAnchorName){var h=this.keepRatio()||t.shiftKey,d=this.centeredScaling()||t.altKey;if("top-left"===this._movingAnchorName){if(h){var f=d?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};r=Math.sqrt(Math.pow(f.x-i.x(),2)+Math.pow(f.y-i.y(),2));var p=this.findOne(".top-left").x()>f.x?-1:1,g=this.findOne(".top-left").y()>f.y?-1:1;e=r*this.cos*p,n=r*this.sin*g,this.findOne(".top-left").x(f.x-e),this.findOne(".top-left").y(f.y-n)}}else if("top-center"===this._movingAnchorName)this.findOne(".top-left").y(i.y());else if("top-right"===this._movingAnchorName){if(h){f=d?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};r=Math.sqrt(Math.pow(i.x()-f.x,2)+Math.pow(f.y-i.y(),2));p=this.findOne(".top-right").x()<f.x?-1:1,g=this.findOne(".top-right").y()>f.y?-1:1;e=r*this.cos*p,n=r*this.sin*g,this.findOne(".top-right").x(f.x+e),this.findOne(".top-right").y(f.y-n)}var m=i.position();this.findOne(".top-left").y(m.y),this.findOne(".bottom-right").x(m.x)}else if("middle-left"===this._movingAnchorName)this.findOne(".top-left").x(i.x());else if("middle-right"===this._movingAnchorName)this.findOne(".bottom-right").x(i.x());else if("bottom-left"===this._movingAnchorName){if(h){f=d?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};r=Math.sqrt(Math.pow(f.x-i.x(),2)+Math.pow(i.y()-f.y,2));p=f.x<i.x()?-1:1,g=i.y()<f.y?-1:1;e=r*this.cos*p,n=r*this.sin*g,i.x(f.x-e),i.y(f.y+n)}m=i.position(),this.findOne(".top-left").x(m.x),this.findOne(".bottom-right").y(m.y)}else if("bottom-center"===this._movingAnchorName)this.findOne(".bottom-right").y(i.y());else if("bottom-right"===this._movingAnchorName){if(h){f=d?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};r=Math.sqrt(Math.pow(i.x()-f.x,2)+Math.pow(i.y()-f.y,2));p=this.findOne(".bottom-right").x()<f.x?-1:1,g=this.findOne(".bottom-right").y()<f.y?-1:1;e=r*this.cos*p,n=r*this.sin*g,this.findOne(".bottom-right").x(f.x+e),this.findOne(".bottom-right").y(f.y+n)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));if(d=this.centeredScaling()||t.altKey){var v=this.findOne(".top-left"),y=this.findOne(".bottom-right"),b=v.x(),x=v.y(),w=this.getWidth()-y.x(),C=this.getHeight()-y.y();y.move({x:-b,y:-x}),v.move({x:w,y:C})}var k=this.findOne(".top-left").getAbsolutePosition();e=k.x,n=k.y;var S=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),_=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:e,y:n,width:S,height:_,rotation:o.getAngle(this.rotation())},t)}else{var D=this._getNodeRect();e=i.x()-D.width/2,n=-i.y()+D.height/2;let r=Math.atan2(-n,e)+Math.PI/2;D.height<0&&(r-=Math.PI);const a=o.getAngle(this.rotation())+r,s=o.getAngle(this.rotationSnapTolerance()),l=Je(D,function(t,e,n){let r=e;for(let i=0;i<t.length;i++){const a=o.getAngle(t[i]),s=Math.abs(a-e)%(2*Math.PI);Math.min(s,2*Math.PI-s)<n&&(r=a)}return r}(this.rotationSnaps(),a,s)-D.rotation);this._fitNodesInto(l,t)}}_handleMouseUp(t){this._removeEvents(t)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(t){if(this._transforming){this._transforming=!1,"undefined"!=typeof window&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));var e=this.getNode();this._fire("transformend",{evt:t,target:e}),e&&this._nodes.forEach((e=>{e._fire("transformend",{evt:t,target:e})})),this._movingAnchorName=null}}_fitNodesInto(t,e){var n=this._getNodeRect();if(g._inRange(t.width,2*-this.padding()-1,1))return void this.update();if(g._inRange(t.height,2*-this.padding()-1,1))return void this.update();const r=this.flipEnabled();var i=new s;if(i.rotate(o.getAngle(this.rotation())),this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("left")>=0){const e=i.point({x:2*-this.padding(),y:0});if(t.x+=e.x,t.y+=e.y,t.width+=2*this.padding(),this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,!r)return void this.update()}else if(this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("right")>=0){const e=i.point({x:2*this.padding(),y:0});if(this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,t.width+=2*this.padding(),!r)return void this.update()}if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("top")>=0){const e=i.point({x:0,y:2*-this.padding()});if(t.x+=e.x,t.y+=e.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,t.height+=2*this.padding(),!r)return void this.update()}else if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const e=i.point({x:0,y:2*this.padding()});if(this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,t.height+=2*this.padding(),!r)return void this.update()}if(this.boundBoxFunc()){const e=this.boundBoxFunc()(n,t);e?t=e:g.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const a=1e7,l=new s;l.translate(n.x,n.y),l.rotate(n.rotation),l.scale(n.width/a,n.height/a);const u=new s;u.translate(t.x,t.y),u.rotate(t.rotation),u.scale(t.width/a,t.height/a);const c=u.multiply(l.invert());this._nodes.forEach((t=>{var n;const r=t.getParent().getAbsoluteTransform(),i=t.getTransform().copy();i.translate(t.offsetX(),t.offsetY());const o=new s;o.multiply(r.copy().invert()).multiply(c).multiply(r).multiply(i);const a=o.decompose();t.setAttrs(a),this._fire("transform",{evt:e,target:t}),t._fire("transform",{evt:e,target:t}),null===(n=t.getLayer())||void 0===n||n.batchDraw()})),this.rotation(g._getRotation(t.rotation)),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(t,e){this.findOne(t).setAttrs(e)}update(){var t,e=this._getNodeRect();this.rotation(g._getRotation(e.rotation));var n=e.width,r=e.height,i=this.enabledAnchors(),o=this.resizeEnabled(),a=this.padding(),s=this.anchorSize();this.find("._anchor").forEach((t=>{t.setAttrs({width:s,height:s,offsetX:s/2,offsetY:s/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})})),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:s/2+a,offsetY:s/2+a,visible:o&&i.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:n/2,y:0,offsetY:s/2+a,visible:o&&i.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:n,y:0,offsetX:s/2-a,offsetY:s/2+a,visible:o&&i.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:r/2,offsetX:s/2+a,visible:o&&i.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:n,y:r/2,offsetX:s/2-a,visible:o&&i.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:r,offsetX:s/2+a,offsetY:s/2-a,visible:o&&i.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:n/2,y:r,offsetY:s/2-a,visible:o&&i.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:n,y:r,offsetX:s/2-a,offsetY:s/2-a,visible:o&&i.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:n/2,y:-this.rotateAnchorOffset()*g._sign(r)-a,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:n,height:r,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0}),null===(t=this.getLayer())||void 0===t||t.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();var t=this.findOne("."+this._movingAnchorName);t&&t.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),$t.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return J.prototype.toObject.call(this)}clone(t){return J.prototype.clone.call(this,t)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}Qe.prototype.className="Transformer",a(Qe),D.addGetterSetter(Qe,"enabledAnchors",Ve,(function(t){return t instanceof Array||g.warn("enabledAnchors value should be an array"),t instanceof Array&&t.forEach((function(t){-1===Ve.indexOf(t)&&g.warn("Unknown anchor name: "+t+". Available names are: "+Ve.join(", "))})),t||[]})),D.addGetterSetter(Qe,"flipEnabled",!0,k()),D.addGetterSetter(Qe,"resizeEnabled",!0),D.addGetterSetter(Qe,"anchorSize",10,y()),D.addGetterSetter(Qe,"rotateEnabled",!0),D.addGetterSetter(Qe,"rotationSnaps",[]),D.addGetterSetter(Qe,"rotateAnchorOffset",50,y()),D.addGetterSetter(Qe,"rotationSnapTolerance",5,y()),D.addGetterSetter(Qe,"borderEnabled",!0),D.addGetterSetter(Qe,"anchorStroke","rgb(0, 161, 255)"),D.addGetterSetter(Qe,"anchorStrokeWidth",1,y()),D.addGetterSetter(Qe,"anchorFill","white"),D.addGetterSetter(Qe,"anchorCornerRadius",0,y()),D.addGetterSetter(Qe,"borderStroke","rgb(0, 161, 255)"),D.addGetterSetter(Qe,"borderStrokeWidth",1,y()),D.addGetterSetter(Qe,"borderDash"),D.addGetterSetter(Qe,"keepRatio",!0),D.addGetterSetter(Qe,"centeredScaling",!1),D.addGetterSetter(Qe,"ignoreStroke",!1),D.addGetterSetter(Qe,"padding",0,y()),D.addGetterSetter(Qe,"node"),D.addGetterSetter(Qe,"nodes"),D.addGetterSetter(Qe,"boundBoxFunc"),D.addGetterSetter(Qe,"anchorDragBoundFunc"),D.addGetterSetter(Qe,"shouldOverdrawWholeArea",!1),D.addGetterSetter(Qe,"useSingleNodeRotation",!0),D.backCompat(Qe,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});class Ze extends Gt{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.radius(),0,o.getAngle(this.angle()),this.clockwise()),t.lineTo(0,0),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(t){this.radius(t/2)}setHeight(t){this.radius(t/2)}}function tn(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}Ze.prototype.className="Wedge",Ze.prototype._centroid=!0,Ze.prototype._attrsAffectingSize=["radius"],a(Ze),D.addGetterSetter(Ze,"radius",0,y()),D.addGetterSetter(Ze,"angle",0,y()),D.addGetterSetter(Ze,"clockwise",!1),D.backCompat(Ze,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});var en=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],nn=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];D.addGetterSetter(J,"blurRadius",0,y(),D.afterSetFilter);D.addGetterSetter(J,"brightness",0,y(),D.afterSetFilter);D.addGetterSetter(J,"contrast",0,y(),D.afterSetFilter);function rn(t,e,n,r,i){var o=n-e,a=i-r;return 0===o?r+a/2:0===a?r:a*((t-e)/o)+r}D.addGetterSetter(J,"embossStrength",.5,y(),D.afterSetFilter),D.addGetterSetter(J,"embossWhiteLevel",.5,y(),D.afterSetFilter),D.addGetterSetter(J,"embossDirection","top-left",null,D.afterSetFilter),D.addGetterSetter(J,"embossBlend",!1,null,D.afterSetFilter);D.addGetterSetter(J,"enhance",0,y(),D.afterSetFilter);D.addGetterSetter(J,"hue",0,y(),D.afterSetFilter),D.addGetterSetter(J,"saturation",0,y(),D.afterSetFilter),D.addGetterSetter(J,"luminance",0,y(),D.afterSetFilter);D.addGetterSetter(J,"hue",0,y(),D.afterSetFilter),D.addGetterSetter(J,"saturation",0,y(),D.afterSetFilter),D.addGetterSetter(J,"value",0,y(),D.afterSetFilter);function on(t,e,n){var r=4*(n*t.width+e),i=[];return i.push(t.data[r++],t.data[r++],t.data[r++],t.data[r++]),i}function an(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}D.addGetterSetter(J,"kaleidoscopePower",2,y(),D.afterSetFilter),D.addGetterSetter(J,"kaleidoscopeAngle",0,y(),D.afterSetFilter);D.addGetterSetter(J,"threshold",0,y(),D.afterSetFilter);D.addGetterSetter(J,"noise",.2,y(),D.afterSetFilter);D.addGetterSetter(J,"pixelSize",8,y(),D.afterSetFilter);D.addGetterSetter(J,"levels",.5,y(),D.afterSetFilter);D.addGetterSetter(J,"red",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),D.addGetterSetter(J,"green",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),D.addGetterSetter(J,"blue",0,v,D.afterSetFilter);D.addGetterSetter(J,"red",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),D.addGetterSetter(J,"green",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),D.addGetterSetter(J,"blue",0,v,D.afterSetFilter),D.addGetterSetter(J,"alpha",1,(function(t){return this._filterUpToDate=!1,t>1?1:t<0?0:t}));D.addGetterSetter(J,"threshold",.5,y(),D.afterSetFilter);const sn=ne.Util._assign(ne,{Arc:re,Arrow:le,Circle:ue,Ellipse:ce,Image:he,Label:ye,Tag:be,Line:ae,Path:se,Rect:xe,RegularPolygon:we,Ring:ke,Sprite:Se,Star:_e,Text:Re,TextPath:Ge,Transformer:Qe,Wedge:Ze,Filters:{Blur:function(t){var e=Math.round(this.blurRadius());e>0&&function(t,e){var n,r,i,o,a,s,l,u,c,h,d,f,p,g,m,v,y,b,x,w,C,k,S,_,D=t.data,A=t.width,T=t.height,E=e+e+1,F=A-1,L=T-1,P=e+1,O=P*(P+1)/2,M=new tn,B=null,N=M,I=null,R=null,j=en[e],z=nn[e];for(i=1;i<E;i++)N=N.next=new tn,i===P&&(B=N);for(N.next=M,l=s=0,r=0;r<T;r++){for(v=y=b=x=u=c=h=d=0,f=P*(w=D[s]),p=P*(C=D[s+1]),g=P*(k=D[s+2]),m=P*(S=D[s+3]),u+=O*w,c+=O*C,h+=O*k,d+=O*S,N=M,i=0;i<P;i++)N.r=w,N.g=C,N.b=k,N.a=S,N=N.next;for(i=1;i<P;i++)o=s+((F<i?F:i)<<2),u+=(N.r=w=D[o])*(_=P-i),c+=(N.g=C=D[o+1])*_,h+=(N.b=k=D[o+2])*_,d+=(N.a=S=D[o+3])*_,v+=w,y+=C,b+=k,x+=S,N=N.next;for(I=M,R=B,n=0;n<A;n++)D[s+3]=S=d*j>>z,0!==S?(S=255/S,D[s]=(u*j>>z)*S,D[s+1]=(c*j>>z)*S,D[s+2]=(h*j>>z)*S):D[s]=D[s+1]=D[s+2]=0,u-=f,c-=p,h-=g,d-=m,f-=I.r,p-=I.g,g-=I.b,m-=I.a,o=l+((o=n+e+1)<F?o:F)<<2,u+=v+=I.r=D[o],c+=y+=I.g=D[o+1],h+=b+=I.b=D[o+2],d+=x+=I.a=D[o+3],I=I.next,f+=w=R.r,p+=C=R.g,g+=k=R.b,m+=S=R.a,v-=w,y-=C,b-=k,x-=S,R=R.next,s+=4;l+=A}for(n=0;n<A;n++){for(y=b=x=v=c=h=d=u=0,f=P*(w=D[s=n<<2]),p=P*(C=D[s+1]),g=P*(k=D[s+2]),m=P*(S=D[s+3]),u+=O*w,c+=O*C,h+=O*k,d+=O*S,N=M,i=0;i<P;i++)N.r=w,N.g=C,N.b=k,N.a=S,N=N.next;for(a=A,i=1;i<=e;i++)s=a+n<<2,u+=(N.r=w=D[s])*(_=P-i),c+=(N.g=C=D[s+1])*_,h+=(N.b=k=D[s+2])*_,d+=(N.a=S=D[s+3])*_,v+=w,y+=C,b+=k,x+=S,N=N.next,i<L&&(a+=A);for(s=n,I=M,R=B,r=0;r<T;r++)D[3+(o=s<<2)]=S=d*j>>z,S>0?(S=255/S,D[o]=(u*j>>z)*S,D[o+1]=(c*j>>z)*S,D[o+2]=(h*j>>z)*S):D[o]=D[o+1]=D[o+2]=0,u-=f,c-=p,h-=g,d-=m,f-=I.r,p-=I.g,g-=I.b,m-=I.a,o=n+((o=r+P)<L?o:L)*A<<2,u+=v+=I.r=D[o],c+=y+=I.g=D[o+1],h+=b+=I.b=D[o+2],d+=x+=I.a=D[o+3],I=I.next,f+=w=R.r,p+=C=R.g,g+=k=R.b,m+=S=R.a,v-=w,y-=C,b-=k,x-=S,R=R.next,s+=A}}(t,e)},Brighten:function(t){var e,n=255*this.brightness(),r=t.data,i=r.length;for(e=0;e<i;e+=4)r[e]+=n,r[e+1]+=n,r[e+2]+=n},Contrast:function(t){var e,n=Math.pow((this.contrast()+100)/100,2),r=t.data,i=r.length,o=150,a=150,s=150;for(e=0;e<i;e+=4)o=r[e],a=r[e+1],s=r[e+2],o/=255,o-=.5,o*=n,o+=.5,a/=255,a-=.5,a*=n,a+=.5,s/=255,s-=.5,s*=n,s+=.5,o=(o*=255)<0?0:o>255?255:o,a=(a*=255)<0?0:a>255?255:a,s=(s*=255)<0?0:s>255?255:s,r[e]=o,r[e+1]=a,r[e+2]=s},Emboss:function(t){var e=10*this.embossStrength(),n=255*this.embossWhiteLevel(),r=this.embossDirection(),i=this.embossBlend(),o=0,a=0,s=t.data,l=t.width,u=t.height,c=4*l,h=u;switch(r){case"top-left":o=-1,a=-1;break;case"top":o=-1,a=0;break;case"top-right":o=-1,a=1;break;case"right":o=0,a=1;break;case"bottom-right":o=1,a=1;break;case"bottom":o=1,a=0;break;case"bottom-left":o=1,a=-1;break;case"left":o=0,a=-1;break;default:g.error("Unknown emboss direction: "+r)}do{var d=(h-1)*c,f=o;h+f<1&&(f=0),h+f>u&&(f=0);var p=(h-1+f)*l*4,m=l;do{var v=d+4*(m-1),y=a;m+y<1&&(y=0),m+y>l&&(y=0);var b=p+4*(m-1+y),x=s[v]-s[b],w=s[v+1]-s[b+1],C=s[v+2]-s[b+2],k=x,S=k>0?k:-k;if((w>0?w:-w)>S&&(k=w),(C>0?C:-C)>S&&(k=C),k*=e,i){var _=s[v]+k,D=s[v+1]+k,A=s[v+2]+k;s[v]=_>255?255:_<0?0:_,s[v+1]=D>255?255:D<0?0:D,s[v+2]=A>255?255:A<0?0:A}else{var T=n-k;T<0?T=0:T>255&&(T=255),s[v]=s[v+1]=s[v+2]=T}}while(--m)}while(--h)},Enhance:function(t){var e,n,r,i,o=t.data,a=o.length,s=o[0],l=s,u=o[1],c=u,h=o[2],d=h,f=this.enhance();if(0!==f){for(i=0;i<a;i+=4)(e=o[i+0])<s?s=e:e>l&&(l=e),(n=o[i+1])<u?u=n:n>c&&(c=n),(r=o[i+2])<h?h=r:r>d&&(d=r);var p,g,m,v,y,b,x,w,C;for(l===s&&(l=255,s=0),c===u&&(c=255,u=0),d===h&&(d=255,h=0),f>0?(g=l+f*(255-l),m=s-f*(s-0),y=c+f*(255-c),b=u-f*(u-0),w=d+f*(255-d),C=h-f*(h-0)):(g=l+f*(l-(p=.5*(l+s))),m=s+f*(s-p),y=c+f*(c-(v=.5*(c+u))),b=u+f*(u-v),w=d+f*(d-(x=.5*(d+h))),C=h+f*(h-x)),i=0;i<a;i+=4)o[i+0]=rn(o[i+0],s,l,m,g),o[i+1]=rn(o[i+1],u,c,b,y),o[i+2]=rn(o[i+2],h,d,C,w)}},Grayscale:function(t){var e,n,r=t.data,i=r.length;for(e=0;e<i;e+=4)n=.34*r[e]+.5*r[e+1]+.16*r[e+2],r[e]=n,r[e+1]=n,r[e+2]=n},HSL:function(t){var e,n,r,i,o,a=t.data,s=a.length,l=Math.pow(2,this.saturation()),u=Math.abs(this.hue()+360)%360,c=127*this.luminance(),h=1*l*Math.cos(u*Math.PI/180),d=1*l*Math.sin(u*Math.PI/180),f=.299+.701*h+.167*d,p=.587-.587*h+.33*d,g=.114-.114*h-.497*d,m=.299-.299*h-.328*d,v=.587+.413*h+.035*d,y=.114-.114*h+.293*d,b=.299-.3*h+1.25*d,x=.587-.586*h-1.05*d,w=.114+.886*h-.2*d;for(e=0;e<s;e+=4)n=a[e+0],r=a[e+1],i=a[e+2],o=a[e+3],a[e+0]=f*n+p*r+g*i+c,a[e+1]=m*n+v*r+y*i+c,a[e+2]=b*n+x*r+w*i+c,a[e+3]=o},HSV:function(t){var e,n,r,i,o,a=t.data,s=a.length,l=Math.pow(2,this.value()),u=Math.pow(2,this.saturation()),c=Math.abs(this.hue()+360)%360,h=l*u*Math.cos(c*Math.PI/180),d=l*u*Math.sin(c*Math.PI/180),f=.299*l+.701*h+.167*d,p=.587*l-.587*h+.33*d,g=.114*l-.114*h-.497*d,m=.299*l-.299*h-.328*d,v=.587*l+.413*h+.035*d,y=.114*l-.114*h+.293*d,b=.299*l-.3*h+1.25*d,x=.587*l-.586*h-1.05*d,w=.114*l+.886*h-.2*d;for(e=0;e<s;e+=4)n=a[e+0],r=a[e+1],i=a[e+2],o=a[e+3],a[e+0]=f*n+p*r+g*i,a[e+1]=m*n+v*r+y*i,a[e+2]=b*n+x*r+w*i,a[e+3]=o},Invert:function(t){var e,n=t.data,r=n.length;for(e=0;e<r;e+=4)n[e]=255-n[e],n[e+1]=255-n[e+1],n[e+2]=255-n[e+2]},Kaleidoscope:function(t){var e,n,r,i,o,a,s,l,u,c=t.width,h=t.height,d=Math.round(this.kaleidoscopePower()),f=Math.round(this.kaleidoscopeAngle()),p=Math.floor(c*(f%360)/360);if(!(d<1)){var m=g.createCanvasElement();m.width=c,m.height=h;var v=m.getContext("2d").getImageData(0,0,c,h);g.releaseCanvas(m),function(t,e,n){var r,i,o,a,s=t.data,l=e.data,u=t.width,c=t.height,h=n.polarCenterX||u/2,d=n.polarCenterY||c/2,f=0,p=0,g=0,m=0,v=Math.sqrt(h*h+d*d);i=u-h,o=c-d,v=(a=Math.sqrt(i*i+o*o))>v?a:v;var y,b,x,w,C=c,k=u,S=360/k*Math.PI/180;for(b=0;b<k;b+=1)for(x=Math.sin(b*S),w=Math.cos(b*S),y=0;y<C;y+=1)i=Math.floor(h+v*y/C*w),f=s[0+(r=4*((o=Math.floor(d+v*y/C*x))*u+i))],p=s[r+1],g=s[r+2],m=s[r+3],l[0+(r=4*(b+y*u))]=f,l[r+1]=p,l[r+2]=g,l[r+3]=m}(t,v,{polarCenterX:c/2,polarCenterY:h/2});for(var y=c/Math.pow(2,d);y<=8;)y*=2,d-=1;var b=y=Math.ceil(y),x=0,w=b,C=1;for(p+y>c&&(x=b,w=0,C=-1),n=0;n<h;n+=1)for(e=x;e!==w;e+=C)l=4*(c*n+Math.round(e+p)%c),i=v.data[l+0],o=v.data[l+1],a=v.data[l+2],s=v.data[l+3],u=4*(c*n+e),v.data[u+0]=i,v.data[u+1]=o,v.data[u+2]=a,v.data[u+3]=s;for(n=0;n<h;n+=1)for(b=Math.floor(y),r=0;r<d;r+=1){for(e=0;e<b+1;e+=1)l=4*(c*n+e),i=v.data[l+0],o=v.data[l+1],a=v.data[l+2],s=v.data[l+3],u=4*(c*n+2*b-e-1),v.data[u+0]=i,v.data[u+1]=o,v.data[u+2]=a,v.data[u+3]=s;b*=2}!function(t,e,n){var r,i,o,a,s,l,u=t.data,c=e.data,h=t.width,d=t.height,f=n.polarCenterX||h/2,p=n.polarCenterY||d/2,g=0,m=0,v=0,y=0,b=Math.sqrt(f*f+p*p);i=h-f,o=d-p,b=(l=Math.sqrt(i*i+o*o))>b?l:b;var x,w,C,k=d,S=h,_=n.polarRotation||0;for(i=0;i<h;i+=1)for(o=0;o<d;o+=1)a=i-f,s=o-p,x=Math.sqrt(a*a+s*s)*k/b,w=(w=(180*Math.atan2(s,a)/Math.PI+360+_)%360)*S/360,C=Math.floor(w),g=u[0+(r=4*(Math.floor(x)*h+C))],m=u[r+1],v=u[r+2],y=u[r+3],c[0+(r=4*(o*h+i))]=g,c[r+1]=m,c[r+2]=v,c[r+3]=y}(v,t,{polarRotation:0})}},Mask:function(t){var e=function(t,e){var n=on(t,0,0),r=on(t,t.width-1,0),i=on(t,0,t.height-1),o=on(t,t.width-1,t.height-1),a=e||10;if(an(n,r)<a&&an(r,o)<a&&an(o,i)<a&&an(i,n)<a){for(var s=function(t){for(var e=[0,0,0],n=0;n<t.length;n++)e[0]+=t[n][0],e[1]+=t[n][1],e[2]+=t[n][2];return e[0]/=t.length,e[1]/=t.length,e[2]/=t.length,e}([r,n,o,i]),l=[],u=0;u<t.width*t.height;u++){var c=an(s,[t.data[4*u],t.data[4*u+1],t.data[4*u+2]]);l[u]=c<a?0:255}return l}}(t,this.threshold());return e&&function(t,e){for(var n=0;n<t.width*t.height;n++)t.data[4*n+3]=e[n]}(t,e=function(t,e,n){for(var r=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],i=Math.round(Math.sqrt(r.length)),o=Math.floor(i/2),a=[],s=0;s<n;s++)for(var l=0;l<e;l++){for(var u=s*e+l,c=0,h=0;h<i;h++)for(var d=0;d<i;d++){var f=s+h-o,p=l+d-o;if(f>=0&&f<n&&p>=0&&p<e){var g=r[h*i+d];c+=t[f*e+p]*g}}a[u]=c}return a}(e=function(t,e,n){for(var r=[1,1,1,1,1,1,1,1,1],i=Math.round(Math.sqrt(r.length)),o=Math.floor(i/2),a=[],s=0;s<n;s++)for(var l=0;l<e;l++){for(var u=s*e+l,c=0,h=0;h<i;h++)for(var d=0;d<i;d++){var f=s+h-o,p=l+d-o;if(f>=0&&f<n&&p>=0&&p<e){var g=r[h*i+d];c+=t[f*e+p]*g}}a[u]=c>=1020?255:0}return a}(e=function(t,e,n){for(var r=[1,1,1,1,0,1,1,1,1],i=Math.round(Math.sqrt(r.length)),o=Math.floor(i/2),a=[],s=0;s<n;s++)for(var l=0;l<e;l++){for(var u=s*e+l,c=0,h=0;h<i;h++)for(var d=0;d<i;d++){var f=s+h-o,p=l+d-o;if(f>=0&&f<n&&p>=0&&p<e){var g=r[h*i+d];c+=t[f*e+p]*g}}a[u]=2040===c?255:0}return a}(e,t.width,t.height),t.width,t.height),t.width,t.height)),t},Noise:function(t){var e,n=255*this.noise(),r=t.data,i=r.length,o=n/2;for(e=0;e<i;e+=4)r[e+0]+=o-2*o*Math.random(),r[e+1]+=o-2*o*Math.random(),r[e+2]+=o-2*o*Math.random()},Pixelate:function(t){var e,n,r,i,o,a,s,l,u,c,h,d,f,p,m=Math.ceil(this.pixelSize()),v=t.width,y=t.height,b=Math.ceil(v/m),x=Math.ceil(y/m),w=t.data;if(m<=0)g.error("pixelSize value can not be <= 0");else for(d=0;d<b;d+=1)for(f=0;f<x;f+=1){for(i=0,o=0,a=0,s=0,u=(l=d*m)+m,h=(c=f*m)+m,p=0,e=l;e<u;e+=1)if(!(e>=v))for(n=c;n<h;n+=1)n>=y||(i+=w[(r=4*(v*n+e))+0],o+=w[r+1],a+=w[r+2],s+=w[r+3],p+=1);for(i/=p,o/=p,a/=p,s/=p,e=l;e<u;e+=1)if(!(e>=v))for(n=c;n<h;n+=1)n>=y||(w[(r=4*(v*n+e))+0]=i,w[r+1]=o,w[r+2]=a,w[r+3]=s)}},Posterize:function(t){var e,n=Math.round(254*this.levels())+1,r=t.data,i=r.length,o=255/n;for(e=0;e<i;e+=1)r[e]=Math.floor(r[e]/o)*o},RGB:function(t){var e,n,r=t.data,i=r.length,o=this.red(),a=this.green(),s=this.blue();for(e=0;e<i;e+=4)n=(.34*r[e]+.5*r[e+1]+.16*r[e+2])/255,r[e]=n*o,r[e+1]=n*a,r[e+2]=n*s,r[e+3]=r[e+3]},RGBA:function(t){var e,n,r=t.data,i=r.length,o=this.red(),a=this.green(),s=this.blue(),l=this.alpha();for(e=0;e<i;e+=4)n=1-l,r[e]=o*l+r[e]*n,r[e+1]=a*l+r[e+1]*n,r[e+2]=s*l+r[e+2]*n},Sepia:function(t){var e,n,r,i,o=t.data,a=o.length;for(e=0;e<a;e+=4)n=o[e+0],r=o[e+1],i=o[e+2],o[e+0]=Math.min(255,.393*n+.769*r+.189*i),o[e+1]=Math.min(255,.349*n+.686*r+.168*i),o[e+2]=Math.min(255,.272*n+.534*r+.131*i)},Solarize:function(t){var e=t.data,n=t.width,r=4*n,i=t.height;do{var o=(i-1)*r,a=n;do{var s=o+4*(a-1),l=e[s],u=e[s+1],c=e[s+2];l>127&&(l=255-l),u>127&&(u=255-u),c>127&&(c=255-c),e[s]=l,e[s+1]=u,e[s+2]=c}while(--a)}while(--i)},Threshold:function(t){var e,n=255*this.threshold(),r=t.data,i=r.length;for(e=0;e<i;e+=1)r[e]=r[e]<n?0:255}}})},7235:function(t,e,n){var r,i,o,a=this&&this.__extends||(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},l=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))},u=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};r=[n,e,n(9180)],i=function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Pane=void 0;var r=function(t){function e(){var e=t.apply(this,l([],s(arguments),!1))||this;return e.from=null,e.waitDbClickNode=null,e._isInited=!1,e}return a(e,t),e.prototype.setAppCommands=function(t){this.appCommands=t},e.prototype.setCurrentLayerTag=function(t){this.currentLayerTag=t,this.getLinker()&&this.getLinker().setCurrentLayerTag(this.currentLayerTag)},e.prototype.setLinker=function(e){t.prototype.setLinker.call(this,e),this.getLinker().setCurrentLayerTag(this.currentLayerTag)},e.prototype.onResize=function(){this.stage.width(this.width),this.stage.height(this.height)},e.prototype.isInited=function(){return this._isInited},e.prototype.init=function(e){this._isInited||(this.width=window.innerWidth,this.height=window.innerHeight,t.prototype.init.call(this,e),this._isInited=!0)},e.prototype.longTouch=function(t,e){var n=this,r=this.storage.getByCoords(t);if(null!==this.from||!r)return this.from==r?(confirm("Удалить?")&&this.appCommands.deleteNode(r.getId()).then((function(t){t.success&&(n.getStorage().remove(r),r.remove(),n.linker.removeFor(r))})),void(this.from=null)):this.from&&r&&!this.linker.isLinked(this.from,r)?(this.appCommands.link(this.from.getId(),r.getId(),this.currentLayerTag,this.currentBoard.id).then((function(t){if(t.success){var e=t.link.from,r=t.link.to;n.appBus.link(e,r),n.from=null}})),void(this.from=null)):this.from&&r&&this.linker.isLinked(this.from,r)?(this.appCommands.unlink(this.from.getId(),r.getId(),this.currentLayerTag).then((function(t){t.success&&(n.appBus.unlink(n.from,r),n.from=null)})),void(this.from=null)):void 0;this.from=r},e.prototype.click=function(t,e){var n=this,r=this.storage.getByCoords(t);if(r&&e.evt.ctrlKey)return null===this.from&&r?void(this.from=r):this.from==r?(confirm("Удалить?")&&this.appCommands.deleteNode(r.getId()).then((function(t){t.success&&(n.getStorage().remove(r),r.remove(),n.linker.removeFor(r))})),void(this.from=null)):this.from&&r&&!this.linker.isLinked(this.from,r)?void this.appCommands.link(this.from.getId(),r.getId(),this.currentLayerTag,this.currentBoard.id).then((function(t){if(t.success){var e=t.link.from,r=t.link.to;n.appBus.link(e,r),n.from=null}})):void(this.from&&r&&this.linker.isLinked(this.from,r)&&this.appCommands.unlink(this.from.getId(),r.getId(),this.currentLayerTag).then((function(t){t.success&&(n.appBus.unlink(n.from,r),n.from=null)})));if(r){if(r&&(this.linker.highlightFor(r),this.linker.drawLines()),r&&!this.waitDbClickNode)return this.waitDbClickNode=r,void setTimeout((function(){n.waitDbClickNode=null}),200);r&&r==this.waitDbClickNode&&(this.appBus.execNodeModal(r.getData()),this.waitDbClickNode=null)}else{var i=this.getStorage().getShapes();for(var o in i){i[o].higlight(!1)}this.appCommands.createNote({id:"note_"+this.getRandomString(32),boardId:this.currentBoard.id,x:t.x,y:t.y}).then((function(e){e.success&&n.appBus.addShape(1,{id:e.note.id,x:t.x,y:t.y})}))}},e.prototype.getRandomString=function(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;r<t;r++)n+=e.charAt(Math.floor(62*Math.random()));return n},e.prototype.update=function(t){t.id=this.currentBoard.id,this.appCommands.update(t)},e.prototype.loadNotes=function(t){var e,n;try{for(var r=u(t),i=r.next();!i.done;i=r.next()){var o=i.value,a=this.shapesFactory.createShape(1);a.init(o),a.load(o),this.storage.pushShape(a),a.addToLayer(this.layer)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},e.prototype.loadLinks=function(t){var e,n;this.linker.clear();try{for(var r=u(t),i=r.next();!i.done;i=r.next()){var o=i.value,a=this.storage.getById(o.from),s=this.storage.getById(o.to),l=o.layerId;a&&s&&l&&this.linker.linkShapes(a,s,l)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}this.linker.drawLines()},e}(n.AbstractPane);e.Pane=r}.apply(e,r),void 0===i||(t.exports=i)},7280:(t,e,n)=>{var r;r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractShape=void 0;var n=function(){function t(){}return t.prototype.getCoordinates=function(){return this.coordinates},t}();e.AbstractShape=n}.apply(e,[n,e]),void 0===r||(t.exports=r)},7806:(t,e,n)=>{var r,i;r=[n,e,n(7159)],i=function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Line=void 0;var r=function(){function t(){this.isHihlight=!1,this.id=this.makeid(16),this.line=new n.default.Line({points:[],stroke:"black",strokeWidth:2,lineJoin:"round"})}return t.prototype.setFromShape=function(t){this.fromShape=t},t.prototype.getFromShape=function(){return this.fromShape},t.prototype.setToShape=function(t){this.toShape=t},t.prototype.getToShape=function(){return this.toShape},t.prototype.setLayerTag=function(t){this.layerTag=t},t.prototype.getLayerTag=function(){return this.layerTag},t.prototype.setHighlight=function(t){this.isHihlight=t},t.prototype.getPath=function(){if(!this.fromShape||!this.toShape)return[];var t={x:this.fromShape.getCoordinates().x-10,y:this.fromShape.getCoordinates().y-10,width:this.fromShape.getWidth()+20,height:this.fromShape.getHeight()+20},e={x:this.toShape.getCoordinates().x-10,y:this.toShape.getCoordinates().y-10,width:this.toShape.getWidth()+20,height:this.toShape.getHeight()+20},n={x:t.x+t.width/2,y:t.y+t.height/2},r={x:e.x+e.width/2,y:e.y+e.height/2},i=[],o=t.x+t.width,a=t.y+t.height,s=e.x+e.width,l=e.y+e.height;return o<e.x&&r.y<a+60&&r.y>t.y-60?(i.push(o-10),i.push(n.y),i.push(o),i.push(n.y),i.push(e.x),i.push(r.y),i.push(e.x+10),i.push(r.y)):s<t.x&&r.y<a+60&&r.y>t.y-60?(i.push(t.x+10),i.push(n.y),i.push(t.x),i.push(n.y),i.push(s),i.push(r.y),i.push(s-10),i.push(r.y)):a<e.y?(i.push(n.x),i.push(a-10),i.push(n.x),i.push(a),i.push(r.x),i.push(e.y),i.push(r.x),i.push(e.y+10)):l<t.y&&(i.push(n.x),i.push(t.y+10),i.push(n.x),i.push(t.y),i.push(r.x),i.push(l),i.push(r.x),i.push(l-10)),i},t.prototype.draw=function(t){var e=this.getPath();0!=e.length&&(this.line.strokeWidth(2),this.isHihlight&&this.line.strokeWidth(10),this.line.points(e),t.add(this.line))},t.prototype.makeid=function(t){for(var e="",n="abcdefghijklmnopqrstuvwxyz0123456789",r=0;r<t;r++)e+=n.charAt(Math.floor(36*Math.random()));return e},t.prototype.getId=function(){return this.id},t.prototype.remove=function(){this.line.remove()},t}();e.Line=r}.apply(e,r),void 0===i||(t.exports=i)},7951:(t,e,n)=>{var r,i;r=[n,e,n(5002)],void 0===(i=function(t,e,n){"use strict";window.addEventListener("DOMContentLoaded",(function(t){console.log("DOM fully loaded and parsed");var e=document.querySelector(".js-app-contaier");(new n.Factory).init(e),"serviceWorker"in navigator&&navigator.serviceWorker.register("/distr/js/sw.js").then((function(t){return console.log("Service Worker registered!",t)})).catch((function(t){return console.error("Service Worker registration failed:",t)}))}))}.apply(e,r))||(t.exports=i)},7966:function(t,e,n){t.exports=function(){"use strict";var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)},e=function(){return(e=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function r(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||((r=r||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:n.g,o=Object.keys,a=Array.isArray;function s(t,e){return"object"!=typeof e||o(e).forEach((function(n){t[n]=e[n]})),t}"undefined"==typeof Promise||i.Promise||(i.Promise=Promise);var l=Object.getPrototypeOf,u={}.hasOwnProperty;function c(t,e){return u.call(t,e)}function h(t,e){"function"==typeof e&&(e=e(l(t))),("undefined"==typeof Reflect?o:Reflect.ownKeys)(e).forEach((function(n){f(t,n,e[n])}))}var d=Object.defineProperty;function f(t,e,n,r){d(t,e,s(n&&c(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function p(t){return{from:function(e){return t.prototype=Object.create(e.prototype),f(t.prototype,"constructor",t),{extend:h.bind(null,t.prototype)}}}}var g=Object.getOwnPropertyDescriptor,m=[].slice;function v(t,e,n){return m.call(t,e,n)}function y(t,e){return e(t)}function b(t){if(!t)throw new Error("Assertion Failed")}function x(t){i.setImmediate?setImmediate(t):setTimeout(t,0)}function w(t,e){if("string"==typeof e&&c(t,e))return t[e];if(!e)return t;if("string"!=typeof e){for(var n=[],r=0,i=e.length;r<i;++r){var o=w(t,e[r]);n.push(o)}return n}var a=e.indexOf(".");if(-1!==a){var s=t[e.substr(0,a)];return null==s?void 0:w(s,e.substr(a+1))}}function C(t,e,n){if(t&&void 0!==e&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if("string"!=typeof e&&"length"in e){b("string"!=typeof n&&"length"in n);for(var r=0,i=e.length;r<i;++r)C(t,e[r],n[r])}else{var o,s,l=e.indexOf(".");-1!==l?(o=e.substr(0,l),""===(s=e.substr(l+1))?void 0===n?a(t)&&!isNaN(parseInt(o))?t.splice(o,1):delete t[o]:t[o]=n:C(l=(l=t[o])&&c(t,o)?l:t[o]={},s,n)):void 0===n?a(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function k(t){var e,n={};for(e in t)c(t,e)&&(n[e]=t[e]);return n}var S=[].concat;function _(t){return S.apply([],t)}var D="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(_([8,16,32,64].map((function(t){return["Int","Uint","Float"].map((function(e){return e+t+"Array"}))})))).filter((function(t){return i[t]})),A=new Set(D.map((function(t){return i[t]}))),T=null;function E(t){return T=new WeakMap,t=function t(e){if(!e||"object"!=typeof e)return e;var n=T.get(e);if(n)return n;if(a(e)){n=[],T.set(e,n);for(var r=0,i=e.length;r<i;++r)n.push(t(e[r]))}else if(A.has(e.constructor))n=e;else{var o,s=l(e);for(o in n=s===Object.prototype?{}:Object.create(s),T.set(e,n),e)c(e,o)&&(n[o]=t(e[o]))}return n}(t),T=null,t}var F={}.toString;function L(t){return F.call(t).slice(8,-1)}var P="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",O="symbol"==typeof P?function(t){var e;return null!=t&&(e=t[P])&&e.apply(t)}:function(){return null};function M(t,e){return 0<=(e=t.indexOf(e))&&t.splice(e,1),0<=e}var B={};function N(t){var e,n,r,i;if(1===arguments.length){if(a(t))return t.slice();if(this===B&&"string"==typeof t)return[t];if(i=O(t)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==t)return[t];if("number"!=typeof(e=t.length))return[t];for(n=new Array(e);e--;)n[e]=t[e];return n}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var I="undefined"!=typeof Symbol?function(t){return"AsyncFunction"===t[Symbol.toStringTag]}:function(){return!1},R=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(lt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"]),j={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function z(t,e){this.name=t,this.message=e}function H(t,e){return t+". Errors: "+Object.keys(e).map((function(t){return e[t].toString()})).filter((function(t,e,n){return n.indexOf(t)===e})).join("\n")}function G(t,e,n,r){this.failures=e,this.failedKeys=r,this.successCount=n,this.message=H(t,e)}function W(t,e){this.name="BulkError",this.failures=Object.keys(e).map((function(t){return e[t]})),this.failuresByPos=e,this.message=H(t,this.failures)}p(z).from(Error).extend({toString:function(){return this.name+": "+this.message}}),p(G).from(z),p(W).from(z);var q=R.reduce((function(t,e){return t[e]=e+"Error",t}),{}),U=z,K=R.reduce((function(t,e){var n=e+"Error";function r(t,r){this.name=n,t?"string"==typeof t?(this.message="".concat(t).concat(r?"\n "+r:""),this.inner=r||null):"object"==typeof t&&(this.message="".concat(t.name," ").concat(t.message),this.inner=t):(this.message=j[e]||n,this.inner=null)}return p(r).from(U),t[e]=r,t}),{});K.Syntax=SyntaxError,K.Type=TypeError,K.Range=RangeError;var $=lt.reduce((function(t,e){return t[e+"Error"]=K[e],t}),{}),Y=R.reduce((function(t,e){return-1===["Syntax","Type","Range"].indexOf(e)&&(t[e+"Error"]=K[e]),t}),{});function V(){}function X(t){return t}function J(t,e){return null==t||t===X?e:function(n){return e(t(n))}}function Q(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function Z(t,e){return t===V?e:function(){var n=t.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Q(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Q(i,this.onerror):i),void 0!==o?o:n}}function tt(t,e){return t===V?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Q(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Q(r,this.onerror):r)}}function et(t,e){return t===V?e:function(n){var r=t.apply(this,arguments);s(n,r);var i=this.onsuccess,o=this.onerror;return this.onsuccess=null,this.onerror=null,n=e.apply(this,arguments),i&&(this.onsuccess=this.onsuccess?Q(i,this.onsuccess):i),o&&(this.onerror=this.onerror?Q(o,this.onerror):o),void 0===r?void 0===n?void 0:n:s(r,n)}}function nt(t,e){return t===V?e:function(){return!1!==e.apply(this,arguments)&&t.apply(this,arguments)}}function rt(t,e){return t===V?e:function(){var n=t.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then((function(){return e.apply(r,o)}))}return e.apply(this,arguments)}}Y.ModifyError=G,Y.DexieError=z,Y.BulkError=W;var it="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ot(t){it=t}var at={},st=100,lt=(D="undefined"==typeof Promise?[]:function(){var t=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[t,l(t),t];var e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,l(e),t]}(),D[0]),ut=(R=D[1],D=D[2],R=R&&R.then,lt&&lt.constructor),ct=!!D,ht=function(t,e){bt.push([t,e]),ft&&(queueMicrotask(Et),ft=!1)},dt=!0,ft=!0,pt=[],gt=[],mt=X,vt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:V,pgp:!1,env:{},finalize:V},yt=vt,bt=[],xt=0,wt=[];function Ct(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var e=this._PSD=yt;if("function"!=typeof t){if(t!==at)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&_t(this,this._value))}this._state=null,this._value=null,++e.ref,function t(e,n){try{n((function(n){if(null===e._state){if(n===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&Ft();n&&"function"==typeof n.then?t(e,(function(t,e){n instanceof Ct?n._then(t,e):n.then(t,e)})):(e._state=!0,e._value=n,Dt(e)),r&&Lt()}}),_t.bind(null,e))}catch(n){_t(e,n)}}(this,t)}var kt={get:function(){var t=yt,e=jt;function n(n,r){var i=this,o=!t.global&&(t!==yt||e!==jt),a=o&&!Wt(),s=new Ct((function(e,s){At(i,new St(Vt(n,t,o,a),Vt(r,t,o,a),e,s,t))}));return this._consoleTask&&(s._consoleTask=this._consoleTask),s}return n.prototype=at,n},set:function(t){f(this,"then",t&&t.prototype===at?kt:{get:function(){return t},set:kt.set})}};function St(t,e,n,r,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=r,this.psd=i}function _t(t,e){var n,r;gt.push(e),null===t._state&&(n=t._lib&&Ft(),e=mt(e),t._state=!1,t._value=e,r=t,pt.some((function(t){return t._value===r._value}))||pt.push(r),Dt(t),n&&Lt())}function Dt(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)At(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),0===xt&&(++xt,ht((function(){0==--xt&&Pt()}),[]))}function At(t,e){if(null!==t._state){var n=t._state?e.onFulfilled:e.onRejected;if(null===n)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++xt,ht(Tt,[n,t,e])}else t._listeners.push(e)}function Tt(t,e,n){try{var r,i=e._value;!e._state&&gt.length&&(gt=[]),r=it&&e._consoleTask?e._consoleTask.run((function(){return t(i)})):t(i),e._state||-1!==gt.indexOf(i)||function(t){for(var e=pt.length;e;)if(pt[--e]._value===t._value)return pt.splice(e,1)}(e),n.resolve(r)}catch(t){n.reject(t)}finally{0==--xt&&Pt(),--n.psd.ref||n.psd.finalize()}}function Et(){Yt(vt,(function(){Ft()&&Lt()}))}function Ft(){var t=dt;return ft=dt=!1,t}function Lt(){var t,e,n;do{for(;0<bt.length;)for(t=bt,bt=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}}while(0<bt.length);ft=dt=!0}function Pt(){var t=pt;pt=[],t.forEach((function(t){t._PSD.onunhandled.call(null,t._value,t)}));for(var e=wt.slice(0),n=e.length;n;)e[--n]()}function Ot(t){return new Ct(at,!1,t)}function Mt(t,e){var n=yt;return function(){var r=Ft(),i=yt;try{return Kt(n,!0),t.apply(this,arguments)}catch(r){e&&e(r)}finally{Kt(i,!1),r&&Lt()}}}h(Ct.prototype,{then:kt,_then:function(t,e){At(this,new St(null,null,t,e,yt))},catch:function(t){if(1===arguments.length)return this.then(null,t);var e=t,n=arguments[1];return"function"==typeof e?this.then(null,(function(t){return(t instanceof e?n:Ot)(t)})):this.then(null,(function(t){return(t&&t.name===e?n:Ot)(t)}))},finally:function(t){return this.then((function(e){return Ct.resolve(t()).then((function(){return e}))}),(function(e){return Ct.resolve(t()).then((function(){return Ot(e)}))}))},timeout:function(t,e){var n=this;return t<1/0?new Ct((function(r,i){var o=setTimeout((function(){return i(new K.Timeout(e))}),t);n.then(r,i).finally(clearTimeout.bind(null,o))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&f(Ct.prototype,Symbol.toStringTag,"Dexie.Promise"),vt.env=$t(),h(Ct,{all:function(){var t=N.apply(null,arguments).map(qt);return new Ct((function(e,n){0===t.length&&e([]);var r=t.length;t.forEach((function(i,o){return Ct.resolve(i).then((function(n){t[o]=n,--r||e(t)}),n)}))}))},resolve:function(t){return t instanceof Ct?t:t&&"function"==typeof t.then?new Ct((function(e,n){t.then(e,n)})):new Ct(at,!0,t)},reject:Ot,race:function(){var t=N.apply(null,arguments).map(qt);return new Ct((function(e,n){t.map((function(t){return Ct.resolve(t).then(e,n)}))}))},PSD:{get:function(){return yt},set:function(t){return yt=t}},totalEchoes:{get:function(){return jt}},newPSD:Ht,usePSD:Yt,scheduler:{get:function(){return ht},set:function(t){ht=t}},rejectionMapper:{get:function(){return mt},set:function(t){mt=t}},follow:function(t,e){return new Ct((function(n,r){return Ht((function(e,n){var r=yt;r.unhandleds=[],r.onunhandled=n,r.finalize=Q((function(){var t,r=this;t=function(){0===r.unhandleds.length?e():n(r.unhandleds[0])},wt.push((function e(){t(),wt.splice(wt.indexOf(e),1)})),++xt,ht((function(){0==--xt&&Pt()}),[])}),r.finalize),t()}),e,n,r)}))}}),ut&&(ut.allSettled&&f(Ct,"allSettled",(function(){var t=N.apply(null,arguments).map(qt);return new Ct((function(e){0===t.length&&e([]);var n=t.length,r=new Array(n);t.forEach((function(t,i){return Ct.resolve(t).then((function(t){return r[i]={status:"fulfilled",value:t}}),(function(t){return r[i]={status:"rejected",reason:t}})).then((function(){return--n||e(r)}))}))}))})),ut.any&&"undefined"!=typeof AggregateError&&f(Ct,"any",(function(){var t=N.apply(null,arguments).map(qt);return new Ct((function(e,n){0===t.length&&n(new AggregateError([]));var r=t.length,i=new Array(r);t.forEach((function(t,o){return Ct.resolve(t).then((function(t){return e(t)}),(function(t){i[o]=t,--r||n(new AggregateError(i))}))}))}))})),ut.withResolvers&&(Ct.withResolvers=ut.withResolvers));var Bt={awaits:0,echoes:0,id:0},Nt=0,It=[],Rt=0,jt=0,zt=0;function Ht(t,e,n,r){var i=yt,o=Object.create(i);return o.parent=i,o.ref=0,o.global=!1,o.id=++zt,vt.env,o.env=ct?{Promise:Ct,PromiseProp:{value:Ct,configurable:!0,writable:!0},all:Ct.all,race:Ct.race,allSettled:Ct.allSettled,any:Ct.any,resolve:Ct.resolve,reject:Ct.reject}:{},e&&s(o,e),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()},r=Yt(o,t,n,r),0===o.ref&&o.finalize(),r}function Gt(){return Bt.id||(Bt.id=++Nt),++Bt.awaits,Bt.echoes+=st,Bt.id}function Wt(){return!!Bt.awaits&&(0==--Bt.awaits&&(Bt.id=0),Bt.echoes=Bt.awaits*st,!0)}function qt(t){return Bt.echoes&&t&&t.constructor===ut?(Gt(),t.then((function(t){return Wt(),t}),(function(t){return Wt(),Jt(t)}))):t}function Ut(){var t=It[It.length-1];It.pop(),Kt(t,!1)}function Kt(t,e){var n,r=yt;(e?!Bt.echoes||Rt++&&t===yt:!Rt||--Rt&&t===yt)||queueMicrotask(e?function(t){++jt,Bt.echoes&&0!=--Bt.echoes||(Bt.echoes=Bt.awaits=Bt.id=0),It.push(yt),Kt(t,!0)}.bind(null,t):Ut),t!==yt&&(yt=t,r===vt&&(vt.env=$t()),ct&&(n=vt.env.Promise,e=t.env,(r.global||t.global)&&(Object.defineProperty(i,"Promise",e.PromiseProp),n.all=e.all,n.race=e.race,n.resolve=e.resolve,n.reject=e.reject,e.allSettled&&(n.allSettled=e.allSettled),e.any&&(n.any=e.any))))}function $t(){var t=i.Promise;return ct?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(i,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject}:{}}function Yt(t,e,n,r,i){var o=yt;try{return Kt(t,!0),e(n,r,i)}finally{Kt(o,!1)}}function Vt(t,e,n,r){return"function"!=typeof t?t:function(){var i=yt;n&&Gt(),Kt(e,!0);try{return t.apply(this,arguments)}finally{Kt(i,!1),r&&queueMicrotask(Wt)}}}function Xt(t){Promise===ut&&0===Bt.echoes?0===Rt?t():enqueueNativeMicroTask(t):setTimeout(t,0)}-1===(""+R).indexOf("[native code]")&&(Gt=Wt=V);var Jt=Ct.reject,Qt=String.fromCharCode(65535),Zt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",te="String expected.",ee=[],ne="__dbnames",re="readonly",ie="readwrite";function oe(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var ae={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function se(t){return"string"!=typeof t||/\./.test(t)?function(t){return t}:function(e){return void 0===e[t]&&t in e&&delete(e=E(e))[t],e}}function le(){throw K.Type()}function ue(t,e){try{var n=ce(t),r=ce(e);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e<t?1:t<e?-1:0;case"binary":return function(t,e){for(var n=t.length,r=e.length,i=n<r?n:r,o=0;o<i;++o)if(t[o]!==e[o])return t[o]<e[o]?-1:1;return n===r?0:n<r?-1:1}(he(t),he(e));case"Array":return function(t,e){for(var n=t.length,r=e.length,i=n<r?n:r,o=0;o<i;++o){var a=ue(t[o],e[o]);if(0!==a)return a}return n===r?0:n<r?-1:1}(t,e)}}catch(t){}return NaN}function ce(t){var e=typeof t;return"object"!=e?e:ArrayBuffer.isView(t)||"ArrayBuffer"===(t=L(t))?"binary":t}function he(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var de=(fe.prototype._trans=function(t,e,n){var r=this._tx||yt.trans,i=this.name,o=it&&"undefined"!=typeof console&&console.createTask&&console.createTask("Dexie: ".concat("readonly"===t?"read":"write"," ").concat(this.name));function a(t,n,r){if(!r.schema[i])throw new K.NotFound("Table "+i+" not part of transaction");return e(r.idbtrans,r)}var s=Ft();try{var l=r&&r.db._novip===this.db._novip?r===yt.trans?r._promise(t,a,n):Ht((function(){return r._promise(t,a,n)}),{trans:r,transless:yt.transless||yt}):function t(e,n,r,i){if(e.idbdb&&(e._state.openComplete||yt.letThrough||e._vip)){var o=e._createTransaction(n,r,e._dbSchema);try{o.create(),e._state.PR1398_maxLoop=3}catch(o){return o.name===q.InvalidState&&e.isOpen()&&0<--e._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then((function(){return t(e,n,r,i)}))):Jt(o)}return o._promise(n,(function(t,e){return Ht((function(){return yt.trans=o,i(t,e,o)}))})).then((function(t){if("readwrite"===n)try{o.idbtrans.commit()}catch(t){}return"readonly"===n?t:o._completion.then((function(){return t}))}))}if(e._state.openComplete)return Jt(new K.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return Jt(new K.DatabaseClosed);e.open().catch(V)}return e._state.dbReadyPromise.then((function(){return t(e,n,r,i)}))}(this.db,t,[this.name],a);return o&&(l._consoleTask=o,l=l.catch((function(t){return console.trace(t),Jt(t)}))),l}finally{s&&Lt()}},fe.prototype.get=function(t,e){var n=this;return t&&t.constructor===Object?this.where(t).first(e):null==t?Jt(new K.Type("Invalid argument to Table.get()")):this._trans("readonly",(function(e){return n.core.get({trans:e,key:t}).then((function(t){return n.hook.reading.fire(t)}))})).then(e)},fe.prototype.where=function(t){if("string"==typeof t)return new this.db.WhereClause(this,t);if(a(t))return new this.db.WhereClause(this,"[".concat(t.join("+"),"]"));var e=o(t);if(1===e.length)return this.where(e[0]).equals(t[e[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter((function(t){if(t.compound&&e.every((function(e){return 0<=t.keyPath.indexOf(e)}))){for(var n=0;n<e.length;++n)if(-1===e.indexOf(t.keyPath[n]))return!1;return!0}return!1})).sort((function(t,e){return t.keyPath.length-e.keyPath.length}))[0];if(n&&this.db._maxKey!==Qt){var r=n.keyPath.slice(0,e.length);return this.where(r).equals(r.map((function(e){return t[e]})))}!n&&it&&console.warn("The query ".concat(JSON.stringify(t)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(e.join("+"),"]"));var i=this.schema.idxByName;function s(t,e){return 0===ue(t,e)}var l=e.reduce((function(e,n){var r=e[0],o=e[1],l=(e=i[n],t[n]);return[r||e,r||!e?oe(o,e&&e.multi?function(t){return t=w(t,n),a(t)&&t.some((function(t){return s(l,t)}))}:function(t){return s(l,w(t,n))}):o]}),[null,null]);return r=l[0],l=l[1],r?this.where(r.name).equals(t[r.keyPath]).filter(l):n?this.filter(l):this.where(e).equals("")},fe.prototype.filter=function(t){return this.toCollection().and(t)},fe.prototype.count=function(t){return this.toCollection().count(t)},fe.prototype.offset=function(t){return this.toCollection().offset(t)},fe.prototype.limit=function(t){return this.toCollection().limit(t)},fe.prototype.each=function(t){return this.toCollection().each(t)},fe.prototype.toArray=function(t){return this.toCollection().toArray(t)},fe.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},fe.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,a(t)?"[".concat(t.join("+"),"]"):t))},fe.prototype.reverse=function(){return this.toCollection().reverse()},fe.prototype.mapToClass=function(e){var n,r=this.db,i=this.name;function o(){return null!==n&&n.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof le&&(function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(o,n=e),Object.defineProperty(o.prototype,"db",{get:function(){return r},enumerable:!1,configurable:!0}),o.prototype.table=function(){return i},e=o);for(var a=new Set,s=e.prototype;s;s=l(s))Object.getOwnPropertyNames(s).forEach((function(t){return a.add(t)}));function u(t){if(!t)return t;var n,r=Object.create(e.prototype);for(n in t)if(!a.has(n))try{r[n]=t[n]}catch(t){}return r}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=u,this.hook("reading",u),e},fe.prototype.defineClass=function(){return this.mapToClass((function(t){s(this,t)}))},fe.prototype.add=function(t,e){var n=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,a=t;return o&&i&&(a=se(o)(t)),this._trans("readwrite",(function(t){return n.core.mutate({trans:t,type:"add",keys:null!=e?[e]:null,values:[a]})})).then((function(t){return t.numFailures?Ct.reject(t.failures[0]):t.lastResult})).then((function(e){if(o)try{C(t,o,e)}catch(e){}return e}))},fe.prototype.update=function(t,e){return"object"!=typeof t||a(t)?this.where(":id").equals(t).modify(e):void 0===(t=w(t,this.schema.primKey.keyPath))?Jt(new K.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(t).modify(e)},fe.prototype.put=function(t,e){var n=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,a=t;return o&&i&&(a=se(o)(t)),this._trans("readwrite",(function(t){return n.core.mutate({trans:t,type:"put",values:[a],keys:null!=e?[e]:null})})).then((function(t){return t.numFailures?Ct.reject(t.failures[0]):t.lastResult})).then((function(e){if(o)try{C(t,o,e)}catch(e){}return e}))},fe.prototype.delete=function(t){var e=this;return this._trans("readwrite",(function(n){return e.core.mutate({trans:n,type:"delete",keys:[t]})})).then((function(t){return t.numFailures?Ct.reject(t.failures[0]):void 0}))},fe.prototype.clear=function(){var t=this;return this._trans("readwrite",(function(e){return t.core.mutate({trans:e,type:"deleteRange",range:ae})})).then((function(t){return t.numFailures?Ct.reject(t.failures[0]):void 0}))},fe.prototype.bulkGet=function(t){var e=this;return this._trans("readonly",(function(n){return e.core.getMany({keys:t,trans:n}).then((function(t){return t.map((function(t){return e.hook.reading.fire(t)}))}))}))},fe.prototype.bulkAdd=function(t,e,n){var r=this,i=Array.isArray(e)?e:void 0,o=(n=n||(i?void 0:e))?n.allKeys:void 0;return this._trans("readwrite",(function(e){var n=(s=r.schema.primKey).auto;if((s=s.keyPath)&&i)throw new K.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new K.InvalidArgument("Arguments objects and keys must have the same length");var a=t.length,s=s&&n?t.map(se(s)):t;return r.core.mutate({trans:e,type:"add",keys:i,values:s,wantResults:o}).then((function(t){var e=t.numFailures,n=t.results,i=t.lastResult;if(t=t.failures,0===e)return o?n:i;throw new W("".concat(r.name,".bulkAdd(): ").concat(e," of ").concat(a," operations failed"),t)}))}))},fe.prototype.bulkPut=function(t,e,n){var r=this,i=Array.isArray(e)?e:void 0,o=(n=n||(i?void 0:e))?n.allKeys:void 0;return this._trans("readwrite",(function(e){var n=(s=r.schema.primKey).auto;if((s=s.keyPath)&&i)throw new K.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new K.InvalidArgument("Arguments objects and keys must have the same length");var a=t.length,s=s&&n?t.map(se(s)):t;return r.core.mutate({trans:e,type:"put",keys:i,values:s,wantResults:o}).then((function(t){var e=t.numFailures,n=t.results,i=t.lastResult;if(t=t.failures,0===e)return o?n:i;throw new W("".concat(r.name,".bulkPut(): ").concat(e," of ").concat(a," operations failed"),t)}))}))},fe.prototype.bulkUpdate=function(t){var e=this,n=this.core,r=t.map((function(t){return t.key})),i=t.map((function(t){return t.changes})),o=[];return this._trans("readwrite",(function(a){return n.getMany({trans:a,keys:r,cache:"clone"}).then((function(s){var l=[],u=[];t.forEach((function(t,n){var r=t.key,i=t.changes,a=s[n];if(a){for(var c=0,h=Object.keys(i);c<h.length;c++){var d=h[c],f=i[d];if(d===e.schema.primKey.keyPath){if(0!==ue(f,r))throw new K.Constraint("Cannot update primary key in bulkUpdate()")}else C(a,d,f)}o.push(n),l.push(r),u.push(a)}}));var c=l.length;return n.mutate({trans:a,type:"put",keys:l,values:u,updates:{keys:r,changeSpecs:i}}).then((function(t){var n=t.numFailures,r=t.failures;if(0===n)return c;for(var i=0,a=Object.keys(r);i<a.length;i++){var s,l=a[i],u=o[Number(l)];null!=u&&(s=r[l],delete r[l],r[u]=s)}throw new W("".concat(e.name,".bulkUpdate(): ").concat(n," of ").concat(c," operations failed"),r)}))}))}))},fe.prototype.bulkDelete=function(t){var e=this,n=t.length;return this._trans("readwrite",(function(n){return e.core.mutate({trans:n,type:"delete",keys:t})})).then((function(t){var r=t.numFailures,i=t.lastResult;if(t=t.failures,0===r)return i;throw new W("".concat(e.name,".bulkDelete(): ").concat(r," of ").concat(n," operations failed"),t)}))},fe);function fe(){}function pe(t){function e(e,r){if(r){for(var i=arguments.length,o=new Array(i-1);--i;)o[i-1]=arguments[i];return n[e].subscribe.apply(null,o),t}if("string"==typeof e)return n[e]}var n={};e.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return e;function s(t,r,i){if("object"!=typeof t){var l;r=r||nt;var u={subscribers:[],fire:i=i||V,subscribe:function(t){-1===u.subscribers.indexOf(t)&&(u.subscribers.push(t),u.fire=r(u.fire,t))},unsubscribe:function(t){u.subscribers=u.subscribers.filter((function(e){return e!==t})),u.fire=u.subscribers.reduce(r,i)}};return n[t]=e[t]=u}o(l=t).forEach((function(t){var e=l[t];if(a(e))s(t,l[t][0],l[t][1]);else{if("asap"!==e)throw new K.InvalidArgument("Invalid event config");var n=s(t,X,(function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];n.subscribers.forEach((function(t){x((function(){t.apply(null,e)}))}))}))}}))}}function ge(t,e){return p(e).from({prototype:t}),e}function me(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function ve(t,e){t.filter=oe(t.filter,e)}function ye(t,e,n){var r=t.replayFilter;t.replayFilter=r?function(){return oe(r(),e())}:e,t.justLimit=n&&!r}function be(t,e){if(t.isPrimKey)return e.primaryKey;var n=e.getIndexByKeyPath(t.index);if(!n)throw new K.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function xe(t,e,n){var r=be(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:"prev"===t.dir,unique:!!t.unique,query:{index:r,range:t.range}})}function we(t,e,n,r){var i=t.replayFilter?oe(t.filter,t.replayFilter()):t.filter;if(t.or){var o={},a=function(t,n,r){var a,s;i&&!i(n,r,(function(t){return n.stop(t)}),(function(t){return n.fail(t)}))||("[object ArrayBuffer]"==(s=""+(a=n.primaryKey))&&(s=""+new Uint8Array(a)),c(o,s)||(o[s]=!0,e(t,n,r)))};return Promise.all([t.or._iterate(a,n),Ce(xe(t,r,n),t.algorithm,a,!t.keysOnly&&t.valueMapper)])}return Ce(xe(t,r,n),oe(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function Ce(t,e,n,r){var i=Mt(r?function(t,e,i){return n(r(t),e,i)}:n);return t.then((function(t){if(t)return t.start((function(){var n=function(){return t.continue()};e&&!e(t,(function(t){return n=t}),(function(e){t.stop(e),n=V}),(function(e){t.fail(e),n=V}))||i(t.value,t,(function(t){return n=t})),n()}))}))}var ke=(Se.prototype.execute=function(t){var e=this["@@propmod"];if(void 0!==e.add){var n=e.add;if(a(n))return r(r([],a(t)?t:[],!0),n,!0).sort();if("number"==typeof n)return(Number(t)||0)+n;if("bigint"==typeof n)try{return BigInt(t)+n}catch(t){return BigInt(0)+n}throw new TypeError("Invalid term ".concat(n))}if(void 0!==e.remove){var i=e.remove;if(a(i))return a(t)?t.filter((function(t){return!i.includes(t)})).sort():[];if("number"==typeof i)return Number(t)-i;if("bigint"==typeof i)try{return BigInt(t)-i}catch(t){return BigInt(0)-i}throw new TypeError("Invalid subtrahend ".concat(i))}return(n=null===(n=e.replacePrefix)||void 0===n?void 0:n[0])&&"string"==typeof t&&t.startsWith(n)?e.replacePrefix[1]+t.substring(n.length):t},Se);function Se(t){this["@@propmod"]=t}var _e=(De.prototype._read=function(t,e){var n=this._ctx;return n.error?n.table._trans(null,Jt.bind(null,n.error)):n.table._trans("readonly",t).then(e)},De.prototype._write=function(t){var e=this._ctx;return e.error?e.table._trans(null,Jt.bind(null,e.error)):e.table._trans("readwrite",t,"locked")},De.prototype._addAlgorithm=function(t){var e=this._ctx;e.algorithm=oe(e.algorithm,t)},De.prototype._iterate=function(t,e){return we(this._ctx,t,e,this._ctx.table.core)},De.prototype.clone=function(t){var e=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return t&&s(n,t),e._ctx=n,e},De.prototype.raw=function(){return this._ctx.valueMapper=null,this},De.prototype.each=function(t){var e=this._ctx;return this._read((function(n){return we(e,t,n,e.table.core)}))},De.prototype.count=function(t){var e=this;return this._read((function(t){var n=e._ctx,r=n.table.core;if(me(n,!0))return r.count({trans:t,query:{index:be(n,r.schema),range:n.range}}).then((function(t){return Math.min(t,n.limit)}));var i=0;return we(n,(function(){return++i,!1}),t,r).then((function(){return i}))})).then(t)},De.prototype.sortBy=function(t,e){var n=t.split(".").reverse(),r=n[0],i=n.length-1;function o(t,e){return e?o(t[n[e]],e-1):t[r]}var a="next"===this._ctx.dir?1:-1;function s(t,e){return ue(o(t,i),o(e,i))*a}return this.toArray((function(t){return t.sort(s)})).then(e)},De.prototype.toArray=function(t){var e=this;return this._read((function(t){var n=e._ctx;if("next"===n.dir&&me(n,!0)&&0<n.limit){var r=n.valueMapper,i=be(n,n.table.core.schema);return n.table.core.query({trans:t,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then((function(t){return t=t.result,r?t.map(r):t}))}var o=[];return we(n,(function(t){return o.push(t)}),t,n.table.core).then((function(){return o}))}),t)},De.prototype.offset=function(t){var e=this._ctx;return t<=0||(e.offset+=t,me(e)?ye(e,(function(){var e=t;return function(t,n){return 0===e||(1===e?--e:n((function(){t.advance(e),e=0})),!1)}})):ye(e,(function(){var e=t;return function(){return--e<0}}))),this},De.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),ye(this._ctx,(function(){var e=t;return function(t,n,r){return--e<=0&&n(r),0<=e}}),!0),this},De.prototype.until=function(t,e){return ve(this._ctx,(function(n,r,i){return!t(n.value)||(r(i),e)})),this},De.prototype.first=function(t){return this.limit(1).toArray((function(t){return t[0]})).then(t)},De.prototype.last=function(t){return this.reverse().first(t)},De.prototype.filter=function(t){var e;return ve(this._ctx,(function(e){return t(e.value)})),(e=this._ctx).isMatch=oe(e.isMatch,t),this},De.prototype.and=function(t){return this.filter(t)},De.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},De.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},De.prototype.desc=function(){return this.reverse()},De.prototype.eachKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each((function(e,n){t(n.key,n)}))},De.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},De.prototype.eachPrimaryKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each((function(e,n){t(n.primaryKey,n)}))},De.prototype.keys=function(t){var e=this._ctx;e.keysOnly=!e.isMatch;var n=[];return this.each((function(t,e){n.push(e.key)})).then((function(){return n})).then(t)},De.prototype.primaryKeys=function(t){var e=this._ctx;if("next"===e.dir&&me(e,!0)&&0<e.limit)return this._read((function(t){var n=be(e,e.table.core.schema);return e.table.core.query({trans:t,values:!1,limit:e.limit,query:{index:n,range:e.range}})})).then((function(t){return t.result})).then(t);e.keysOnly=!e.isMatch;var n=[];return this.each((function(t,e){n.push(e.primaryKey)})).then((function(){return n})).then(t)},De.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},De.prototype.firstKey=function(t){return this.limit(1).keys((function(t){return t[0]})).then(t)},De.prototype.lastKey=function(t){return this.reverse().firstKey(t)},De.prototype.distinct=function(){var t;if(!(t=(t=this._ctx).index&&t.table.schema.idxByName[t.index])||!t.multi)return this;var e={};return ve(this._ctx,(function(t){var n=t.primaryKey.toString();return t=c(e,n),e[n]=!0,!t})),this},De.prototype.modify=function(t){var e=this,n=this._ctx;return this._write((function(r){var i,a,s;s="function"==typeof t?t:(i=o(t),a=i.length,function(e){for(var n=!1,r=0;r<a;++r){var o=i[r],s=t[o],l=w(e,o);s instanceof ke?(C(e,o,s.execute(l)),n=!0):l!==s&&(C(e,o,s),n=!0)}return n});var l,u=n.table.core,c=(l=u.schema.primaryKey).outbound,h=l.extractKey,d=200;function f(t,e){var n=e.failures;e=e.numFailures,g+=t-e;for(var r=0,i=o(n);r<i.length;r++){var a=i[r];p.push(n[a])}}(l=e.db._options.modifyChunkSize)&&(d="object"==typeof l?l[u.name]||l["*"]||200:l);var p=[],g=0,m=[];return e.clone().primaryKeys().then((function(e){function i(n){var a=Math.min(d,e.length-n);return u.getMany({trans:r,keys:e.slice(n,n+a),cache:"immutable"}).then((function(l){for(var p=[],g=[],m=c?[]:null,v=[],y=0;y<a;++y){var b=l[y],x={value:E(b),primKey:e[n+y]};!1!==s.call(x,x.value,x)&&(null==x.value?v.push(e[n+y]):c||0===ue(h(b),h(x.value))?(g.push(x.value),c&&m.push(e[n+y])):(v.push(e[n+y]),p.push(x.value)))}return Promise.resolve(0<p.length&&u.mutate({trans:r,type:"add",values:p}).then((function(t){for(var e in t.failures)v.splice(parseInt(e),1);f(p.length,t)}))).then((function(){return(0<g.length||o&&"object"==typeof t)&&u.mutate({trans:r,type:"put",keys:m,values:g,criteria:o,changeSpec:"function"!=typeof t&&t,isAdditionalChunk:0<n}).then((function(t){return f(g.length,t)}))})).then((function(){return(0<v.length||o&&t===Ae)&&u.mutate({trans:r,type:"delete",keys:v,criteria:o,isAdditionalChunk:0<n}).then((function(t){return f(v.length,t)}))})).then((function(){return e.length>n+a&&i(n+d)}))}))}var o=me(n)&&n.limit===1/0&&("function"!=typeof t||t===Ae)&&{index:n.index,range:n.range};return i(0).then((function(){if(0<p.length)throw new G("Error modifying one or more objects",p,g,m);return e.length}))}))}))},De.prototype.delete=function(){var t=this._ctx,e=t.range;return me(t)&&(t.isPrimKey||3===e.type)?this._write((function(n){var r=t.table.core.schema.primaryKey,i=e;return t.table.core.count({trans:n,query:{index:r,range:i}}).then((function(e){return t.table.core.mutate({trans:n,type:"deleteRange",range:i}).then((function(t){var n=t.failures;if(t.lastResult,t.results,t=t.numFailures)throw new G("Could not delete some values",Object.keys(n).map((function(t){return n[t]})),e-t);return e-t}))}))})):this.modify(Ae)},De);function De(){}var Ae=function(t,e){return e.value=null};function Te(t,e){return t<e?-1:t===e?0:1}function Ee(t,e){return e<t?-1:t===e?0:1}function Fe(t,e,n){return(t=t instanceof Be?new t.Collection(t):t)._ctx.error=new(n||TypeError)(e),t}function Le(t){return new t.Collection(t,(function(){return Me("")})).limit(0)}function Pe(t,e,n,r){var i,o,a,s,l,u,c,h=n.length;if(!n.every((function(t){return"string"==typeof t})))return Fe(t,te);function d(t){i="next"===t?function(t){return t.toUpperCase()}:function(t){return t.toLowerCase()},o="next"===t?function(t){return t.toLowerCase()}:function(t){return t.toUpperCase()},a="next"===t?Te:Ee;var e=n.map((function(t){return{lower:o(t),upper:i(t)}})).sort((function(t,e){return a(t.lower,e.lower)}));s=e.map((function(t){return t.upper})),l=e.map((function(t){return t.lower})),c="next"===(u=t)?"":r}d("next"),(t=new t.Collection(t,(function(){return Oe(s[0],l[h-1]+r)})))._ondirectionchange=function(t){d(t)};var f=0;return t._addAlgorithm((function(t,n,r){var i=t.key;if("string"!=typeof i)return!1;var d=o(i);if(e(d,l,f))return!0;for(var p=null,g=f;g<h;++g){var m=function(t,e,n,r,i,o){for(var a=Math.min(t.length,r.length),s=-1,l=0;l<a;++l){var u=e[l];if(u!==r[l])return i(t[l],n[l])<0?t.substr(0,l)+n[l]+n.substr(l+1):i(t[l],r[l])<0?t.substr(0,l)+r[l]+n.substr(l+1):0<=s?t.substr(0,s)+e[s]+n.substr(s+1):null;i(t[l],u)<0&&(s=l)}return a<r.length&&"next"===o?t+n.substr(t.length):a<t.length&&"prev"===o?t.substr(0,n.length):s<0?null:t.substr(0,s)+r[s]+n.substr(s+1)}(i,d,s[g],l[g],a,u);null===m&&null===p?f=g+1:(null===p||0<a(p,m))&&(p=m)}return n(null!==p?function(){t.continue(p+c)}:r),!1})),t}function Oe(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function Me(t){return{type:1,lower:t,upper:t}}var Be=(Object.defineProperty(Ne.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Ne.prototype.between=function(t,e,n,r){n=!1!==n,r=!0===r;try{return 0<this._cmp(t,e)||0===this._cmp(t,e)&&(n||r)&&(!n||!r)?Le(this):new this.Collection(this,(function(){return Oe(t,e,!n,!r)}))}catch(t){return Fe(this,Zt)}},Ne.prototype.equals=function(t){return null==t?Fe(this,Zt):new this.Collection(this,(function(){return Me(t)}))},Ne.prototype.above=function(t){return null==t?Fe(this,Zt):new this.Collection(this,(function(){return Oe(t,void 0,!0)}))},Ne.prototype.aboveOrEqual=function(t){return null==t?Fe(this,Zt):new this.Collection(this,(function(){return Oe(t,void 0,!1)}))},Ne.prototype.below=function(t){return null==t?Fe(this,Zt):new this.Collection(this,(function(){return Oe(void 0,t,!1,!0)}))},Ne.prototype.belowOrEqual=function(t){return null==t?Fe(this,Zt):new this.Collection(this,(function(){return Oe(void 0,t)}))},Ne.prototype.startsWith=function(t){return"string"!=typeof t?Fe(this,te):this.between(t,t+Qt,!0,!0)},Ne.prototype.startsWithIgnoreCase=function(t){return""===t?this.startsWith(t):Pe(this,(function(t,e){return 0===t.indexOf(e[0])}),[t],Qt)},Ne.prototype.equalsIgnoreCase=function(t){return Pe(this,(function(t,e){return t===e[0]}),[t],"")},Ne.prototype.anyOfIgnoreCase=function(){var t=N.apply(B,arguments);return 0===t.length?Le(this):Pe(this,(function(t,e){return-1!==e.indexOf(t)}),t,"")},Ne.prototype.startsWithAnyOfIgnoreCase=function(){var t=N.apply(B,arguments);return 0===t.length?Le(this):Pe(this,(function(t,e){return e.some((function(e){return 0===t.indexOf(e)}))}),t,Qt)},Ne.prototype.anyOf=function(){var t=this,e=N.apply(B,arguments),n=this._cmp;try{e.sort(n)}catch(r){return Fe(this,Zt)}if(0===e.length)return Le(this);var r=new this.Collection(this,(function(){return Oe(e[0],e[e.length-1])}));r._ondirectionchange=function(r){n="next"===r?t._ascending:t._descending,e.sort(n)};var i=0;return r._addAlgorithm((function(t,r,o){for(var a=t.key;0<n(a,e[i]);)if(++i===e.length)return r(o),!1;return 0===n(a,e[i])||(r((function(){t.continue(e[i])})),!1)})),r},Ne.prototype.notEqual=function(t){return this.inAnyRange([[-1/0,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Ne.prototype.noneOf=function(){var t=N.apply(B,arguments);if(0===t.length)return new this.Collection(this);try{t.sort(this._ascending)}catch(t){return Fe(this,Zt)}var e=t.reduce((function(t,e){return t?t.concat([[t[t.length-1][1],e]]):[[-1/0,e]]}),null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})},Ne.prototype.inAnyRange=function(t,e){var n=this,r=this._cmp,i=this._ascending,o=this._descending,a=this._min,s=this._max;if(0===t.length)return Le(this);if(!t.every((function(t){return void 0!==t[0]&&void 0!==t[1]&&i(t[0],t[1])<=0})))return Fe(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",K.InvalidArgument);var l,u=!e||!1!==e.includeLowers,c=e&&!0===e.includeUppers,h=i;function d(t,e){return h(t[0],e[0])}try{(l=t.reduce((function(t,e){for(var n=0,i=t.length;n<i;++n){var o=t[n];if(r(e[0],o[1])<0&&0<r(e[1],o[0])){o[0]=a(o[0],e[0]),o[1]=s(o[1],e[1]);break}}return n===i&&t.push(e),t}),[])).sort(d)}catch(t){return Fe(this,Zt)}var f=0,p=c?function(t){return 0<i(t,l[f][1])}:function(t){return 0<=i(t,l[f][1])},g=u?function(t){return 0<o(t,l[f][0])}:function(t){return 0<=o(t,l[f][0])},m=p;return(t=new this.Collection(this,(function(){return Oe(l[0][0],l[l.length-1][1],!u,!c)})))._ondirectionchange=function(t){h="next"===t?(m=p,i):(m=g,o),l.sort(d)},t._addAlgorithm((function(t,e,r){for(var o,a=t.key;m(a);)if(++f===l.length)return e(r),!1;return!p(o=a)&&!g(o)||(0===n._cmp(a,l[f][1])||0===n._cmp(a,l[f][0])||e((function(){h===i?t.continue(l[f][0]):t.continue(l[f][1])})),!1)})),t},Ne.prototype.startsWithAnyOf=function(){var t=N.apply(B,arguments);return t.every((function(t){return"string"==typeof t}))?0===t.length?Le(this):this.inAnyRange(t.map((function(t){return[t,t+Qt]}))):Fe(this,"startsWithAnyOf() only works with strings")},Ne);function Ne(){}function Ie(t){return Mt((function(e){return Re(e),t(e.target.error),!1}))}function Re(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var je="storagemutated",ze="x-storagemutated-1",He=pe(null,je),Ge=(We.prototype._lock=function(){return b(!yt.global),++this._reculock,1!==this._reculock||yt.global||(yt.lockOwnerFor=this),this},We.prototype._unlock=function(){if(b(!yt.global),0==--this._reculock)for(yt.global||(yt.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var t=this._blockedFuncs.shift();try{Yt(t[1],t[0])}catch(t){}}return this},We.prototype._locked=function(){return this._reculock&&yt.lockOwnerFor!==this},We.prototype.create=function(t){var e=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(b(!this.idbtrans),!t&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new K.DatabaseClosed(r);case"MissingAPIError":throw new K.MissingAPI(r.message,r);default:throw new K.OpenFailed(r)}if(!this.active)throw new K.TransactionInactive;return b(null===this._completion._state),(t=this.idbtrans=t||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Mt((function(n){Re(n),e._reject(t.error)})),t.onabort=Mt((function(n){Re(n),e.active&&e._reject(new K.Abort(t.error)),e.active=!1,e.on("abort").fire(n)})),t.oncomplete=Mt((function(){e.active=!1,e._resolve(),"mutatedParts"in t&&He.storagemutated.fire(t.mutatedParts)})),this},We.prototype._promise=function(t,e,n){var r=this;if("readwrite"===t&&"readwrite"!==this.mode)return Jt(new K.ReadOnly("Transaction is readonly"));if(!this.active)return Jt(new K.TransactionInactive);if(this._locked())return new Ct((function(i,o){r._blockedFuncs.push([function(){r._promise(t,e,n).then(i,o)},yt])}));if(n)return Ht((function(){var t=new Ct((function(t,n){r._lock();var i=e(t,n,r);i&&i.then&&i.then(t,n)}));return t.finally((function(){return r._unlock()})),t._lib=!0,t}));var i=new Ct((function(t,n){var i=e(t,n,r);i&&i.then&&i.then(t,n)}));return i._lib=!0,i},We.prototype._root=function(){return this.parent?this.parent._root():this},We.prototype.waitFor=function(t){var e,n=this._root(),r=Ct.resolve(t);n._waitingFor?n._waitingFor=n._waitingFor.then((function(){return r})):(n._waitingFor=r,n._waitingQueue=[],e=n.idbtrans.objectStore(n.storeNames[0]),function t(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(e.get(-1/0).onsuccess=t)}());var i=n._waitingFor;return new Ct((function(t,e){r.then((function(e){return n._waitingQueue.push(Mt(t.bind(null,e)))}),(function(t){return n._waitingQueue.push(Mt(e.bind(null,t)))})).finally((function(){n._waitingFor===i&&(n._waitingFor=null)}))}))},We.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new K.Abort))},We.prototype.table=function(t){var e=this._memoizedTables||(this._memoizedTables={});if(c(e,t))return e[t];var n=this.schema[t];if(!n)throw new K.NotFound("Table "+t+" not part of transaction");return(n=new this.db.Table(t,n,this)).core=this.db.core.table(t),e[t]=n},We);function We(){}function qe(t,e,n,r,i,o,a){return{name:t,keyPath:e,unique:n,multi:r,auto:i,compound:o,src:(n&&!a?"&":"")+(r?"*":"")+(i?"++":"")+Ue(e)}}function Ue(t){return"string"==typeof t?t:t?"["+[].join.call(t,"+")+"]":""}function Ke(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:(r=function(t){return[t.name,t]},n.reduce((function(t,e,n){return(n=r(e,n))&&(t[n[0]]=n[1]),t}),{}))};var r}var $e=function(t){try{return t.only([[]]),$e=function(){return[[]]},[[]]}catch(t){return $e=function(){return Qt},Qt}};function Ye(t){return null==t?function(){}:"string"==typeof t?1===(e=t).split(".").length?function(t){return t[e]}:function(t){return w(t,e)}:function(e){return w(e,t)};var e}function Ve(t){return[].slice.call(t)}var Xe=0;function Je(t){return null==t?":id":"string"==typeof t?t:"[".concat(t.join("+"),"]")}function Qe(t,e,n){function r(t){if(3===t.type)return null;if(4===t.type)throw new Error("Cannot convert never type to IDBKeyRange");var n=t.lower,r=t.upper,i=t.lowerOpen;return t=t.upperOpen,void 0===n?void 0===r?null:e.upperBound(r,!!t):void 0===r?e.lowerBound(n,!!i):e.bound(n,r,!!i,!!t)}function i(t){var e,n=t.name;return{name:n,schema:t,mutate:function(t){var e=t.trans,i=t.type,o=t.keys,a=t.values,s=t.range;return new Promise((function(t,l){t=Mt(t);var u=e.objectStore(n),c=null==u.keyPath,h="put"===i||"add"===i;if(!h&&"delete"!==i&&"deleteRange"!==i)throw new Error("Invalid operation type: "+i);var d,f=(o||a||{length:1}).length;if(o&&a&&o.length!==a.length)throw new Error("Given keys array must have same length as given values array.");if(0===f)return t({numFailures:0,failures:{},results:[],lastResult:void 0});function p(t){++v,Re(t)}var g=[],m=[],v=0;if("deleteRange"===i){if(4===s.type)return t({numFailures:v,failures:m,results:[],lastResult:void 0});3===s.type?g.push(d=u.clear()):g.push(d=u.delete(r(s)))}else{var y=(c=h?c?[a,o]:[a,null]:[o,null])[0],b=c[1];if(h)for(var x=0;x<f;++x)g.push(d=b&&void 0!==b[x]?u[i](y[x],b[x]):u[i](y[x])),d.onerror=p;else for(x=0;x<f;++x)g.push(d=u[i](y[x])),d.onerror=p}function w(e){e=e.target.result,g.forEach((function(t,e){return null!=t.error&&(m[e]=t.error)})),t({numFailures:v,failures:m,results:"delete"===i?o:g.map((function(t){return t.result})),lastResult:e})}d.onerror=function(t){p(t),w(t)},d.onsuccess=w}))},getMany:function(t){var e=t.trans,r=t.keys;return new Promise((function(t,i){t=Mt(t);for(var o,a=e.objectStore(n),s=r.length,l=new Array(s),u=0,c=0,h=function(e){e=e.target,l[e._pos]=e.result,++c===u&&t(l)},d=Ie(i),f=0;f<s;++f)null!=r[f]&&((o=a.get(r[f]))._pos=f,o.onsuccess=h,o.onerror=d,++u);0===u&&t(l)}))},get:function(t){var e=t.trans,r=t.key;return new Promise((function(t,i){t=Mt(t);var o=e.objectStore(n).get(r);o.onsuccess=function(e){return t(e.target.result)},o.onerror=Ie(i)}))},query:(e=c,function(t){return new Promise((function(i,o){i=Mt(i);var a,s,l,u=t.trans,c=t.values,h=t.limit,d=t.query,f=h===1/0?void 0:h,p=d.index;if(d=d.range,u=u.objectStore(n),p=p.isPrimaryKey?u:u.index(p.name),d=r(d),0===h)return i({result:[]});e?((f=c?p.getAll(d,f):p.getAllKeys(d,f)).onsuccess=function(t){return i({result:t.target.result})},f.onerror=Ie(o)):(a=0,s=!c&&"openKeyCursor"in p?p.openKeyCursor(d):p.openCursor(d),l=[],s.onsuccess=function(t){var e=s.result;return e?(l.push(c?e.value:e.primaryKey),++a===h?i({result:l}):void e.continue()):i({result:l})},s.onerror=Ie(o))}))}),openCursor:function(t){var e=t.trans,i=t.values,o=t.query,a=t.reverse,s=t.unique;return new Promise((function(t,l){t=Mt(t);var u=o.index,c=o.range,h=e.objectStore(n),d=(h=u.isPrimaryKey?h:h.index(u.name),u=a?s?"prevunique":"prev":s?"nextunique":"next",!i&&"openKeyCursor"in h?h.openKeyCursor(r(c),u):h.openCursor(r(c),u));d.onerror=Ie(l),d.onsuccess=Mt((function(n){var r,i,o,a,s=d.result;s?(s.___id=++Xe,s.done=!1,r=s.continue.bind(s),i=(i=s.continuePrimaryKey)&&i.bind(s),o=s.advance.bind(s),a=function(){throw new Error("Cursor not stopped")},s.trans=e,s.stop=s.continue=s.continuePrimaryKey=s.advance=function(){throw new Error("Cursor not started")},s.fail=Mt(l),s.next=function(){var t=this,e=1;return this.start((function(){return e--?t.continue():t.stop()})).then((function(){return t}))},s.start=function(t){function e(){if(d.result)try{t()}catch(t){s.fail(t)}else s.done=!0,s.start=function(){throw new Error("Cursor behind last entry")},s.stop()}var n=new Promise((function(t,e){t=Mt(t),d.onerror=Ie(e),s.fail=e,s.stop=function(e){s.stop=s.continue=s.continuePrimaryKey=s.advance=a,t(e)}}));return d.onsuccess=Mt((function(t){d.onsuccess=e,e()})),s.continue=r,s.continuePrimaryKey=i,s.advance=o,e(),n},t(s)):t(null)}),l)}))},count:function(t){var e=t.query,i=t.trans,o=e.index,a=e.range;return new Promise((function(t,e){var s=i.objectStore(n),l=o.isPrimaryKey?s:s.index(o.name);(l=(s=r(a))?l.count(s):l.count()).onsuccess=Mt((function(e){return t(e.target.result)})),l.onerror=Ie(e)}))}}}var o,s,l,u=(s=n,l=Ve((o=t).objectStoreNames),{schema:{name:o.name,tables:l.map((function(t){return s.objectStore(t)})).map((function(t){var e=t.keyPath,n=t.autoIncrement,r=a(e),i={};return n={name:t.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:null==e,compound:r,keyPath:e,autoIncrement:n,unique:!0,extractKey:Ye(e)},indexes:Ve(t.indexNames).map((function(e){return t.index(e)})).map((function(t){var e=t.name,n=t.unique,r=t.multiEntry;return t=t.keyPath,r={name:e,compound:a(t),keyPath:t,unique:n,multiEntry:r,extractKey:Ye(t)},i[Je(t)]=r})),getIndexByKeyPath:function(t){return i[Je(t)]}},i[":id"]=n.primaryKey,null!=e&&(i[Je(e)]=n.primaryKey),n}))},hasGetAll:0<l.length&&"getAll"in s.objectStore(l[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),c=(n=u.schema,u.hasGetAll),h=(u=n.tables.map(i),{});return u.forEach((function(t){return h[t.name]=t})),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(t){if(!h[t])throw new Error("Table '".concat(t,"' not found"));return h[t]},MIN_KEY:-1/0,MAX_KEY:$e(e),schema:n}}function Ze(t,n,r,i){var o=r.IDBKeyRange;return r.indexedDB,{dbcore:(i=Qe(n,o,i),t.dbcore.reduce((function(t,n){return n=n.create,e(e({},t),n(t))}),i))}}function tn(t,e){var n=e.db;e=Ze(t._middlewares,n,t._deps,e),t.core=e.dbcore,t.tables.forEach((function(e){var n=e.name;t.core.schema.tables.some((function(t){return t.name===n}))&&(e.core=t.core.table(n),t[n]instanceof t.Table&&(t[n].core=e.core))}))}function en(t,e,n,r){n.forEach((function(n){var i=r[n];e.forEach((function(e){var r=function t(e,n){return g(e,n)||(e=l(e))&&t(e,n)}(e,n);(!r||"value"in r&&void 0===r.value)&&(e===t.Transaction.prototype||e instanceof t.Transaction?f(e,n,{get:function(){return this.table(n)},set:function(t){d(this,n,{value:t,writable:!0,configurable:!0,enumerable:!0})}}):e[n]=new t.Table(n,i))}))}))}function nn(t,e){e.forEach((function(e){for(var n in e)e[n]instanceof t.Table&&delete e[n]}))}function rn(t,e){return t._cfg.version-e._cfg.version}function on(t,e,n,r){var i=t._dbSchema;n.objectStoreNames.contains("$meta")&&!i.$meta&&(i.$meta=Ke("$meta",fn("")[0],[]),t._storeNames.push("$meta"));var a=t._createTransaction("readwrite",t._storeNames,i);a.create(n),a._completion.catch(r);var s=a._reject.bind(a),l=yt.transless||yt;Ht((function(){return yt.trans=a,yt.transless=l,0!==e?(tn(t,n),u=e,((r=a).storeNames.includes("$meta")?r.table("$meta").get("version").then((function(t){return null!=t?t:u})):Ct.resolve(u)).then((function(e){return i=e,s=a,l=n,u=[],e=(r=t)._versions,c=r._dbSchema=hn(0,r.idbdb,l),0!==(e=e.filter((function(t){return t._cfg.version>=i}))).length?(e.forEach((function(t){u.push((function(){var e=c,n=t._cfg.dbschema;dn(r,e,l),dn(r,n,l),c=r._dbSchema=n;var a=sn(e,n);a.add.forEach((function(t){ln(l,t[0],t[1].primKey,t[1].indexes)})),a.change.forEach((function(t){if(t.recreate)throw new K.Upgrade("Not yet support for changing primary key");var e=l.objectStore(t.name);t.add.forEach((function(t){return cn(e,t)})),t.change.forEach((function(t){e.deleteIndex(t.name),cn(e,t)})),t.del.forEach((function(t){return e.deleteIndex(t)}))}));var u=t._cfg.contentUpgrade;if(u&&t._cfg.version>i){tn(r,l),s._memoizedTables={};var h=k(n);a.del.forEach((function(t){h[t]=e[t]})),nn(r,[r.Transaction.prototype]),en(r,[r.Transaction.prototype],o(h),h),s.schema=h;var d,f=I(u);return f&&Gt(),a=Ct.follow((function(){var t;(d=u(s))&&f&&(t=Wt.bind(null,null),d.then(t,t))})),d&&"function"==typeof d.then?Ct.resolve(d):a.then((function(){return d}))}})),u.push((function(e){var n,i,o=t._cfg.dbschema;n=o,i=e,[].slice.call(i.db.objectStoreNames).forEach((function(t){return null==n[t]&&i.db.deleteObjectStore(t)})),nn(r,[r.Transaction.prototype]),en(r,[r.Transaction.prototype],r._storeNames,r._dbSchema),s.schema=r._dbSchema})),u.push((function(e){r.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(r.idbdb.version/10)===t._cfg.version?(r.idbdb.deleteObjectStore("$meta"),delete r._dbSchema.$meta,r._storeNames=r._storeNames.filter((function(t){return"$meta"!==t}))):e.objectStore("$meta").put(t._cfg.version,"version"))}))})),function t(){return u.length?Ct.resolve(u.shift()(s.idbtrans)).then(t):Ct.resolve()}().then((function(){un(c,l)}))):Ct.resolve();var r,i,s,l,u,c})).catch(s)):(o(i).forEach((function(t){ln(n,t,i[t].primKey,i[t].indexes)})),tn(t,n),void Ct.follow((function(){return t.on.populate.fire(a)})).catch(s));var r,u}))}function an(t,e){un(t._dbSchema,e),e.db.version%10!=0||e.objectStoreNames.contains("$meta")||e.db.createObjectStore("$meta").add(Math.ceil(e.db.version/10-1),"version");var n=hn(0,t.idbdb,e);dn(t,t._dbSchema,e);for(var r=0,i=sn(n,t._dbSchema).change;r<i.length;r++){var o=function(t){if(t.change.length||t.recreate)return console.warn("Unable to patch indexes of table ".concat(t.name," because it has changes on the type of index or primary key.")),{value:void 0};var n=e.objectStore(t.name);t.add.forEach((function(e){it&&console.debug("Dexie upgrade patch: Creating missing index ".concat(t.name,".").concat(e.src)),cn(n,e)}))}(i[r]);if("object"==typeof o)return o.value}}function sn(t,e){var n,r={del:[],add:[],change:[]};for(n in t)e[n]||r.del.push(n);for(n in e){var i=t[n],o=e[n];if(i){var a={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto)a.recreate=!0,r.change.push(a);else{var s=i.idxByName,l=o.idxByName,u=void 0;for(u in s)l[u]||a.del.push(u);for(u in l){var c=s[u],h=l[u];c?c.src!==h.src&&a.change.push(h):a.add.push(h)}(0<a.del.length||0<a.add.length||0<a.change.length)&&r.change.push(a)}}else r.add.push([n,o])}return r}function ln(t,e,n,r){var i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((function(t){return cn(i,t)})),i}function un(t,e){o(t).forEach((function(n){e.db.objectStoreNames.contains(n)||(it&&console.debug("Dexie: Creating missing table",n),ln(e,n,t[n].primKey,t[n].indexes))}))}function cn(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function hn(t,e,n){var r={};return v(e.objectStoreNames,0).forEach((function(t){for(var e=n.objectStore(t),i=qe(Ue(s=e.keyPath),s||"",!0,!1,!!e.autoIncrement,s&&"string"!=typeof s,!0),o=[],a=0;a<e.indexNames.length;++a){var s=(l=e.index(e.indexNames[a])).keyPath,l=qe(l.name,s,!!l.unique,!!l.multiEntry,!1,s&&"string"!=typeof s,!1);o.push(l)}r[t]=Ke(t,i,o)})),r}function dn(t,e,n){for(var r=n.db.objectStoreNames,o=0;o<r.length;++o){var a=r[o],s=n.objectStore(a);t._hasGetAll="getAll"in s;for(var l=0;l<s.indexNames.length;++l){var u=s.indexNames[l],c=s.index(u).keyPath,h="string"==typeof c?c:"["+v(c).join("+")+"]";!e[a]||(c=e[a].idxByName[h])&&(c.name=u,delete e[a].idxByName[h],e[a].idxByName[u]=c)}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&i.WorkerGlobalScope&&i instanceof i.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function fn(t){return t.split(",").map((function(t,e){var n=(t=t.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return qe(n,r||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),a(r),0===e)}))}var pn=(gn.prototype._parseStoresSpec=function(t,e){o(t).forEach((function(n){if(null!==t[n]){var r=fn(t[n]),i=r.shift();if(i.unique=!0,i.multi)throw new K.Schema("Primary key cannot be multi-valued");r.forEach((function(t){if(t.auto)throw new K.Schema("Only primary key can be marked as autoIncrement (++)");if(!t.keyPath)throw new K.Schema("Index must have a name and cannot be an empty string")})),e[n]=Ke(n,i,r)}}))},gn.prototype.stores=function(t){var e=this.db;this._cfg.storesSource=this._cfg.storesSource?s(this._cfg.storesSource,t):t,t=e._versions;var n={},r={};return t.forEach((function(t){s(n,t._cfg.storesSource),r=t._cfg.dbschema={},t._parseStoresSpec(n,r)})),e._dbSchema=r,nn(e,[e._allTables,e,e.Transaction.prototype]),en(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],o(r),r),e._storeNames=o(r),this},gn.prototype.upgrade=function(t){return this._cfg.contentUpgrade=rt(this._cfg.contentUpgrade||V,t),this},gn);function gn(){}function mn(t,e){var n=t._dbNamesDB;return n||(n=t._dbNamesDB=new er(ne,{addons:[],indexedDB:t,IDBKeyRange:e})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function vn(t){return t&&"function"==typeof t.databases}function yn(t){return Ht((function(){return yt.letThrough=!0,t()}))}function bn(t){return!("from"in t)}var xn=function(t,e){if(!this){var n=new xn;return t&&"d"in t&&s(n,t),n}s(this,arguments.length?{d:1,from:t,to:1<arguments.length?e:t}:{d:0})};function wn(t,e,n){var r=ue(e,n);if(!isNaN(r)){if(0<r)throw RangeError();if(bn(t))return s(t,{from:e,to:n,d:1});var i=t.l;if(r=t.r,ue(n,t.from)<0)return i?wn(i,e,n):t.l={from:e,to:n,d:1,l:null,r:null},_n(t);if(0<ue(e,t.to))return r?wn(r,e,n):t.r={from:e,to:n,d:1,l:null,r:null},_n(t);ue(e,t.from)<0&&(t.from=e,t.l=null,t.d=r?r.d+1:1),0<ue(n,t.to)&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1),n=!t.r,i&&!t.l&&Cn(t,i),r&&n&&Cn(t,r)}}function Cn(t,e){bn(e)||function t(e,n){var r=n.from,i=n.to,o=n.l;n=n.r,wn(e,r,i),o&&t(e,o),n&&t(e,n)}(t,e)}function kn(t,e){var n=Sn(e),r=n.next();if(r.done)return!1;for(var i=r.value,o=Sn(t),a=o.next(i.from),s=a.value;!r.done&&!a.done;){if(ue(s.from,i.to)<=0&&0<=ue(s.to,i.from))return!0;ue(i.from,s.from)<0?i=(r=n.next(s.from)).value:s=(a=o.next(i.from)).value}return!1}function Sn(t){var e=bn(t)?null:{s:0,n:t};return{next:function(t){for(var n=0<arguments.length;e;)switch(e.s){case 0:if(e.s=1,n)for(;e.n.l&&ue(t,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!n||ue(t,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function _n(t){var n,r,i=((null===(n=t.r)||void 0===n?void 0:n.d)||0)-((null===(r=t.l)||void 0===r?void 0:r.d)||0),o=1<i?"r":i<-1?"l":"";o&&(n="r"==o?"l":"r",r=e({},t),i=t[o],t.from=i.from,t.to=i.to,t[o]=i[o],r[o]=i[n],(t[n]=r).d=Dn(r)),t.d=Dn(t)}function Dn(t){var e=t.r;return t=t.l,(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}function An(t,e){return o(e).forEach((function(n){t[n]?Cn(t[n],e[n]):t[n]=function t(e){var n,r,i={};for(n in e)c(e,n)&&(r=e[n],i[n]=!r||"object"!=typeof r||A.has(r.constructor)?r:t(r));return i}(e[n])})),t}function Tn(t,e){return t.all||e.all||Object.keys(t).some((function(n){return e[n]&&kn(e[n],t[n])}))}h(xn.prototype,((R={add:function(t){return Cn(this,t),this},addKey:function(t){return wn(this,t,t),this},addKeys:function(t){var e=this;return t.forEach((function(t){return wn(e,t,t)})),this},hasKey:function(t){var e=Sn(this).next(t).value;return e&&ue(e.from,t)<=0&&0<=ue(e.to,t)}})[P]=function(){return Sn(this)},R));var En={},Fn={},Ln=!1;function Pn(t){An(Fn,t),Ln||(Ln=!0,setTimeout((function(){Ln=!1,On(Fn,!(Fn={}))}),0))}function On(t,e){void 0===e&&(e=!1);var n=new Set;if(t.all)for(var r=0,i=Object.values(En);r<i.length;r++)Mn(a=i[r],t,n,e);else for(var o in t){var a,s=/^idb\:\/\/(.*)\/(.*)\//.exec(o);s&&(o=s[1],s=s[2],(a=En["idb://".concat(o,"/").concat(s)])&&Mn(a,t,n,e))}n.forEach((function(t){return t()}))}function Mn(t,e,n,r){for(var i=[],o=0,a=Object.entries(t.queries.query);o<a.length;o++){for(var s=a[o],l=s[0],u=[],c=0,h=s[1];c<h.length;c++){var d=h[c];Tn(e,d.obsSet)?d.subscribers.forEach((function(t){return n.add(t)})):r&&u.push(d)}r&&i.push([l,u])}if(r)for(var f=0,p=i;f<p.length;f++){var g=p[f];l=g[0],u=g[1],t.queries.query[l]=u}}function Bn(t){var e=t._state,n=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then((function(){return e.dbOpenError?Jt(e.dbOpenError):t}));e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var r=e.openCanceller,i=Math.round(10*t.verno),a=!1;function s(){if(e.openCanceller!==r)throw new K.DatabaseClosed("db.open() was cancelled")}function l(){return new Ct((function(r,u){if(s(),!n)throw new K.MissingAPI;var c=t.name,f=e.autoSchema||!i?n.open(c):n.open(c,i);if(!f)throw new K.MissingAPI;f.onerror=Ie(u),f.onblocked=Mt(t._fireOnBlocked),f.onupgradeneeded=Mt((function(r){var i;h=f.transaction,e.autoSchema&&!t._options.allowEmptyDB?(f.onerror=Re,h.abort(),f.result.close(),(i=n.deleteDatabase(c)).onsuccess=i.onerror=Mt((function(){u(new K.NoSuchDatabase("Database ".concat(c," doesnt exist")))}))):(h.onerror=Ie(u),r=r.oldVersion>Math.pow(2,62)?0:r.oldVersion,d=r<1,t.idbdb=f.result,a&&an(t,h),on(t,r/10,h,u))}),u),f.onsuccess=Mt((function(){h=null;var n,s,u,p,g,m=t.idbdb=f.result,y=v(m.objectStoreNames);if(0<y.length)try{var b=m.transaction(1===(p=y).length?p[0]:p,"readonly");if(e.autoSchema)s=m,u=b,(n=t).verno=s.version/10,u=n._dbSchema=hn(0,s,u),n._storeNames=v(s.objectStoreNames,0),en(n,[n._allTables],o(u),u);else if(dn(t,t._dbSchema,b),((g=sn(hn(0,(g=t).idbdb,b),g._dbSchema)).add.length||g.change.some((function(t){return t.add.length||t.change.length})))&&!a)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),m.close(),i=m.version+1,a=!0,r(l());tn(t,b)}catch(n){}ee.push(t),m.onversionchange=Mt((function(n){e.vcFired=!0,t.on("versionchange").fire(n)})),m.onclose=Mt((function(e){t.on("close").fire(e)})),d&&(g=t._deps,b=c,m=g.indexedDB,g=g.IDBKeyRange,vn(m)||b===ne||mn(m,g).put({name:b}).catch(V)),r()}),u)})).catch((function(t){switch(null==t?void 0:t.name){case"UnknownError":if(0<e.PR1398_maxLoop)return e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),l();break;case"VersionError":if(0<i)return i=0,l()}return Ct.reject(t)}))}var u,c=e.dbReadyResolve,h=null,d=!1;return Ct.race([r,("undefined"==typeof navigator?Ct.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){function e(){return indexedDB.databases().finally(t)}u=setInterval(e,100),e()})).finally((function(){return clearInterval(u)})):Promise.resolve()).then(l)]).then((function(){return s(),e.onReadyBeingFired=[],Ct.resolve(yn((function(){return t.on.ready.fire(t.vip)}))).then((function n(){if(0<e.onReadyBeingFired.length){var r=e.onReadyBeingFired.reduce(rt,V);return e.onReadyBeingFired=[],Ct.resolve(yn((function(){return r(t.vip)}))).then(n)}}))})).finally((function(){e.openCanceller===r&&(e.onReadyBeingFired=null,e.isBeingOpened=!1)})).catch((function(n){e.dbOpenError=n;try{h&&h.abort()}catch(n){}return r===e.openCanceller&&t._close(),Jt(n)})).finally((function(){e.openComplete=!0,c()})).then((function(){var e;return d&&(e={},t.tables.forEach((function(n){n.schema.indexes.forEach((function(r){r.name&&(e["idb://".concat(t.name,"/").concat(n.name,"/").concat(r.name)]=new xn(-1/0,[[[]]]))})),e["idb://".concat(t.name,"/").concat(n.name,"/")]=e["idb://".concat(t.name,"/").concat(n.name,"/:dels")]=new xn(-1/0,[[[]]])})),He(je).fire(e),On(e,!0)),t}))}function Nn(t){function e(e){return t.next(e)}var n=i(e),r=i((function(e){return t.throw(e)}));function i(t){return function(e){var i=t(e);return e=i.value,i.done?e:e&&"function"==typeof e.then?e.then(n,r):a(e)?Promise.all(e).then(n,r):n(e)}}return i(e)()}function In(t,e,n){for(var r=a(t)?t.slice():[t],i=0;i<n;++i)r.push(e);return r}var Rn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return e(e({},t),{table:function(n){var r=t.table(n),i=r.schema,o={},a=[];function s(t,n,r){var i=Je(t),l=o[i]=o[i]||[],u=null==t?0:"string"==typeof t?1:t.length,c=0<n;return c=e(e({},r),{name:c?"".concat(i,"(virtual-from:").concat(r.name,")"):r.name,lowLevelIndex:r,isVirtual:c,keyTail:n,keyLength:u,extractKey:Ye(t),unique:!c&&r.unique}),l.push(c),c.isPrimaryKey||a.push(c),1<u&&s(2===u?t[0]:t.slice(0,u-1),n+1,r),l.sort((function(t,e){return t.keyTail-e.keyTail})),c}n=s(i.primaryKey.keyPath,0,i.primaryKey),o[":id"]=[n];for(var l=0,u=i.indexes;l<u.length;l++){var c=u[l];s(c.keyPath,0,c)}function h(n){var r,i=n.query.index;return i.isVirtual?e(e({},n),{query:{index:i.lowLevelIndex,range:(r=n.query.range,i=i.keyTail,{type:1===r.type?2:r.type,lower:In(r.lower,r.lowerOpen?t.MAX_KEY:t.MIN_KEY,i),lowerOpen:!0,upper:In(r.upper,r.upperOpen?t.MIN_KEY:t.MAX_KEY,i),upperOpen:!0})}}):n}return e(e({},r),{schema:e(e({},i),{primaryKey:n,indexes:a,getIndexByKeyPath:function(t){return(t=o[Je(t)])&&t[0]}}),count:function(t){return r.count(h(t))},query:function(t){return r.query(h(t))},openCursor:function(e){var n=e.query.index,i=n.keyTail,o=n.isVirtual,a=n.keyLength;return o?r.openCursor(h(e)).then((function(t){return t&&s(t)})):r.openCursor(e);function s(n){return Object.create(n,{continue:{value:function(r){null!=r?n.continue(In(r,e.reverse?t.MAX_KEY:t.MIN_KEY,i)):e.unique?n.continue(n.key.slice(0,a).concat(e.reverse?t.MIN_KEY:t.MAX_KEY,i)):n.continue()}},continuePrimaryKey:{value:function(e,r){n.continuePrimaryKey(In(e,t.MAX_KEY,i),r)}},primaryKey:{get:function(){return n.primaryKey}},key:{get:function(){var t=n.key;return 1===a?t[0]:t.slice(0,a)}},value:{get:function(){return n.value}}})}}})}})}};function jn(t,e,n,r){return n=n||{},r=r||"",o(t).forEach((function(i){var o,a,s;c(e,i)?(o=t[i],a=e[i],"object"==typeof o&&"object"==typeof a&&o&&a?(s=L(o))!==L(a)?n[r+i]=e[i]:"Object"===s?jn(o,a,n,r+i+"."):o!==a&&(n[r+i]=e[i]):o!==a&&(n[r+i]=e[i])):n[r+i]=void 0})),o(e).forEach((function(i){c(t,i)||(n[r+i]=e[i])})),n}function zn(t,e){return"delete"===e.type?e.keys:e.keys||e.values.map(t.extractKey)}var Hn={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return e(e({},t),{table:function(n){var i=t.table(n),o=i.schema.primaryKey;return e(e({},i),{mutate:function(t){var a=yt.trans,s=a.table(n).hook,l=s.deleting,u=s.creating,h=s.updating;switch(t.type){case"add":if(u.fire===V)break;return a._promise("readwrite",(function(){return d(t)}),!0);case"put":if(u.fire===V&&h.fire===V)break;return a._promise("readwrite",(function(){return d(t)}),!0);case"delete":if(l.fire===V)break;return a._promise("readwrite",(function(){return d(t)}),!0);case"deleteRange":if(l.fire===V)break;return a._promise("readwrite",(function(){return function t(n,r,a){return i.query({trans:n,values:!1,query:{index:o,range:r},limit:a}).then((function(i){var o=i.result;return d({type:"delete",keys:o,trans:n}).then((function(i){return 0<i.numFailures?Promise.reject(i.failures[0]):o.length<a?{failures:[],numFailures:0,lastResult:void 0}:t(n,e(e({},r),{lower:o[o.length-1],lowerOpen:!0}),a)}))}))}(t.trans,t.range,1e4)}),!0)}return i.mutate(t);function d(t){var n,a,s,d=yt.trans,f=t.keys||zn(o,t);if(!f)throw new Error("Keys missing");return"delete"!==(t="add"===t.type||"put"===t.type?e(e({},t),{keys:f}):e({},t)).type&&(t.values=r([],t.values,!0)),t.keys&&(t.keys=r([],t.keys,!0)),n=i,s=f,("add"===(a=t).type?Promise.resolve([]):n.getMany({trans:a.trans,keys:s,cache:"immutable"})).then((function(e){var n=f.map((function(n,r){var i,a,s,f=e[r],p={onerror:null,onsuccess:null};return"delete"===t.type?l.fire.call(p,n,f,d):"add"===t.type||void 0===f?(i=u.fire.call(p,n,t.values[r],d),null==n&&null!=i&&(t.keys[r]=n=i,o.outbound||C(t.values[r],o.keyPath,n))):(i=jn(f,t.values[r]),(a=h.fire.call(p,i,n,f,d))&&(s=t.values[r],Object.keys(a).forEach((function(t){c(s,t)?s[t]=a[t]:C(s,t,a[t])})))),p}));return i.mutate(t).then((function(r){for(var i=r.failures,o=r.results,a=r.numFailures,s=(r=r.lastResult,0);s<f.length;++s){var l=(o||f)[s],u=n[s];null==l?u.onerror&&u.onerror(i[s]):u.onsuccess&&u.onsuccess("put"===t.type&&e[s]?t.values[s]:l)}return{failures:i,results:o,numFailures:a,lastResult:r}})).catch((function(t){return n.forEach((function(e){return e.onerror&&e.onerror(t)})),Promise.reject(t)}))}))}}})}})}};function Gn(t,e,n){try{if(!e)return null;if(e.keys.length<t.length)return null;for(var r=[],i=0,o=0;i<e.keys.length&&o<t.length;++i)0===ue(e.keys[i],t[o])&&(r.push(n?E(e.values[i]):e.values[i]),++o);return r.length===t.length?r:null}catch(t){return null}}var Wn={stack:"dbcore",level:-1,create:function(t){return{table:function(n){var r=t.table(n);return e(e({},r),{getMany:function(t){if(!t.cache)return r.getMany(t);var e=Gn(t.keys,t.trans._cache,"clone"===t.cache);return e?Ct.resolve(e):r.getMany(t).then((function(e){return t.trans._cache={keys:t.keys,values:"clone"===t.cache?E(e):e},e}))},mutate:function(t){return"add"!==t.type&&(t.trans._cache=null),r.mutate(t)}})}}}};function qn(t,e){return"readonly"===t.trans.mode&&!!t.subscr&&!t.trans.explicit&&"disabled"!==t.trans.db._options.cache&&!e.schema.primaryKey.outbound}function Un(t,e){switch(t){case"query":return e.values&&!e.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Kn={stack:"dbcore",level:0,name:"Observability",create:function(t){var n=t.schema.name,r=new xn(t.MIN_KEY,t.MAX_KEY);return e(e({},t),{transaction:function(e,n,r){if(yt.subscr&&"readonly"!==n)throw new K.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(yt.querier));return t.transaction(e,n,r)},table:function(i){var s=t.table(i),l=s.schema,u=l.primaryKey,c=l.indexes,h=u.extractKey,d=u.outbound,f=u.autoIncrement&&c.filter((function(t){return t.compound&&t.keyPath.includes(u.keyPath)})),p=e(e({},s),{mutate:function(e){function o(t){return t="idb://".concat(n,"/").concat(i,"/").concat(t),g[t]||(g[t]=new xn)}var c,h,d,p=e.trans,g=e.mutatedParts||(e.mutatedParts={}),m=o(""),v=o(":dels"),y=e.type,b="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[zn(u,e).filter((function(t){return t})),e.values]:[],x=b[0],w=b[1];return b=e.trans._cache,a(x)?(m.addKeys(x),(b="delete"===y||x.length===w.length?Gn(x,b):null)||v.addKeys(x),(b||w)&&(c=o,h=b,d=w,l.indexes.forEach((function(t){var e=c(t.name||"");function n(e){return null!=e?t.extractKey(e):null}function r(n){return t.multiEntry&&a(n)?n.forEach((function(t){return e.addKey(t)})):e.addKey(n)}(h||d).forEach((function(t,e){var i=h&&n(h[e]);0!==ue(i,e=d&&n(d[e]))&&(null!=i&&r(i),null!=e&&r(e))}))})))):x?(w={from:null!==(w=x.lower)&&void 0!==w?w:t.MIN_KEY,to:null!==(w=x.upper)&&void 0!==w?w:t.MAX_KEY},v.add(w),m.add(w)):(m.add(r),v.add(r),l.indexes.forEach((function(t){return o(t.name).add(r)}))),s.mutate(e).then((function(t){return!x||"add"!==e.type&&"put"!==e.type||(m.addKeys(t.results),f&&f.forEach((function(n){for(var r=e.values.map((function(t){return n.extractKey(t)})),i=n.keyPath.findIndex((function(t){return t===u.keyPath})),a=0,s=t.results.length;a<s;++a)r[a][i]=t.results[a];o(n.name).addKeys(r)}))),p.mutatedParts=An(p.mutatedParts||{},g),t}))}}),g=(c=function(e){e=(n=e.query).index;var n=n.range;return[e,new xn(null!==(e=n.lower)&&void 0!==e?e:t.MIN_KEY,null!==(n=n.upper)&&void 0!==n?n:t.MAX_KEY)]},{get:function(t){return[u,new xn(t.key)]},getMany:function(t){return[u,(new xn).addKeys(t.keys)]},count:c,query:c,openCursor:c});return o(g).forEach((function(t){p[t]=function(o){var a=!!(p=yt.subscr),l=qn(yt,s)&&Un(t,o)?o.obsSet={}:p;if(a){var u=function(t){return t="idb://".concat(n,"/").concat(i,"/").concat(t),l[t]||(l[t]=new xn)},c=u(""),f=u(":dels"),p=(a=(p=g[t](o))[0],p[1]);if(("query"===t&&a.isPrimaryKey&&!o.values?f:u(a.name||"")).add(p),!a.isPrimaryKey){if("count"!==t){var m="query"===t&&d&&o.values&&s.query(e(e({},o),{values:!1}));return s[t].apply(this,arguments).then((function(e){if("query"===t){if(d&&o.values)return m.then((function(t){return t=t.result,c.addKeys(t),e}));var n=o.values?e.result.map(h):e.result;(o.values?c:f).addKeys(n)}else if("openCursor"===t){var r=e,i=o.values;return r&&Object.create(r,{key:{get:function(){return f.addKey(r.primaryKey),r.key}},primaryKey:{get:function(){var t=r.primaryKey;return f.addKey(t),t}},value:{get:function(){return i&&c.addKey(r.primaryKey),r.value}}})}return e}))}f.add(r)}}return s[t].apply(this,arguments)}})),p}})}};function $n(t,n,r){if(0===r.numFailures)return n;if("deleteRange"===n.type)return null;var i=n.keys?n.keys.length:"values"in n&&n.values?n.values.length:1;return r.numFailures===i?null:(n=e({},n),a(n.keys)&&(n.keys=n.keys.filter((function(t,e){return!(e in r.failures)}))),"values"in n&&a(n.values)&&(n.values=n.values.filter((function(t,e){return!(e in r.failures)}))),n)}function Yn(t,e){return n=t,(void 0===(r=e).lower||(r.lowerOpen?0<ue(n,r.lower):0<=ue(n,r.lower)))&&(void 0===e.upper||(e.upperOpen?ue(t,e.upper)<0:ue(t,e.upper)<=0));var n,r}function Vn(t,e,n,r,i,o){if(!n||0===n.length)return t;var s=e.query.index,l=s.multiEntry,u=e.query.range,c=r.schema.primaryKey.extractKey,h=s.extractKey,d=(s.lowLevelIndex||s).extractKey;return n=n.reduce((function(t,n){var r=t,i=[];if("add"===n.type||"put"===n.type)for(var o=new xn,s=n.values.length-1;0<=s;--s){var d,f=n.values[s],p=c(f);o.hasKey(p)||(d=h(f),(l&&a(d)?d.some((function(t){return Yn(t,u)})):Yn(d,u))&&(o.addKey(p),i.push(f)))}switch(n.type){case"add":var g=(new xn).addKeys(e.values?t.map((function(t){return c(t)})):t);r=t.concat(e.values?i.filter((function(t){return t=c(t),!g.hasKey(t)&&(g.addKey(t),!0)})):i.map((function(t){return c(t)})).filter((function(t){return!g.hasKey(t)&&(g.addKey(t),!0)})));break;case"put":var m=(new xn).addKeys(n.values.map((function(t){return c(t)})));r=t.filter((function(t){return!m.hasKey(e.values?c(t):t)})).concat(e.values?i:i.map((function(t){return c(t)})));break;case"delete":var v=(new xn).addKeys(n.keys);r=t.filter((function(t){return!v.hasKey(e.values?c(t):t)}));break;case"deleteRange":var y=n.range;r=t.filter((function(t){return!Yn(c(t),y)}))}return r}),t),n===t?t:(n.sort((function(t,e){return ue(d(t),d(e))||ue(c(t),c(e))})),e.limit&&e.limit<1/0&&(n.length>e.limit?n.length=e.limit:t.length===e.limit&&n.length<e.limit&&(i.dirty=!0)),o?Object.freeze(n):n)}function Xn(t,e){return 0===ue(t.lower,e.lower)&&0===ue(t.upper,e.upper)&&!!t.lowerOpen==!!e.lowerOpen&&!!t.upperOpen==!!e.upperOpen}function Jn(t,e){return function(t,e,n,r){if(void 0===t)return void 0!==e?-1:0;if(void 0===e)return 1;if(0===(e=ue(t,e))){if(n&&r)return 0;if(n)return 1;if(r)return-1}return e}(t.lower,e.lower,t.lowerOpen,e.lowerOpen)<=0&&0<=function(t,e,n,r){if(void 0===t)return void 0!==e?1:0;if(void 0===e)return-1;if(0===(e=ue(t,e))){if(n&&r)return 0;if(n)return-1;if(r)return 1}return e}(t.upper,e.upper,t.upperOpen,e.upperOpen)}function Qn(t,e,n,r){t.subscribers.add(n),r.addEventListener("abort",(function(){var r,i;t.subscribers.delete(n),0===t.subscribers.size&&(r=t,i=e,setTimeout((function(){0===r.subscribers.size&&M(i,r)}),3e3))}))}var Zn={stack:"dbcore",level:0,name:"Cache",create:function(t){var n=t.schema.name;return e(e({},t),{transaction:function(e,r,i){var o,a,s=t.transaction(e,r,i);return"readwrite"===r&&(a=(o=new AbortController).signal,i=function(i){return function(){if(o.abort(),"readwrite"===r){for(var a=new Set,l=0,u=e;l<u.length;l++){var c=u[l],h=En["idb://".concat(n,"/").concat(c)];if(h){var d=t.table(c),f=h.optimisticOps.filter((function(t){return t.trans===s}));if(s._explicit&&i&&s.mutatedParts)for(var p=0,g=Object.values(h.queries.query);p<g.length;p++)for(var m=0,v=(x=g[p]).slice();m<v.length;m++)Tn((w=v[m]).obsSet,s.mutatedParts)&&(M(x,w),w.subscribers.forEach((function(t){return a.add(t)})));else if(0<f.length){h.optimisticOps=h.optimisticOps.filter((function(t){return t.trans!==s}));for(var y=0,b=Object.values(h.queries.query);y<b.length;y++)for(var x,w,C,k=0,S=(x=b[y]).slice();k<S.length;k++)null!=(w=S[k]).res&&s.mutatedParts&&(i&&!w.dirty?(C=Object.isFrozen(w.res),C=Vn(w.res,w.req,f,d,w,C),w.dirty?(M(x,w),w.subscribers.forEach((function(t){return a.add(t)}))):C!==w.res&&(w.res=C,w.promise=Ct.resolve({result:C}))):(w.dirty&&M(x,w),w.subscribers.forEach((function(t){return a.add(t)}))))}}}a.forEach((function(t){return t()}))}}},s.addEventListener("abort",i(!1),{signal:a}),s.addEventListener("error",i(!1),{signal:a}),s.addEventListener("complete",i(!0),{signal:a})),s},table:function(r){var i=t.table(r),o=i.schema.primaryKey;return e(e({},i),{mutate:function(t){var a=yt.trans;if(o.outbound||"disabled"===a.db._options.cache||a.explicit||"readwrite"!==a.idbtrans.mode)return i.mutate(t);var s=En["idb://".concat(n,"/").concat(r)];return s?(a=i.mutate(t),"add"!==t.type&&"put"!==t.type||!(50<=t.values.length||zn(o,t).some((function(t){return null==t})))?(s.optimisticOps.push(t),t.mutatedParts&&Pn(t.mutatedParts),a.then((function(e){0<e.numFailures&&(M(s.optimisticOps,t),(e=$n(0,t,e))&&s.optimisticOps.push(e),t.mutatedParts&&Pn(t.mutatedParts))})),a.catch((function(){M(s.optimisticOps,t),t.mutatedParts&&Pn(t.mutatedParts)}))):a.then((function(n){var r=$n(0,e(e({},t),{values:t.values.map((function(t,r){var i;return n.failures[r]||C(t=null!==(i=o.keyPath)&&void 0!==i&&i.includes(".")?E(t):e({},t),o.keyPath,n.results[r]),t}))}),n);s.optimisticOps.push(r),queueMicrotask((function(){return t.mutatedParts&&Pn(t.mutatedParts)}))})),a):i.mutate(t)},query:function(t){if(!qn(yt,i)||!Un("query",t))return i.query(t);var e="immutable"===(null===(s=yt.trans)||void 0===s?void 0:s.db._options.cache),o=(u=yt).requery,a=u.signal,s=function(t,e,n,r){var i=En["idb://".concat(t,"/").concat(e)];if(!i)return[];if(!(e=i.queries[n]))return[null,!1,i,null];var o=e[(r.query?r.query.index.name:null)||""];if(!o)return[null,!1,i,null];switch(n){case"query":var a=o.find((function(t){return t.req.limit===r.limit&&t.req.values===r.values&&Xn(t.req.query.range,r.query.range)}));return a?[a,!0,i,o]:[o.find((function(t){return("limit"in t.req?t.req.limit:1/0)>=r.limit&&(!r.values||t.req.values)&&Jn(t.req.query.range,r.query.range)})),!1,i,o];case"count":return a=o.find((function(t){return Xn(t.req.query.range,r.query.range)})),[a,!!a,i,o]}}(n,r,"query",t),l=s[0],u=s[1],c=s[2],h=s[3];return l&&u?l.obsSet=t.obsSet:(u=i.query(t).then((function(t){var n=t.result;if(l&&(l.res=n),e){for(var r=0,i=n.length;r<i;++r)Object.freeze(n[r]);Object.freeze(n)}else t.result=E(n);return t})).catch((function(t){return h&&l&&M(h,l),Promise.reject(t)})),l={obsSet:t.obsSet,promise:u,subscribers:new Set,type:"query",req:t,dirty:!1},h?h.push(l):(h=[l],(c=c||(En["idb://".concat(n,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[t.query.index.name||""]=h)),Qn(l,h,o,a),l.promise.then((function(n){return{result:Vn(n.result,t,null==c?void 0:c.optimisticOps,i,l,e)}}))}})}})}};function tr(t,e){return new Proxy(t,{get:function(t,n,r){return"db"===n?e:Reflect.get(t,n,r)}})}var er=(nr.prototype.version=function(t){if(isNaN(t)||t<.1)throw new K.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new K.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=this._versions,n=e.filter((function(e){return e._cfg.version===t}))[0];return n||(n=new this.Version(t),e.push(n),e.sort(rn),n.stores({}),this._state.autoSchema=!1,n)},nr.prototype._whenReady=function(t){var e=this;return this.idbdb&&(this._state.openComplete||yt.letThrough||this._vip)?t():new Ct((function(t,n){if(e._state.openComplete)return n(new K.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return void n(new K.DatabaseClosed);e.open().catch(V)}e._state.dbReadyPromise.then(t,n)})).then(t)},nr.prototype.use=function(t){var e=t.stack,n=t.create,r=t.level,i=t.name;return i&&this.unuse({stack:e,name:i}),(t=this._middlewares[e]||(this._middlewares[e]=[])).push({stack:e,create:n,level:null==r?10:r,name:i}),t.sort((function(t,e){return t.level-e.level})),this},nr.prototype.unuse=function(t){var e=t.stack,n=t.name,r=t.create;return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter((function(t){return r?t.create!==r:!!n&&t.name!==n}))),this},nr.prototype.open=function(){var t=this;return Yt(vt,(function(){return Bn(t)}))},nr.prototype._close=function(){var t=this._state,e=ee.indexOf(this);if(0<=e&&ee.splice(e,1),this.idbdb){try{this.idbdb.close()}catch(e){}this.idbdb=null}t.isBeingOpened||(t.dbReadyPromise=new Ct((function(e){t.dbReadyResolve=e})),t.openCanceller=new Ct((function(e,n){t.cancelOpen=n})))},nr.prototype.close=function(t){var e=(void 0===t?{disableAutoOpen:!0}:t).disableAutoOpen;t=this._state,e?(t.isBeingOpened&&t.cancelOpen(new K.DatabaseClosed),this._close(),t.autoOpen=!1,t.dbOpenError=new K.DatabaseClosed):(this._close(),t.autoOpen=this._options.autoOpen||t.isBeingOpened,t.openComplete=!1,t.dbOpenError=null)},nr.prototype.delete=function(t){var e=this;void 0===t&&(t={disableAutoOpen:!0});var n=0<arguments.length&&"object"!=typeof arguments[0],r=this._state;return new Ct((function(i,o){function a(){e.close(t);var n=e._deps.indexedDB.deleteDatabase(e.name);n.onsuccess=Mt((function(){var t,n,r;t=e._deps,n=e.name,r=t.indexedDB,t=t.IDBKeyRange,vn(r)||n===ne||mn(r,t).delete(n).catch(V),i()})),n.onerror=Ie(o),n.onblocked=e._fireOnBlocked}if(n)throw new K.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(a):a()}))},nr.prototype.backendDB=function(){return this.idbdb},nr.prototype.isOpen=function(){return null!==this.idbdb},nr.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&"DatabaseClosed"===t.name},nr.prototype.hasFailed=function(){return null!==this._state.dbOpenError},nr.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(nr.prototype,"tables",{get:function(){var t=this;return o(this._allTables).map((function(e){return t._allTables[e]}))},enumerable:!1,configurable:!0}),nr.prototype.transaction=function(){var t=function(t,e,n){var r=arguments.length;if(r<2)throw new K.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[t,_(i),n]}.apply(this,arguments);return this._transaction.apply(this,t)},nr.prototype._transaction=function(t,e,n){var r=this,i=yt.trans;i&&i.db===this&&-1===t.indexOf("!")||(i=null);var o,a,s=-1!==t.indexOf("?");t=t.replace("!","").replace("?","");try{if(a=e.map((function(t){if("string"!=typeof(t=t instanceof r.Table?t.name:t))throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==t||t===re)o=re;else{if("rw"!=t&&t!=ie)throw new K.InvalidArgument("Invalid transaction mode: "+t);o=ie}if(i){if(i.mode===re&&o===ie){if(!s)throw new K.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&a.forEach((function(t){if(i&&-1===i.storeNames.indexOf(t)){if(!s)throw new K.SubTransaction("Table "+t+" not included in parent transaction.");i=null}})),s&&i&&!i.active&&(i=null)}}catch(n){return i?i._promise(null,(function(t,e){e(n)})):Jt(n)}var l=function t(e,n,r,i,o){return Ct.resolve().then((function(){var a=yt.transless||yt,s=e._createTransaction(n,r,e._dbSchema,i);if(s.explicit=!0,a={trans:s,transless:a},i)s.idbtrans=i.idbtrans;else try{s.create(),s.idbtrans._explicit=!0,e._state.PR1398_maxLoop=3}catch(a){return a.name===q.InvalidState&&e.isOpen()&&0<--e._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then((function(){return t(e,n,r,null,o)}))):Jt(a)}var l,u=I(o);return u&&Gt(),a=Ct.follow((function(){var t;(l=o.call(s,s))&&(u?(t=Wt.bind(null,null),l.then(t,t)):"function"==typeof l.next&&"function"==typeof l.throw&&(l=Nn(l)))}),a),(l&&"function"==typeof l.then?Ct.resolve(l).then((function(t){return s.active?t:Jt(new K.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))})):a.then((function(){return l}))).then((function(t){return i&&s._resolve(),s._completion.then((function(){return t}))})).catch((function(t){return s._reject(t),Jt(t)}))}))}.bind(null,this,o,a,i,n);return i?i._promise(o,l,"lock"):yt.trans?Yt(yt.transless,(function(){return r._whenReady(l)})):this._whenReady(l)},nr.prototype.table=function(t){if(!c(this._allTables,t))throw new K.InvalidTable("Table ".concat(t," does not exist"));return this._allTables[t]},nr);function nr(t,n){var r=this;this._middlewares={},this.verno=0;var i=nr.dependencies;this._options=n=e({addons:nr.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange,cache:"cloned"},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange},i=n.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var o,a,s,l,u,c={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:V,dbReadyPromise:null,cancelOpen:V,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:n.autoOpen};c.dbReadyPromise=new Ct((function(t){c.dbReadyResolve=t})),c.openCanceller=new Ct((function(t,e){c.cancelOpen=e})),this._state=c,this.name=t,this.on=pe(this,"populate","blocked","versionchange","close",{ready:[rt,V]}),this.on.ready.subscribe=y(this.on.ready.subscribe,(function(t){return function(e,n){nr.vip((function(){var i,o=r._state;o.openComplete?(o.dbOpenError||Ct.resolve().then(e),n&&t(e)):o.onReadyBeingFired?(o.onReadyBeingFired.push(e),n&&t(e)):(t(e),i=r,n||t((function t(){i.on.ready.unsubscribe(e),i.on.ready.unsubscribe(t)})))}))}})),this.Collection=(o=this,ge(_e.prototype,(function(t,e){this.db=o;var n=ae,r=null;if(e)try{n=e()}catch(t){r=t}var i=t._ctx;t=(e=i.table).hook.reading.fire,this._ctx={table:e,index:i.index,isPrimKey:!i.index||e.schema.primKey.keyPath&&i.index===e.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:t!==X?t:null}}))),this.Table=(a=this,ge(de.prototype,(function(t,e,n){this.db=a,this._tx=n,this.name=t,this.schema=e,this.hook=a._allTables[t]?a._allTables[t].hook:pe(null,{creating:[Z,V],reading:[J,X],updating:[et,V],deleting:[tt,V]})}))),this.Transaction=(s=this,ge(Ge.prototype,(function(t,e,n,r,i){var o=this;this.db=s,this.mode=t,this.storeNames=e,this.schema=n,this.chromeTransactionDurability=r,this.idbtrans=null,this.on=pe(this,"complete","error","abort"),this.parent=i||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ct((function(t,e){o._resolve=t,o._reject=e})),this._completion.then((function(){o.active=!1,o.on.complete.fire()}),(function(t){var e=o.active;return o.active=!1,o.on.error.fire(t),o.parent?o.parent._reject(t):e&&o.idbtrans&&o.idbtrans.abort(),Jt(t)}))}))),this.Version=(l=this,ge(pn.prototype,(function(t){this.db=l,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))),this.WhereClause=(u=this,ge(Be.prototype,(function(t,e,n){if(this.db=u,this._ctx={table:t,index:":id"===e?null:e,or:n},this._cmp=this._ascending=ue,this._descending=function(t,e){return ue(e,t)},this._max=function(t,e){return 0<ue(t,e)?t:e},this._min=function(t,e){return ue(t,e)<0?t:e},this._IDBKeyRange=u._deps.IDBKeyRange,!this._IDBKeyRange)throw new K.MissingAPI}))),this.on("versionchange",(function(t){0<t.newVersion?console.warn("Another connection wants to upgrade database '".concat(r.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(r.name,"'. Closing db now to resume the delete request.")),r.close({disableAutoOpen:!1})})),this.on("blocked",(function(t){!t.newVersion||t.newVersion<t.oldVersion?console.warn("Dexie.delete('".concat(r.name,"') was blocked")):console.warn("Upgrade '".concat(r.name,"' blocked by other connection holding version ").concat(t.oldVersion/10))})),this._maxKey=$e(n.IDBKeyRange),this._createTransaction=function(t,e,n,i){return new r.Transaction(t,e,n,r._options.chromeTransactionDurability,i)},this._fireOnBlocked=function(t){r.on("blocked").fire(t),ee.filter((function(t){return t.name===r.name&&t!==r&&!t._state.vcFired})).map((function(e){return e.on("versionchange").fire(t)}))},this.use(Wn),this.use(Zn),this.use(Kn),this.use(Rn),this.use(Hn);var h=new Proxy(this,{get:function(t,e,n){if("_vip"===e)return!0;if("table"===e)return function(t){return tr(r.table(t),h)};var i=Reflect.get(t,e,n);return i instanceof de?tr(i,h):"tables"===e?i.map((function(t){return tr(t,h)})):"_createTransaction"===e?function(){return tr(i.apply(this,arguments),h)}:i}});this.vip=h,i.forEach((function(t){return t(r)}))}R="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";var rr,ir=(or.prototype.subscribe=function(t,e,n){return this._subscribe(t&&"function"!=typeof t?t:{next:t,error:e,complete:n})},or.prototype[R]=function(){return this},or);function or(t){this._subscribe=t}try{rr={indexedDB:i.indexedDB||i.mozIndexedDB||i.webkitIndexedDB||i.msIndexedDB,IDBKeyRange:i.IDBKeyRange||i.webkitIDBKeyRange}}catch(D){rr={indexedDB:null,IDBKeyRange:null}}function ar(t){var e,n=!1,r=new ir((function(r){var i,o=I(t),a=!1,s={},l={},u={get closed(){return a},unsubscribe:function(){a||(a=!0,i&&i.abort(),h&&He.storagemutated.unsubscribe(f))}};r.start&&r.start(u);var h=!1,d=function(){return Xt(p)},f=function(t){An(s,t),Tn(l,s)&&d()},p=function(){var u,p,g;!a&&rr.indexedDB&&(s={},u={},i&&i.abort(),i=new AbortController,g=function(e){var n=Ft();try{o&&Gt();var r=Ht(t,e);return r=o?r.finally(Wt):r}finally{n&&Lt()}}(p={subscr:u,signal:i.signal,requery:d,querier:t,trans:null}),Promise.resolve(g).then((function(t){n=!0,e=t,a||p.signal.aborted||(s={},function(t){for(var e in t)if(c(t,e))return;return 1}(l=u)||h||(He(je,f),h=!0),Xt((function(){return!a&&r.next&&r.next(t)})))}),(function(t){n=!1,["DatabaseClosedError","AbortError"].includes(null==t?void 0:t.name)||a||Xt((function(){a||r.error&&r.error(t)}))})))};return setTimeout(d,0),u}));return r.hasValue=function(){return n},r.getValue=function(){return e},r}var sr=er;function lr(t){var e=cr;try{cr=!0,He.storagemutated.fire(t),On(t,!0)}finally{cr=e}}h(sr,e(e({},Y),{delete:function(t){return new sr(t,{addons:[]}).delete()},exists:function(t){return new sr(t,{addons:[]}).open().then((function(t){return t.close(),!0})).catch("NoSuchDatabaseError",(function(){return!1}))},getDatabaseNames:function(t){try{return n=(e=sr.dependencies).indexedDB,e=e.IDBKeyRange,(vn(n)?Promise.resolve(n.databases()).then((function(t){return t.map((function(t){return t.name})).filter((function(t){return t!==ne}))})):mn(n,e).toCollection().primaryKeys()).then(t)}catch(t){return Jt(new K.MissingAPI)}var e,n},defineClass:function(){return function(t){s(this,t)}},ignoreTransaction:function(t){return yt.trans?Yt(yt.transless,t):t()},vip:yn,async:function(t){return function(){try{var e=Nn(t.apply(this,arguments));return e&&"function"==typeof e.then?e:Ct.resolve(e)}catch(e){return Jt(e)}}},spawn:function(t,e,n){try{var r=Nn(t.apply(n,e||[]));return r&&"function"==typeof r.then?r:Ct.resolve(r)}catch(t){return Jt(t)}},currentTransaction:{get:function(){return yt.trans||null}},waitFor:function(t,e){return e=Ct.resolve("function"==typeof t?sr.ignoreTransaction(t):t).timeout(e||6e4),yt.trans?yt.trans.waitFor(e):e},Promise:Ct,debug:{get:function(){return it},set:function(t){ot(t)}},derive:p,extend:s,props:h,override:y,Events:pe,on:He,liveQuery:ar,extendObservabilitySet:An,getByKeyPath:w,setByKeyPath:C,delByKeyPath:function(t,e){"string"==typeof e?C(t,e,void 0):"length"in e&&[].map.call(e,(function(e){C(t,e,void 0)}))},shallowClone:k,deepClone:E,getObjectDiff:jn,cmp:ue,asap:x,minKey:-1/0,addons:[],connections:ee,errnames:q,dependencies:rr,cache:En,semVer:"4.0.11",version:"4.0.11".split(".").map((function(t){return parseInt(t)})).reduce((function(t,e,n){return t+e/Math.pow(10,2*n)}))})),sr.maxKey=$e(sr.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(He(je,(function(t){cr||(t=new CustomEvent(ze,{detail:t}),cr=!0,dispatchEvent(t),cr=!1)})),addEventListener(ze,(function(t){t=t.detail,cr||lr(t)})));var ur,cr=!1,hr=function(){};return"undefined"!=typeof BroadcastChannel&&((hr=function(){(ur=new BroadcastChannel(ze)).onmessage=function(t){return t.data&&lr(t.data)}})(),"function"==typeof ur.unref&&ur.unref(),He(je,(function(t){cr||ur.postMessage(t)}))),"undefined"!=typeof addEventListener&&(addEventListener("pagehide",(function(t){if(!er.disableBfCache&&t.persisted){it&&console.debug("Dexie: handling persisted pagehide"),null!=ur&&ur.close();for(var e=0,n=ee;e<n.length;e++)n[e].close({disableAutoOpen:!1})}})),addEventListener("pageshow",(function(t){!er.disableBfCache&&t.persisted&&(it&&console.debug("Dexie: handling persisted pageshow"),hr(),lr({all:new xn(-1/0,[[]])}))}))),Ct.rejectionMapper=function(t,e){return!t||t instanceof z||t instanceof TypeError||t instanceof SyntaxError||!t.name||!$[t.name]?t:(e=new $[t.name](e||t.message,t),"stack"in t&&f(e,"stack",{get:function(){return this.inner.stack}}),e)},ot(it),e(er,Object.freeze({__proto__:null,Dexie:er,liveQuery:ar,Entity:le,cmp:ue,PropModification:ke,replacePrefix:function(t,e){return new ke({replacePrefix:[t,e]})},add:function(t){return new ke({add:t})},remove:function(t){return new ke({remove:t})},default:er,RangeSet:xn,mergeRanges:Cn,rangesOverlap:kn}),{default:er}),er}()},8023:(t,e,n)=>{!function(t){"use strict";var e,n,r=t.Pos;function i(t){var e=t.flags;return null!=e?e:(t.ignoreCase?"i":"")+(t.global?"g":"")+(t.multiline?"m":"")}function o(t,e){for(var n=i(t),r=n,o=0;o<e.length;o++)-1==r.indexOf(e.charAt(o))&&(r+=e.charAt(o));return n==r?t:new RegExp(t.source,r)}function a(t){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(t.source)}function s(t,e,n){e=o(e,"g");for(var i=n.line,a=n.ch,s=t.lastLine();i<=s;i++,a=0){e.lastIndex=a;var l=t.getLine(i),u=e.exec(l);if(u)return{from:r(i,u.index),to:r(i,u.index+u[0].length),match:u}}}function l(t,e,n){if(!a(e))return s(t,e,n);e=o(e,"gm");for(var i,l=1,u=n.line,c=t.lastLine();u<=c;){for(var h=0;h<l&&!(u>c);h++){var d=t.getLine(u++);i=null==i?d:i+"\n"+d}l*=2,e.lastIndex=n.ch;var f=e.exec(i);if(f){var p=i.slice(0,f.index).split("\n"),g=f[0].split("\n"),m=n.line+p.length-1,v=p[p.length-1].length;return{from:r(m,v),to:r(m+g.length-1,1==g.length?v+g[0].length:g[g.length-1].length),match:f}}}}function u(t,e,n){for(var r,i=0;i<=t.length;){e.lastIndex=i;var o=e.exec(t);if(!o)break;var a=o.index+o[0].length;if(a>t.length-n)break;(!r||a>r.index+r[0].length)&&(r=o),i=o.index+1}return r}function c(t,e,n){e=o(e,"g");for(var i=n.line,a=n.ch,s=t.firstLine();i>=s;i--,a=-1){var l=t.getLine(i),c=u(l,e,a<0?0:l.length-a);if(c)return{from:r(i,c.index),to:r(i,c.index+c[0].length),match:c}}}function h(t,e,n){if(!a(e))return c(t,e,n);e=o(e,"gm");for(var i,s=1,l=t.getLine(n.line).length-n.ch,h=n.line,d=t.firstLine();h>=d;){for(var f=0;f<s&&h>=d;f++){var p=t.getLine(h--);i=null==i?p:p+"\n"+i}s*=2;var g=u(i,e,l);if(g){var m=i.slice(0,g.index).split("\n"),v=g[0].split("\n"),y=h+m.length,b=m[m.length-1].length;return{from:r(y,b),to:r(y+v.length-1,1==v.length?b+v[0].length:v[v.length-1].length),match:g}}}}function d(t,e,n,r){if(t.length==e.length)return n;for(var i=0,o=n+Math.max(0,t.length-e.length);;){if(i==o)return i;var a=i+o>>1,s=r(t.slice(0,a)).length;if(s==n)return a;s>n?o=a:i=a+1}}function f(t,i,o,a){if(!i.length)return null;var s=a?e:n,l=s(i).split(/\r|\n\r?/);t:for(var u=o.line,c=o.ch,h=t.lastLine()+1-l.length;u<=h;u++,c=0){var f=t.getLine(u).slice(c),p=s(f);if(1==l.length){var g=p.indexOf(l[0]);if(-1==g)continue t;return o=d(f,p,g,s)+c,{from:r(u,d(f,p,g,s)+c),to:r(u,d(f,p,g+l[0].length,s)+c)}}var m=p.length-l[0].length;if(p.slice(m)==l[0]){for(var v=1;v<l.length-1;v++)if(s(t.getLine(u+v))!=l[v])continue t;var y=t.getLine(u+l.length-1),b=s(y),x=l[l.length-1];if(b.slice(0,x.length)==x)return{from:r(u,d(f,p,m,s)+c),to:r(u+l.length-1,d(y,b,x.length,s))}}}}function p(t,i,o,a){if(!i.length)return null;var s=a?e:n,l=s(i).split(/\r|\n\r?/);t:for(var u=o.line,c=o.ch,h=t.firstLine()-1+l.length;u>=h;u--,c=-1){var f=t.getLine(u);c>-1&&(f=f.slice(0,c));var p=s(f);if(1==l.length){var g=p.lastIndexOf(l[0]);if(-1==g)continue t;return{from:r(u,d(f,p,g,s)),to:r(u,d(f,p,g+l[0].length,s))}}var m=l[l.length-1];if(p.slice(0,m.length)==m){var v=1;for(o=u-l.length+1;v<l.length-1;v++)if(s(t.getLine(o+v))!=l[v])continue t;var y=t.getLine(u+1-l.length),b=s(y);if(b.slice(b.length-l[0].length)==l[0])return{from:r(u+1-l.length,d(y,b,y.length-l[0].length,s)),to:r(u,d(f,p,m.length,s))}}}}function g(t,e,n,i){var a;this.atOccurrence=!1,this.afterEmptyMatch=!1,this.doc=t,n=n?t.clipPos(n):r(0,0),this.pos={from:n,to:n},"object"==typeof i?a=i.caseFold:(a=i,i=null),"string"==typeof e?(null==a&&(a=!1),this.matches=function(n,r){return(n?p:f)(t,e,r,a)}):(e=o(e,"gm"),i&&!1===i.multiline?this.matches=function(n,r){return(n?c:s)(t,e,r)}:this.matches=function(n,r){return(n?h:l)(t,e,r)})}String.prototype.normalize?(e=function(t){return t.normalize("NFD").toLowerCase()},n=function(t){return t.normalize("NFD")}):(e=function(t){return t.toLowerCase()},n=function(t){return t}),g.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){var n=this.doc.clipPos(e?this.pos.from:this.pos.to);if(this.afterEmptyMatch&&this.atOccurrence&&(n=r(n.line,n.ch),e?(n.ch--,n.ch<0&&(n.line--,n.ch=(this.doc.getLine(n.line)||"").length)):(n.ch++,n.ch>(this.doc.getLine(n.line)||"").length&&(n.ch=0,n.line++)),0!=t.cmpPos(n,this.doc.clipPos(n))))return this.atOccurrence=!1;var i=this.matches(e,n);if(this.afterEmptyMatch=i&&0==t.cmpPos(i.from,i.to),i)return this.pos=i,this.atOccurrence=!0,this.pos.match||!0;var o=r(e?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:o,to:o},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(e,n){if(this.atOccurrence){var i=t.splitLines(e);this.doc.replaceRange(i,this.pos.from,this.pos.to,n),this.pos.to=r(this.pos.from.line+i.length-1,i[i.length-1].length+(1==i.length?this.pos.from.ch:0))}}},t.defineExtension("getSearchCursor",(function(t,e,n){return new g(this.doc,t,e,n)})),t.defineDocExtension("getSearchCursor",(function(t,e,n){return new g(this,t,e,n)})),t.defineExtension("selectMatches",(function(e,n){for(var r=[],i=this.getSearchCursor(e,this.getCursor("from"),n);i.findNext()&&!(t.cmpPos(i.to(),this.getCursor("to"))>0);)r.push({anchor:i.from(),head:i.to()});r.length&&this.setSelections(r,0)}))}(n(1719))},8131:(t,e,n)=>{var r,i;r=[n,e,n(8676),n(5298),n(321)],i=function(t,e,n,r,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;var o=function(){function t(){this.componentsFactory=null,this.busFactory=null,this.storageFactory=null,this.conf={}}return t.prototype.getComponentsFactory=function(){return null===this.componentsFactory&&(this.componentsFactory=new n.Factory,this.componentsFactory.setAppFactory(this),this.componentsFactory.init(this.conf.components)),this.componentsFactory},t.prototype.init=function(t){void 0===t&&(t={}),this.conf={components:{factory:null},storage:{factory:null},bus:{factory:null}},this.objectReplaceRecursive(this.conf,t)},t.prototype.getBusFactory=function(){return null===this.busFactory&&(this.busFactory=this.conf.bus.factory||new r.Factory,this.busFactory.setAppFactory(this),this.busFactory.init(this.conf.bus)),this.busFactory},t.prototype.getStorageFactory=function(){return null===this.storageFactory&&(this.storageFactory=this.conf.storage.factory||new i.Factory,this.storageFactory.setAppFactory(this),this.storageFactory.init(this.conf.storage)),this.storageFactory},t.prototype.objectReplaceRecursive=function(t,e){for(var n in e)t[n]&&"object"==typeof t[n]&&"Object"==t[n].constructor.name&&this.objectReplaceRecursive(t[n],e[n]),t[n]&&"object"==typeof t[n]&&"Object"==t[n].constructor.name||(t[n]=e[n])},t}();e.Factory=o}.apply(e,r),void 0===i||(t.exports=i)},8160:function(t,e,n){var r,i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{l(r.next(t))}catch(t){o(t)}}function s(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},a=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},s=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))};r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NodeModal=void 0;var r=n(890),l=function(){function t(){}return t.prototype.setAppCommands=function(t){this.appCommands=t},t.prototype.setAppBus=function(t){this.appBus=t},t.prototype.setTagsLinks=function(t){this.tagsLinks=t},t.prototype.init=function(t){var e=this;this.container=t,this.closeBtn=this.container.querySelector(".js-close-btn"),this.modalContent=this.container.querySelector(".js-modal-content"),this.previewContainer=this.container.querySelector(".js-preview-container"),this.previewInput=this.container.querySelector(".js-preview-input"),this.tagsContainer=this.container.querySelector(".js-tags-container"),this.addTagBtn=this.container.querySelector(".js-add-tag-btn"),this.editBtn=this.container.querySelector(".js-edit-button"),this.saveBtn=this.container.querySelector(".js-save-button"),this.cryptBtn=this.container.querySelector(".js-crypt-button"),this.closeBtn.onclick=function(){e.container.classList.toggle("hide",!0)};var n=this.container.querySelector(".js-content-input");this.easyMDE=new r({element:n}),this.easyMDE.togglePreview(),this.editBtn.onclick=function(){e.easyMDE.togglePreview(),e.previewContainer.classList.toggle("hide",!1)},this.saveBtn.onclick=function(){e.data.is_crypted?alert("Необходимо зашифровать"):(e.data.tags=e.data.tags||[],e.appCommands.updateNote({id:e.data.id,preview:e.previewInput.value,content:e.easyMDE.value(),tags:e.data.tags,isCrypted:e.data.is_crypted}).then((function(t){if(t.success){var n=Object.values(t.note.tags).map((function(t){return t.id}));e.data.tags=Object.values(e.data.tags).filter((function(t){return!t.id||n.includes(t.id)})),e.appBus.onNodeUpdate({id:e.data.id,preview:e.previewInput.value,content:e.easyMDE.value(),tags:t.note.tags}),e.easyMDE.togglePreview(),e.easyMDE.preview||e.easyMDE.togglePreview(),e.previewContainer.classList.toggle("hide",!0),e.appBus.updateNavigatonPanel()}})))},this.cryptBtn.onclick=function(){var t="";e.prevPassword&&(t="prev");var n=prompt("Password",t);if(n){"prev"==n&&(n=e.prevPassword),e.prevPassword=n,e.data.is_crypted=!0;var r=e.easyMDE.value();e.encryptWithPassword(r,n).then((function(t){var n=t.ciphertext,r=t.iv;return e.data.content=r+":"+n,e.data.tags=e.data.tags||[],e.appCommands.updateNote({id:e.data.id,preview:e.previewInput.value,content:e.easyMDE.value(),tags:e.data.tags,isCrypted:e.data.is_crypted})})).then((function(t){if(t.success){var n=Object.values(t.note.tags).map((function(t){return t.id}));e.data.tags=Object.values(e.data.tags||{}).filter((function(t){return!t.id||n.includes(t.id)})),e.appBus.onNodeUpdate({id:e.data.id,preview:e.previewInput.value,content:e.data.content,tags:t.note.tags,is_crypted:e.data.is_crypted}),e.easyMDE.togglePreview(),e.easyMDE.preview||e.easyMDE.togglePreview(),e.previewContainer.classList.toggle("hide",!0),e.container.classList.toggle("hide",!0),e.appBus.updateNavigatonPanel()}})),e.appBus.updateNavigatonPanel()}},this.container.onclick=function(){e.container.classList.toggle("hide",!0)},this.modalContent.onclick=function(t){t.stopPropagation()},this.addTagBtn.onclick=function(t){e.tagsModal.show(e.tagsLinks).then((function(t){e.appendTag(t.id,t.title),e.data.tags||(e.data.tags=[]),e.data.tags.push(t)}))};var i=this.container.querySelector(".js-tags-modal");this.tagsModal=this.createTagsModal(),this.tagsModal.init(i)},t.prototype.deriveKeyFromPassword=function(t){return i(this,void 0,void 0,(function(){var e,n,r,i;return o(this,(function(o){switch(o.label){case 0:return e=new TextEncoder,n=e.encode(t),r=e.encode("123456789"),[4,crypto.subtle.importKey("raw",n,{name:"PBKDF2"},!1,["deriveKey"])];case 1:return i=o.sent(),[4,crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},i,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])];case 2:return[2,o.sent()]}}))}))},t.prototype.uint8ArrayToBase64=function(t){return btoa(String.fromCharCode.apply(String,s([],a(t),!1)))},t.prototype.base64ToUint8Array=function(t){return new Uint8Array(atob(t).split("").map((function(t){return t.charCodeAt(0)})))},t.prototype.encryptWithPassword=function(t,e){return i(this,void 0,void 0,(function(){var n,r,i,a,s;return o(this,(function(o){switch(o.label){case 0:return n=new TextEncoder,r=crypto.getRandomValues(new Uint8Array(12)),[4,this.deriveKeyFromPassword(e)];case 1:return i=o.sent(),a=n.encode(t),[4,crypto.subtle.encrypt({name:"AES-GCM",iv:r},i,a)];case 2:return s=o.sent(),[2,{iv:this.uint8ArrayToBase64(r),ciphertext:this.uint8ArrayToBase64(new Uint8Array(s))}]}}))}))},t.prototype.decryptWithPassword=function(t,e,n){return i(this,void 0,void 0,(function(){var r,i,a,s,l;return o(this,(function(o){switch(o.label){case 0:return r=new TextDecoder,i=this.base64ToUint8Array(t),a=this.base64ToUint8Array(e),[4,this.deriveKeyFromPassword(n)];case 1:return s=o.sent(),[4,crypto.subtle.decrypt({name:"AES-GCM",iv:i},s,a)];case 2:return l=o.sent(),[2,r.decode(l)]}}))}))},t.prototype.show=function(t){var e=this;if(console.log(this.tagsLinks),this.data=t,this.container.classList.toggle("hide",!1),this.previewInput.value=t.preview,t.is_crypted){var n="";this.prevPassword&&(n="prev");var r=prompt("Password",n);"prev"==r&&(r=this.prevPassword),this.prevPassword=r;var i=t.content.split(":");this.decryptWithPassword(i[0],i[1],r).then((function(t){e.easyMDE.value(t)})).catch((function(t){e.easyMDE.value(""),e.container.classList.toggle("hide",!0),alert("Неверный пароль")}))}else this.easyMDE.value(t.content||"");for(var o in this.easyMDE.togglePreview(),this.easyMDE.preview||this.easyMDE.togglePreview(),this.tagsContainer.innerHTML="",t.tags)this.appendTag(t.tags[o].id,t.tags[o].title)},t.prototype.appendTag=function(t,e){var n=this,r=document.createElement("div");r.innerHTML='<div style="background: #ccc; border-radius: 3px; padding: 3px 10px; cursor: pointer;"></div>';var i=r.firstChild;i.innerText=e,i.setAttribute("data-id",t),this.tagsContainer.append(i),i.onclick=function(t){if(t.ctrlKey){i.remove();var e=i.innerText;for(var r in n.data.tags)n.data.tags[r].title==e&&delete n.data.tags[r]}else{var o=i.getAttribute("data-id");n.appBus.highligtForTag(o),n.container.classList.toggle("hide",!0)}}},t.prototype.createTagsModal=function(){return new u},t}();e.NodeModal=l;var u=function(){function t(){}return t.prototype.init=function(t){var e=this;this.container=t,this.modalContent=this.container.querySelector(".js-tags-modal-content"),this.input=this.container.querySelector(".js-tag-input"),this.autocompleteList=this.container.querySelector(".js-autocomplete-list"),this.inputBtn=this.container.querySelector(".js-input-btn"),this.input.oninput=function(){var t=e.input.value;t?e.showAutocompleteList(t):e.autocompleteList.classList.toggle("hide",!0)},this.container.onclick=function(){e.container.classList.toggle("hide",!0)},this.modalContent.onclick=function(t){t.stopPropagation()},this.inputBtn.onclick=function(){e.resolve(e.selectedTag),e.container.classList.toggle("hide",!0)}},t.prototype.show=function(t){var e=this;return this.tagsLinks=t,this.input.value="",this.container.classList.toggle("hide",!1),this.autocompleteList.classList.toggle("hide",!0),new Promise((function(t,n){e.reject=n,e.resolve=t}))},t.prototype.showAutocompleteList=function(t){var e=this;this.autocompleteList.classList.toggle("hide",!1),this.autocompleteList.innerHTML="";var n=function(n){if(r.tagsLinks[n].title.startsWith(t)){var i=r.createItem(r.tagsLinks[n]);r.autocompleteList.append(i),i.onclick=function(){e.selectedTag=e.tagsLinks[n],e.input.value=e.tagsLinks[n].title,e.showSubitems(e.tagsLinks[n].links)}}},r=this;for(var i in this.tagsLinks)n(i)},t.prototype.showSubitems=function(t){var e=this;for(var n in this.autocompleteList.innerHTML="",t){var r=t[n].to,i=function(t){if(o.tagsLinks[t].id==r){if(o.selectedTag&&o.selectedTag.id==o.tagsLinks[t].id)return"continue";var n=o.createItem(o.tagsLinks[t]);o.autocompleteList.append(n),n.onclick=function(){e.selectedTag=e.tagsLinks[t],e.input.value=e.tagsLinks[t].title,e.showSubitems(e.tagsLinks[t].links)}}},o=this;for(var a in this.tagsLinks)i(a)}},t.prototype.createItem=function(t){var e=document.createElement("div");e.innerHTML='<li class="autocomplete-item"></li>';var n=e.firstChild;return n.innerText=t.title,n.setAttribute("id",t.id),n},t}()}.apply(e,[n,e]),void 0===r||(t.exports=r)},8176:(t,e,n)=>{!function(t){"use strict";function e(t){var e=t.getWrapperElement();t.state.fullScreenRestore={scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset,width:e.style.width,height:e.style.height},e.style.width="",e.style.height="auto",e.className+=" CodeMirror-fullscreen",document.documentElement.style.overflow="hidden",t.refresh()}function n(t){var e=t.getWrapperElement();e.className=e.className.replace(/\s*CodeMirror-fullscreen\b/,""),document.documentElement.style.overflow="";var n=t.state.fullScreenRestore;e.style.width=n.width,e.style.height=n.height,window.scrollTo(n.scrollLeft,n.scrollTop),t.refresh()}t.defineOption("fullScreen",!1,(function(r,i,o){o==t.Init&&(o=!1),!o!=!i&&(i?e(r):n(r))}))}(n(1719))},8549:(t,e,n)=>{var r;!function(){"use strict";(r=function(t,e,n,r){r=r||{},this.dictionary=null,this.rules={},this.dictionaryTable={},this.compoundRules=[],this.compoundRuleCodes={},this.replacementTable=[],this.flags=r.flags||{},this.memoized={},this.loaded=!1;var i,o,a,s,l,u=this;if(t)if(u.dictionary=t,e&&n)p();else if("undefined"!=typeof window&&(window.chrome||window.browser)){var c=window.chrome&&window.chrome.runtime?window.chrome.runtime:browser.runtime;i=r.dictionaryPath?r.dictionaryPath:"typo/dictionaries",e||h(c.getURL(i+"/"+t+"/"+t+".aff"),d),n||h(c.getURL(i+"/"+t+"/"+t+".dic"),f)}else i=r.dictionaryPath?r.dictionaryPath:"//dictionaries",e||h(i+"/"+t+"/"+t+".aff",d),n||h(i+"/"+t+"/"+t+".dic",f);function h(t,e){var n=u._readFile(t,null,null==r?void 0:r.asyncLoad);(null==r?void 0:r.asyncLoad)?n.then((function(t){e(t)})):e(n)}function d(t){e=t,n&&p()}function f(t){n=t,e&&p()}function p(){for(u.rules=u._parseAFF(e),u.compoundRuleCodes={},o=0,s=u.compoundRules.length;o<s;o++){var t=u.compoundRules[o];for(a=0,l=t.length;a<l;a++)u.compoundRuleCodes[t[a]]=[]}for(o in"ONLYINCOMPOUND"in u.flags&&(u.compoundRuleCodes[u.flags.ONLYINCOMPOUND]=[]),u.dictionaryTable=u._parseDIC(n),u.compoundRuleCodes)0===u.compoundRuleCodes[o].length&&delete u.compoundRuleCodes[o];for(o=0,s=u.compoundRules.length;o<s;o++){var i=u.compoundRules[o],c="";for(a=0,l=i.length;a<l;a++){var h=i[a];h in u.compoundRuleCodes?c+="("+u.compoundRuleCodes[h].join("|")+")":c+=h}u.compoundRules[o]=new RegExp("^"+c+"$","i")}u.loaded=!0,(null==r?void 0:r.asyncLoad)&&(null==r?void 0:r.loadedCallback)&&r.loadedCallback(u)}return this}).prototype={load:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);return this},_readFile:function(t,e,r){var i;if(e=e||"utf8","undefined"!=typeof XMLHttpRequest){var o=new XMLHttpRequest;if(o.open("GET",t,!!r),null===(i=o.overrideMimeType)||void 0===i||i.call(o,"text/plain; charset="+e),r){var a=new Promise((function(t,e){o.onload=function(){200===o.status?t(o.responseText):e(o.statusText)},o.onerror=function(){e(o.statusText)}}));return o.send(null),a}return o.send(null),o.responseText}var s=n(8986);try{if(s.existsSync(t))return s.readFileSync(t,e);console.log("Path "+t+" does not exist.")}catch(t){console.log(t)}return""},_parseAFF:function(t){var e,n,r,i,o,a,s,l={},u=t.split(/\r?\n/);for(i=0,a=u.length;i<a;i++)if(e=(e=this._removeAffixComments(u[i])).trim()){var c=e.split(/\s+/),h=c[0];if("PFX"===h||"SFX"===h){var d=c[1],f=c[2],p=[];for(o=i+1,s=i+1+(n=parseInt(c[3],10));o<s;o++){var g=(r=u[o].split(/\s+/))[2],m=r[3].split("/"),v=m[0];"0"===v&&(v="");var y=this.parseRuleCodes(m[1]),b=r[4],x={add:v};y.length>0&&(x.continuationClasses=y),"."!==b&&(x.match="SFX"===h?new RegExp(b+"$"):new RegExp("^"+b)),"0"!=g&&(x.remove="SFX"===h?new RegExp(g+"$"):g),p.push(x)}l[d]={type:h,combineable:"Y"===f,entries:p},i+=n}else if("COMPOUNDRULE"===h){for(o=i+1,s=i+1+(n=parseInt(c[1],10));o<s;o++)r=(e=u[o]).split(/\s+/),this.compoundRules.push(r[1]);i+=n}else"REP"===h?3===(r=e.split(/\s+/)).length&&this.replacementTable.push([r[1],r[2]]):this.flags[h]=c[1]}return l},_removeAffixComments:function(t){return t.match(/^\s*#/)?"":t},_parseDIC:function(t){var e=(t=this._removeDicComments(t)).split(/\r?\n/),n={};function r(t,e){n.hasOwnProperty(t)||(n[t]=null),e.length>0&&(null===n[t]&&(n[t]=[]),n[t].push(e))}for(var i=1,o=e.length;i<o;i++){var a=e[i];if(a){var s=a.split("/",2),l=s[0];if(s.length>1){var u=this.parseRuleCodes(s[1]);"NEEDAFFIX"in this.flags&&-1!==u.indexOf(this.flags.NEEDAFFIX)||r(l,u);for(var c=0,h=u.length;c<h;c++){var d=u[c],f=this.rules[d];if(f)for(var p=this._applyRule(l,f),g=0,m=p.length;g<m;g++){var v=p[g];if(r(v,[]),f.combineable)for(var y=c+1;y<h;y++){var b=u[y],x=this.rules[b];if(x&&x.combineable&&f.type!=x.type)for(var w=this._applyRule(v,x),C=0,k=w.length;C<k;C++){r(w[C],[])}}}d in this.compoundRuleCodes&&this.compoundRuleCodes[d].push(l)}}else r(l.trim(),[])}}return n},_removeDicComments:function(t){return t=t.replace(/^\t.*$/gm,"")},parseRuleCodes:function(t){if(t){if("FLAG"in this.flags){if("long"===this.flags.FLAG){for(var e=[],n=0,r=t.length;n<r;n+=2)e.push(t.substr(n,2));return e}return"num"===this.flags.FLAG?t.split(","):"UTF-8"===this.flags.FLAG?Array.from(t):t.split("")}return t.split("")}return[]},_applyRule:function(t,e){for(var n=e.entries,r=[],i=0,o=n.length;i<o;i++){var a=n[i];if(!a.match||t.match(a.match)){var s=t;if(a.remove&&(s=s.replace(a.remove,"")),"SFX"===e.type?s+=a.add:s=a.add+s,r.push(s),"continuationClasses"in a)for(var l=0,u=a.continuationClasses.length;l<u;l++){var c=this.rules[a.continuationClasses[l]];c&&(r=r.concat(this._applyRule(s,c)))}}}return r},check:function(t){if(!this.loaded)throw"Dictionary not loaded.";if(!t)return!1;var e=t.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(this.checkExact(e))return!0;if(e.toUpperCase()===e){var n=e[0]+e.substring(1).toLowerCase();if(this.hasFlag(n,"KEEPCASE"))return!1;if(this.checkExact(n))return!0;if(this.checkExact(e.toLowerCase()))return!0}var r=e[0].toLowerCase()+e.substring(1);if(r!==e){if(this.hasFlag(r,"KEEPCASE"))return!1;if(this.checkExact(r))return!0}return!1},checkExact:function(t){if(!this.loaded)throw"Dictionary not loaded.";var e,n,r=this.dictionaryTable[t];if(void 0===r){if("COMPOUNDMIN"in this.flags&&t.length>=this.flags.COMPOUNDMIN)for(e=0,n=this.compoundRules.length;e<n;e++)if(t.match(this.compoundRules[e]))return!0}else{if(null===r)return!0;if("object"==typeof r)for(e=0,n=r.length;e<n;e++)if(!this.hasFlag(t,"ONLYINCOMPOUND",r[e]))return!0}return!1},hasFlag:function(t,e,n){if(!this.loaded)throw"Dictionary not loaded.";return!(!(e in this.flags)||(void 0===n&&(n=Array.prototype.concat.apply([],this.dictionaryTable[t])),!n||-1===n.indexOf(this.flags[e])))},alphabet:"",suggest:function(t,e){if(!this.loaded)throw"Dictionary not loaded.";if(e=e||5,this.memoized.hasOwnProperty(t)){var n=this.memoized[t].limit;if(e<=n||this.memoized[t].suggestions.length<n)return this.memoized[t].suggestions.slice(0,e)}if(this.check(t))return[];for(var r=0,i=this.replacementTable.length;r<i;r++){var o=this.replacementTable[r];if(-1!==t.indexOf(o[0])){var a=t.replace(o[0],o[1]);if(this.check(a))return[a]}}if(!this.alphabet){this.alphabet="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ","TRY"in this.flags&&(this.alphabet+=this.flags.TRY),"WORDCHARS"in this.flags&&(this.alphabet+=this.flags.WORDCHARS);var s=this.alphabet.split("");s.sort();var l={};for(r=0;r<s.length;r++)l[s[r]]=!0;for(var r in this.alphabet="",l)this.alphabet+=r}var u=this;function c(t,e){var n,r,i,o,a={},s=u.alphabet.length;for(var l in t)for(n=0,i=l.length+1;n<i;n++){var c=[l.substring(0,n),l.substring(n)];if(c[1]&&(o=c[0]+c[1].substring(1),e&&!u.check(o)||(o in a?a[o]+=1:a[o]=1)),c[1].length>1&&c[1][1]!==c[1][0]&&(o=c[0]+c[1][1]+c[1][0]+c[1].substring(2),e&&!u.check(o)||(o in a?a[o]+=1:a[o]=1)),c[1]){var h=c[1].substring(0,1).toUpperCase()===c[1].substring(0,1)?"uppercase":"lowercase";for(r=0;r<s;r++){var d=u.alphabet[r];"uppercase"===h&&(d=d.toUpperCase()),d!=c[1].substring(0,1)&&(o=c[0]+d+c[1].substring(1),e&&!u.check(o)||(o in a?a[o]+=1:a[o]=1))}}if(c[1])for(r=0;r<s;r++){h=c[0].substring(-1).toUpperCase()===c[0].substring(-1)&&c[1].substring(0,1).toUpperCase()===c[1].substring(0,1)?"uppercase":"lowercase",d=u.alphabet[r];"uppercase"===h&&(d=d.toUpperCase()),o=c[0]+d+c[1],e&&!u.check(o)||(o in a?a[o]+=1:a[o]=1)}}return a}return this.memoized[t]={suggestions:function(t){var n,r,i=c(((n={})[t]=!0,n)),o=c(i,!0);for(var a in i)u.check(a)&&(a in o?o[a]+=i[a]:o[a]=i[a]);var s=[];for(r in o)o.hasOwnProperty(r)&&s.push([r,o[r]]);s.sort((function(t,e){var n=t[1],r=e[1];return n<r?-1:n>r?1:e[0].localeCompare(t[0])})).reverse();var l=[],h="lowercase";t.toUpperCase()===t?h="uppercase":t.substr(0,1).toUpperCase()+t.substr(1).toLowerCase()===t&&(h="capitalized");var d=e;for(r=0;r<Math.min(d,s.length);r++)"uppercase"===h?s[r][0]=s[r][0].toUpperCase():"capitalized"===h&&(s[r][0]=s[r][0].substr(0,1).toUpperCase()+s[r][0].substr(1)),u.hasFlag(s[r][0],"NOSUGGEST")||-1!==l.indexOf(s[r][0])?d++:l.push(s[r][0]);return l}(t),limit:e},this.memoized[t].suggestions}}}(),t.exports=r},8676:(t,e,n)=>{var r,i;r=[n,e,n(4235),n(7806)],i=function(t,e,n,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;var i=function(){function t(){this.pane=null,this.conf={}}return t.prototype.init=function(t){void 0===t&&(t={}),this.conf={pane:null},this.appFactory.objectReplaceRecursive(this.conf,t)},t.prototype.setAppFactory=function(t){this.appFactory=t},t.prototype.getAppFactory=function(){return this.appFactory},t.prototype.getPane=function(){if(null===this.pane){this.pane=this.conf.pane;var t=this.appFactory.getBusFactory().getAppBus();this.pane.setAppBus(t);var e=this.appFactory.getStorageFactory().getStorage();this.pane.setStorage(e);var n=this.appFactory.getStorageFactory().getAbstractShapesFactory();this.pane.setShapesFactory(n);var r=this.createLinker();this.pane.setLinker(r)}return this.pane},t.prototype.createLinker=function(){var t=new n.Linker;return t.setLineCreator(this.createLine.bind(this)),t},t.prototype.createLine=function(){return new r.Line},t}();e.Factory=i}.apply(e,r),void 0===i||(t.exports=i)},8728:(t,e,n)=>{!function(t){"use strict";var e=/^(\s*)(>[> ]*|[*+-] \[[x ]\]\s|[*+-]\s|(\d+)([.)]))(\s*)/,n=/^(\s*)(>[> ]*|[*+-] \[[x ]\]|[*+-]|(\d+)[.)])(\s*)$/,r=/[*+-]\s/;function i(t,n){var r=n.line,i=0,o=0,a=e.exec(t.getLine(r)),s=a[1];do{var l=r+(i+=1),u=t.getLine(l),c=e.exec(u);if(c){var h=c[1],d=parseInt(a[3],10)+i-o,f=parseInt(c[3],10),p=f;if(s!==h||isNaN(f)){if(s.length>h.length)return;if(s.length<h.length&&1===i)return;o+=1}else d===f&&(p=f+1),d>f&&(p=d+1),t.replaceRange(u.replace(e,h+p+c[4]+c[5]),{line:l,ch:0},{line:l,ch:u.length})}}while(c)}t.commands.newlineAndIndentContinueMarkdownList=function(o){if(o.getOption("disableInput"))return t.Pass;for(var a=o.listSelections(),s=[],l=0;l<a.length;l++){var u=a[l].head,c=o.getStateAfter(u.line),h=t.innerMode(o.getMode(),c);if("markdown"!==h.mode.name&&"markdown"!==h.mode.helperType)return void o.execCommand("newlineAndIndent");var d=!1!==(c=h.state).list,f=0!==c.quote,p=o.getLine(u.line),g=e.exec(p),m=/^\s*$/.test(p.slice(0,u.ch));if(!a[l].empty()||!d&&!f||!g||m)return void o.execCommand("newlineAndIndent");if(n.test(p)){var v=f&&/>\s*$/.test(p),y=!/>\s*$/.test(p);(v||y)&&o.replaceRange("",{line:u.line,ch:0},{line:u.line,ch:u.ch+1}),s[l]="\n"}else{var b=g[1],x=g[5],w=!(r.test(g[2])||g[2].indexOf(">")>=0),C=w?parseInt(g[3],10)+1+g[4]:g[2].replace("x"," ");s[l]="\n"+b+C+x,w&&i(o,u)}}o.replaceSelections(s)}}(n(1719))},8986:()=>{},9180:(t,e,n)=>{var r,i;r=[n,e,n(7159)],i=function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractPane=void 0;var r=function(){function t(){this.timeout=null,this.width=600,this.height=600}return t.prototype.setAppBus=function(t){this.appBus=t},t.prototype.setStorage=function(t){this.storage=t},t.prototype.getStorage=function(){return this.storage},t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.getStage=function(){return this.stage},t.prototype.setShapesFactory=function(t){this.shapesFactory=t},t.prototype.setLinker=function(t){this.linker=t},t.prototype.getLinker=function(){return this.linker},t.prototype.init=function(t){var e=this;this.container=t,n.default.pixelRatio=1,this.stage=new n.default.Stage({container:this.container,width:this.width,height:this.height,draggable:!0});var r=this.container.clientWidth;this.stage.width(r),this.layer=new n.default.Layer,this.linesLayer=new n.default.Layer,this.linker.setLinesLayer(this.linesLayer),this.stage.add(this.linesLayer);var i=null,o=0,a=!1;n.default.hitOnDragEnabled=!0,this.stage.on("touchmove",(function(t){t.evt.preventDefault(),e.longPressTimeout&&(clearTimeout(e.longPressTimeout),e.longPressTimeout=null);var n=t.evt.touches[0],r=t.evt.touches[1];if(n&&!r&&!e.stage.isDragging()&&a&&(e.stage.startDrag(),a=!1),n&&r){e.stage.isDragging()&&(a=!0,e.stage.stopDrag());var s={x:n.clientX,y:n.clientY},l={x:r.clientX,y:r.clientY};if(!i)return void(i=e.getCenter(s,l));var u=e.getCenter(s,l),c=e.getDistance(s,l);o||(o=c);var h={x:(u.x-e.stage.x())/e.stage.scaleX(),y:(u.y-e.stage.y())/e.stage.scaleX()},d=e.stage.scaleX()*(c/o);e.stage.scaleX(d),e.stage.scaleY(d);var f=u.x-i.x,p=u.y-i.y,g={x:u.x-h.x*d+f,y:u.y-h.y*d+p};e.stage.position(g),o=c,i=u,e.timeout&&clearTimeout(e.timeout),e.timeout=setTimeout((function(){e.update({scale:d,x:g.x,y:g.y}),e.timeout=null}),500)}})),this.stage.on("touchend",(function(){o=0,i=null,e.longPressTimeout&&(clearTimeout(e.longPressTimeout),e.longPressTimeout=null)})),this.stage.on("touchstart",(function(t){var n=e.stage.getPointerPosition(),r={x:(n.x-e.stage.x())/e.stage.scaleX(),y:(n.y-e.stage.y())/e.stage.scaleY()};e.storage.getByCoords(r)&&(e.longPressTimeout=setTimeout((function(){navigator.vibrate(200),e.longTouch(r,t)}),800))})),this.stage.on("wheel",(function(t){t.evt.preventDefault();var n=e.stage.scaleX()?e.stage.scaleX():1,r=e.stage.getPointerPosition(),i=(r.x-e.stage.x())/n,o=(r.y-e.stage.y())/n,a=t.evt.deltaY>0?1:-1;t.evt.ctrlKey&&(a=-a);var s=a>0?1.05*n:n/1.05;e.stage.scale({x:s,y:s});var l={x:r.x-i*s,y:r.y-o*s};e.stage.position(l),clearTimeout(e.timeout),e.timeout=setTimeout((function(){e.update({scale:s,x:l.x,y:l.y})}),500)}));var s="click";this.isMobile()&&(s="tap"),this.stage.on(s,(function(t){var n=e.stage.getPointerPosition();console.log(e.stage.x()),console.log(e.stage.scaleX());var r={x:(n.x-e.stage.x())/e.stage.scaleX(),y:(n.y-e.stage.y())/e.stage.scaleY()};e.click(r,t),e.longPressTimeout&&(clearTimeout(e.longPressTimeout),e.longPressTimeout=null)})),this.stage.on("dragend",(function(t){var n=e.stage.position();e.update({x:n.x,y:n.y})})),this.stage.add(this.layer)},t.prototype.isMobile=function(){var t,e=!1;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(t.substr(0,4)))&&(e=!0),e},t.prototype.getDistance=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},t.prototype.getCenter=function(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}},t.prototype.resizeStage=function(t){var e=this.container.clientWidth;this.stage.width(e);var n=t||600;this.stage.height(n)},t.prototype.debounce=function(t,e,n){var r;return function(){var i=this,o=arguments,a=n&&!r;clearTimeout(r),r=null,r=setTimeout((function(){r=null,n||t.apply(i,o)}),e),a&&t.apply(i,o)}.bind(this)},t.prototype.getLinesLayer=function(){return this.linesLayer},t.prototype.getLayer=function(){return this.layer},t.prototype.loadSettings=function(t){0==t.scale&&(t.scale=1.05),this.stage.scale({x:t.scale,y:t.scale}),this.stage.x(t.x),this.stage.y(t.y),this.currentBoard=t},t.prototype.clear=function(){this.stage.clear(),this.layer.clear(),this.layer.children=[],this.linesLayer.clear(),this.linesLayer.children=[],this.storage.clear(),this.linker.clear()},t}();e.AbstractPane=r}.apply(e,r),void 0===i||(t.exports=i)},9328:(t,e,n)=>{!function(t){function e(t){t.state.placeholder&&(t.state.placeholder.parentNode.removeChild(t.state.placeholder),t.state.placeholder=null)}function n(t){e(t);var n=t.state.placeholder=document.createElement("pre");n.style.cssText="height: 0; overflow: visible",n.style.direction=t.getOption("direction"),n.className="CodeMirror-placeholder CodeMirror-line-like";var r=t.getOption("placeholder");"string"==typeof r&&(r=document.createTextNode(r)),n.appendChild(r),t.display.lineSpace.insertBefore(n,t.display.lineSpace.firstChild)}function r(t){setTimeout((function(){var r=!1;if(1==t.lineCount()){var i=t.getInputField();r="TEXTAREA"==i.nodeName?!t.getLine(0).length:!/[^\u200b]/.test(i.querySelector(".CodeMirror-line").textContent)}r?n(t):e(t)}),20)}function i(t){a(t)&&n(t)}function o(t){var r=t.getWrapperElement(),i=a(t);r.className=r.className.replace(" CodeMirror-empty","")+(i?" CodeMirror-empty":""),i?n(t):e(t)}function a(t){return 1===t.lineCount()&&""===t.getLine(0)}t.defineOption("placeholder","",(function(n,a,s){var l=s&&s!=t.Init;if(a&&!l)n.on("blur",i),n.on("change",o),n.on("swapDoc",o),t.on(n.getInputField(),"compositionupdate",n.state.placeholderCompose=function(){r(n)}),o(n);else if(!a&&l){n.off("blur",i),n.off("change",o),n.off("swapDoc",o),t.off(n.getInputField(),"compositionupdate",n.state.placeholderCompose),e(n);var u=n.getWrapperElement();u.className=u.className.replace(" CodeMirror-empty","")}a&&!n.hasFocus()&&i(n)}))}(n(1719))},9764:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>I,exportDB:()=>A,importDB:()=>O,importInto:()=>B,peakImportFile:()=>M});var r=n(4143),i=function(){return i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},i.apply(this,arguments)};function o(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{l(r.next(t))}catch(t){o(t)}}function s(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((r=r.apply(t,e||[])).next())}))}function a(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function s(t){return[t.schema.primKey].concat(t.schema.indexes).map((function(t){return t.src})).join(",")}function l(t,e){return new Promise((function(n,r){var i=new FileReader;i.onabort=function(t){return r(new Error("file read aborted"))},i.onerror=function(t){return r(t.target.error)},i.onload=function(t){return n(t.target.result)},"binary"===e?i.readAsArrayBuffer(t):i.readAsText(t)}))}function u(t,e){if("undefined"==typeof FileReaderSync)throw new Error("FileReaderSync missing. Reading blobs synchronously requires code to run from within a web worker. Use TSON.encapsulateAsync() to do it from the main thread.");var n=new FileReaderSync;return"binary"===e?n.readAsArrayBuffer(t):n.readAsText(t)}var c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function h(t,e){return t(e={exports:{}},e.exports),e.exports}for(var d=h((function(t,e){t.exports=function(){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e,n,r,i,o,a){try{var s=t[o](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(r,i)}function n(t){return function(){var n=this,r=arguments;return new Promise((function(i,o){var a=t.apply(n,r);function s(t){e(a,i,o,s,l,"next",t)}function l(t){e(a,i,o,s,l,"throw",t)}s(void 0)}))}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function u(t,e){return d(t)||p(t,e)||m()}function c(t){return h(t)||f(t)||g()}function h(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}function d(t){if(Array.isArray(t))return t}function f(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function p(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}function g(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function m(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var v=function t(e){r(this,t),this.p=new Promise(e)};v.__typeson__type__="TypesonPromise","undefined"!=typeof Symbol&&(v.prototype[Symbol.toStringTag]="TypesonPromise"),v.prototype.then=function(t,e){var n=this;return new v((function(r,i){n.p.then((function(e){r(t?t(e):e)})).catch((function(t){return e?e(t):Promise.reject(t)})).then(r,i)}))},v.prototype.catch=function(t){return this.then(null,t)},v.resolve=function(t){return new v((function(e){e(t)}))},v.reject=function(t){return new v((function(e,n){n(t)}))},["all","race"].forEach((function(t){v[t]=function(e){return new v((function(n,r){Promise[t](e.map((function(t){return t&&t.constructor&&"TypesonPromise"===t.constructor.__typeson__type__?t.p:t}))).then(n,r)}))}}));var y={}.toString,b={}.hasOwnProperty,x=Object.getPrototypeOf,w=b.toString;function C(t,e){return A(t)&&"function"==typeof t.then&&(!e||"function"==typeof t.catch)}function k(t){return y.call(t).slice(8,-1)}function S(e,n){if(!e||"object"!==t(e))return!1;var r=x(e);if(!r)return null===n;var i=b.call(r,"constructor")&&r.constructor;return"function"!=typeof i?null===n:n===i||null!==n&&w.call(i)===w.call(n)||"function"==typeof n&&"string"==typeof i.__typeson__type__&&i.__typeson__type__===n.__typeson__type__}function _(t){return!(!t||"Object"!==k(t))&&(!x(t)||S(t,Object))}function D(t){if(!t||"Object"!==k(t))return!1;var e=x(t);return!e||S(t,Object)||D(e)}function A(e){return e&&"object"===t(e)}function T(t){return t.replace(/~/g,"~0").replace(/\./g,"~1")}function E(t){return t.replace(/~1/g,".").replace(/~0/g,"~")}function F(t,e){if(""===e)return t;var n=e.indexOf(".");if(n>-1){var r=t[E(e.slice(0,n))];return void 0===r?void 0:F(r,e.slice(n+1))}return t[E(e)]}function L(t,e,n){if(""===e)return n;var r=e.indexOf(".");return r>-1?L(t[E(e.slice(0,r))],e.slice(r+1),n):(t[E(e)]=n,t)}function P(e){return null===e?"null":Array.isArray(e)?"array":t(e)}var O=Object.keys,M=Array.isArray,B={}.hasOwnProperty,N=["type","replaced","iterateIn","iterateUnsetNumeric"];function I(t,e){if(""===t.keypath)return-1;var n=t.keypath.match(/\./g)||0,r=e.keypath.match(/\./g)||0;return n&&(n=n.length),r&&(r=r.length),n>r?-1:n<r?1:t.keypath<e.keypath?-1:t.keypath>e.keypath}var R=function(){function e(t){r(this,e),this.options=t,this.plainObjectReplacers=[],this.nonplainObjectReplacers=[],this.revivers={},this.types={}}return o(e,[{key:"stringify",value:function(t,e,n,r){r=l({},this.options,{},r,{stringification:!0});var i=this.encapsulate(t,null,r);return M(i)?JSON.stringify(i[0],e,n):i.then((function(t){return JSON.stringify(t,e,n)}))}},{key:"stringifySync",value:function(t,e,n,r){return this.stringify(t,e,n,l({throwOnBadSyncType:!0},r,{sync:!0}))}},{key:"stringifyAsync",value:function(t,e,n,r){return this.stringify(t,e,n,l({throwOnBadSyncType:!0},r,{sync:!1}))}},{key:"parse",value:function(t,e,n){return n=l({},this.options,{},n,{parse:!0}),this.revive(JSON.parse(t,e),n)}},{key:"parseSync",value:function(t,e,n){return this.parse(t,e,l({throwOnBadSyncType:!0},n,{sync:!0}))}},{key:"parseAsync",value:function(t,e,n){return this.parse(t,e,l({throwOnBadSyncType:!0},n,{sync:!1}))}},{key:"specialTypeNames",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.returnTypeNames=!0,this.encapsulate(t,e,n)}},{key:"rootTypeName",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.iterateNone=!0,this.encapsulate(t,e,n)}},{key:"encapsulate",value:function(r,i,o){var a=(o=l({sync:!0},this.options,{},o)).sync,s=this,h={},d=[],f=[],p=[],g=!("cyclic"in o)||o.cyclic,m=o.encapsulateObserver,y=k("",r,g,i||{},p);function b(t){var n=Object.values(h);if(o.iterateNone)return n.length?n[0]:e.getJSONType(t);if(n.length){if(o.returnTypeNames)return c(new Set(n));t&&_(t)&&!B.call(t,"$types")?t.$types=h:t={$:t,$types:{$:h}}}else A(t)&&B.call(t,"$types")&&(t={$:t,$types:!0});return!o.returnTypeNames&&t}function x(t,e){return w.apply(this,arguments)}function w(){return w=n(regeneratorRuntime.mark((function t(e,r){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(r.map((function(t){return t[1].p})));case 2:return i=t.sent,t.next=5,Promise.all(i.map(function(){var t=n(regeneratorRuntime.mark((function t(n){var i,o,a,s,l,c,h,d,f,p,g,m,y,b;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=[],o=r.splice(0,1),a=u(o,1),s=a[0],l=u(s,7),c=l[0],h=l[2],d=l[3],f=l[4],p=l[5],g=l[6],m=k(c,n,h,d,i,!0,g),y=S(m,v),!c||!y){t.next=11;break}return t.next=8,m.p;case 8:return b=t.sent,f[p]=b,t.abrupt("return",x(e,i));case 11:return c?f[p]=m:e=y?m.p:m,t.abrupt("return",x(e,i));case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 5:return t.abrupt("return",e);case 6:case"end":return t.stop()}}),t)}))),w.apply(this,arguments)}function C(t,e,n){Object.assign(t,e);var r=N.map((function(e){var n=t[e];return delete t[e],n}));n(),N.forEach((function(e,n){t[e]=r[n]}))}function k(n,r,i,a,l,u,c){var p,g={},y=t(r),b=m?function(t){var o=c||a.type||e.getJSONType(r);m(Object.assign(t||g,{keypath:n,value:r,cyclic:i,stateObj:a,promisesData:l,resolvingTypesonPromise:u,awaitingTypesonPromise:S(r,v)},{type:o}))}:null;if(["string","boolean","number","undefined"].includes(y))return void 0===r||"number"===y&&(isNaN(r)||r===-1/0||r===1/0)?(p=a.replaced?r:D(n,r,a,l,!1,u,b))!==r&&(g={replaced:p}):p=r,b&&b(),p;if(null===r)return b&&b(),r;if(i&&!a.iterateIn&&!a.iterateUnsetNumeric&&r&&"object"===t(r)){var x=d.indexOf(r);if(!(x<0))return h[n]="#",b&&b({cyclicKeypath:f[x]}),"#"+f[x];!0===i&&(d.push(r),f.push(n))}var w,A=_(r),E=M(r),F=(A||E)&&(!s.plainObjectReplacers.length||a.replaced)||a.iterateIn?r:D(n,r,a,l,A||E,null,b);if(F!==r?(p=F,g={replaced:F}):""===n&&S(r,v)?(l.push([n,r,i,a,void 0,void 0,a.type]),p=r):E&&"object"!==a.iterateIn||"array"===a.iterateIn?(w=new Array(r.length),g={clone:w}):(["function","symbol"].includes(t(r))||"toJSON"in r||S(r,v)||S(r,Promise)||S(r,ArrayBuffer))&&!A&&"object"!==a.iterateIn?p=r:(w={},a.addLength&&(w.length=r.length),g={clone:w}),b&&b(),o.iterateNone)return w||p;if(!w)return p;if(a.iterateIn){var L=function(t){var e={ownKeys:B.call(r,t)};C(a,e,(function(){var e=n+(n?".":"")+T(t),o=k(e,r[t],Boolean(i),a,l,u);S(o,v)?l.push([e,o,Boolean(i),a,w,t,a.type]):void 0!==o&&(w[t]=o)}))};for(var P in r)L(P);b&&b({endIterateIn:!0,end:!0})}else O(r).forEach((function(t){var e=n+(n?".":"")+T(t);C(a,{ownKeys:!0},(function(){var n=k(e,r[t],Boolean(i),a,l,u);S(n,v)?l.push([e,n,Boolean(i),a,w,t,a.type]):void 0!==n&&(w[t]=n)}))})),b&&b({endIterateOwn:!0,end:!0});if(a.iterateUnsetNumeric){for(var N=r.length,I=function(t){if(!(t in r)){var e=n+(n?".":"")+t;C(a,{ownKeys:!1},(function(){var n=k(e,void 0,Boolean(i),a,l,u);S(n,v)?l.push([e,n,Boolean(i),a,w,t,a.type]):void 0!==n&&(w[t]=n)}))}},R=0;R<N;R++)I(R);b&&b({endIterateUnsetNumeric:!0,end:!0})}return w}function D(t,e,n,r,i,o,l){for(var u=i?s.plainObjectReplacers:s.nonplainObjectReplacers,c=u.length;c--;){var d=u[c];if(d.test(e,n)){var f=d.type;if(s.revivers[f]){var p=h[t];h[t]=p?[f].concat(p):f}return Object.assign(n,{type:f,replaced:!0}),!a&&d.replaceAsync||d.replace?(l&&l({replacing:!0}),k(t,d[a||!d.replaceAsync?"replace":"replaceAsync"](e,n),g&&"readonly",n,r,o,f)):(l&&l({typeDetected:!0}),k(t,e,g&&"readonly",n,r,o,f))}}return e}return p.length?a&&o.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():Promise.resolve(x(y,p)).then(b):!a&&o.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():o.stringification&&a?[b(y)]:a?b(y):Promise.resolve(b(y))}},{key:"encapsulateSync",value:function(t,e,n){return this.encapsulate(t,e,l({throwOnBadSyncType:!0},n,{sync:!0}))}},{key:"encapsulateAsync",value:function(t,e,n){return this.encapsulate(t,e,l({throwOnBadSyncType:!0},n,{sync:!1}))}},{key:"revive",value:function(t,e){var n=t&&t.$types;if(!n)return t;if(!0===n)return t.$;var r=(e=l({sync:!0},this.options,{},e)).sync,i=[],o={},a=!0;n.$&&_(n.$)&&(t=t.$,n=n.$,a=!1);var s=this;function c(t,e){var n=u(s.revivers[t]||[],1)[0];if(!n)throw new Error("Unregistered type: "+t);return r&&!("revive"in n)?e:n[r&&n.revive?"revive":!r&&n.reviveAsync?"reviveAsync":"revive"](e,o)}function h(){var e=[];if(Object.entries(n).forEach((function(t){var r=u(t,2),i=r[0],o=r[1];"#"!==o&&[].concat(o).forEach((function(t){u(s.revivers[t]||[null,{}],2)[1].plain&&(e.push({keypath:i,type:t}),delete n[i])}))})),e.length)return e.sort(I).reduce((function e(n,r){var i=r.keypath,o=r.type;if(C(n))return n.then((function(t){return e(t,{keypath:i,type:o})}));var a=F(t,i);if(S(a=c(o,a),v))return a.then((function(e){var n=L(t,i,e);n===e&&(t=n)}));var s=L(t,i,a);s===a&&(t=s)}),void 0)}var d=[];function f(t,e,r,o,s){if(!a||"$types"!==t){var l=n[t],h=M(e);if(h||_(e)){var p=h?new Array(e.length):{};for(O(e).forEach((function(n){var i=f(t+(t?".":"")+T(n),e[n],r||p,p,n),o=function(t){return S(t,j)?p[n]=void 0:void 0!==t&&(p[n]=t),t};S(i,v)?d.push(i.then((function(t){return o(t)}))):o(i)})),e=p;i.length;){var g=u(i[0],4),m=g[0],y=g[1],b=g[2],x=g[3],w=F(m,y);if(void 0===w)break;b[x]=w,i.splice(0,1)}}if(!l)return e;if("#"===l){var C=F(r,e.slice(1));return void 0===C&&i.push([r,e.slice(1),o,s]),C}return[].concat(l).reduce((function t(e,n){return S(e,v)?e.then((function(e){return t(e,n)})):c(n,e)}),e)}}function p(t){return S(t,j)?void 0:t}var g,m=h();return S(m,v)?g=m.then((function(){return t})):(g=f("",t,null),d.length&&(g=v.resolve(g).then((function(t){return v.all([t].concat(d))})).then((function(t){return u(t,1)[0]})))),C(g)?r&&e.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():S(g,v)?g.p.then(p):g:!r&&e.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():r?p(g):Promise.resolve(p(g))}},{key:"reviveSync",value:function(t,e){return this.revive(t,l({throwOnBadSyncType:!0},e,{sync:!0}))}},{key:"reviveAsync",value:function(t,e){return this.revive(t,l({throwOnBadSyncType:!0},e,{sync:!1}))}},{key:"register",value:function(t,n){return n=n||{},[].concat(t).forEach((function t(r){var i=this;if(M(r))return r.map((function(e){return t.call(i,e)}));r&&O(r).forEach((function(t){if("#"===t)throw new TypeError("# cannot be used as a type name as it is reserved for cyclic objects");if(e.JSON_TYPES.includes(t))throw new TypeError("Plain JSON object types are reserved as type names");var i=r[t],o=i&&i.testPlainObjects?this.plainObjectReplacers:this.nonplainObjectReplacers,a=o.filter((function(e){return e.type===t}));if(a.length&&(o.splice(o.indexOf(a[0]),1),delete this.revivers[t],delete this.types[t]),"function"==typeof i){var s=i;i={test:function(t){return t&&t.constructor===s},replace:function(t){return l({},t)},revive:function(t){return Object.assign(Object.create(s.prototype),t)}}}else if(M(i)){var c=u(i,3);i={test:c[0],replace:c[1],revive:c[2]}}if(i&&i.test){var h={type:t,test:i.test.bind(i)};i.replace&&(h.replace=i.replace.bind(i)),i.replaceAsync&&(h.replaceAsync=i.replaceAsync.bind(i));var d="number"==typeof n.fallback?n.fallback:n.fallback?0:1/0;if(i.testPlainObjects?this.plainObjectReplacers.splice(d,0,h):this.nonplainObjectReplacers.splice(d,0,h),i.revive||i.reviveAsync){var f={};i.revive&&(f.revive=i.revive.bind(i)),i.reviveAsync&&(f.reviveAsync=i.reviveAsync.bind(i)),this.revivers[t]=[f,{plain:i.testPlainObjects}]}this.types[t]=i}}),this)}),this),this}}]),e}(),j=function t(){r(this,t)};return j.__typeson__type__="TypesonUndefined",R.Undefined=j,R.Promise=v,R.isThenable=C,R.toStringTag=k,R.hasConstructorOf=S,R.isObject=A,R.isPlainObject=_,R.isUserObject=D,R.escapeKeyPathComponent=T,R.unescapeKeyPathComponent=E,R.getByKeyPath=F,R.getJSONType=P,R.JSON_TYPES=["null","boolean","number","string","array","object"],R}()})),f=h((function(t,e){t.exports=function(){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function o(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function h(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){h(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function p(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(t,e)||m(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t){return function(t){if(Array.isArray(t))return v(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||m(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(t,e){if(t){if("string"==typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(t,e):void 0}}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var y=function t(e){l(this,t),this.p=new Promise(e)};y.__typeson__type__="TypesonPromise","undefined"!=typeof Symbol&&(y.prototype[Symbol.toStringTag]="TypesonPromise"),y.prototype.then=function(t,e){var n=this;return new y((function(r,i){n.p.then((function(e){r(t?t(e):e)})).catch((function(t){return e?e(t):Promise.reject(t)})).then(r,i)}))},y.prototype.catch=function(t){return this.then(null,t)},y.resolve=function(t){return new y((function(e){e(t)}))},y.reject=function(t){return new y((function(e,n){n(t)}))},["all","race"].forEach((function(t){y[t]=function(e){return new y((function(n,r){Promise[t](e.map((function(t){return t&&t.constructor&&"TypesonPromise"===t.constructor.__typeson__type__?t.p:t}))).then(n,r)}))}}));var b={}.toString,x={}.hasOwnProperty,w=Object.getPrototypeOf,C=x.toString;function k(t,e){return A(t)&&"function"==typeof t.then&&(!e||"function"==typeof t.catch)}function S(t){return b.call(t).slice(8,-1)}function _(t,e){if(!t||"object"!==s(t))return!1;var n=w(t);if(!n)return null===e;var r=x.call(n,"constructor")&&n.constructor;return"function"!=typeof r?null===e:e===r||null!==e&&C.call(r)===C.call(e)||"function"==typeof e&&"string"==typeof r.__typeson__type__&&r.__typeson__type__===e.__typeson__type__}function D(t){return!(!t||"Object"!==S(t))&&(!w(t)||_(t,Object))}function A(t){return t&&"object"===s(t)}function T(t){return t.replace(/~/g,"~0").replace(/\./g,"~1")}function E(t){return t.replace(/~1/g,".").replace(/~0/g,"~")}function F(t,e){if(""===e)return t;var n=e.indexOf(".");if(n>-1){var r=t[E(e.slice(0,n))];return void 0===r?void 0:F(r,e.slice(n+1))}return t[E(e)]}function L(t,e,n){if(""===e)return n;var r=e.indexOf(".");return r>-1?L(t[E(e.slice(0,r))],e.slice(r+1),n):(t[E(e)]=n,t)}function P(t,e,n){return n?e?e(t):t:(t&&t.then||(t=Promise.resolve(t)),e?t.then(e):t)}var O=Object.keys,M=Array.isArray,B={}.hasOwnProperty,N=["type","replaced","iterateIn","iterateUnsetNumeric"];function I(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return Promise.resolve(t.apply(this,e))}catch(t){return Promise.reject(t)}}}function R(t,e){if(""===t.keypath)return-1;var n=t.keypath.match(/\./g)||0,r=e.keypath.match(/\./g)||0;return n&&(n=n.length),r&&(r=r.length),n>r?-1:n<r?1:t.keypath<e.keypath?-1:t.keypath>e.keypath}var j=function(){function t(e){l(this,t),this.options=e,this.plainObjectReplacers=[],this.nonplainObjectReplacers=[],this.revivers={},this.types={}}return function(t,e,n){e&&u(t.prototype,e),n&&u(t,n)}(t,[{key:"stringify",value:function(t,e,n,r){r=f(f(f({},this.options),r),{},{stringification:!0});var i=this.encapsulate(t,null,r);return M(i)?JSON.stringify(i[0],e,n):i.then((function(t){return JSON.stringify(t,e,n)}))}},{key:"stringifySync",value:function(t,e,n,r){return this.stringify(t,e,n,f(f({throwOnBadSyncType:!0},r),{},{sync:!0}))}},{key:"stringifyAsync",value:function(t,e,n,r){return this.stringify(t,e,n,f(f({throwOnBadSyncType:!0},r),{},{sync:!1}))}},{key:"parse",value:function(t,e,n){return n=f(f(f({},this.options),n),{},{parse:!0}),this.revive(JSON.parse(t,e),n)}},{key:"parseSync",value:function(t,e,n){return this.parse(t,e,f(f({throwOnBadSyncType:!0},n),{},{sync:!0}))}},{key:"parseAsync",value:function(t,e,n){return this.parse(t,e,f(f({throwOnBadSyncType:!0},n),{},{sync:!1}))}},{key:"specialTypeNames",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.returnTypeNames=!0,this.encapsulate(t,e,n)}},{key:"rootTypeName",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.iterateNone=!0,this.encapsulate(t,e,n)}},{key:"encapsulate",value:function(e,n,r){var i=I((function(t,e){return P(Promise.all(e.map((function(t){return t[1].p}))),(function(n){return P(Promise.all(n.map(I((function(n){var r=!1,o=[],a=p(e.splice(0,1),1),s=p(a[0],7),l=s[0],u=s[2],c=s[3],h=s[4],d=s[5],f=s[6],g=w(l,n,u,c,o,!0,f),m=_(g,y);return function(t,e){var n=t();return n&&n.then?n.then(e):e(n)}((function(){if(l&&m)return P(g.p,(function(e){return h[d]=e,r=!0,i(t,o)}))}),(function(e){return r?e:(l?h[d]=g:t=m?g.p:g,i(t,o))}))})))),(function(){return t}))}))})),o=(r=f(f({sync:!0},this.options),r)).sync,a=this,l={},u=[],c=[],h=[],d=!("cyclic"in r)||r.cyclic,m=r.encapsulateObserver,v=w("",e,d,n||{},h);function b(e){var n=Object.values(l);if(r.iterateNone)return n.length?n[0]:t.getJSONType(e);if(n.length){if(r.returnTypeNames)return g(new Set(n));e&&D(e)&&!B.call(e,"$types")?e.$types=l:e={$:e,$types:{$:l}}}else A(e)&&B.call(e,"$types")&&(e={$:e,$types:!0});return!r.returnTypeNames&&e}function x(t,e,n){Object.assign(t,e);var r=N.map((function(e){var n=t[e];return delete t[e],n}));n(),N.forEach((function(e,n){t[e]=r[n]}))}function w(e,n,i,o,h,d,f){var p,g={},v=s(n),b=m?function(r){var a=f||o.type||t.getJSONType(n);m(Object.assign(r||g,{keypath:e,value:n,cyclic:i,stateObj:o,promisesData:h,resolvingTypesonPromise:d,awaitingTypesonPromise:_(n,y)},{type:a}))}:null;if(["string","boolean","number","undefined"].includes(v))return void 0===n||Number.isNaN(n)||n===Number.NEGATIVE_INFINITY||n===Number.POSITIVE_INFINITY?(p=o.replaced?n:C(e,n,o,h,!1,d,b))!==n&&(g={replaced:p}):p=n,b&&b(),p;if(null===n)return b&&b(),n;if(i&&!o.iterateIn&&!o.iterateUnsetNumeric&&n&&"object"===s(n)){var k=u.indexOf(n);if(!(k<0))return l[e]="#",b&&b({cyclicKeypath:c[k]}),"#"+c[k];!0===i&&(u.push(n),c.push(e))}var S,A=D(n),E=M(n),F=(A||E)&&(!a.plainObjectReplacers.length||o.replaced)||o.iterateIn?n:C(e,n,o,h,A||E,null,b);if(F!==n?(p=F,g={replaced:F}):""===e&&_(n,y)?(h.push([e,n,i,o,void 0,void 0,o.type]),p=n):E&&"object"!==o.iterateIn||"array"===o.iterateIn?(S=new Array(n.length),g={clone:S}):(["function","symbol"].includes(s(n))||"toJSON"in n||_(n,y)||_(n,Promise)||_(n,ArrayBuffer))&&!A&&"object"!==o.iterateIn?p=n:(S={},o.addLength&&(S.length=n.length),g={clone:S}),b&&b(),r.iterateNone)return S||p;if(!S)return p;if(o.iterateIn){var L=function(t){var r={ownKeys:B.call(n,t)};x(o,r,(function(){var r=e+(e?".":"")+T(t),a=w(r,n[t],Boolean(i),o,h,d);_(a,y)?h.push([r,a,Boolean(i),o,S,t,o.type]):void 0!==a&&(S[t]=a)}))};for(var P in n)L(P);b&&b({endIterateIn:!0,end:!0})}else O(n).forEach((function(t){var r=e+(e?".":"")+T(t);x(o,{ownKeys:!0},(function(){var e=w(r,n[t],Boolean(i),o,h,d);_(e,y)?h.push([r,e,Boolean(i),o,S,t,o.type]):void 0!==e&&(S[t]=e)}))})),b&&b({endIterateOwn:!0,end:!0});if(o.iterateUnsetNumeric){for(var N=n.length,I=function(t){if(!(t in n)){var r=e+(e?".":"")+t;x(o,{ownKeys:!1},(function(){var e=w(r,void 0,Boolean(i),o,h,d);_(e,y)?h.push([r,e,Boolean(i),o,S,t,o.type]):void 0!==e&&(S[t]=e)}))}},R=0;R<N;R++)I(R);b&&b({endIterateUnsetNumeric:!0,end:!0})}return S}function C(t,e,n,r,i,s,u){for(var c=i?a.plainObjectReplacers:a.nonplainObjectReplacers,h=c.length;h--;){var f=c[h];if(f.test(e,n)){var p=f.type;if(a.revivers[p]){var g=l[t];l[t]=g?[p].concat(g):p}return Object.assign(n,{type:p,replaced:!0}),!o&&f.replaceAsync||f.replace?(u&&u({replacing:!0}),w(t,f[o||!f.replaceAsync?"replace":"replaceAsync"](e,n),d&&"readonly",n,r,s,p)):(u&&u({typeDetected:!0}),w(t,e,d&&"readonly",n,r,s,p))}}return e}return h.length?o&&r.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():Promise.resolve(i(v,h)).then(b):!o&&r.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():r.stringification&&o?[b(v)]:o?b(v):Promise.resolve(b(v))}},{key:"encapsulateSync",value:function(t,e,n){return this.encapsulate(t,e,f(f({throwOnBadSyncType:!0},n),{},{sync:!0}))}},{key:"encapsulateAsync",value:function(t,e,n){return this.encapsulate(t,e,f(f({throwOnBadSyncType:!0},n),{},{sync:!1}))}},{key:"revive",value:function(t,e){var n=t&&t.$types;if(!n)return t;if(!0===n)return t.$;var r=(e=f(f({sync:!0},this.options),e)).sync,i=[],o={},a=!0;n.$&&D(n.$)&&(t=t.$,n=n.$,a=!1);var s=this;function l(t,e){var n=p(s.revivers[t]||[],1)[0];if(!n)throw new Error("Unregistered type: "+t);return r&&!("revive"in n)?e:n[r&&n.revive?"revive":!r&&n.reviveAsync?"reviveAsync":"revive"](e,o)}var u=[];function c(t){return _(t,z)?void 0:t}var h,d=function(){var e=[];if(Object.entries(n).forEach((function(t){var r=p(t,2),i=r[0],o=r[1];"#"!==o&&[].concat(o).forEach((function(t){p(s.revivers[t]||[null,{}],2)[1].plain&&(e.push({keypath:i,type:t}),delete n[i])}))})),e.length)return e.sort(R).reduce((function e(n,r){var i=r.keypath,o=r.type;if(k(n))return n.then((function(t){return e(t,{keypath:i,type:o})}));var a=F(t,i);if(_(a=l(o,a),y))return a.then((function(e){var n=L(t,i,e);n===e&&(t=n)}));var s=L(t,i,a);s===a&&(t=s)}),void 0)}();return _(d,y)?h=d.then((function(){return t})):(h=function t(e,r,o,s,c){if(!a||"$types"!==e){var h=n[e],d=M(r);if(d||D(r)){var f=d?new Array(r.length):{};for(O(r).forEach((function(n){var i=t(e+(e?".":"")+T(n),r[n],o||f,f,n),a=function(t){return _(t,z)?f[n]=void 0:void 0!==t&&(f[n]=t),t};_(i,y)?u.push(i.then((function(t){return a(t)}))):a(i)})),r=f;i.length;){var g=p(i[0],4),m=g[0],v=g[1],b=g[2],x=g[3],w=F(m,v);if(void 0===w)break;b[x]=w,i.splice(0,1)}}if(!h)return r;if("#"===h){var C=F(o,r.slice(1));return void 0===C&&i.push([o,r.slice(1),s,c]),C}return[].concat(h).reduce((function t(e,n){return _(e,y)?e.then((function(e){return t(e,n)})):l(n,e)}),r)}}("",t,null),u.length&&(h=y.resolve(h).then((function(t){return y.all([t].concat(u))})).then((function(t){return p(t,1)[0]})))),k(h)?r&&e.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():_(h,y)?h.p.then(c):h:!r&&e.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():r?c(h):Promise.resolve(c(h))}},{key:"reviveSync",value:function(t,e){return this.revive(t,f(f({throwOnBadSyncType:!0},e),{},{sync:!0}))}},{key:"reviveAsync",value:function(t,e){return this.revive(t,f(f({throwOnBadSyncType:!0},e),{},{sync:!1}))}},{key:"register",value:function(e,n){return n=n||{},[].concat(e).forEach((function e(r){var i=this;if(M(r))return r.map((function(t){return e.call(i,t)}));r&&O(r).forEach((function(e){if("#"===e)throw new TypeError("# cannot be used as a type name as it is reserved for cyclic objects");if(t.JSON_TYPES.includes(e))throw new TypeError("Plain JSON object types are reserved as type names");var i=r[e],o=i&&i.testPlainObjects?this.plainObjectReplacers:this.nonplainObjectReplacers,a=o.filter((function(t){return t.type===e}));if(a.length&&(o.splice(o.indexOf(a[0]),1),delete this.revivers[e],delete this.types[e]),"function"==typeof i){var s=i;i={test:function(t){return t&&t.constructor===s},replace:function(t){return f({},t)},revive:function(t){return Object.assign(Object.create(s.prototype),t)}}}else if(M(i)){var l=p(i,3);i={test:l[0],replace:l[1],revive:l[2]}}if(i&&i.test){var u={type:e,test:i.test.bind(i)};i.replace&&(u.replace=i.replace.bind(i)),i.replaceAsync&&(u.replaceAsync=i.replaceAsync.bind(i));var c="number"==typeof n.fallback?n.fallback:n.fallback?0:Number.POSITIVE_INFINITY;if(i.testPlainObjects?this.plainObjectReplacers.splice(c,0,u):this.nonplainObjectReplacers.splice(c,0,u),i.revive||i.reviveAsync){var h={};i.revive&&(h.revive=i.revive.bind(i)),i.reviveAsync&&(h.reviveAsync=i.reviveAsync.bind(i)),this.revivers[e]=[h,{plain:i.testPlainObjects}]}this.types[e]=i}}),this)}),this),this}}]),t}(),z=function t(){l(this,t)};z.__typeson__type__="TypesonUndefined",j.Undefined=z,j.Promise=y,j.isThenable=k,j.toStringTag=S,j.hasConstructorOf=_,j.isObject=A,j.isPlainObject=D,j.isUserObject=function t(e){if(!e||"Object"!==S(e))return!1;var n=w(e);return!n||_(e,Object)||t(n)},j.escapeKeyPathComponent=T,j.unescapeKeyPathComponent=E,j.getByKeyPath=F,j.getJSONType=function(t){return null===t?"null":Array.isArray(t)?"array":s(t)},j.JSON_TYPES=["null","boolean","number","string","array","object"];for(var H={userObject:{test:function(t,e){return j.isUserObject(t)},replace:function(t){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},t)},revive:function(t){return t}}},G=[{arrayNonindexKeys:{testPlainObjects:!0,test:function(t,e){return!!Array.isArray(t)&&(Object.keys(t).some((function(t){return String(Number.parseInt(t))!==t}))&&(e.iterateIn="object",e.addLength=!0),!0)},replace:function(t,e){return e.iterateUnsetNumeric=!0,t},revive:function(t){if(Array.isArray(t))return t;var e=[];return Object.keys(t).forEach((function(n){var r=t[n];e[n]=r})),e}}},{sparseUndefined:{test:function(t,e){return void 0===t&&!1===e.ownKeys},replace:function(t){return 0},revive:function(t){}}}],W={undef:{test:function(t,e){return void 0===t&&(e.ownKeys||!("ownKeys"in e))},replace:function(t){return 0},revive:function(t){return new j.Undefined}}},q={StringObject:{test:function(e){return"String"===j.toStringTag(e)&&"object"===t(e)},replace:function(t){return String(t)},revive:function(t){return new String(t)}},BooleanObject:{test:function(e){return"Boolean"===j.toStringTag(e)&&"object"===t(e)},replace:function(t){return Boolean(t)},revive:function(t){return new Boolean(t)}},NumberObject:{test:function(e){return"Number"===j.toStringTag(e)&&"object"===t(e)},replace:function(t){return Number(t)},revive:function(t){return new Number(t)}}},U=[{nan:{test:function(t){return Number.isNaN(t)},replace:function(t){return"NaN"},revive:function(t){return Number.NaN}}},{infinity:{test:function(t){return t===Number.POSITIVE_INFINITY},replace:function(t){return"Infinity"},revive:function(t){return Number.POSITIVE_INFINITY}}},{negativeInfinity:{test:function(t){return t===Number.NEGATIVE_INFINITY},replace:function(t){return"-Infinity"},revive:function(t){return Number.NEGATIVE_INFINITY}}}],K={date:{test:function(t){return"Date"===j.toStringTag(t)},replace:function(t){var e=t.getTime();return Number.isNaN(e)?"NaN":e},revive:function(t){return"NaN"===t?new Date(Number.NaN):new Date(t)}}},$={regexp:{test:function(t){return"RegExp"===j.toStringTag(t)},replace:function(t){return{source:t.source,flags:(t.global?"g":"")+(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.sticky?"y":"")+(t.unicode?"u":"")}},revive:function(t){var e=t.source,n=t.flags;return new RegExp(e,n)}}},Y={map:{test:function(t){return"Map"===j.toStringTag(t)},replace:function(t){return o(t.entries())},revive:function(t){return new Map(t)}}},V={set:{test:function(t){return"Set"===j.toStringTag(t)},replace:function(t){return o(t.values())},revive:function(t){return new Set(t)}}},X="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",J=new Uint8Array(256),Q=0;Q<X.length;Q++)J[X.charCodeAt(Q)]=Q;var Z=function(t,e,n){null==n&&(n=t.byteLength);for(var r=new Uint8Array(t,e||0,n),i=r.length,o="",a=0;a<i;a+=3)o+=X[r[a]>>2],o+=X[(3&r[a])<<4|r[a+1]>>4],o+=X[(15&r[a+1])<<2|r[a+2]>>6],o+=X[63&r[a+2]];return i%3==2?o=o.slice(0,-1)+"=":i%3==1&&(o=o.slice(0,-2)+"=="),o},tt=function(t){var e,n,r,i,o=t.length,a=.75*t.length,s=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);for(var l=new ArrayBuffer(a),u=new Uint8Array(l),c=0;c<o;c+=4)e=J[t.charCodeAt(c)],n=J[t.charCodeAt(c+1)],r=J[t.charCodeAt(c+2)],i=J[t.charCodeAt(c+3)],u[s++]=e<<2|n>>4,u[s++]=(15&n)<<4|r>>2,u[s++]=(3&r)<<6|63&i;return l},et={arraybuffer:{test:function(t){return"ArrayBuffer"===j.toStringTag(t)},replace:function(t,e){e.buffers||(e.buffers=[]);var n=e.buffers.indexOf(t);return n>-1?{index:n}:(e.buffers.push(t),Z(t))},revive:function(e,n){if(n.buffers||(n.buffers=[]),"object"===t(e))return n.buffers[e.index];var r=tt(e);return n.buffers.push(r),r}}},nt="undefined"==typeof self?c:self,rt={};["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"].forEach((function(t){var e=t,n=nt[e];n&&(rt[t.toLowerCase()]={test:function(t){return j.toStringTag(t)===e},replace:function(t,e){var n=t.buffer,r=t.byteOffset,i=t.length;e.buffers||(e.buffers=[]);var o=e.buffers.indexOf(n);return o>-1?{index:o,byteOffset:r,length:i}:(e.buffers.push(n),{encoded:Z(n),byteOffset:r,length:i})},revive:function(t,e){e.buffers||(e.buffers=[]);var r,i=t.byteOffset,o=t.length,a=t.encoded,s=t.index;return"index"in t?r=e.buffers[s]:(r=tt(a),e.buffers.push(r)),new n(r,i,o)}})}));var it={dataview:{test:function(t){return"DataView"===j.toStringTag(t)},replace:function(t,e){var n=t.buffer,r=t.byteOffset,i=t.byteLength;e.buffers||(e.buffers=[]);var o=e.buffers.indexOf(n);return o>-1?{index:o,byteOffset:r,byteLength:i}:(e.buffers.push(n),{encoded:Z(n),byteOffset:r,byteLength:i})},revive:function(t,e){e.buffers||(e.buffers=[]);var n,r=t.byteOffset,i=t.byteLength,o=t.encoded,a=t.index;return"index"in t?n=e.buffers[a]:(n=tt(o),e.buffers.push(n)),new DataView(n,r,i)}}},ot={IntlCollator:{test:function(t){return j.hasConstructorOf(t,Intl.Collator)},replace:function(t){return t.resolvedOptions()},revive:function(t){return new Intl.Collator(t.locale,t)}},IntlDateTimeFormat:{test:function(t){return j.hasConstructorOf(t,Intl.DateTimeFormat)},replace:function(t){return t.resolvedOptions()},revive:function(t){return new Intl.DateTimeFormat(t.locale,t)}},IntlNumberFormat:{test:function(t){return j.hasConstructorOf(t,Intl.NumberFormat)},replace:function(t){return t.resolvedOptions()},revive:function(t){return new Intl.NumberFormat(t.locale,t)}}};function at(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e.buffer}var st={file:{test:function(t){return"File"===j.toStringTag(t)},replace:function(t){var e=new XMLHttpRequest;if(e.overrideMimeType("text/plain; charset=x-user-defined"),e.open("GET",URL.createObjectURL(t),!1),e.send(),200!==e.status&&0!==e.status)throw new Error("Bad File access: "+e.status);return{type:t.type,stringContents:e.responseText,name:t.name,lastModified:t.lastModified}},revive:function(t){var e=t.name,n=t.type,r=t.stringContents,i=t.lastModified;return new File([at(r)],e,{type:n,lastModified:i})},replaceAsync:function(t){return new j.Promise((function(e,n){var r=new FileReader;r.addEventListener("load",(function(){e({type:t.type,stringContents:r.result,name:t.name,lastModified:t.lastModified})})),r.addEventListener("error",(function(){n(r.error)})),r.readAsBinaryString(t)}))}}},lt={bigint:{test:function(t){return"bigint"==typeof t},replace:function(t){return String(t)},revive:function(t){return BigInt(t)}}},ut={bigintObject:{test:function(e){return"object"===t(e)&&j.hasConstructorOf(e,BigInt)},replace:function(t){return String(t)},revive:function(t){return new Object(BigInt(t))}}},ct={cryptokey:{test:function(t){return"CryptoKey"===j.toStringTag(t)&&t.extractable},replaceAsync:function(t){return new j.Promise((function(e,n){crypto.subtle.exportKey("jwk",t).catch((function(t){n(t)})).then((function(n){e({jwk:n,algorithm:t.algorithm,usages:t.usages})}))}))},revive:function(t){var e=t.jwk,n=t.algorithm,r=t.usages;return crypto.subtle.importKey("jwk",e,n,!0,r)}}};return[H,W,G,q,U,K,$,{imagedata:{test:function(t){return"ImageData"===j.toStringTag(t)},replace:function(t){return{array:o(t.data),width:t.width,height:t.height}},revive:function(t){return new ImageData(new Uint8ClampedArray(t.array),t.width,t.height)}}},{imagebitmap:{test:function(t){return"ImageBitmap"===j.toStringTag(t)||t&&t.dataset&&"ImageBitmap"===t.dataset.toStringTag},replace:function(t){var e=document.createElement("canvas");return e.getContext("2d").drawImage(t,0,0),e.toDataURL()},revive:function(t){var e=document.createElement("canvas"),n=e.getContext("2d"),r=document.createElement("img");return r.addEventListener("load",(function(){n.drawImage(r,0,0)})),r.src=t,e},reviveAsync:function(t){var e=document.createElement("canvas"),n=e.getContext("2d"),r=document.createElement("img");return r.addEventListener("load",(function(){n.drawImage(r,0,0)})),r.src=t,createImageBitmap(e)}}},st,{file:st.file,filelist:{test:function(t){return"FileList"===j.toStringTag(t)},replace:function(t){for(var e=[],n=0;n<t.length;n++)e[n]=t.item(n);return e},revive:function(t){return new(function(){function t(){e(this,t),this._files=arguments[0],this.length=this._files.length}return function(t,e,r){e&&n(t.prototype,e),r&&n(t,r)}(t,[{key:"item",value:function(t){return this._files[t]}},{key:Symbol.toStringTag,get:function(){return"FileList"}}]),t}())(t)}}},{blob:{test:function(t){return"Blob"===j.toStringTag(t)},replace:function(t){var e=new XMLHttpRequest;if(e.overrideMimeType("text/plain; charset=x-user-defined"),e.open("GET",URL.createObjectURL(t),!1),e.send(),200!==e.status&&0!==e.status)throw new Error("Bad Blob access: "+e.status);return{type:t.type,stringContents:e.responseText}},revive:function(t){var e=t.type,n=t.stringContents;return new Blob([at(n)],{type:e})},replaceAsync:function(t){return new j.Promise((function(e,n){var r=new FileReader;r.addEventListener("load",(function(){e({type:t.type,stringContents:r.result})})),r.addEventListener("error",(function(){n(r.error)})),r.readAsBinaryString(t)}))}}}].concat("function"==typeof Map?Y:[],"function"==typeof Set?V:[],"function"==typeof ArrayBuffer?et:[],"function"==typeof Uint8Array?rt:[],"function"==typeof DataView?it:[],"undefined"!=typeof Intl?ot:[],"undefined"!=typeof crypto?ct:[],"undefined"!=typeof BigInt?[lt,ut]:[])}()})),p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g=new Uint8Array(256),m=0;m<64;m++)g[p.codePointAt(m)]=m;var v=function(t,e,n){null==n&&(n=t.byteLength);for(var r=new Uint8Array(t,e||0,n),i=r.length,o="",a=0;a<i;a+=3)o+=p[r[a]>>2],o+=p[(3&r[a])<<4|r[a+1]>>4],o+=p[(15&r[a+1])<<2|r[a+2]>>6],o+=p[63&r[a+2]];return i%3==2?o=o.slice(0,-1)+"=":i%3==1&&(o=o.slice(0,-2)+"=="),o},y=function(t){var e,n,r,i,o=t.length,a=.75*t.length,s=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);for(var l=new ArrayBuffer(a),u=new Uint8Array(l),c=0;c<o;c+=4)e=g[t.codePointAt(c)],n=g[t.codePointAt(c+1)],r=g[t.codePointAt(c+2)],i=g[t.codePointAt(c+3)],u[s++]=e<<2|n>>4,u[s++]=(15&n)<<4|r>>2,u[s++]=(3&r)<<6|63&i;return l},b="undefined"==typeof self?global:self,x={};["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"].forEach((function(t){var e=t,n=b[e];n&&(x[t.toLowerCase()+"2"]={test:function(t){return d.toStringTag(t)===e},replace:function(t){return{buffer:t.buffer,byteOffset:t.byteOffset,length:t.length}},revive:function(t){var e=t.buffer,r=t.byteOffset,i=t.length;return new n(e,r,i)}})}));var w={arraybuffer:{test:function(t){return"ArrayBuffer"===d.toStringTag(t)},replace:function(t){return v(t,0,t.byteLength)},revive:function(t){return y(t)}}},C=(new d).register(f),k="FileReaderSync"in self,S=[],_=0;C.register([w,x,{blob2:{test:function(t){return"Blob"===d.toStringTag(t)},replace:function(t){if(t.isClosed)throw new Error("The Blob is closed");if(k){var e=u(t,"binary"),n=v(e,0,e.byteLength);return{type:t.type,data:n}}S.push(t);var r={type:t.type,data:{start:_,end:_+t.size}};return _+=t.size,r},finalize:function(t,e){t.data=v(e,0,e.byteLength)},revive:function(t){var e=t.type,n=t.data;return new Blob([y(n)],{type:e})}}}]),C.mustFinalize=function(){return S.length>0},C.finalize=function(t){return o(void 0,void 0,void 0,(function(){var e,n,i,o,s,u,c,h,d,f,p,g;return a(this,(function(a){switch(a.label){case 0:return[4,l(new Blob(S),"binary")];case 1:if(e=a.sent(),t)for(n=0,i=t;n<i.length;n++)if((o=i[n]).$types)for(c in s=o.$types,(u=s.$)&&(s=s.$),s)h=s[c],(d=C.types[h])&&d.finalize&&(f=r.default.getByKeyPath(o,u?"$."+c:c),d.finalize(f,e.slice(null===(p=f.data)||void 0===p?void 0:p.start,null===(g=f.data)||void 0===g?void 0:g.end)));return S=[],_=0,[2]}}))}))};var D=2e3;function A(t,e){return o(this,void 0,void 0,(function(){function n(){return o(this,void 0,void 0,(function(){var n,i,o,s,g,m,v,y,b,x;return a(this,(function(w){switch(w.label){case 0:return[4,Promise.all(l.map((function(t){return t.count()})))];case 1:(n=w.sent()).forEach((function(t,e){return c[e].rowCount=t})),p.totalRows=n.reduce((function(t,e){return t+e})),i=JSON.stringify(d,void 0,h?2:void 0),o=i.lastIndexOf("]"),s=i.substring(0,o),u.push(s),g=e.filter,m=e.transform,v=function(n){var i,o,s,l,c,d,v,y,b,x,w;return a(this,(function(k){switch(k.label){case 0:i=t.table(n),o=i.schema.primKey,s=!!o.keyPath,l=e.numRowsPerChunk||D,c=s?{tableName:i.name,inbound:!0,rows:[]}:{tableName:i.name,inbound:!1,rows:[]},d=JSON.stringify(c,void 0,h?2:void 0),h&&(d=d.split("\n").join("\n    ")),v=d.lastIndexOf("]"),u.push(d.substring(0,v)),y=null,b=0,x=!0,w=function(){var t,e,c,d,v,w,k,S,_;return a(this,(function(a){switch(a.label){case 0:return f&&r.default.ignoreTransaction((function(){return f(p)})),[4,(t=null==y?i.limit(l):i.where(":id").above(y).limit(l)).toArray()];case 1:return 0===(e=a.sent()).length?[2,"break"]:(null!=y&&b>0&&(u.push(","),h&&u.push("\n      ")),x=e.length===l,s?(c=g?e.filter((function(t){return g(n,t)})):e,d=m?c.map((function(t){return m(n,t).value})):c,v=d.map((function(t){return C.encapsulate(t)})),C.mustFinalize()?[4,r.default.waitFor(C.finalize(v))]:[3,3]):[3,4]);case 2:a.sent(),a.label=3;case 3:return _=JSON.stringify(v,void 0,h?2:void 0),h&&(_=_.split("\n").join("\n      ")),u.push(new Blob([_.substring(1,_.length-1)])),b=d.length,y=e.length>0?r.default.getByKeyPath(e[e.length-1],o.keyPath):null,[3,8];case 4:return[4,t.primaryKeys()];case 5:return w=a.sent(),k=w.map((function(t,n){return[t,e[n]]})),g&&(k=k.filter((function(t){var e=t[0],r=t[1];return g(n,r,e)}))),m&&(k=k.map((function(t){var e=t[0],r=t[1],i=m(n,r,e);return[i.key,i.value]}))),S=k.map((function(t){return C.encapsulate(t)})),C.mustFinalize()?[4,r.default.waitFor(C.finalize(S))]:[3,7];case 6:a.sent(),a.label=7;case 7:_=JSON.stringify(S,void 0,h?2:void 0),h&&(_=_.split("\n").join("\n      ")),u.push(new Blob([_.substring(1,_.length-1)])),b=k.length,y=w.length>0?w[w.length-1]:null,a.label=8;case 8:return p.completedRows+=e.length,[2]}}))},k.label=1;case 1:return x?[5,w()]:[3,3];case 2:return"break"===k.sent()?[3,3]:[3,1];case 3:return u.push(d.substr(v)),p.completedTables+=1,p.completedTables<p.totalTables&&u.push(","),[2]}}))},y=0,b=c,w.label=2;case 2:return y<b.length?(x=b[y].name,[5,v(x)]):[3,5];case 3:w.sent(),w.label=4;case 4:return y++,[3,2];case 5:return u.push(i.substr(o)),p.done=!0,f&&r.default.ignoreTransaction((function(){return f(p)})),[2]}}))}))}var i,l,u,c,h,d,f,p;return a(this,(function(r){switch(r.label){case 0:i=(e=e||{}).skipTables?e.skipTables:[],l=t.tables.filter((function(t){return!i.includes(t.name)})),u=[],c=l.map((function(t){return{name:t.name,schema:s(t),rowCount:0}})),h=e.prettyJson,d={formatName:"dexie",formatVersion:1,data:{databaseName:t.name,databaseVersion:t.verno,tables:c,data:[]}},f=e.progressCallback,p={done:!1,completedRows:0,completedTables:0,totalRows:NaN,totalTables:c.length},r.label=1;case 1:return r.trys.push([1,,6,7]),e.noTransaction?[4,n()]:[3,3];case 2:return r.sent(),[3,5];case 3:return[4,t.transaction("r",t.tables,n)];case 4:r.sent(),r.label=5;case 5:return[3,7];case 6:return C.finalize(),[7];case 7:return[2,new Blob(u,{type:"text/json"})]}}))}))}var T=1,E=function(){},F=h((function(t,e){!function(t){var e="object"==typeof process&&process.env?process.env:self;t.parser=function(t){return new R(t)},t.CParser=R,t.CStream=j,t.createStream=function(t){return new j(t)},t.MAX_BUFFER_LENGTH=10485760,t.DEBUG="debug"===e.CDEBUG,t.INFO="debug"===e.CDEBUG||"info"===e.CDEBUG,t.EVENTS=["value","string","key","openobject","closeobject","openarray","closearray","error","end","ready"];var n,r={textNode:void 0,numberNode:""},i=t.EVENTS.filter((function(t){return"error"!==t&&"end"!==t})),o=0;for(var a in t.STATE={BEGIN:o++,VALUE:o++,OPEN_OBJECT:o++,CLOSE_OBJECT:o++,OPEN_ARRAY:o++,CLOSE_ARRAY:o++,TEXT_ESCAPE:o++,STRING:o++,BACKSLASH:o++,END:o++,OPEN_KEY:o++,CLOSE_KEY:o++,TRUE:o++,TRUE2:o++,TRUE3:o++,FALSE:o++,FALSE2:o++,FALSE3:o++,FALSE4:o++,NULL:o++,NULL2:o++,NULL3:o++,NUMBER_DECIMAL_POINT:o++,NUMBER_DIGIT:o++},t.STATE)t.STATE[t.STATE[a]]=a;o=t.STATE;const s=9,l=10,u=13,c=32,h=34,d=43,f=44,p=45,g=46,m=48,v=57,y=58,b=69,x=91,w=92,C=93,k=97,S=98,_=101,D=102,A=108,T=110,F=114,L=115,P=116,O=117,M=123,B=125;function N(t){for(var e in r)t[e]=r[e]}Object.create||(Object.create=function(t){function e(){this.__proto__=t}return e.prototype=t,new e}),Object.getPrototypeOf||(Object.getPrototypeOf=function(t){return t.__proto__}),Object.keys||(Object.keys=function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e});var I=/[\\"\n]/g;function R(e){if(!(this instanceof R))return new R(e);var n=this;N(n),n.bufferCheckPosition=t.MAX_BUFFER_LENGTH,n.q=n.c=n.p="",n.opt=e||{},n.closed=n.closedRoot=n.sawRoot=!1,n.tag=n.error=null,n.state=o.BEGIN,n.stack=new Array,n.position=n.column=0,n.line=1,n.slashed=!1,n.unicodeI=0,n.unicodeS=null,n.depth=0,z(n,"onready")}R.prototype={end:function(){U(this)},write:function(e){var n=this;if(this.error)throw this.error;if(n.closed)return q(n,"Cannot write after close. Assign an onready handler.");if(null===e)return U(n);var i=0,a=e.charCodeAt(0),s=n.p;t.DEBUG&&console.log("write -> ["+e+"]");for(;a&&(s=a,n.c=a=e.charCodeAt(i++),s!==a?n.p=s:s=n.p,a);)switch(t.DEBUG&&console.log(i,a,t.STATE[n.state]),n.position++,a===l?(n.line++,n.column=0):n.column++,n.state){case o.BEGIN:a===M?n.state=o.OPEN_OBJECT:a===x?n.state=o.OPEN_ARRAY:K(a)||q(n,"Non-whitespace before {[.");continue;case o.OPEN_KEY:case o.OPEN_OBJECT:if(K(a))continue;if(n.state===o.OPEN_KEY)n.stack.push(o.CLOSE_KEY);else{if(a===B){z(n,"onopenobject"),this.depth++,z(n,"oncloseobject"),this.depth--,n.state=n.stack.pop()||o.VALUE;continue}n.stack.push(o.CLOSE_OBJECT)}a===h?n.state=o.STRING:q(n,'Malformed object key should start with "');continue;case o.CLOSE_KEY:case o.CLOSE_OBJECT:if(K(a))continue;n.state,o.CLOSE_KEY,a===y?(n.state===o.CLOSE_OBJECT?(n.stack.push(o.CLOSE_OBJECT),G(n,"onopenobject"),this.depth++):G(n,"onkey"),n.state=o.VALUE):a===B?(H(n,"oncloseobject"),this.depth--,n.state=n.stack.pop()||o.VALUE):a===f?(n.state===o.CLOSE_OBJECT&&n.stack.push(o.CLOSE_OBJECT),G(n),n.state=o.OPEN_KEY):q(n,"Bad object");continue;case o.OPEN_ARRAY:case o.VALUE:if(K(a))continue;if(n.state===o.OPEN_ARRAY){if(z(n,"onopenarray"),this.depth++,n.state=o.VALUE,a===C){z(n,"onclosearray"),this.depth--,n.state=n.stack.pop()||o.VALUE;continue}n.stack.push(o.CLOSE_ARRAY)}a===h?n.state=o.STRING:a===M?n.state=o.OPEN_OBJECT:a===x?n.state=o.OPEN_ARRAY:a===P?n.state=o.TRUE:a===D?n.state=o.FALSE:a===T?n.state=o.NULL:a===p?n.numberNode+="-":m<=a&&a<=v?(n.numberNode+=String.fromCharCode(a),n.state=o.NUMBER_DIGIT):q(n,"Bad value");continue;case o.CLOSE_ARRAY:if(a===f)n.stack.push(o.CLOSE_ARRAY),G(n,"onvalue"),n.state=o.VALUE;else if(a===C)H(n,"onclosearray"),this.depth--,n.state=n.stack.pop()||o.VALUE;else{if(K(a))continue;q(n,"Bad array")}continue;case o.STRING:void 0===n.textNode&&(n.textNode="");var u=i-1,c=n.slashed,E=n.unicodeI;t:for(;;){for(t.DEBUG&&console.log(i,a,t.STATE[n.state],c);E>0;)if(n.unicodeS+=String.fromCharCode(a),a=e.charCodeAt(i++),n.position++,4===E?(n.textNode+=String.fromCharCode(parseInt(n.unicodeS,16)),E=0,u=i-1):E++,!a)break t;if(a===h&&!c){n.state=n.stack.pop()||o.VALUE,n.textNode+=e.substring(u,i-1),n.position+=i-1-u;break}if(a===w&&!c&&(c=!0,n.textNode+=e.substring(u,i-1),n.position+=i-1-u,a=e.charCodeAt(i++),n.position++,!a))break;if(c){if(c=!1,a===T?n.textNode+="\n":a===F?n.textNode+="\r":a===P?n.textNode+="\t":a===D?n.textNode+="\f":a===S?n.textNode+="\b":a===O?(E=1,n.unicodeS=""):n.textNode+=String.fromCharCode(a),a=e.charCodeAt(i++),n.position++,u=i-1,a)continue;break}I.lastIndex=i;var N=I.exec(e);if(null===N){i=e.length+1,n.textNode+=e.substring(u,i-1),n.position+=i-1-u;break}if(i=N.index+1,!(a=e.charCodeAt(N.index))){n.textNode+=e.substring(u,i-1),n.position+=i-1-u;break}}n.slashed=c,n.unicodeI=E;continue;case o.TRUE:a===F?n.state=o.TRUE2:q(n,"Invalid true started with t"+a);continue;case o.TRUE2:a===O?n.state=o.TRUE3:q(n,"Invalid true started with tr"+a);continue;case o.TRUE3:a===_?(z(n,"onvalue",!0),n.state=n.stack.pop()||o.VALUE):q(n,"Invalid true started with tru"+a);continue;case o.FALSE:a===k?n.state=o.FALSE2:q(n,"Invalid false started with f"+a);continue;case o.FALSE2:a===A?n.state=o.FALSE3:q(n,"Invalid false started with fa"+a);continue;case o.FALSE3:a===L?n.state=o.FALSE4:q(n,"Invalid false started with fal"+a);continue;case o.FALSE4:a===_?(z(n,"onvalue",!1),n.state=n.stack.pop()||o.VALUE):q(n,"Invalid false started with fals"+a);continue;case o.NULL:a===O?n.state=o.NULL2:q(n,"Invalid null started with n"+a);continue;case o.NULL2:a===A?n.state=o.NULL3:q(n,"Invalid null started with nu"+a);continue;case o.NULL3:a===A?(z(n,"onvalue",null),n.state=n.stack.pop()||o.VALUE):q(n,"Invalid null started with nul"+a);continue;case o.NUMBER_DECIMAL_POINT:a===g?(n.numberNode+=".",n.state=o.NUMBER_DIGIT):q(n,"Leading zero not followed by .");continue;case o.NUMBER_DIGIT:m<=a&&a<=v?n.numberNode+=String.fromCharCode(a):a===g?(-1!==n.numberNode.indexOf(".")&&q(n,"Invalid number has two dots"),n.numberNode+="."):a===_||a===b?(-1===n.numberNode.indexOf("e")&&-1===n.numberNode.indexOf("E")||q(n,"Invalid number has two exponential"),n.numberNode+="e"):a===d||a===p?(s!==_&&s!==b&&q(n,"Invalid symbol in number"),n.numberNode+=String.fromCharCode(a)):(W(n),i--,n.state=n.stack.pop()||o.VALUE);continue;default:q(n,"Unknown state: "+n.state)}n.position>=n.bufferCheckPosition&&function(e){var n=Math.max(t.MAX_BUFFER_LENGTH,10),i=0;for(var o in r){var a=void 0===e[o]?0:e[o].length;a>n&&("text"===o?closeText(e):q(e,"Max buffer length exceeded: "+o)),i=Math.max(i,a)}e.bufferCheckPosition=t.MAX_BUFFER_LENGTH-i+e.position}(n);return n},resume:function(){return this.error=null,this},close:function(){return this.write(null)}};try{n=E}catch(t){n=function(){}}function j(t){if(!(this instanceof j))return new j(t);this._parser=new R(t),this.writable=!0,this.readable=!0,this.bytes_remaining=0,this.bytes_in_sequence=0,this.temp_buffs={2:new Buffer(2),3:new Buffer(3),4:new Buffer(4)},this.string="";var e=this;n.apply(e),this._parser.onend=function(){e.emit("end")},this._parser.onerror=function(t){e.emit("error",t),e._parser.error=null},i.forEach((function(t){Object.defineProperty(e,"on"+t,{get:function(){return e._parser["on"+t]},set:function(n){if(!n)return e.removeAllListeners(t),e._parser["on"+t]=n,n;e.on(t,n)},enumerable:!0,configurable:!1})}))}function z(e,n,r){t.INFO&&console.log("-- emit",n,r),e[n]&&e[n](r)}function H(t,e,n){G(t),z(t,e,n)}function G(t,e){t.textNode=function(t,e){if(void 0===e)return e;t.trim&&(e=e.trim());t.normalize&&(e=e.replace(/\s+/g," "));return e}(t.opt,t.textNode),void 0!==t.textNode&&z(t,e||"onvalue",t.textNode),t.textNode=void 0}function W(t){t.numberNode&&z(t,"onvalue",parseFloat(t.numberNode)),t.numberNode=""}function q(t,e){return G(t),e+="\nLine: "+t.line+"\nColumn: "+t.column+"\nChar: "+t.c,e=new Error(e),t.error=e,z(t,"onerror",e),t}function U(t){return t.state===o.VALUE&&0===t.depth||q(t,"Unexpected end"),G(t),t.c="",t.closed=!0,z(t,"onend"),R.call(t,t.opt),t}function K(t){return t===u||t===l||t===c||t===s}j.prototype=Object.create(n.prototype,{constructor:{value:j}}),j.prototype.write=function(t){t=new Buffer(t);for(var e=0;e<t.length;e++){var n=t[e];if(this.bytes_remaining>0){for(var r=0;r<this.bytes_remaining;r++)this.temp_buffs[this.bytes_in_sequence][this.bytes_in_sequence-this.bytes_remaining+r]=t[r];this.string=this.temp_buffs[this.bytes_in_sequence].toString(),this.bytes_in_sequence=this.bytes_remaining=0,e=e+r-1,this._parser.write(this.string),this.emit("data",this.string)}else if(0===this.bytes_remaining&&n>=128){if(n>=194&&n<=223&&(this.bytes_in_sequence=2),n>=224&&n<=239&&(this.bytes_in_sequence=3),n>=240&&n<=244&&(this.bytes_in_sequence=4),this.bytes_in_sequence+e>t.length){for(var i=0;i<=t.length-1-e;i++)this.temp_buffs[this.bytes_in_sequence][i]=t[e+i];return this.bytes_remaining=e+this.bytes_in_sequence-t.length,!0}this.string=t.slice(e,e+this.bytes_in_sequence).toString(),e=e+this.bytes_in_sequence-1,this._parser.write(this.string),this.emit("data",this.string)}else{for(var o=e;o<t.length&&!(t[o]>=128);o++);this.string=t.slice(e,o).toString(),this._parser.write(this.string),this.emit("data",this.string),e=o-1}}},j.prototype.end=function(t){return t&&t.length&&this._parser.write(t.toString()),this._parser.end(),!0},j.prototype.on=function(t,e){var r=this;return r._parser["on"+t]||-1===i.indexOf(t)||(r._parser["on"+t]=function(){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);e.splice(0,0,t),r.emit.apply(r,e)}),n.prototype.on.call(r,t,e)},j.prototype.destroy=function(){N(this._parser),this.emit("close")}}(e)}));function L(t){var e=0,n=function(t){var e,n,r,i=F.parser(),o=0,a=[],s=!1,l=!1;return i.onopenobject=function(i){var s={incomplete:!0};e||(e=s),n&&(a.push([r,n,l]),t&&(l?n.push(s):n[r]=s)),n=s,r=i,l=!1,++o},i.onkey=function(t){return r=t},i.onvalue=function(t){return l?n.push(t):n[r]=t},i.oncloseobject=function(){var e;if(delete n.incomplete,r=null,0==--o)s=!0;else{var i=n;e=a.pop(),r=e[0],n=e[1],l=e[2],t||(l?n.push(i):n[r]=i)}},i.onopenarray=function(){var i=[];i.incomplete=!0,e||(e=i),n&&(a.push([r,n,l]),t&&(l?n.push(i):n[r]=i)),n=i,l=!0,r=null,++o},i.onclosearray=function(){var e;if(delete n.incomplete,r=null,0==--o)s=!0;else{var i=n;e=a.pop(),r=e[0],n=e[1],l=e[2],t||(l?n.push(i):n[r]=i)}},{write:function(t){return i.write(t),e},done:function(){return s}}}(!0),r={pullAsync:function(i){return o(this,void 0,void 0,(function(){var o,s,u;return a(this,(function(a){switch(a.label){case 0:return o=t.slice(e,e+i),e+=i,[4,l(o,"text")];case 1:return s=a.sent(),u=n.write(s),r.result=u||{},[2,u]}}))}))},pullSync:function(i){var o=t.slice(e,e+i);e+=i;var a=u(o,"text"),s=n.write(a);return r.result=s||{},s},done:function(){return n.done()},eof:function(){return e>=t.size},result:{}};return r}var P=1024;function O(t,e){return o(this,void 0,void 0,(function(){var n,o,s,l;return a(this,(function(a){switch(a.label){case 0:return n=(e=e||{}).chunkSizeBytes||1024*P,[4,N(t,n)];case 1:return o=a.sent(),s=o.result.data,(l=new r.default(void 0!==e.name?e.name:s.databaseName)).version(s.databaseVersion).stores(function(t){for(var e={},n=0,r=t.tables;n<r.length;n++){var i=r[n];e[i.name]=i.schema}return e}(s)),[4,B(l,o,void 0!==e.name?i(i({},e),{acceptNameDiff:!0}):e)];case 2:return a.sent(),[2,l]}}))}))}function M(t){return o(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:e=L(t),n.label=1;case 1:return e.eof()?[3,3]:[4,e.pullAsync(5120)];case 2:return n.sent(),e.result.data&&e.result.data.data?(delete e.result.data.data,[3,3]):[3,1];case 3:return[2,e.result]}}))}))}function B(t,e,n){return o(this,void 0,void 0,(function(){function i(){return o(this,void 0,void 0,(function(){var e,i,o,u;return a(this,(function(g){switch(g.label){case 0:e=function(e){var i,o,s,l,u,c,g,m,v,y,b,x,w;return a(this,(function(a){switch(a.label){case 0:if(d.includes(e.tableName))return[2,"continue"];if(!e.rows)return[2,"break"];if(!e.rows.incomplete&&0===e.rows.length)return[2,"continue"];if(f&&r.default.ignoreTransaction((function(){return f(p)})),i=e.tableName,o=t.table(i),s=h.tables.filter((function(t){return t.name===i}))[0].schema,!o){if(n.acceptMissingTables)return[2,"continue"];throw new Error("Exported table ".concat(e.tableName," is missing in installed database"))}if(!n.acceptChangedPrimaryKey&&s.split(",")[0]!=o.schema.primKey.src)throw new Error("Primary key differs for table ".concat(e.tableName,". "));for(l=e.rows,u=[],c=0;c<l.length&&!(g=l[c]).incomplete;c++)u.push(C.revive(g));return m=n.filter,v=n.transform,y=m?e.inbound?u.filter((function(t){return m(i,t)})):u.filter((function(t){var e=t[0],n=t[1];return m(i,n,e)})):u,v&&(y=y.map(e.inbound?function(t){return v(i,t).value}:function(t){var e=t[0],n=t[1],r=v(i,n,e);return[r.key,r.value]})),b=e.inbound?[void 0,y]:[y.map((function(t){return t[0]})),u.map((function(t){return t[1]}))],x=b[0],w=b[1],n.overwriteValues?[4,o.bulkPut(w,x)]:[3,2];case 1:return a.sent(),[3,4];case 2:return[4,o.bulkAdd(w,x)];case 3:a.sent(),a.label=4;case 4:return p.completedRows+=u.length,u.incomplete||(p.completedTables+=1),l.splice(0,u.length),[2]}}))},i=0,o=h.data,g.label=1;case 1:return i<o.length?(u=o[i],[5,e(u)]):[3,4];case 2:if("break"===g.sent())return[3,4];g.label=3;case 3:return i++,[3,1];case 4:for(;h.data.length>0&&h.data[0].rows&&!h.data[0].rows.incomplete;)h.data.splice(0,1);return l.done()||l.eof()?[3,8]:c?(l.pullSync(s),[3,7]):[3,5];case 5:return[4,r.default.waitFor(l.pullAsync(s))];case 6:g.sent(),g.label=7;case 7:return[3,9];case 8:return[3,10];case 9:return[3,0];case 10:return[2]}}))}))}var s,l,u,c,h,d,f,p,g,m,v;return a(this,(function(o){switch(o.label){case 0:return s=(n=n||{}).chunkSizeBytes||1024*P,[4,N(e,s)];case 1:if(l=o.sent(),u=l.result,c="FileReaderSync"in self,h=u.data,d=n.skipTables?n.skipTables:[],!n.acceptNameDiff&&t.name!==h.databaseName)throw new Error("Name differs. Current database name is ".concat(t.name," but export is ").concat(h.databaseName));if(!n.acceptVersionDiff&&t.verno!==h.databaseVersion)throw new Error("Database version differs. Current database is in version ".concat(t.verno," but export is ").concat(h.databaseVersion));if(f=n.progressCallback,p={done:!1,completedRows:0,completedTables:0,totalRows:h.tables.reduce((function(t,e){return t+e.rowCount}),0),totalTables:h.tables.length},f&&r.default.ignoreTransaction((function(){return f(p)})),!n.clearTablesBeforeImport)return[3,5];g=0,m=t.tables,o.label=2;case 2:return g<m.length?(v=m[g],d.includes(v.name)?[3,4]:[4,v.clear()]):[3,5];case 3:o.sent(),o.label=4;case 4:return g++,[3,2];case 5:return n.noTransaction?[4,i()]:[3,7];case 6:return o.sent(),[3,9];case 7:return[4,t.transaction("rw",t.tables,i)];case 8:o.sent(),o.label=9;case 9:return p.done=!0,f&&r.default.ignoreTransaction((function(){return f(p)})),[2]}}))}))}function N(t,e){return o(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:n="slice"in t?L(t):t,i.label=1;case 1:return n.eof()?[3,3]:[4,n.pullAsync(e)];case 2:return i.sent(),n.result.data&&n.result.data.data?[3,3]:[3,1];case 3:if(!(r=n.result)||"dexie"!=r.formatName)throw new Error("Given file is not a dexie export");if(r.formatVersion>T)throw new Error("Format version ".concat(r.formatVersion," not supported"));if(!r.data)throw new Error("No data in export file");if(!r.data.databaseName)throw new Error("Missing databaseName in export file");if(!r.data.databaseVersion)throw new Error("Missing databaseVersion in export file");if(!r.data.tables)throw new Error("Missing tables in export file");return[2,n]}}))}))}r.default.prototype.export=function(t){return A(this,t)},r.default.prototype.import=function(t,e){return B(this,t,e)},r.default.import=function(t,e){return O(t,e)};var I=function(){throw new Error("This addon extends Dexie.prototype globally and does not have be included in Dexie constructor's addons options.")}},9825:(t,e,n)=>{var r;r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LayersStorage=void 0;var n=function(){function t(){}return t.prototype.setDb=function(t){this.db=t},t.prototype.setNotesLinksStorage=function(t){this.notesLinksStorage=t},t.prototype.add=function(t){this.db.layers.add(t)},t.prototype.getList=function(t){return this.db.layers.where("boardId").equals(t).toArray()},t.prototype.update=function(t){this.db.layers.update(t.id,t)},t.prototype.create=function(t,e){return this.db.layers.add({id:"layer_"+this.getRandomString(32),boardId:t,name:e})},t.prototype.getRandomString=function(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;r<t;r++)n+=e.charAt(Math.floor(62*Math.random()));return n},t.prototype.deleteForBoard=function(t){return this.db.layers.where("boardId").equals(t).delete()},t.prototype.delete=function(t){return this.notesLinksStorage.deleteForLayer(t),this.db.layers.where("id").equals(t).delete()},t}();e.LayersStorage=n}.apply(e,[n,e]),void 0===r||(t.exports=r)},9896:(t,e,n)=>{!function(t){"use strict";t.modeInfo=[{name:"APL",mime:"text/apl",mode:"apl",ext:["dyalog","apl"]},{name:"PGP",mimes:["application/pgp","application/pgp-encrypted","application/pgp-keys","application/pgp-signature"],mode:"asciiarmor",ext:["asc","pgp","sig"]},{name:"ASN.1",mime:"text/x-ttcn-asn",mode:"asn.1",ext:["asn","asn1"]},{name:"Asterisk",mime:"text/x-asterisk",mode:"asterisk",file:/^extensions\.conf$/i},{name:"Brainfuck",mime:"text/x-brainfuck",mode:"brainfuck",ext:["b","bf"]},{name:"C",mime:"text/x-csrc",mode:"clike",ext:["c","h","ino"]},{name:"C++",mime:"text/x-c++src",mode:"clike",ext:["cpp","c++","cc","cxx","hpp","h++","hh","hxx"],alias:["cpp"]},{name:"Cobol",mime:"text/x-cobol",mode:"cobol",ext:["cob","cpy","cbl"]},{name:"C#",mime:"text/x-csharp",mode:"clike",ext:["cs"],alias:["csharp","cs"]},{name:"Clojure",mime:"text/x-clojure",mode:"clojure",ext:["clj","cljc","cljx"]},{name:"ClojureScript",mime:"text/x-clojurescript",mode:"clojure",ext:["cljs"]},{name:"Closure Stylesheets (GSS)",mime:"text/x-gss",mode:"css",ext:["gss"]},{name:"CMake",mime:"text/x-cmake",mode:"cmake",ext:["cmake","cmake.in"],file:/^CMakeLists\.txt$/},{name:"CoffeeScript",mimes:["application/vnd.coffeescript","text/coffeescript","text/x-coffeescript"],mode:"coffeescript",ext:["coffee"],alias:["coffee","coffee-script"]},{name:"Common Lisp",mime:"text/x-common-lisp",mode:"commonlisp",ext:["cl","lisp","el"],alias:["lisp"]},{name:"Cypher",mime:"application/x-cypher-query",mode:"cypher",ext:["cyp","cypher"]},{name:"Cython",mime:"text/x-cython",mode:"python",ext:["pyx","pxd","pxi"]},{name:"Crystal",mime:"text/x-crystal",mode:"crystal",ext:["cr"]},{name:"CSS",mime:"text/css",mode:"css",ext:["css"]},{name:"CQL",mime:"text/x-cassandra",mode:"sql",ext:["cql"]},{name:"D",mime:"text/x-d",mode:"d",ext:["d"]},{name:"Dart",mimes:["application/dart","text/x-dart"],mode:"dart",ext:["dart"]},{name:"diff",mime:"text/x-diff",mode:"diff",ext:["diff","patch"]},{name:"Django",mime:"text/x-django",mode:"django"},{name:"Dockerfile",mime:"text/x-dockerfile",mode:"dockerfile",file:/^Dockerfile$/},{name:"DTD",mime:"application/xml-dtd",mode:"dtd",ext:["dtd"]},{name:"Dylan",mime:"text/x-dylan",mode:"dylan",ext:["dylan","dyl","intr"]},{name:"EBNF",mime:"text/x-ebnf",mode:"ebnf"},{name:"ECL",mime:"text/x-ecl",mode:"ecl",ext:["ecl"]},{name:"edn",mime:"application/edn",mode:"clojure",ext:["edn"]},{name:"Eiffel",mime:"text/x-eiffel",mode:"eiffel",ext:["e"]},{name:"Elm",mime:"text/x-elm",mode:"elm",ext:["elm"]},{name:"Embedded JavaScript",mime:"application/x-ejs",mode:"htmlembedded",ext:["ejs"]},{name:"Embedded Ruby",mime:"application/x-erb",mode:"htmlembedded",ext:["erb"]},{name:"Erlang",mime:"text/x-erlang",mode:"erlang",ext:["erl"]},{name:"Esper",mime:"text/x-esper",mode:"sql"},{name:"Factor",mime:"text/x-factor",mode:"factor",ext:["factor"]},{name:"FCL",mime:"text/x-fcl",mode:"fcl"},{name:"Forth",mime:"text/x-forth",mode:"forth",ext:["forth","fth","4th"]},{name:"Fortran",mime:"text/x-fortran",mode:"fortran",ext:["f","for","f77","f90","f95"]},{name:"F#",mime:"text/x-fsharp",mode:"mllike",ext:["fs"],alias:["fsharp"]},{name:"Gas",mime:"text/x-gas",mode:"gas",ext:["s"]},{name:"Gherkin",mime:"text/x-feature",mode:"gherkin",ext:["feature"]},{name:"GitHub Flavored Markdown",mime:"text/x-gfm",mode:"gfm",file:/^(readme|contributing|history)\.md$/i},{name:"Go",mime:"text/x-go",mode:"go",ext:["go"]},{name:"Groovy",mime:"text/x-groovy",mode:"groovy",ext:["groovy","gradle"],file:/^Jenkinsfile$/},{name:"HAML",mime:"text/x-haml",mode:"haml",ext:["haml"]},{name:"Haskell",mime:"text/x-haskell",mode:"haskell",ext:["hs"]},{name:"Haskell (Literate)",mime:"text/x-literate-haskell",mode:"haskell-literate",ext:["lhs"]},{name:"Haxe",mime:"text/x-haxe",mode:"haxe",ext:["hx"]},{name:"HXML",mime:"text/x-hxml",mode:"haxe",ext:["hxml"]},{name:"ASP.NET",mime:"application/x-aspx",mode:"htmlembedded",ext:["aspx"],alias:["asp","aspx"]},{name:"HTML",mime:"text/html",mode:"htmlmixed",ext:["html","htm","handlebars","hbs"],alias:["xhtml"]},{name:"HTTP",mime:"message/http",mode:"http"},{name:"IDL",mime:"text/x-idl",mode:"idl",ext:["pro"]},{name:"Pug",mime:"text/x-pug",mode:"pug",ext:["jade","pug"],alias:["jade"]},{name:"Java",mime:"text/x-java",mode:"clike",ext:["java"]},{name:"Java Server Pages",mime:"application/x-jsp",mode:"htmlembedded",ext:["jsp"],alias:["jsp"]},{name:"JavaScript",mimes:["text/javascript","text/ecmascript","application/javascript","application/x-javascript","application/ecmascript"],mode:"javascript",ext:["js"],alias:["ecmascript","js","node"]},{name:"JSON",mimes:["application/json","application/x-json"],mode:"javascript",ext:["json","map"],alias:["json5"]},{name:"JSON-LD",mime:"application/ld+json",mode:"javascript",ext:["jsonld"],alias:["jsonld"]},{name:"JSX",mime:"text/jsx",mode:"jsx",ext:["jsx"]},{name:"Jinja2",mime:"text/jinja2",mode:"jinja2",ext:["j2","jinja","jinja2"]},{name:"Julia",mime:"text/x-julia",mode:"julia",ext:["jl"],alias:["jl"]},{name:"Kotlin",mime:"text/x-kotlin",mode:"clike",ext:["kt"]},{name:"LESS",mime:"text/x-less",mode:"css",ext:["less"]},{name:"LiveScript",mime:"text/x-livescript",mode:"livescript",ext:["ls"],alias:["ls"]},{name:"Lua",mime:"text/x-lua",mode:"lua",ext:["lua"]},{name:"Markdown",mime:"text/x-markdown",mode:"markdown",ext:["markdown","md","mkd"]},{name:"mIRC",mime:"text/mirc",mode:"mirc"},{name:"MariaDB SQL",mime:"text/x-mariadb",mode:"sql"},{name:"Mathematica",mime:"text/x-mathematica",mode:"mathematica",ext:["m","nb","wl","wls"]},{name:"Modelica",mime:"text/x-modelica",mode:"modelica",ext:["mo"]},{name:"MUMPS",mime:"text/x-mumps",mode:"mumps",ext:["mps"]},{name:"MS SQL",mime:"text/x-mssql",mode:"sql"},{name:"mbox",mime:"application/mbox",mode:"mbox",ext:["mbox"]},{name:"MySQL",mime:"text/x-mysql",mode:"sql"},{name:"Nginx",mime:"text/x-nginx-conf",mode:"nginx",file:/nginx.*\.conf$/i},{name:"NSIS",mime:"text/x-nsis",mode:"nsis",ext:["nsh","nsi"]},{name:"NTriples",mimes:["application/n-triples","application/n-quads","text/n-triples"],mode:"ntriples",ext:["nt","nq"]},{name:"Objective-C",mime:"text/x-objectivec",mode:"clike",ext:["m"],alias:["objective-c","objc"]},{name:"Objective-C++",mime:"text/x-objectivec++",mode:"clike",ext:["mm"],alias:["objective-c++","objc++"]},{name:"OCaml",mime:"text/x-ocaml",mode:"mllike",ext:["ml","mli","mll","mly"]},{name:"Octave",mime:"text/x-octave",mode:"octave",ext:["m"]},{name:"Oz",mime:"text/x-oz",mode:"oz",ext:["oz"]},{name:"Pascal",mime:"text/x-pascal",mode:"pascal",ext:["p","pas"]},{name:"PEG.js",mime:"null",mode:"pegjs",ext:["jsonld"]},{name:"Perl",mime:"text/x-perl",mode:"perl",ext:["pl","pm"]},{name:"PHP",mimes:["text/x-php","application/x-httpd-php","application/x-httpd-php-open"],mode:"php",ext:["php","php3","php4","php5","php7","phtml"]},{name:"Pig",mime:"text/x-pig",mode:"pig",ext:["pig"]},{name:"Plain Text",mime:"text/plain",mode:"null",ext:["txt","text","conf","def","list","log"]},{name:"PLSQL",mime:"text/x-plsql",mode:"sql",ext:["pls"]},{name:"PostgreSQL",mime:"text/x-pgsql",mode:"sql"},{name:"PowerShell",mime:"application/x-powershell",mode:"powershell",ext:["ps1","psd1","psm1"]},{name:"Properties files",mime:"text/x-properties",mode:"properties",ext:["properties","ini","in"],alias:["ini","properties"]},{name:"ProtoBuf",mime:"text/x-protobuf",mode:"protobuf",ext:["proto"]},{name:"Python",mime:"text/x-python",mode:"python",ext:["BUILD","bzl","py","pyw"],file:/^(BUCK|BUILD)$/},{name:"Puppet",mime:"text/x-puppet",mode:"puppet",ext:["pp"]},{name:"Q",mime:"text/x-q",mode:"q",ext:["q"]},{name:"R",mime:"text/x-rsrc",mode:"r",ext:["r","R"],alias:["rscript"]},{name:"reStructuredText",mime:"text/x-rst",mode:"rst",ext:["rst"],alias:["rst"]},{name:"RPM Changes",mime:"text/x-rpm-changes",mode:"rpm"},{name:"RPM Spec",mime:"text/x-rpm-spec",mode:"rpm",ext:["spec"]},{name:"Ruby",mime:"text/x-ruby",mode:"ruby",ext:["rb"],alias:["jruby","macruby","rake","rb","rbx"]},{name:"Rust",mime:"text/x-rustsrc",mode:"rust",ext:["rs"]},{name:"SAS",mime:"text/x-sas",mode:"sas",ext:["sas"]},{name:"Sass",mime:"text/x-sass",mode:"sass",ext:["sass"]},{name:"Scala",mime:"text/x-scala",mode:"clike",ext:["scala"]},{name:"Scheme",mime:"text/x-scheme",mode:"scheme",ext:["scm","ss"]},{name:"SCSS",mime:"text/x-scss",mode:"css",ext:["scss"]},{name:"Shell",mimes:["text/x-sh","application/x-sh"],mode:"shell",ext:["sh","ksh","bash"],alias:["bash","sh","zsh"],file:/^PKGBUILD$/},{name:"Sieve",mime:"application/sieve",mode:"sieve",ext:["siv","sieve"]},{name:"Slim",mimes:["text/x-slim","application/x-slim"],mode:"slim",ext:["slim"]},{name:"Smalltalk",mime:"text/x-stsrc",mode:"smalltalk",ext:["st"]},{name:"Smarty",mime:"text/x-smarty",mode:"smarty",ext:["tpl"]},{name:"Solr",mime:"text/x-solr",mode:"solr"},{name:"SML",mime:"text/x-sml",mode:"mllike",ext:["sml","sig","fun","smackspec"]},{name:"Soy",mime:"text/x-soy",mode:"soy",ext:["soy"],alias:["closure template"]},{name:"SPARQL",mime:"application/sparql-query",mode:"sparql",ext:["rq","sparql"],alias:["sparul"]},{name:"Spreadsheet",mime:"text/x-spreadsheet",mode:"spreadsheet",alias:["excel","formula"]},{name:"SQL",mime:"text/x-sql",mode:"sql",ext:["sql"]},{name:"SQLite",mime:"text/x-sqlite",mode:"sql"},{name:"Squirrel",mime:"text/x-squirrel",mode:"clike",ext:["nut"]},{name:"Stylus",mime:"text/x-styl",mode:"stylus",ext:["styl"]},{name:"Swift",mime:"text/x-swift",mode:"swift",ext:["swift"]},{name:"sTeX",mime:"text/x-stex",mode:"stex"},{name:"LaTeX",mime:"text/x-latex",mode:"stex",ext:["text","ltx","tex"],alias:["tex"]},{name:"SystemVerilog",mime:"text/x-systemverilog",mode:"verilog",ext:["v","sv","svh"]},{name:"Tcl",mime:"text/x-tcl",mode:"tcl",ext:["tcl"]},{name:"Textile",mime:"text/x-textile",mode:"textile",ext:["textile"]},{name:"TiddlyWiki",mime:"text/x-tiddlywiki",mode:"tiddlywiki"},{name:"Tiki wiki",mime:"text/tiki",mode:"tiki"},{name:"TOML",mime:"text/x-toml",mode:"toml",ext:["toml"]},{name:"Tornado",mime:"text/x-tornado",mode:"tornado"},{name:"troff",mime:"text/troff",mode:"troff",ext:["1","2","3","4","5","6","7","8","9"]},{name:"TTCN",mime:"text/x-ttcn",mode:"ttcn",ext:["ttcn","ttcn3","ttcnpp"]},{name:"TTCN_CFG",mime:"text/x-ttcn-cfg",mode:"ttcn-cfg",ext:["cfg"]},{name:"Turtle",mime:"text/turtle",mode:"turtle",ext:["ttl"]},{name:"TypeScript",mime:"application/typescript",mode:"javascript",ext:["ts"],alias:["ts"]},{name:"TypeScript-JSX",mime:"text/typescript-jsx",mode:"jsx",ext:["tsx"],alias:["tsx"]},{name:"Twig",mime:"text/x-twig",mode:"twig"},{name:"Web IDL",mime:"text/x-webidl",mode:"webidl",ext:["webidl"]},{name:"VB.NET",mime:"text/x-vb",mode:"vb",ext:["vb"]},{name:"VBScript",mime:"text/vbscript",mode:"vbscript",ext:["vbs"]},{name:"Velocity",mime:"text/velocity",mode:"velocity",ext:["vtl"]},{name:"Verilog",mime:"text/x-verilog",mode:"verilog",ext:["v"]},{name:"VHDL",mime:"text/x-vhdl",mode:"vhdl",ext:["vhd","vhdl"]},{name:"Vue.js Component",mimes:["script/x-vue","text/x-vue"],mode:"vue",ext:["vue"]},{name:"XML",mimes:["application/xml","text/xml"],mode:"xml",ext:["xml","xsl","xsd","svg"],alias:["rss","wsdl","xsd"]},{name:"XQuery",mime:"application/xquery",mode:"xquery",ext:["xy","xquery"]},{name:"Yacas",mime:"text/x-yacas",mode:"yacas",ext:["ys"]},{name:"YAML",mimes:["text/x-yaml","text/yaml"],mode:"yaml",ext:["yaml","yml"],alias:["yml"]},{name:"Z80",mime:"text/x-z80",mode:"z80",ext:["z80"]},{name:"mscgen",mime:"text/x-mscgen",mode:"mscgen",ext:["mscgen","mscin","msc"]},{name:"xu",mime:"text/x-xu",mode:"mscgen",ext:["xu"]},{name:"msgenny",mime:"text/x-msgenny",mode:"mscgen",ext:["msgenny"]},{name:"WebAssembly",mime:"text/webassembly",mode:"wast",ext:["wat","wast"]}];for(var e=0;e<t.modeInfo.length;e++){var n=t.modeInfo[e];n.mimes&&(n.mime=n.mimes[0])}t.findModeByMIME=function(e){e=e.toLowerCase();for(var n=0;n<t.modeInfo.length;n++){var r=t.modeInfo[n];if(r.mime==e)return r;if(r.mimes)for(var i=0;i<r.mimes.length;i++)if(r.mimes[i]==e)return r}return/\+xml$/.test(e)?t.findModeByMIME("application/xml"):/\+json$/.test(e)?t.findModeByMIME("application/json"):void 0},t.findModeByExtension=function(e){e=e.toLowerCase();for(var n=0;n<t.modeInfo.length;n++){var r=t.modeInfo[n];if(r.ext)for(var i=0;i<r.ext.length;i++)if(r.ext[i]==e)return r}},t.findModeByFileName=function(e){for(var n=0;n<t.modeInfo.length;n++){var r=t.modeInfo[n];if(r.file&&r.file.test(e))return r}var i=e.lastIndexOf("."),o=i>-1&&e.substring(i+1,e.length);if(o)return t.findModeByExtension(o)},t.findModeByName=function(e){e=e.toLowerCase();for(var n=0;n<t.modeInfo.length;n++){var r=t.modeInfo[n];if(r.name.toLowerCase()==e)return r;if(r.alias)for(var i=0;i<r.alias.length;i++)if(r.alias[i].toLowerCase()==e)return r}}}(n(1719))}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,n),o.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};n(7951)})();